{"version":3,"sources":["webpack:///./node_modules/@mdf/cube/src/bizmodel/billmaker.ts"],"names":["selectgrid","unselectgrid","selectall","unselectall","scress","sure","position","fresh","item","help","out","search","load","formula","str","srcData","dstData","Function","func","billmaker","billNo","viewmodel","params","cache","get","RuleCache","mainId","mainAndChildId","childForId","childId","type","postData","indexes","HeadData","getData","HeadSelectData","getSelectedRows","forEach","push","length","rulePolicyList","head","HeadRuleData","i","unselect","cb","utils","alert","isSingleVoucher","headIds","code","callback","err","suc","message","data","headId","items","subItem","bodyGridModel","setDataSource","getState","bodyselectindexes","bodyIds","BodySelectIds","select","cSvcUrl","cHttpMethod","rowindex","indexOf","unselectdata","getRowsByIndexes","rowIndexes","BodyData","unselectId","unselectMainId","index","_err","ids","PropertyName","headName","hIds","headData","mainIds","selectData","childIds","rest","DynamicProxy","create","makeBill","url","method","execute","FilterCache","hasFilter","postdata","condition","this","showSearch","headPropertyName","init","undefined","menu_url","queryString","makeBilltype","self","proxy","getMeta","options","uniform","Object","assign","result","console","error","requireInner","vmurl","defaultParams","viewmeta","cBillNo","subId","cSubId","vm","viewmodels","vmName","extend","getParams","MakeBill","bodyPropertyName","on","args","do","rows","cBillName","act","action","columnsetting","namespace","biz","common"],"mappings":"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","file":"public/javascripts/7.bundle.js?_=d566ad53-de75-49ba-965f-44adb4dd2a09","sourcesContent":["import * as common from './common';\n\nconst formula = function (str, srcData, dstData) {\n  if (!str) return true;\n  const func = new Function('src', 'dst', 'return ' + str); // eslint-disable-line no-new-func\n  return func(srcData, dstData);\n}\n\nconst billmaker = (function () {\n  // 选择\n  const selectgrid = function (billNo, viewmodel, params) {\n    const cache = viewmodel.get('MakeBillCache');\n    const RuleCache = viewmodel.get('RuleCache');\n    const mainId = RuleCache.mainAndChildId.mainId;\n    const childForId = RuleCache.mainAndChildId.childForId;\n    const childId = RuleCache.mainAndChildId.childId;\n    if (params.type === 'head') {\n      const postData: AnyObject = {}; const allIds = []; const headIds = []; const indexes = [];\n      const params = { cSvcUrl: 'makeBill/getBodyData', cHttpMethod: 'POST' };\n      const HeadData = viewmodel.get(viewmodel.get('Head')).getData();\n      const HeadSelectData = viewmodel.get(viewmodel.get('Head')).getSelectedRows();\n      let selectRowData;\n      HeadSelectData.forEach(function (item) {\n        allIds.push(item[mainId]);\n        if (cache[item[mainId]]) return;\n        headIds.push(item[mainId]);\n        selectRowData = item;\n      });\n      if (HeadSelectData.length > 1) {\n        if (!formula(RuleCache.rulePolicyList.head[0], RuleCache.HeadRuleData, selectRowData)) {\n          for (let i = 0; i < HeadData.length; i++) {\n            if (HeadData[i][mainId] === headIds[0])\n              indexes.push(i);\n          }\n          viewmodel.get(viewmodel.get('Head')).unselect(indexes);\n          cb.utils.alert('所选数据不符合生单规则，请重新选择数据！');\n          return;\n        }\n      }\n      if (HeadSelectData.length === 1)\n        RuleCache.HeadRuleData = selectRowData;\n      // 是否单表结构\n      if (RuleCache.isSingleVoucher === 0) {\n        postData.headIds = headIds;\n        postData.code = viewmodel.get('MakeBill').code;\n        const callback = function (err, suc) {\n          if (err && err.message) {\n            cb.utils.alert(err.message, 'error');\n            return;\n          }\n          suc.forEach(function (item) {\n            if (!cache[item[childForId]])\n              cache[item[childForId]] = [];\n            cache[item[childForId]].push(item);\n          });\n          const data = [];\n          allIds.forEach(function (headId) {\n            const items = cache[headId];\n            if (items)\n              items.forEach(function (subItem) {\n                data.push(subItem)\n              });\n          });\n          const bodyGridModel = viewmodel.get(viewmodel.get('Body'));\n          bodyGridModel.setDataSource(data);\n          if (!bodyGridModel.getState('showCheckbox')) return;\n          const bodyselectindexes = [];\n          for (const bodyIds in cache.BodySelectIds) {\n            for (let i = 0; i < data.length; i++) {\n              cache.BodySelectIds[bodyIds].forEach(function (item) {\n                if (item === data[i][mainId.mainId])\n                  bodyselectindexes.push(i);\n              });\n            }\n            viewmodel.get(viewmodel.get('Body')).select(bodyselectindexes);\n          }\n        }\n        if (headIds.length)\n          common.doProxy(params, callback, postData);\n        else\n          callback(null, []);\n      }\n    } else {\n      const BodyData = viewmodel.get(viewmodel.get('Body')).getSelectedRows();\n      BodyData.forEach(function (rowindex) {\n        if (!cache.BodySelectIds[rowindex[childForId]]) {\n          cache.BodySelectIds[rowindex[childForId]] = [];\n          cache.BodySelectIds[rowindex[childForId]].push(rowindex[childId]);\n        } else {\n          if (cache.BodySelectIds[rowindex[childForId]].indexOf(rowindex[childId]) === -1)\n            cache.BodySelectIds[rowindex[childForId]].push(rowindex[childId]);\n        }\n      });\n    }\n  }\n  // 取消选择\n  const unselectgrid = function (billNo, viewmodel, params) {\n    const cache = viewmodel.get('MakeBillCache');\n    const RuleCache = viewmodel.get('RuleCache');\n    const mainId = RuleCache.mainAndChildId.mainId;\n    const childForId = RuleCache.mainAndChildId.childForId;\n    const childId = RuleCache.mainAndChildId.childId;\n    if (params.type === 'head' && RuleCache.isSingleVoucher === 0) {\n      const unselectdata = viewmodel.get(viewmodel.get('Head')).getRowsByIndexes(params.rowIndexes);\n      if (cache[unselectdata[0][mainId]])\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete cache[unselectdata[0][mainId]]\n      if (cache.BodySelectIds[unselectdata[0][mainId]])\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete cache.BodySelectIds[unselectdata[0][mainId]]\n      const HeadData = viewmodel.get(viewmodel.get('Head')).getSelectedRows();\n      const headIds = [];\n      HeadData.forEach(function (item) {\n        headIds.push(item[mainId]);\n      });\n      if (headIds.length !== 0) {\n        const data = [];\n        headIds.forEach(function (headId) {\n          const items = cache[headId];\n          if (items)\n            items.forEach(function (subItem) {\n              data.push(subItem)\n            });\n        });\n        const bodyGridModel = viewmodel.get(viewmodel.get('Body'));\n        bodyGridModel.setDataSource(data);\n        if (!bodyGridModel.getState('showCheckbox')) return;\n        const bodyselectindexes = [];\n        for (const bodyIds in cache.BodySelectIds) {\n          for (let i = 0; i < data.length; i++) {\n            cache.BodySelectIds[bodyIds].forEach(function (item) {\n              if (item === data[i][mainId])\n                bodyselectindexes.push(i);\n            });\n          }\n          viewmodel.get(viewmodel.get('Body')).select(bodyselectindexes);\n        }\n      } else {\n        viewmodel.get(viewmodel.get('Body')).setDataSource([]);\n      }\n    } else {\n      const BodyData = viewmodel.get(viewmodel.get('Body')).getData();\n      const BodySelectData = viewmodel.get(viewmodel.get('Body')).getSelectedRows();\n      if (BodySelectData.length === 0) {\n        cache.BodySelectIds = {};\n        return;\n      }\n      const unselectId = BodyData[params.rowIndexes[0]][childId];\n      const unselectMainId = BodyData[params.rowIndexes[0]][childForId];\n      for (const bodyIds in cache.BodySelectIds) {\n        if (bodyIds === unselectMainId)\n          cache.BodySelectIds[bodyIds].push(unselectId);\n      }\n    }\n  }\n  // 全选\n  const selectall = function (billNo, viewmodel, params) {\n    let cache = viewmodel.get('MakeBillCache');\n    const RuleCache = viewmodel.get('RuleCache');\n    const mainId = RuleCache.mainAndChildId.mainId;\n    const childForId = RuleCache.mainAndChildId.childForId;\n    const childId = RuleCache.mainAndChildId.childId;\n    if (params.type === 'head') {\n      const postData: AnyObject = {}; const allIds = []; const headIds = []; const indexes = [];\n      const params = { cSvcUrl: 'makeBill/getBodyData', cHttpMethod: 'POST' };\n      const HeadData = viewmodel.get(viewmodel.get('Head')).getData();\n      // const BodyData = viewmodel.get(viewmodel.get('Body')).getSelectedRows();\n      // 全选时，数据重新从服务端获取。清除缓存中的数据。\n      const BodySelectIds = cache.BodySelectIds;\n      cache = {};\n      cache.BodySelectIds = BodySelectIds;\n      if (RuleCache.HeadRuleData)\n        delete RuleCache.HeadRuleData;\n\n      HeadData.forEach(function (item, index) {\n        if (RuleCache.HeadRuleData) {\n          if (!formula(RuleCache.rulePolicyList.head[0], RuleCache.HeadRuleData, item)) {\n            headIds.push(item[mainId]);\n            if (RuleCache.HeadRuleData[mainId] !== item[mainId]) indexes.push(index);\n            return;\n          }\n          allIds.push(item[mainId]);\n        } else {\n          RuleCache.HeadRuleData = item;\n          allIds.push(item[mainId]);\n        }\n      });\n      if (indexes.length > 0) {\n        viewmodel.get(viewmodel.get('Head')).unselect(indexes);\n        cb.utils.alert('所选数据中存在不符合生单规则的数据！');\n        return\n      }\n      // 是否单表结构\n      if (RuleCache.isSingleVoucher === 0) {\n        postData.headIds = allIds;\n        postData.code = viewmodel.get('MakeBill').code;\n        const callback = function (_err, suc) {\n          suc.forEach(function (item) {\n            if (!cache[item[childForId]])\n              cache[item[childForId]] = [];\n            cache[item[childForId]].push(item);\n          });\n          const data = [];\n          allIds.forEach(function (headId) {\n            if (cache[headId]) {\n              cache[headId].forEach(function (subItem) {\n                data.push(subItem)\n              });\n            }\n          });\n          const bodyGridModel = viewmodel.get(viewmodel.get('Body'));\n          bodyGridModel.setDataSource(data);\n          if (!bodyGridModel.getState('showCheckbox')) return;\n          const bodyselectindexes = [];\n          for (const bodyIds in cache.BodySelectIds) {\n            for (let i = 0; i < data.length; i++) {\n              cache.BodySelectIds[bodyIds].forEach(function (item) {\n                if (item === data[i][mainId])\n                  bodyselectindexes.push(i);\n              });\n            }\n            viewmodel.get(viewmodel.get('Body')).select(bodyselectindexes);\n          }\n        }\n        common.doProxy(params, callback, postData);\n      }\n    } else {\n      const BodyData = viewmodel.get(viewmodel.get('Body')).getData();\n      if (BodyData !== null) {\n        BodyData.forEach(function (rowindex) {\n          if (!cache.BodySelectIds[rowindex[childForId]]) {\n            cache.BodySelectIds[rowindex[childForId]] = [];\n            cache.BodySelectIds[rowindex[childForId]].push(rowindex[childId]);\n          } else {\n            if (cache.BodySelectIds[rowindex[childForId]].indexOf(rowindex[childId]) === -1)\n              cache.BodySelectIds[rowindex[childForId]].push(rowindex[childId]);\n          }\n        });\n      }\n    }\n  }\n  // 全消\n  const unselectall = function (billNo, viewmodel, params) {\n    const cache = viewmodel.get('MakeBillCache');\n    const RuleCache = viewmodel.get('RuleCache');\n    const HeadData = viewmodel.get(viewmodel.get('Head')).getData();\n    HeadData.forEach(function (item) {\n      if (cache[item[RuleCache.mainAndChildId.mainId]])\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete cache[item[RuleCache.mainAndChildId.mainId]];\n    });\n    if (params.type === 'head' && RuleCache.isSingleVoucher === 0)\n      viewmodel.get(viewmodel.get('Body')).setDataSource([]);\n  }\n  // 筛选\n  const scress = function (billNo, viewmodel, params) {\n  }\n  // 确定\n  const sure = function (billNo, viewmodel, params) {\n    const RuleCache = viewmodel.get('RuleCache');\n    let childId = RuleCache.mainAndChildId.childId;\n    const ids = []; let PropertyName = '';\n    const postData: AnyObject = {};\n    postData.code = viewmodel.get('MakeBill').code;\n    const proxyUrl = '/makeBill/pullVoucher';\n    // //是否推单\n    // if (viewmodel.get('RuleCache').makeBilltype === 'push')\n    //   proxyUrl = '/makeBill/pushVoucher';\n    // 是否单表结构\n    if (RuleCache.isSingleVoucher === 0) {\n      PropertyName = viewmodel.get('Body');\n      const headName = viewmodel.get('Head');\n      const headId = RuleCache.mainAndChildId.mainId;\n      const hIds = [];\n      const headData = viewmodel.get(headName).getSelectedRows();\n      if (headData.length === 0) {\n        cb.utils.alert('未选择数据，请选择数据后重试！');\n        return;\n      }\n      for (let i = 0; i < headData.length; i++) {\n        hIds.push(headData[i][headId]);\n      }\n      postData.mainIds = hIds;\n    } else {\n      childId = RuleCache.mainAndChildId.mainId;\n      PropertyName = viewmodel.get('Head');\n    }\n    const selectData = viewmodel.get(PropertyName).getSelectedRows();\n    if (selectData.length === 0) {\n      cb.utils.alert('未选择数据，请选择数据后重试！');\n      return;\n    }\n    for (let i = 0; i < selectData.length; i++) {\n      ids.push(selectData[i][childId]);\n    }\n    postData.childIds = ids;\n    const proxy = cb.rest.DynamicProxy.create({\n      makeBill: { url: proxyUrl, method: 'POST' }\n    });\n    proxy.makeBill(postData, function (err, suc) {\n      if (err) {\n        if (err.message)\n          cb.utils.alert('出错啦后台->' + err.message);\n        else\n          cb.utils.alert('出错啦后台->' + err.code);\n        return;\n      }\n      // if (viewmodel.get('RuleCache').makeBilltype === 'pull') {\n      viewmodel.execute('afterOkClick', { data: suc });\n      viewmodel.execute('close');\n      // } else {\n      //   cb.utils.alert('生单成功!');\n      //   viewmodel.execute('close');\n      // }\n    });\n  }\n  // 定位\n  const position = function (billNo, viewmodel, params) {\n  }\n  // 刷新\n  const fresh = function (billNo, viewmodel, params) {\n    const FilterCache = viewmodel.get('FilterCache');\n    if (FilterCache.hasFilter) {\n      viewmodel.get(viewmodel.get('Body')).setDataSource([]);\n      const postdata = { condition: FilterCache.condition };\n      this.search(billNo, viewmodel, postdata);\n    } else {\n      this.load(billNo, viewmodel, params);\n    }\n  }\n  // 栏目设置\n  const item = function (billNo, viewmodel, params) {\n  }\n  // 帮助\n  const help = function (billNo, viewmodel, params) {\n  }\n  // 退出\n  const out = function (billNo, viewmodel, params) {\n    viewmodel.execute('close');\n  }\n  // 过滤\n  const search = (billNo, viewmodel, params) => {\n    delete params.showSearch;\n    const FilterCache = viewmodel.get('FilterCache');\n    const Property = { cSvcUrl: 'makeBill/getMakeVoucherShowData', cHttpMethod: 'POST' };\n    const callback = function (_err, suc) {\n      const cache = viewmodel.get('MakeBillCache');\n      cache.BodySelectIds = {};\n      const headPropertyName = viewmodel.get('Head');\n      viewmodel.get(headPropertyName).setDataSource(suc.headData);\n    }\n    FilterCache.condition = params.condition;\n    params.code = viewmodel.get('MakeBill').code;\n    common.doProxy(Property, callback, params);\n  }\n  const load = (billNo, viewmodel, params) => {\n    const FilterCache = viewmodel.get('FilterCache');\n    if (viewmodel.get('MakeBill').code == null || viewmodel.get('MakeBill').code == '') {\n      FilterCache.hasFilter = false;\n      const Property = { cSvcUrl: 'makeBill/getMakeVoucherShowData', cHttpMethod: 'POST' };\n      const callback = function (_err, suc) {\n        const cache = viewmodel.get('MakeBillCache');\n        cache.BodySelectIds = {};\n        const headPropertyName = viewmodel.get('Head');\n        viewmodel.get(headPropertyName).setDataSource(suc.headData);\n      }\n      params.code = viewmodel.get('MakeBill').code;\n      common.doProxy(Property, callback, params);\n    } else {\n      FilterCache.hasFilter = true;\n    }\n  }\n  return {\n    init: function (billNo, params, callback) {\n      if (params.menu_url !== undefined) {\n        const queryString = new cb.utils.queryString(params.menu_url);\n        params.code = queryString.get('code');\n        params.makeBilltype = queryString.get('makeBilltype');\n      }\n      const self = this;\n      const proxy = cb.rest.DynamicProxy.create({\n        getMeta: { url: '/meta', method: 'POST', options: { uniform: false } }\n      });\n      const postData = Object.assign({}, params, { type: 'billmaker', billNo: billNo, code: params.code, makeBilltype: params.makeBilltype })\n      proxy.getMeta(postData, function (err, result) {\n        if (err) {\n          console.error(err);\n          return;\n        }\n        // var func = new Function(result.vm);\n        // func();\n        cb.requireInner(result.vmurl, function () {\n          const defaultParams = {\n            billNo: result.viewmeta.cBillNo,\n            subId: result.viewmeta.cSubId\n          };\n          if (!result.vmurl && result.vm)\n            new Function(result.vm)();\n          const vm = new cb.viewmodels[result.viewmeta.vmName]();\n          cb.utils.extend(true, vm.getParams(), defaultParams, params);\n          const RuleCache = vm.get('RuleCache');\n          const MakeBill = vm.get('MakeBill');\n          MakeBill.code = params.code;\n          MakeBill.makeBilltype = params.makeBilltype;\n          RuleCache.isSingleVoucher = result.makeBill.isSingleVoucher;\n          RuleCache.mainAndChildId = result.makeBill.mainAndChildId;\n          RuleCache.rulePolicyList = result.makeBill.rulePolicyList;\n          RuleCache.makeBilltype = params.makeBilltype;\n          // 是否单表 0双表  1单表\n          if (RuleCache.isSingleVoucher === 0) {\n            const bodyPropertyName = vm.get('Body');\n            vm.get(bodyPropertyName).on('afterSelect', function (rowIndexes) {\n              const args: AnyObject = {};\n              args.rowIndexes = rowIndexes;\n              args.type = 'body';\n              self.do('selectgrid', vm, args);\n            });\n            vm.get(bodyPropertyName).on('afterUnselect', function (rowIndexes) {\n              const args: AnyObject = {};\n              args.rowIndexes = rowIndexes;\n              args.type = 'body';\n              self.do('unselectgrid', vm, args);\n            });\n            vm.get(bodyPropertyName).on('afterSelectAll', function (rows) {\n              const args: AnyObject = {};\n              args.rows = rows;\n              args.type = 'body';\n              self.do('selectall', vm, args);\n            });\n            vm.get(bodyPropertyName).on('afterUnselectAll', function () {\n              const args: AnyObject = {};\n              args.type = 'body';\n              self.do('unselectall', vm, args);\n            });\n          }\n          const headPropertyName = vm.get('Head');\n          vm.get(headPropertyName).on('afterSelect', function (rowIndexes) {\n            const args: AnyObject = {};\n            args.rowIndexes = rowIndexes;\n            args.type = 'head';\n            self.do('selectgrid', vm, args);\n          });\n          vm.get(headPropertyName).on('afterUnselect', function (rowIndexes) {\n            const args: AnyObject = {};\n            args.rowIndexes = rowIndexes;\n            args.type = 'head';\n            self.do('unselectgrid', vm, args);\n          });\n          vm.get(headPropertyName).on('afterSelectAll', function (rows) {\n            const args: AnyObject = {};\n            args.rows = rows;\n            args.type = 'head';\n            self.do('selectall', vm, args);\n          });\n          vm.get(headPropertyName).on('afterUnselectAll', function () {\n            const args: AnyObject = {};\n            args.type = 'head';\n            self.do('unselectall', vm, args);\n          });\n          callback(vm, result.viewmeta, result.viewmeta.cBillName);\n          self.do('load', vm);\n        })\n      });\n    },\n    do: function (act, viewmodel, params) {\n      common.todo(this, act, viewmodel, params)\n    },\n    action: function () {\n      return {\n        selectgrid: selectgrid,\n        unselectgrid: unselectgrid,\n        selectall: selectall,\n        unselectall: unselectall,\n        scress: scress,\n        sure: sure,\n        position: position,\n        fresh: fresh,\n        item: item,\n        help: help,\n        out: out,\n        search: search,\n        load: load,\n        columnsetting: common.columnsetting\n      }\n    }\n  }\n}())\n\ncb.namespace('biz.common')\ncb.biz.common.billmaker = billmaker;\n\nexport default billmaker;\n"],"sourceRoot":""}