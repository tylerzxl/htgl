(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{2422:function(e,t,a){"use strict";a.d(t,"r",(function(){return l})),a.d(t,"t",(function(){return s})),a.d(t,"m",(function(){return u})),a.d(t,"j",(function(){return d})),a.d(t,"h",(function(){return f})),a.d(t,"d",(function(){return m})),a.d(t,"b",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"k",(function(){return b})),a.d(t,"f",(function(){return v})),a.d(t,"p",(function(){return h})),a.d(t,"u",(function(){return y})),a.d(t,"v",(function(){return S})),a.d(t,"n",(function(){return C})),a.d(t,"l",(function(){return w})),a.d(t,"w",(function(){return T})),a.d(t,"a",(function(){return x})),a.d(t,"q",(function(){return k})),a.d(t,"s",(function(){return I})),a.d(t,"i",(function(){return D})),a.d(t,"o",(function(){return M})),a.d(t,"c",(function(){return O})),a.d(t,"x",(function(){return P})),a.d(t,"e",(function(){return _}));var r=a(196),n=a.n(r),i=function(){return(i=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function o(e){var t={};return e&&(t=e.cParameter?JSON.parse(e.cParameter):e),t}function c(e){"upesn"!==n.a.platform?cb.utils.alert("当前平台： "+n.a.platform+" ，结果："+e):console.log("当前平台： "+n.a.platform+" ，结果："+e)}function l(e,t,a,r,o){var l={};if(null==a?void 0:a.cParameter){var s=JSON.parse(a.cParameter);l.needResult=s.needResult?parseInt(s.needResult):1,"all"===s.scanType?l.scanType=["qrCode","barCode"]:Array.isArray(l.scanType)||(l.scanType=[s.scanType])}n.a.scanQRCode(i(i({},l),{success:function(e){var t=e.resultStr;cb.invoker.publish("mtl",{action:"scan",result:t}),c(t)},fail:function(e){c(e.message)}}))}function s(e,t,a,r,l){var s=o(a);n.a.upesn.showShareMenu(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"share",result:e}),c(e)},fail:function(e){c(e.message)}}))}function u(e,t,a,r,i){var o=n.a.platform;cb.invoker.publish("mtl",{action:"platform",result:o}),c(n.a.platform)}function d(e,t,a,r,i){n.a.getNetworkType({success:function(e){var t=e.networkType;cb.invoker.publish("mtl",{action:"getNetworkType",networkType:t}),c(e)},fail:function(e){c(e.message)}})}function f(e,t,a,r,i){n.a.getMac({success:function(e){var t=e.macAddress;cb.invoker.publish("mtl",{action:"getMac",result:t}),c(e)},fail:function(e){c(e.message)}})}function m(e,t,a,r,l){var s=o(a);n.a.dail(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"dail",result:e}),c(e)},fail:function(e){c(e.message)}}))}function p(e,t,a,r,o){var l={};if(null==a?void 0:a.cParameter){var s=JSON.parse(a.cParameter);l.count=s.count,"all"===s.sourceType?l.sourceType=["album","camera"]:Array.isArray(l.sourceType)||(l.sourceType=[s.sourceType])}n.a.chooseImage(i(i({},l),{success:function(e){var t=e.localIds;cb.invoker.publish("mtl",{action:"chooseImage",result:t}),c(e)},fail:function(e){c(e.message)}}))}function g(e,t,a,r,l){var s=o(a);n.a.getLocation(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"getLocation",result:e}),c(e)},fail:function(e){c(e.message)}}))}function b(e,t,a,r,l){var s=o(a);n.a.openLocation(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"openLocation",result:e}),c(e)},fail:function(e){c(e.message)}}))}function v(e,t,a,r,l){var s=o(a);n.a.generateQRCode(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"generateQRCode",result:e}),c(e)},fail:function(e){c(e.message)}}))}function h(e,t,a,r,l){var s=o(a);if(s.headers&&"string"==typeof s.headers)try{s.headers=JSON.parse(s.headers)}catch(e){return void alert("headers 参数错误")}if(s.params&&"string"==typeof s.params)try{s.params=JSON.parse(s.params)}catch(e){return void alert("params 参数错误")}n.a.request(i(i({},s),{success:function(e){var t=e.data;cb.invoker.publish("mtl",{action:"request",result:t}),c(e)},fail:function(e){c(e.message)}}))}function y(e,t,a,r,i){n.a.startRecord({success:function(e){cb.invoker.publish("mtl",{action:"startRecord",result:e}),c(e)},fail:function(e){c(e.message)}})}function S(e,t,a,r,i){n.a.stopRecord({success:function(e){cb.invoker.publish("mtl",{action:"stopRecord",result:e}),c(e)},fail:function(e){c(e.message)}})}function C(e,t,a,r,l){var s=o(a);n.a.playVoice(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"playVoice",result:e}),c(e)},fail:function(e){c(e.message)}}))}function w(e,t,a,r,l){var s=o(a);n.a.pauseVoice(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"pauseVoice",result:e}),c(e)},fail:function(e){c(e.message)}}))}function T(e,t,a,r,l){var s=o(a);n.a.stopVoice(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"stopVoice",result:e}),c(e)},fail:function(e){c(e.message)}}))}function x(e,t,a,r,l){var s=o(a);n.a.changeScreenOrientation(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"changeScreenOrientation",result:e}),c(e)},fail:function(e){c(e.message)}}))}function k(e,t,a,r,i){n.a.restoreScreenOrientation({success:function(e){cb.invoker.publish("mtl",{action:"restoreScreenOrientation",result:e}),c(e)},fail:function(e){c(e.message)}})}function I(e,t,a,r,l){var s=o(a);n.a.setStorage(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"setStorage",result:e}),c(e)},fail:function(e){c(e.message)}}))}function D(e,t,a,r,l){var s=o(a);n.a.getStorage(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"getStorage",result:e}),c(e)},fail:function(e){c(e.message)}}))}function M(e,t,a,r,l){var s=o(a);n.a.removeStorage(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"removeStorage",result:e}),c(e)},fail:function(e){c(e.message)}}))}function O(e,t,a,r,l){var s=o(a);n.a.clearStorage(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"clearStorage",result:e}),c(e)},fail:function(e){c(e.message)}}))}function P(e,t,a,r,l){var s=o(a);n.a.uploadFile(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"uploadFile",result:e}),c(e)},fail:function(e){c(e.message)}}))}function _(e,t,a,r,l){var s=o(a);n.a.downloadFile(i(i({},s),{success:function(e){cb.invoker.publish("mtl",{action:"downloadFile",result:e}),c(e)},fail:function(e){c(e.message)}}))}},2437:function(e,t,a){"use strict";a.r(t);var r=a(191),n=a(123),i=a(557),o=a.n(i),c=a(429),l=a(2422),s=function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var r,n,i=a.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return o},u=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},d=function(){var e=this,t=function(e,t,a){r.H(e),r.I(e),a?(e.setDirty(!0),e.loadDirtyData(t)):(e.loadData(t),t&&(e.execute("afterLoadData",t),e.validate(!0)))},a=function(e){var t,a,r=e.getTreeModel();return r&&(t=r.getSelectedNodes()),t&&t.length&&t[0]&&(a=t[0]),a},i=function(e,i,o,c,l){i.getCache("lastMode")?a(i)?r.q(e,i,o,c,l,(function(e,a,i){r.p(i,(function(a,i){if(!a){cb.utils.alert("操作成功","success");var o=e.collectData(!0),c=r.e(o,i);r.G(e,n.a.VOUCHER_STATE_EDIT),t(e,c),e.getTreeModel().updateNode(c)}l({err:a,res:i},r.a)}),a)})):cb.utils.alert("请选择有效数据","warning"):function(e,t,a,n,i){var o=a&&a.params&&a.params.index;if(null!=o){var c=t.getGridModel();if(c){var l=c.getRow(o);if(l){var s={billnum:e,data:JSON.stringify(l)};n({params:a,data:s},(function(){r.p(a,(function(e,a){e||(cb.utils.alert("操作成功","success"),t.execute("back")),i({err:e,res:a},r.a)}),s)}))}}}}(e,i,o,c,l)},s=function(e,t,a,r,n){if(!(a=a||{}).cAction){var o=t.allActions&&t.allActions.find((function(e){return"open"===e.cAction.trim().toLocaleLowerCase()}));Object.assign(a,o)}cb.extendConfig.allConfirm&&a.cShowCaption?cb.utils.confirm("是否确认"+a.cShowCaption+"此记录",(function(){i(e,t,a,r,n)})):i(e,t,a,r,n)},d=function(e,t,a,r,n){if(!(a=a||{}).cAction){var o=t.allActions&&t.allActions.find((function(e){return"close"===e.cAction.trim().toLocaleLowerCase()}));Object.assign(a,o)}cb.extendConfig.allConfirm?cb.utils.confirm("是否确认停用此记录",(function(){i(e,t,a,r,n)})):i(e,t,a,r,n)},f=function(e,t,a){for(var n=e.getGridModels(),i=1;i<n.length;i++)n[i].clear();var o=e.getCache("queryItems")||[];if(o.length){var c=!1;if(o.forEach((function(t){var a=t.replace(/(\w)/,(function(e){return e.toUpperCase()}));e.getCache("exec"+a)||(c=!0)})),c)return void(a&&a())}"Report"===r.y(e,"billType")&&e.execute("firstQueryDone",!0);var l=e.getParams().query.reportId,s=e.getGridModel();l&&!t.reportId&&s.setColumns(s.getState("columns")),Object.assign(t,e.getParams().query),delete t.isSum;var u=e.getCache("isSum");if(null!=u&&(t.isSum=u),s){if(s.setState("showSearch",t.showSearch),delete t.showSearch,1==e.getCache("bDisplayNavTree")&&!t.bFromNav)return;s.promiseExecute("beforeLoad",t,(function(){var r=e.allActions&&e.allActions.find((function(e){return e.cCommand&&"cmdlist"===e.cCommand.trim().toLocaleLowerCase()})),n=r&&r.cSvcUrl||"bill/list";n=cb.rest._appendUrl(n,e.getParams().query);var i=r&&r.cSvcUrl?{url:n,method:r.cHttpMethod||"POST",options:{mask:!0}}:{url:n,method:"POST",options:{mask:!0}};s.setDataSource(i,t,(function(e){var t=s.getParent();t&&t.setCache("pageInfo",{recordCount:e.recordCount,pageIndex:e.pageIndex,pageSize:e.pageSize});var a=p(e);a&&this.setColumns(a.columns,a.fieldNames)})),s.setSortColumn(),s.setCache("afterAct",a),e.getCache("cardViewModel")&&s.execute("dblClick",{})}))}},m=function(e){for(var t=e.getCache("FilterViewModel"),a=t._get_data("propertyNames"),r=!0,n=0;n<a.length;n++){var i=a[n],o=t.get(i);if(o instanceof cb.models.BaseModel&&!1!==o._get_data("needCollect")&&!1!==o._get_data("needClear")&&o._get_data("mustInput")){var c=o.getAllData?o.getAllData():o.getData();if("object"==typeof c){if(cb.utils.isEmpty(c.value1)&&cb.utils.isEmpty(c.value2)){r=!1;break}}else if(cb.utils.isEmpty(c)){r=!1;break}}}return r},p=function(e){if(e&&e.viewmodel){for(var t={},a=[],r=e.viewmodel.entities.filter((function(e){return e.bMain&&"Bill"===e.cType}))[0].fields,n=0;n<r.length;n++){var i=r[n];t[i.cItemName]=i,a.push(i.cItemName)}return{columns:t,fieldNames:a}}},g=function(e,t,a,r,n){var i=a?a.groupSchemaId:void 0,o=a?a.groupSchemaName:void 0,c=a?a.dimensionId||9999:void 0;t.execute("refreshEChartConfig",{billnum:e,groupSchemaId:i,groupSchemaName:o,dimensionId:c}),t.setCache("execSchema",!0),t.setCache("groupSchemaId",i),t.getGridModel().setState("showColumnSetting",!i);var l=Object.assign({billnum:e,groupSchemaId:i,isIncludeMeta:!0},t.getCache("lastSearchCondition"));Object.assign(l,t.getParams().query),f(t,l,n)},b=function(e,t){var a=e.getGridModel();if(a){var i=null,o=a.getColumns();for(var c in o)if(o[c].bJointQuery){i=c;break}a.on("cellJointQuery",(function(e){var t=a.getRow(e.rowIndex);e.cellName===i?(a.execute("dblClick",t,e),a.setCache("backData",{rowIndex:e.rowIndex,id:t.id})):a.execute("jointQuery",Object.assign(e,{rowData:t}))})),a.on("dblClick",(function(t,i){var o=this.getParent(),c={mode:n.a.VOUCHER_STATE_EDIT,readOnly:!e.getParams().doubleEdit,id:t.id,rowData:t,cellInfo:i,carryParams:{},cardViewModel:o.getCache("cardViewModel")};if(c=Object.assign({},c,e.getCache("lastSearchCondition")),!a.execute("beforeDblClick",c))return!0;var l=r.y(e,"cardKey");if(l){var s=a.get("dataSource").findIndex((function(e){return e.id==t.id}));o.setCache("curVoucherIndex",s);var u={billtype:"yyarchive",billno:l,params:c};cb.loader.runCommandLine("bill",u,o)}})),e.on("afterBatchdelete",(function(t){var a=e.getGridModels();if(!t.res.failCount)for(var r=1;r<a.length;r++)a[r].clear()})),a.on("afterSetDataSource",(function(){var t=a.getCache("afterAct");t&&t(),r.F(a,e)}))}},v=function(e,t,a){var r=e.allActions&&e.allActions.find((function(e){return e.cCommand&&"cmdquerytree"===e.cCommand.trim().toLocaleLowerCase()})),n=r&&r.cSvcUrl?{url:r.cSvcUrl,method:r.cHttpMethod||"POST"}:{url:"bill/querytree",method:"POST"},i=e.getTreeModel();i&&i.promiseExecute("beforeLoad",t,(function(){i.setDataSource(n,t),a&&i.setCache("afterAct",a)}))},h=function(e,a){var i=e.getTreeModel();if(i){i.setReadOnly(!0);var o=e.getGridModel(),c=e.getParams().billType;i.on("select",(function(i){e.promiseExecute("beforeTreeSelect",i,(function(){if(o||"TreeList"===c){if(!o)return;e.setCache("execTree",!0);var l={billnum:a};if(i.length){var s=i[0],u=s.path,d=s.id;"main"==d&&(d=""),u?l.path=u:d&&(l.ids=d.toString())}Object.assign(l,e.getCache("lastSearchCondition")),f(e,l)}else i.length?(r.G(e,n.a.VOUCHER_STATE_EDIT),function(e,a,n){if(a.getParams().hasChildren){var i={billnum:e,id:n[a.getTreeModel().getState("keyField")]},o=a.allActions&&a.allActions.find((function(e){return e.cCommand&&"cmddetail"===e.cCommand.trim().toLocaleLowerCase()})),c=o&&o.cSvcUrl?{cSvcUrl:o.cSvcUrl,cHttpMethod:o.cHttpMethod||"GET"}:{cSvcUrl:"bill/detail",cHttpMethod:"GET"};r.p(c,(function(e,r){e||t(a,r)}),i)}else t(a,n)}(a,e,i[0]),e.setCache("lastMode",n.a.VOUCHER_STATE_EDIT)):(r.G(e,n.a.VOUCHER_STATE_ADD),e.biz.do("add",e),e.setCache("lastMode",n.a.VOUCHER_STATE_ADD))}))})),i.on("afterSetDataSource",(function(){if(o){var e=o.getCache("afterAct");e&&e()}else{var t=i.getCache("afterAct");t&&t()}}))}},y=function(e,a){var i,c,l,s=r.y(e,"billType"),u=r.y(e,"filterId"),d=r.y(e,"condition"),m=r.y(e,"detailId");switch(s){case"Report":_.get(e.getParams(),"query.viewid");!d&&u||f(e,{billnum:a,condition:d}),b(e);break;case"YYList":case"ArchiveList":f(e,{billnum:a,condition:d}),b(e);break;case"TreeList":var p=e.getTreeModel();if(p&&p.getState("defaultSelectedKeys")&&(c="tree",-1===(l=(i=e).getCache("queryItems")||[]).indexOf(c)&&l.push(c),i.setCache("queryItems",l)),function(e,t){e.get("addAttachment")&&e.getGridModels().forEach((function(e){e.on("beforeSetDataSource",(function(e){return e.forEach((function(e){e.attachmentId||(e.id?e.attachmentId=e.id:e.attachmentId=o()())})),e}))}))}(e),p&&p.getState("banQuery"));else!e.getGridModel()&&u||v(e,{billnum:a,treename:r.y(e,"treeName")});h(e,a),function(e,t){var a=e.getTreeModel();a&&(a.on("cellJointQuery",(function(e){var t=e.rowData;a.execute("dblClick",t)})),a.on("dblClick",(function(e){var t=this.getParent(),i={mode:n.a.VOUCHER_STATE_EDIT,readOnly:!0,id:e.id,rowData:e,cardViewModel:t.getCache("cardViewModel")};if(!a.execute("beforeDblClick",i))return!0;var o={billtype:"yyarchive",billno:r.y(t,"cardKey"),params:i};cb.loader.runCommandLine("bill",o,t)})))}(e),b(e);break;case"TreeArchive":v(e,{billnum:a,treename:r.y(e,"treeName")}),h(e,a),e.biz.do("add",e),e.setCache("lastMode",n.a.VOUCHER_STATE_ADD);break;case"Compare":r.G(e,n.a.VOUCHER_STATE_BROWSE),v(e,{billnum:a,treename:r.y(e,"treeName"),isDistinct:!0}),function(e,a){var i=e.getTreeModel();i&&i.on("select",(function(i){if(e.getGridModel()&&i.length){var o=r.y(e,"foreignKey");if(o){var c=o.split(".");c&&c.length>1&&(o=c[1])}var l={billnum:a,path:i[0][o],operator:"eq"};f(e,l)}var s=i[0];r.G(e,n.a.VOUCHER_STATE_EDIT),t(e,s)}))}(e,a),b(e),t(e)}m&&function(e,t,a){var r=e.getTreeModel();r&&r.on("afterSetDataSource",(function(e){r.select(a)}))}(e,0,m)},S=function(e,t,a){if(void 0===a&&(a=!0),e){var r=t&&t.params&&null!=t.params.index?[e.getRow(t.params.index)]:e.getSelectedRows(),n=[];return r&&r.length>0&&r.map((function(e){e.id&&n.push(e.id)})),a?u(new Set(n)):n}},C=function(e,t,n,i,o){var c=a(t);if(c){var l=t.getTreeModel();n[l.getState("parentField")]=c[l.getState("keyField")]}i({params:n},(function(){r.g(e,t,n,i,o)}))},w=function(e,a,n,i,o){var c=a.getCache("lastMode");if(c){i({params:n},(function(){cb.utils.confirm("确定要放弃么",(function(){!function(e){r.G(e,c),t(e,e.getOriginalData());var a={res:e.getOriginalData()};o(a,r.a)}(a)}))}))}else a.communication({type:"return"})},T=function(e){return e.indexOf("ist")>-1||"compare"==e.toLowerCase()},x=function(e,i,o,c,l){if(!0===cb.isTest_ImportProgressBall)var s=0,u="asyncImport_"+Math.floor(1e10*Math.random()),d=setInterval((function(){s+=1;var e={asyncData:JSON.stringify({flag:1,percentage:s,count:s,totalCount:100}),asyncKey:u,busName:"供应商"+u,curTime:"2019-11-26 10:25:0",fileName:"供应商档案模版.xlsx",fileSize:327101,percentage:s};i.communication({type:"asyncImport",payload:e}),s>=100&&clearInterval(d)}),1e3);else{if(!(o=o||{}).cAction){var f=i.allActions&&i.allActions.find((function(e){return"add"===e.cAction.trim().toLocaleLowerCase()}));Object.assign(o,f)}var m=i.getParams()&&i.getParams().billType;i.setCache("curVoucherIndex",-1),m?T(m)?function(e,t,i,o,c){if("touch"===cb.rest.interMode){var l=t.getGridModel();l&&l.clearCache("backData")}var s,u={};if((i=(i=i||{})||{}).cParameter)try{u=JSON.parse(i.cParameter)}catch(e){}if(s=u.billnum&&"tree"===u.type?u.billnum:r.y(t,"cardKey")){var d,f=a(t);f&&(d=f[t.getTreeModel().getState("keyField")]);var m={params:i,mode:n.a.VOUCHER_STATE_ADD,action:"add",carryParams:{},parentId:d,parent:f};o({params:m=Object.assign({},m,t.getCache("lastSearchCondition"))},(function(e){e&&(m.carryParams.externalData=e),cb.loader.runCommandLine("bill",{billtype:"yyarchive",billno:s,params:m},t),c()}))}else cb.utils.alert("元数据未配置cCardKey","warning")}(0,i,o,c,l):function(e,i,o,c,l){var s=i.getTreeModel()&&i.getTreeModel().getState("maxLevel"),u=!1===s?65536:s||3,d=a(i);if(d&&d.level>u)cb.utils.alert("分类最多"+(u+1)+"级","error");else{var f={billnum:e};c({params:o,data:f},(function(){r.s(f,o,(function(e,a){if(a){r.G(i,n.a.VOUCHER_STATE_ADD);var o=i.getTreeModel(),c=o.getState("parentField");null==a[c]&&d&&(a[c]=d[o.getState("keyField")],a.parent_name=d.name),t(i,a,!0)}l({err:e,res:a},r.a)}))}))}}(e,i,o,c,l):console.error("未获得billType")}},k=function(e,a,i,o,c){var l=a.validate();if(l)return cb.utils.alert("以下数据项校验失败："+l.join(","),"error"),void cb.invoker.publishLoadData(!1);var s=a.collectData();if(s){var u=r.w(a);if(u!=n.a.VOUCHER_STATE_ADD)s._status=cb.models.DataStates.Update;else{s._status=cb.models.DataStates.Insert;var d=a.getTreeModel(),f=s[d.getState("parentField")];if(f){if(d){var m=d.getNodesByKeys(f);m&&m.length&&(s.level=m[0].level+1)}}else s.level=1}var p={billnum:e,data:JSON.stringify(s)};o({params:i,data:p},(function(){i.options={mask:!0},r.p(i,(function(i,o){var l,s,d;if(!i){var f,m=a.collectData(!0),p=[];for(var g in o)Array.isArray(o[g])&&(null===(d=null===(s=null===(l=a.get(g))||void 0===l?void 0:l.getDirtyRowIndexes)||void 0===s?void 0:s.call(l))||void 0===d?void 0:d.length)>0&&(p.push(g),f={});p.forEach((function(e){f[e]=a.get(e).getDirtyRowIndexes()}));var b=r.e(m,o,f);r.G(a,n.a.VOUCHER_STATE_EDIT),t(a,b),a.execute("updateTreeRefer");var h=a.getTreeModel();a.getParams().saveRefresh?v(a,{billnum:e,treename:r.y(a,"treeName")},(function(){var e=b[h.getState("keyField")];e&&h.select(e.toString())})):u!==n.a.VOUCHER_STATE_ADD?h.updateNode(b):h.addNode(b,!0),cb.utils.alert("保存成功","success")}c({err:i,res:o},r.a)}),p)}))}},I=function(e,t,a,r,n){var i=t.getGridModel(),o=a&&a.params&&null!=a.params.index?[i.getRow(a.params.index)]:i.getSelectedRows();if(0!=o.length)if(o.length>1)cb.utils.alert("附件管理只能单行显示","warning");else{var c=o[0],l=t.getCache("attachmentCondition"),s=Object.assign({id:c.attachmentId},l);r({params:a,data:s},(function(){t.communication({type:"modal",payload:{key:"Attachment",data:{size:"md",data:s,model:t}}}),n()}))}else cb.utils.alert("请选择行","warning")},D=function(e,t,a,r,n){M(e,t,a,r,n)},M=function(t,a,r,n,i,o){var c;if("btnDelete"!==r.cItemName&&"btnDeleteRow"!==r.cItemName&&null==o&&(o=!!cb.extendConfig.allConfirm),r.cmdParameter)try{c=JSON.parse(r.cmdParameter).primarykey}catch(e){console.error("batchDo action parameter error: "+e.message)}c||(c="id");var l,s=a.getGridModel(),u=a.getTreeModel(),d={};if((r=r||{}).cParameter)try{d=JSON.parse(r.cParameter)}catch(e){}if(d.billnum&&"tree"===d.type?(l=u.getSelectedNodes(),t=d.billnum):s?l=r&&r.params&&null!=r.params.index?[s.getRow(r.params.index)]:s.getSelectedRows():u&&(l=u.getSelectedNodes()),l&&0!=l.length){var f;f=d.billnum&&"tree"===d.type?u.getNecessaryDataForRows(l):s?s.getNecessaryDataForRows(l):u.getNecessaryDataForRows(l);var m=[],p=[];l.forEach((function(e,t){e.id&&e.pubts&&Object.assign(f[t],{code:e.code,id:e.id,pubts:e.pubts}),-1===p.indexOf(e[c])&&(m.push(f[t]),p.push(e[c]))}),e);var g={billnum:t,data:JSON.stringify(m)};n({params:r,data:g},(function(){if(o){var e=a.getParams().caption;cb.utils.confirm("是否确认"+r.cShowCaption+"此"+e+"？",(function(){O(a,r,i,m,g,c)}),(function(){r&&r.enabledCallback&&r.enabledCallback()}))}else O(a,r,i,m,g,c)}))}else cb.utils.alert("请选择","warning")},O=function(e,t,a,n,i,o){r.p(t,(function(i,o){if(!i){var c=t.cShowCaption;1===n.length?o.failCount?cb.utils.alert(c+"失败："+o.messages[0],"error"):cb.utils.alert(c+"成功","success"):"ncc"!==cb.extendConfig.theme||e.getCache("showBatchMsg")?e.communication({type:"modal",payload:{key:"BatchMsg",data:{type:2,res:o}}}):o.failCount>0?cb.utils.alert("共"+c+o.count+"条, 其中成功"+o.sucessCount+"条,失败"+o.failCount+"条","error"):cb.utils.alert("共"+c+o.count+"条, 其中成功"+o.sucessCount+"条","success"),e.execute("back",t)}a({err:i,res:o},r.a)}),i)},P=function(e,t,i,o,c){var l,s,u,d=t.getGridModel(),f={};if((i=i||{}).cParameter)try{f=JSON.parse(i.cParameter)}catch(e){}if(f.billnum&&"tree"===f.type){u=f.billnum;var m=a(t);l=m.id,s=m}else if(d){var p=i&&i.params&&i.params.index,g=null!=p?[d.getRow(i.params.index)]:d.getSelectedRows();if(!g||1!==g.length)return void cb.utils.alert("请选择一条数据","warning");l=g[0].id,s=g[0],d.setCache("backData",{rowIndex:p,id:l}),u=r.y(t,"cardKey")}else{if(!(m=a(t)))return void cb.utils.alert("请选择一条数据","warning");l=m.id,s=m,u=r.y(t,"cardKey")}var b={params:i,mode:n.a.VOUCHER_STATE_EDIT,copy:i.copy,id:l,rowData:s,carryParams:{}};if(d){var v=d.get("dataSource").findIndex((function(e){return e.id==l}));t.setCache("curVoucherIndex",v),b=Object.assign({},b,t.getCache("lastSearchCondition"))}o({params:i,carry:b},(function(){var e={billtype:"yyarchive",billno:u,params:b};cb.loader.runCommandLine("bill",e,t),c()}))},E=function(e,t,a,n,i){var o=t.getParams()&&t.getParams().billType;o&&(T(o)?P(0,t,a,n,i):r.r(e,t,a,n,i))},R=function(e,t,r,n,i){var o=t.getCache("lastSearchCondition"),c=t.getTreeModel();if(t.getGridModel()){var l=Object.assign({billnum:e},r),s=t.getCache("isSum");null!=s&&(l.isSum=s),Object.assign(l,t.getParams().query);var u=t.getCache("groupSchemaId");if(u&&(l.groupSchemaId=u),c){var d=a(t);if(d){var p=d.path,g=d.id;p&&g?(l.path=p,l.ids=g.toString()):p?l.path=p:g&&(l.ids=g.toString())}}var b=cb.utils.extend(!0,l,o);n?n({params:o,data:b},(function(){f(t,b,i)})):f(t,b,i)}else{if(!("ncc"!=cb.extendConfig.theme||m(t)&&o))return;A(e,t,o)}},N=function(e,t,a,r,n){t.setCache("execFilter",!0),t.setCache("lastSearchCondition",a),r({params:a,data:a},(function(){R(e,t,a,null,n)}))},A=function(e,t,a,n,i){var o={billnum:e,treename:r.y(t,"treeName")};a&&a instanceof Object&&(o=Object.assign(o,a)),n?n({params:a,data:o},(function(){v(t,o,i)})):v(t,o,i)},U=function(e,t,r,i,o){var c=t.getTreeModel();if(c&&r)if(r.cTarget){var l=a(t);if(l){var s={};s.detailId=l[c.getState("keyField")];var u=cb.utils.extend(!0,s,{mode:n.a.VOUCHER_STATE_EDIT});i({params:r,data:u},(function(){var e={billtype:"yylist",billno:r.cTarget,params:u};cb.loader.runCommandLine("bill",e,t),o()}))}}else console.log("未配置tree 的billnumber ,在commend表的target中设置")},L=function(e,t,a,n,i){var o=t.getTreeModel();if(o){var c=o.getSelectedNodes();if(c.length){var l=c[0];if(o.isFirst(l))cb.utils.alert("分类已是同级次的第一个","warning");else{var s=o.getState("keyField"),u={billnum:e,action:a.cAction,id:l[s]};n({params:a,data:u},(function(){r.p(a,(function(e,n){e||(cb.utils.alert(a.cShowCaption+"成功","success"),t.execute("back")),i({err:e,res:n},r.a)}),u)}))}}else cb.utils.alert("请选择一条数据","warning")}},G=function(e,t,a,n,i){var o=t.getTreeModel();if(o){var c=o.getSelectedNodes();if(c.length){var l=c[0];if(o.isLast(l))cb.utils.alert("分类已是同级次的最后一个","warning");else{var s=o.getState("keyField"),u={billnum:e,action:a.cAction,id:l[s]};n({params:a,data:u},(function(){r.p(a,(function(e,n){e||(cb.utils.alert(a.cShowCaption+"成功","success"),t.execute("back")),i({err:e,res:n},r.a)}),u)}))}}else cb.utils.alert("请选择一条数据","warning")}},V=function(e,t,a,r,n){var i,o;try{i=(o=JSON.parse(a.cmdParameter)).billnumber,delete o.billnumber}catch(e){console.error("pull action parameter error: "+e.message)}if(i){var c={source:"pull",query:o};cb.loader.runCommandLine("bill",{billtype:"yylist",billno:i,params:c},t)}},K=function(e,t,a,n,i){r.C(t,a)},q=function(e,t,a,n,i){if(a){var o=a.params&&a.params.index;if(null!=o){var c=t.getGridModel();if(c){var l=c.getRow(o);if(l){var s,u=c.getNecessaryDataForRows([l]);Object.assign(u[0],{id:l.id,pubts:l.pubts});var d=t.get("sumSwitch");d&&(s=d.getState("sumSwitchKey")),a.pushKey=s,r.D(t,a,u,n,i)}}}}},B=function(e,t,a,n,i){var o=t.getGridModel(),c=o.getSelectedRows();if(c.length){var l,s=o.getNecessaryDataForRows(c);c.forEach((function(e,t){e.id&&e.pubts&&Object.assign(s[t],{id:e.id,pubts:e.pubts})}));var u=t.get("sumSwitch");u&&(l=u.getState("sumSwitchKey")),a.pushKey=l,r.D(t,a,s,n,i)}else cb.utils.alert("请选择有效数据","warning")},j=function(e,t,a,n,i){if(a){var o=a.params&&a.params.index;if(null!=o){var c=t.getGridModel();if(c){var l=c.getRow(o);l&&r.k(t,a,l.id,n,i)}}}},F=function(e,t,a,n,i){var o=new cb.utils.queryString(a.cSvcUrl),c=o.get("code"),l=t.getGridModel(),s=S(l);if(s&&0!=s.length){if(c){var u={code:c,isMainSelect:1,childIds:s},d={cSvcUrl:o.pathname+o.toStr(),cHttpMethod:a.cHttpMethod};n({params:a,data:u},(function(){r.p(d,(function(e,t){i({err:e,res:t},r.a)}),u)}))}}else cb.utils.alert("请选择有效数据","warning")},H=function(e,t,a,r,n){var i=a.asyncKey,o=a.asyncInterval,c=void 0===o?1:o,l=a.btnCallBack,s={asyncKey:i,fileSize:a.fileSize,fileName:a.fileName,curTime:cb.utils.getNowFormatDate(),busName:t.getParams()&&(t.getParams().name||t.getParams().caption),percentage:0,asyncData:"{}"};t.communication({type:"asyncImport",payload:s});var u=setInterval((function(){Q(t,s,l)}),1e3*c);t.setCache(i,u),cb.utils.alert("导入已转入后台处理，可进行其它操作！")},J=function(e,t,a,i,o){var c=t.getGridModel(),l="";window._baseUrl&&(l="/"===window._baseUrl.substr(0,1)?window._baseUrl:"/"+window._baseUrl);var s=l+"/files"+a.cSvcUrl,u=new cb.utils.queryString(s),d={format:u.has("type")?u.get("type"):"pdf",type:"yylist",bill:{page:{pageSize:c.getPageSize(),pageIndex:c.getPageIndex()},billnum:e}},f=n.a.HTTP_OUTPUT_BILL;i({params:a,data:d},(function(){r.l(f,d),o()}))},z=function(e,t,a){var r=e.getCache(t.asyncKey);e.clearCache(t.asyncKey),r&&clearTimeout(r),a&&(cb.utils.alert(a),t.bDelTask=!0,t.errStr=a,e.communication({type:"asyncImport",payload:t}))},Q=function(e,t,a){var r=t.asyncKey;cb.rest.DynamicProxy.create({getImportProcess:{url:"billtemp/getImportProcess?",method:"GET",options:{mask:!1}}}).getImportProcess({asyncKey:r},(function(a,r){var n="";if(a)return n=a.message,void z(e,t,n);if(r){var i=void 0;try{i=JSON.parse(r)}catch(a){return void z(e,t,n="模板内容导入失败,返回信息："+r)}var o=parseFloat(i.percentage||"0");"0"==i.flag?(n="模板内容导入失败",i.data&&(n=n+",返回信息："+i.data),z(e,t,n)):1==i.flag&&o>=100&&(z(e,t),e.execute("refresh"),e.execute("openNotification",Object.assign({res:i.data},t))),t.asyncData=r,t.percentage=o,e.communication({type:"asyncImport",payload:t})}}))},Y=function(e,t,a,n,i){var o={disabledCallback:a.disabledCallback,enabledCallback:a.enabledCallback};a.disabledCallback=!1,a.enabledCallback=!1;var c={params:a,data:{}},l=!1,s=1,u="asyncImport_"+cb.utils.getNewGuid().replace(/-/g,""),d="";if(a.cParameter){var f=JSON.parse(a.cParameter);f&&(l=f.isAsync,s=f.interval||s,d=f.acceptedFileType||"")}n(c,(function(){var e=document.createElement("input");e.type="file",d&&(e.accept=d),e.style.display="none",e.onchange=function(n){cb.utils.loadingControl.start("导入中..."),o.disabledCallback&&o.disabledCallback();var i=new FormData;i.enctype="multipart/form-data";var d=n.target.files[0],f=d&&d.name,m=d&&d.size;i.append("file",d),c.data.mapCondition&&i.append("mapCondition",JSON.stringify(c.data.mapCondition));var p=new XMLHttpRequest,g=a.cSvcUrl+"?billnum="+r.y(t,"cardKey");try{"bd_staff_card"===r.y(t,"cardKey")&&(g=a.cSvcUrl+"?billnum="+c.data.mapCondition.billnum)}catch(e){console.error(e)}var b=t.getState("serviceCode")||cb.rest.AppContext.query.serviceCode;b&&(g=g+"&serviceCode="+b),l&&(g=g+"&asyncKey="+u);var v=window._baseUrl?""+window._baseUrl+g:g;p.open("POST",v,!0),p.send(i),l?(o.enabledCallback&&o.enabledCallback(),p.onreadystatechange=function(){cb.utils.loadingControl.end();var e=!1,a="";if(4===p.readyState){if(200===p.status){var r=void 0;try{r=JSON.parse(p.responseText)}catch(t){e=!0,a="模板内容导入失败,返回信息："+p.responseText}r&&200===r.code||(e=!0,a="模板内容导入失败，"+r.message+"。")}else 0==p.status?(e=!0,a="offline"):(e=!0,a="模板内容导入返回信息： xhr.readyState ="+p.readyState+"  xhr.status ="+p.status+"  xhr.responseText = "+p.responseText);if(e)cb.utils.alert(a);else H(0,t,{asyncKey:u,asyncInterval:s,btnCallBack:o,fileSize:m,fileName:f})}}):p.onreadystatechange=function(){if(cb.utils.loadingControl.end(),4===p.readyState)if(o.enabledCallback&&o.enabledCallback(),200===p.status){var e=void 0;try{e=JSON.parse(p.responseText)}catch(e){return void cb.utils.alert("模板内容导入失败,返回信息："+p.responseText)}if(e&&200===e.code){var a=e.data;a.sucessCount&&t.execute("refresh"),t.communication({type:"modal",payload:{key:"BatchMsg",data:{type:2,res:a}}})}else cb.utils.alert("模板内容导入失败，"+e.message+"。","error")}else console.log("模板内容导入返回信息： xhr.readyState ="+p.readyState+"  xhr.status ="+p.status+"  xhr.responseText = "+p.responseText)},document.body.removeChild(e)},document.body.appendChild(e),e.click()}))},W=function(e,t,a,n,i){var o="";window._baseUrl&&(o="/"===window._baseUrl.substr(0,1)?window._baseUrl:"/"+window._baseUrl);var c=o+"/files"+a.cSvcUrl,l=new cb.utils.queryString(c),s=l.pathname+l.toStr(),u={billnum:r.y(t,"cardKey")},d={params:a,data:u};n(d,(function(){var e=t.getParams().caption;e&&(u.fileName=e+"模板"),r.l(s,d.data),i()}))},X=function(e,t,a,r,n){var i=a&&a.cSvcUrl;i?r({params:a},(function(){window.open(i),n()})):cb.utils.alert("导出模板的地址为空","error")},Z=function(e,t,a,n,i){var o=t.getCache("isSum"),c=t.getGridModel();if(c&&!c.getRowsCount())return void cb.utils.alert("导出数据不允许为空，请重新选择后重试！","error");var l="";window._baseUrl&&(l="/"===window._baseUrl.substr(0,1)?window._baseUrl:"/"+window._baseUrl);var s=l+"/files"+a.cSvcUrl,u=new cb.utils.queryString(s),d=u.pathname+u.toStr(),f=Object.assign({billnum:e||r.y(t,"cardKey"),groupSchemaId:t.getCache("groupSchemaId")},t.getParams().query,t.getCache("lastSearchCondition"));delete f.showSearch,null!=o&&(f.isSum=o),n({params:a,data:f},(function(){r.l(d,f),i()}))},$=function(e,t,a,r,n){t.communication({type:"modal",payload:{key:"MessageSubscribe",data:{model:t}}})},ee=function(t,a,n,i,o){var c,l=a.get("sumSwitch");l&&(c=l.getState("sumSwitchKey"));var s=a.getGridModel(),u={billnum:t};c&&(u.key=s.getColumnState(c,"cFieldName"));var d=a.getCache("isSum");if(null!=d&&(u.isSum=d),s){var f=n&&n.params&&null!=n.params.index?[s.getRow(n.params.index)]:s.getSelectedRows();if(!f||0==f.length)return void cb.utils.alert("请选择","warning");if(f.length>2e3)return void cb.utils.alert("单次最大导出2000条,请重新选择后重试！","warning");var m=[];f.forEach((function(e){c?m.push(e[c]):e.id&&e.pubts&&m.push(e.id)}),e),u.ids=m.join()}var p="";window._baseUrl&&(p="/"===window._baseUrl.substr(0,1)?window._baseUrl:"/"+window._baseUrl);var g=p+"/files"+n.cSvcUrl,b=new cb.utils.queryString(g);b.set("serviceCode",cb.rest.AppContext.query.serviceCode||"");var v=b&&b.pathname+b.toStr();i({params:n,data:u},(function(){var e=a.getParams().caption;e&&(u.fileName=e),r.l(v,u),o()}))},te=function(e,t,a,n,i){var o=t.getGridModel();if(o){var c={json:{bill:{page:{pageSize:o.getPageSize(),pageIndex:o.getPageIndex()},billnum:e},type:"yylist",token:!0}};n({params:a,data:c},(function(){r.o(c,a,(function(e,t){e?console.error(e):(window.open(t),i())}))}))}},ae=function(e,t,a,n,i){n({params:a},(function(){var n=t.get("templates").getValue();if(n){var c=window.open("about:blank"),l=cb.rest.DynamicProxy.create({preview:{url:"print/printPreview",method:"POST"}}),s=S(t.getGridModel()),u=t.getCache("lastSearchCondition")?JSON.stringify(t.getCache("lastSearchCondition").condition):null,d={route:a.cSvcUrl||"/bill",billno:e,template:n,ids:s,condition:u};l.preview(d,(function(e,t){if(!e){var a=o()(),n=new cb.utils.queryString(t);n.set("random",a),n.set("params",null),c.location.href=n.pathname+decodeURIComponent(n.toStr()),window.addEventListener("message",(function(e){"context"===e.data.key&&e.data.random===a&&(d.tenantId=n.get("tenantId"),c.postMessage({key:"params",value:d},e.origin))}),!1)}i({err:e,res:t},r.a)}))}else cb.utils.alert("请选择打印模板","warning")}))},re=function(e,t,a,i,o){var c=t.get(n.a.VOUCHER_PRINT_KEY)&&t.get(n.a.VOUCHER_PRINT_KEY).getValue()&&t.get(n.a.VOUCHER_PRINT_KEY).getValue().toString(),l=t.getGridModel(),s=S(l);if(s&&0!=s.length){var u={json:{bill:{billnum:r.y(t,"cardKey"),ids:s,tplid:c},type:"yyarchive"}};i({params:a,data:u},(function(){r.o(u,a,(function(e,t){e?console.error(e):(window.open(t),o())}))}))}else cb.utils.alert("请选择有效数据","warning")},ne=function(e,t,a,n,i){n(a,(function(){var e=t.getGridModel(),n=r.x(a,"preview",t),o=n.currentParams,c=n.url;if(!o)return!1;(e&&e.getSelectedRows()||[]).length>500?cb.utils.confirm("数据量较大，预览可能比较慢，是否使用打印插件，是否直接静默打印",(function(){r.B(a,t)}),(function(){ie(o,c)})):ie(o,c),i()}))},ie=function(e,t){var a=r.i(e);if(a.length>2e3){var n=cb.rest.DynamicProxy.create({cacheData:{url:"/cachePrint",method:"post",options:{uniform:!1}}}),i=JSON.stringify(e.params);n.cacheData({param:i},(function(a,n){if(n){e.sendType=7,e.params=n.key;var i=r.i(e);window.open(t+i,"_blank")}}))}else window.open(t+a,"_blank")},oe=function(e,t,a,n,i){n({params:a},(function(){var e=r.x(a,"design",t),n=e.currentParams,i=e.url;window.open(i+r.i(n),"_blank")}))},ce=function(e,t,a,n,i){n(a,(function(){r.B(a,t),i()}))},le=function(e,t,a,r,n){cb.rest.DynamicProxy.create({saveBo:{url:"print/saveBo",method:"GET"}}).saveBo({billno:e},(function(e,t){e?cb.utils.alert(e.message,"error"):cb.utils.alert("保存业务对象成功","success")}))},se=function(e,t,a,n,i){var o=a.rowData,c=a.index;delete a.rowData,delete a.index;var l={billnum:e,data:JSON.stringify(o)};n({params:a,data:l},(function(){cb.utils.confirm("确定要删除么",(function(){r.p(a,(function(e,a){if(!e){var n=t.getGridModel();n&&n.deleteRows([c]),cb.utils.alert("操作成功","success")}i({err:e,res:a},r.a)}),l)}))}))},ue=function(e,t,a,n,i){if("Report"!==t.getParams().billType){var o=t.get("id")&&t.get("id").getValue(),c=t.get("code")&&t.get("code").getValue();if(cb.utils.isEmpty(o)&&cb.utils.isEmpty(c))cb.utils.alert("未找到具体单据","error");else{var l=r.y(t,"cardKey");if(cb.utils.isEmpty(l))cb.utils.alert("元数据未配置cCardKey","error");else{var s=cb.rest.DynamicProxy.create({getTemplate:{url:"print/getTemplateByBo",method:"GET",options:{mask:!0}},print:{url:"bill/getTemplateStructure",method:"POST",options:{mask:!0}}});s.getTemplate({billno:l},(function(e,t){if(e)cb.utils.alert(e.message,"error");else{var a=1===t.length?t[0]:t.find((function(e){return e.isdefault}));if(cb.utils.isEmpty(a))cb.utils.alert("没有设置打印模板，请检查","error");else{var r={billno:l,templateCode:a.templatecode};c?r.code=c:r.ids=[o],s.print(r,(function(e,t){e?cb.utils.alert(e.message,"error"):n(t,(function(){cb.utils.localPrint(t)}))}))}}}))}}}else fe(e,t,a,n,i)},de=function(e,t,a,r,n){t.setCache("isSum",t.get("sumSwitch").getValue()||null),R(e,t,{isIncludeMeta:!0},r,n)},fe=function(e,t,a,r,n){var i=cb.rest.DynamicProxy.create({getTemplate:{url:"print/getTemplateByBo",method:"GET",options:{mask:!0}},print:{url:"report/getTemplateStructure",method:"POST",options:{mask:!0}}});i.getTemplate({billno:e},(function(a,n){if(a)cb.utils.alert(a.message,"error");else{var o=1===n.length?n[0]:n.find((function(e){return e.isdefault}));if(cb.utils.isEmpty(o))cb.utils.alert("没有设置打印模板，请检查","error");else{var c=t.getCache("lastSearchCondition"),l=c?JSON.stringify(c.condition):null,s={billno:e,templateCode:o.templatecode,condition:l,route:"/report/bill"};i.print(s,(function(e,t){e?cb.utils.alert(e.message,"error"):r(t,(function(){cb.utils.localPrint(t)}))}))}}}))},me=function(e,t,a,r,n){t.communication({type:"modal",payload:{key:"batchModify",data:{billType:"list",billNo:e,model:t,params:a}}})},pe=function(e,t,a,n,i){var o=r.y(t,"cardKey");if(o){var c={params:{editType:"jointquery"},parentViewModel:t,billNum:o,billId:t.getGridModel().getRow(a.params.index).id};t.communication({payload:{title:"单据联查结果显示",type:"platform",url:"voucher-search/ShowFlow",checkReturn:!0,modal:t,data:c}})}else cb.utils.alert("元数据未配置cCardKey","warning")},ge=function(e,t,a,i,o){var c=t.getGridModel(),l=a&&a.params&&a.params.index;if(null!=l&&c){var s=c.getRow(l);if(s)if(s.isWfControlled&&0!==s.verifystate){var u=r.y(t,"cardKey"),d=u+"_"+s.id;u||(d=e+"_"+s.id);var f={width:850,height:510,appsource:n.a.appCode,businessKey:d};i({params:a,data:f},(function(){window.flowComp(f).showFlowBox({onClose:function(a){(t.getCache("queryItems")||[]).forEach((function(e){var a=e.replace(/(\w)/,(function(e){return e.toUpperCase()}));t.setCache("exec"+a,!0)})),R(e,t)}})}))}else cb.utils.alert("暂无审批详情","warning")}},be=function(e,t,a,n,i){r.n(e,t,a,n,i)},ve=function(e,t,a,r,n){Object(c.c)(e,t,a,r,n)},he=function(e,t,a,n,i){var o=r.y(t,"cardKey");cb.route.pushPage("/view/yyarchive/"+o+"MobileArchive")},ye=function(e,t,a,r,n){cb.route.goBack()};return{init:function(e,t,a){cb.extendConfig||(cb.extendConfig={});r.t(e,t,(function(i,o){r.z(i,o,e,t,(function(i,o){delete i.getParams().query.isSum;var c=t&&t.query&&Boolean(t.query.isSum);c&&i.setCache("isSum",c);var l=t&&t.reportId;l&&(t.query.reportId=l);var s={vm:i,view:o};i.promiseExecute("afterLoadMeta",s,(function(){var t=i.get("parent_name");if(t instanceof cb.models.ReferModel){var c=t.getState("maxLevel"),l=!1===c?65536:c||3;t.setState("maxLevel",l)}var s=i.getGridModel();s&&s.on("afterInsertRow",(function(){r.F(s,i,i.getParams().mode)})),a(i,o,o.cBillName),y(i,e);var u=i.get("sumSwitch");if(u&&u.getState("crossPageSelect")){var d=u.getState("sumSwitchKey");cb.utils.isEmpty(d)?s.setState("rowKeyField","id"):s.setState("rowKeyField",d)}n.a.USESTATERULE&&i.getCache("FilterViewModel")&&i.getCache("FilterViewModel").on("afterInit",(function(){i.biz.do("staterule",i)}))}))}),(function(t){"Report"===t.getParams().billType&&t.getParams().filterId&&!t.getParams().condition&&(t.getParams().autoLoad=!1),t.initData();var a=t.getGridModel();if(a){var i=t.getParams().billType,o=(cb.rest.AppContext.user||{}).id;if(["Report","YYList","ArchiveList","TreeList"].indexOf(i)>-1&&e&&o){var c,l=e+"_"+o;cb.indexDB.openDB("cacheInfo",1,["billInfo"]).then((function(e){e?cb.indexDB.IDB_getData({dbTableName:"billInfo",dbName:"cacheInfo",key:l}).then((function(e){if(c=e){for(var t in c)"indexedDB_id"!=t&&"pageSize"!=t&&a.setColumnState(t,"iColWidth",c[t]);c.pageSize&&a.get("pageInfo")&&(a.get("pageInfo").pageSize=c.pageSize)}})):console.error("打开数据库失败，缓存功能不可用！")})).catch((function(e){console.error(e)})),a.on("pageInfoChange",(function(e){var t=e.pageSize;c||(c={indexedDB_id:l}),c.pageSize=t,cb.indexDB.IDB_saveData(c,"billInfo","cacheInfo")})),a.on("colWidthResize",(function(e){var t=e.columnKey,a=e.width;c||(c={indexedDB_id:l}),c[t]=a,cb.indexDB.IDB_saveData(c,"billInfo","cacheInfo")})),a.on("colWidthReturn",(function(e){c={id:l,dbTableName:"billInfo",dbName:"cacheInfo"},cb.indexDB.IDB_deleteOneData(c)}))}}t.on("refresh",(function(){R(e,t)})),t.on("back",(function(a){for(var n=t.getGridModel(),i=t.getGridModels(),o=1;o<i.length;o++)i[o].clear();if(n){if(a){if(a.cParameter)try{if("tree"===JSON.parse(a.cParameter).type)return void t.biz.do("queryTree",t)}catch(e){}}if("touch"===cb.rest.interMode||"3"==cb.rest.terminalType){var c=n.getCache("backData");if(!c)return void R(e,t);n.clearCache("backData");var l=t.allActions&&t.allActions.find((function(e){return e.cCommand&&"cmdlist"===e.cCommand.trim().toLocaleLowerCase()})),s=l&&l.cSvcUrl?{url:l.cSvcUrl,method:l.cHttpMethod||"POST",options:{mask:!0}}:{url:"bill/list",method:"POST",options:{mask:!0}},u=cb.rest.DynamicProxy.create({queryData:s}),d={billnum:e,page:{pageSize:n.getPageSize(),pageIndex:1},condition:{isExtend:!0,simpleVOs:[{field:"id",op:"eq",value1:c.id}]}};u.queryData(d,(function(e,a){a&&a.recordList&&a.recordList.length&&(n.updateRow(c.rowIndex,a.recordList[0]),r.F(n,t))}))}else n.setPageIndex(n.getPageIndex())}else{if(!("ncc"!=cb.extendConfig.theme||m(t)&&t.getCache("lastSearchCondition")))return;A(e,t,t.getCache("lastSearchCondition"),null,(function(){a&&t.getTreeModel().doPropertyChange("setExpandRow",{rowKey:a,isExpand:!0})}))}}));var s=new cb.promise;t.on("return",(function(e){if(r.w(t)===n.a.VOUCHER_STATE_BROWSE||!t.getDirtyData(!1)){var a=t.getRudux("portal");return a&&0==_.isEmpty(a.asyncImportArr)&&(e.prompt={msg:"有异步处理正在进行，请检查。"}),!0}return e&&"object"==typeof e?(e.prompt={},!0):(cb.utils.confirm("确定要"+e+"么",(function(){s.resolve()}),(function(){s.reject()})),s)}))}))}))},do:function(e,t,a){r.K(this,e,t,a)},action:function(){var e={};try{e=cb.extendConfig.yylistExtendConfig}catch(t){console.log(t),e={}}var t={newadd:he,newback:ye,scan:l.r,share:l.t,platform:l.m,getnetworktype:l.j,getmac:l.h,dail:l.d,chooseimage:l.b,getlocation:l.g,openlocation:l.k,generateqrcode:l.f,request:l.p,startrecord:l.u,stoprecord:l.v,playvoice:l.n,pausevoice:l.l,stopvoice:l.w,changescreenorientation:l.a,restorescreenorientation:l.q,setstorage:l.s,getstorage:l.i,removestorage:l.o,clearstorage:l.c,uploadfile:l.x,downloadfile:l.e,doservice:i,copy:j,open:s,close:d,save:k,add:x,push:F,singlepush:q,edit:E,dblclick:P,abandon:w,delete:se,batchdelete:D,batchaudit:M,batchunaudit:M,batchsubmit:M,batchunsubmit:M,batchdo:M,search:N,refresh:R,output:J,batchoutput:ee,batchimport:Y,tempexport:W,statictempexport:X,reportexport:Z,messagesubscribe:$,print:te,batchprint:re,check:C,columnsetting:r.h,edittree:U,querytree:A,moveup:L,movedown:G,commandLine:r.j,switchgroupschema:g,savebo:le,preview:ae,localprint:ue,batchpush:B,sumswitch:de,pull:V,pullx:K,jointquery:pe,batchmodify:me,printpreview:ne,printdesign:oe,workflow:ge,printnow:ce,asyncprocess:H,openpage:be,goback:be,attachment:I,billsetting:r.A,staterule:ve};return Object.assign(t,e)}}}();cb.namespace("biz.common"),cb.biz.common.yylist=d,t.default=d}}]);
//# sourceMappingURL=5.bundle.js.map?_=d566ad53-de75-49ba-965f-44adb4dd2a09