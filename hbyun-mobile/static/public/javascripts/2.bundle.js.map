{"version":3,"sources":["webpack:///./node_modules/@mdf/cube/src/bizmodel/mtlapi.js","webpack:///./node_modules/@mdf/cube/src/staterule/formularule.js","webpack:///./node_modules/@mdf/cube/src/bizmodel/mobile/yyarchive.js"],"names":["_getParams","params","data","cParameter","JSON","parse","_showPrompt","result","platform","cb","utils","alert","console","log","mtlScan","billNo","viewmodel","beforeAct","afterAct","newParams","needResult","parseInt","scanType","Array","isArray","scanQRCode","success","res","resultStr","invoker","publish","action","fail","err","message","mtlShare","upesn","showShareMenu","mtlPlatform","mtlNetworkType","getNetworkType","networkType","mtlGetMac","getMac","macAddress","mtlDail","dail","mtlChooseImage","count","sourceType","chooseImage","localIds","mtlGetLocation","getLocation","mtlOpenLocation","openLocation","mtlGenerateQRCode","generateQRCode","mtlRequest","headers","e","request","mtlStartRecord","startRecord","mtlStopRecord","stopRecord","mtlPlayVoice","playVoice","mtlPauseVoice","pauseVoice","mtlStopVoice","stopVoice","mtlChangeScreenOrientation","changeScreenOrientation","mtlRestoreScreenOrientation","restoreScreenOrientation","mtlSetStorage","setStorage","mtlGetStorage","getStorage","mtlRemoveStorage","removeStorage","mtlClearStorage","clearStorage","mtlUploadFile","uploadFile","mtlDownloadFile","downloadFile","formulaRule","rules","get","forEach","property","models","BaseModel","modelType","fieldName","model","getEditRowModel","push","type","actionGroups","actions","exprType","target","scrExprType","srcExpression","setCache","themeType","submitUrls","daily","pre","production","2020","submitUrl","yyarchive","renderData","viewModel","render","dirty","isNewData","getParams","menuId","mode","VOUCHER_STATE_EDIT","setDirty","loadDirtyData","getGridModels","gridModel","initRowState","DataStates","Insert","masterOrgField","autoAddRow","loadData","_beforeRender","_afterRender","execute","metaType","validate","masterOrgKeyField","masterOrgModel","_set_data","VOUCHER_STATE_ADD","getValue","VOUCHER_STATE_BROWSE","setDisabled","biz","do","hasBuildCoded","_createCode","_reloadVoucher","bSwitchTpl","tplid","billData","meta","_fetchMetaCallback","vm","view","communication","payload","menuName","cBillName","refresh","metaData","_resetData","_getTreeSelectNode","selectNode","node","treeModel","getTreeModel","getSelectedNodes","length","_doService","allData","_doServiceByData","postData","successCallback","cShowCaption","msg","cAction","getCache","oldData","collectData","newData","updateNode","isWfControlled","_tplIsEquql","VOUCHER_TPL_KEY","_loadVm","oldVM","newVM","originalVM","originalViewMeta","_loadTree","Object","assign","configParams","allActions","find","x","cCommand","trim","toLocaleLowerCase","proxyParams","cSvcUrl","url","method","cHttpMethod","promiseExecute","setDataSource","search","billnum","treename","getModeDirtyData","ignoreConfirm","func","getDirtyData","confirm","cancelEditFun","Function","_bindTreeSelect","on","args","manually","status","_renderTreeVoucherData","extendConfig","treeCard","id","getState","toString","hasChildren","options","viewCallback","resolve","retryCallback","originalParams","viewmeta","condition","initData","_afterViewCallback","backRefresh","stringify","_getInitdata","returnPromise","promise","caption","prompt","reject","workflowNoCtrl","callback","rest","DynamicProxy","create","getCmdList","billno","_err","cmdName","carryParams","isSum","readOnly","par","cellsCheck","item","childrenField","getColumn","cellName","bCheck","location","rowIndex","key","value","cControlType","fieldname","cFieldName","referRowsCheck","columnName","index","rows","column","bBatchCheck","mergeAll","cellCheck","oldValue","async","context","ruleItems","indexOf","lineOpenOrClose","rowIndexes","getSelectedRowIndexes","selectData","getRowsByIndexes","getName","select","copy","emptyData","err1","copyData","refreshCallback","pm","para","parent","cCarry","carryKeys","error","map","whiteBillNo","split","verifystate","businessKey","_showApproveFlow","buildDepends","depends","attr","_obj","_gridModel","i","_buildDepends","isEmpty","this","Number","GridModel","field","setState","setColumnState","simpleModel","SimpleModel","buildOrg","setReadOnly","orgId","clearCache","carryData","code","_get_data","setValue","keyMap","realAdd","browse","isExtend","simpleVOs","op","value1","errCallBack","buildCode","isCoded","billNoIndexOf","billNum","substr","getCode","canModify","ballowhandwork","brepeatredo","billPrefix","prefixes","cfieldname","_buildCode","proxy","createCode","buildRule","billNumber","language","beforeActData","eval","rule","fields","triggers","trigger","ds","run","param","ruleid","lineid","items","jointFields","config","queryData","jointQuery","paras","menuCode","menuUrl","join","dt","billtype","extend","loader","runCommandLine","refFields","referModel","_setReferRule","cRefType","setRefCode","cRefRetId","setReturnFields","refid","setFilter","_resetOriginal","getOriginalData","check","nullMsg","theme","getAbandonText","cAbandonText","abandon","getNecessaryData","abandonText","_abandon","enabledCallback","route","goBack","multitpl","lastId","undefined","setVisible","inValid","invalidReason","window","batchModify","billType","submit","publishLoadData","mobileBillNo","mobileBillType","getUserYHTInfo","modelData","appsource","bpmHost","userId","yht_userid","tenantId","tenant_id","getViewModelByType","setData","_getcookie","substring","tenantIdTemp","objname","arrstr","document","cookie","temp","unescape","unsubmit","checkApprove","billId","billCode","workflow","width","height","appCode","flowComp","showFlowBox","onClose","callbackData","audit","open","allConfirm","close","table2DBtnClick","addRow","support2D","t2DInfo_Bus_Get","show2D","appendRow","deleteRow","deleteRows","insertRow","copyRow","rowData","getRow","shiftUpRow","shiftDownRow","localPrint","disabledCallback","printTplItemName","templatesModel","templateCode","_localPrint","getTemplate","mask","template","isdefault","templatecode","ids","print","isInWorkBench","bReturn","isModelHasKey","getParent","isHideAlert","save","requestBillNo","invalidMsg","invalidFields","bShowIt","bHidden","getGridModel","_status","parentData","parentNode","getNodesByKeys","level","parentId","Update","val","defineParams","afterActData","_handlePageInfoStatus","content","cCaption","AppContext","query","random","postMessage","saveRefresh","addNode","unselectAll","arrayKeys","getDirtyRowIndexes","_delete","isReturn","suc","getSelectedKeys","selectedNode","nextNode","getNextSibling","prevNode","getPrevSibling","getParentNode","deleteNode","treeVoucher","selectAfterDelete","selectNodes","jDiwork","closeWin","doDelete","children","text","deleteReturn","nextAction","cmdDelRe","moveFirstOrLast","movePrevOrNext","encodeURI","pull","queryString","targetCode","targetBillNo","isMainSelect","childIds","pathname","toStr","saveAndAdd","saveParams","afterSaveData","clear","addParams","saveData","add","propertyName","doPropertyChange","reload","saveAndAudit","auditParams","callbackdata","has","makeBilltype","newdata","maxLevel","addData","currentTpl","parentField","parent_name","name","getPredicateValue","formatValue","exp","match","values","valid","predicate","obj","replace","localoutput","XLSX","outputData","getData","dataColumns","getColumns","tmpObj","resObj","keyName","resDetails","resSonObj","cFormatData","iNumPoint","cEnumString","enumValue","enumString","lookupVector","keys","resultVector","thisLoc","iColWidth","fileName","sheet","json_to_sheet","sheetRowCount","colCount","rowRange","decode_range","R","C","s","c","cell_address","r","cell_ref","encode_cell","v","controlType","cellConfig","wpx","colRange","thisCell_address","thisCell_ref","t","decimal","option","amountofdecimal","monovalentdecimal","splitter","z","SSF","_table","decimalCount","re","deciLength","wb","book_new","book_append_sheet","writeFile","output","baseUrl","_baseUrl","queryUrl","inputParams","partParam","savebo","saveBo","preview","actionName","errInfo","newTab","href","printID","VOUCHER_PRINT_KEY","json","bill","initDefaultActions","prevAction","selectTpl","cbk","vmAndView","newView","Date","valueOf","groupCode","detailIds","pushKey","from","Set","mainIds","pushData","targetData","externalData","dimensionKeys","dimensionGroupCode","groupTaskKey","bWorkbench","dimensionKey","compositeAction","firstAction","Act","toUpperCase","saveDraft","saveDatatemp","getYhtUserIds","user","person","getYhtUserId","userIds","personIds","concat","refCode","yhtField","dataType","recordList","_getNotice","special","format","ecsuite","webUrl","origin","mobileUrl","notice","YYCooperationBridge","YYLanuchFlow","objectName","objectId","YYRenderCreateTask","idList","ecsuiteItems","yhtIds","YYGroupChat","docCode","YYChat","voucherDo","asyncMeta","Promise","cardViewModel","loadingControl","end","vmParams","processWorkflow","fieldAuths","parseViewModel","parseContainer","parseMainEntity","parseChildEntity","fieldAuthObj","visible","editable","columns","bCanModify","container","containers","controls","parseControls","control","fieldAuth","cItemName","getAllControls","groupIds","selectors","arr","xNum","groupDom","getElementById","groupControls","querySelectorAll","yNum","j","afterInitData","promises","results","len","title","allGroupId","allSelector","allControls","gridModels","addGrandSonTable","cacheKey","cacheWidth","indexDB","openDB","then","IDB_getData","dbTableName","dbName","catch","setTimeout","dataList","rid","attachmentId","row","list","columnKey","indexedDB_id","IDB_saveData","IDB_deleteOneData","_managePageInfoStatue","_bindTreeAttachment","USEFORMULARULE","USESTATERULE","btnMovefirst","btnMovelast","btnMoveprev","btnMovenext","parentViewmodel","lastSearchCondition","curVoucherIndex","recordCount","canLoad","_getParentAllList","info","findIndex","gridmodel","proxyConfig","queryParams","page","parentCurVoucherIndex","parentPageInfo","pageIndex","pageSize","rowDetail","curGridModel","cSunBillNo","selectedRow","jointquery","editType","parentViewModel","childArray","childKey","checkReturn","modal","printPreview","currentParams","printDesign","printNow","batchOutputVoucher","selectedDatas","includes","selectDatas","getSelectedRows","pubts","exportVoucherTemplate","importVoucher","btnCallBack","isAsync","asyncInterval","asyncKey","getNewGuid","acceptedFileType","interval","eleInput","createElement","accept","style","display","onchange","formData","FormData","enctype","file","files","fileSize","size","append","mapCondition","xhr","XMLHttpRequest","_url","send","onreadystatechange","bError","errorInfo","readyState","ajaxResult","responseText","curTime","getNowFormatDate","busName","percentage","asyncData","_timer","setInterval","asyncImportQuery","sucessCount","body","removeChild","appendChild","click","asyncParams","getImportProcess","errStr","handleAsyncImportOver","parseFloat","flag","clearTimeout","bDelTask","doCommunication","attachment","selectRow","attachmentCondition","keyField","loopData","voucherAttachment","newAttchmentId","newId","stateRule","newback","init","hasOwnProperty","saveReturn","act","voucherExtend","voucherExtendConfig","voucherAction","scan","share","getnetworktype","getmac","chooseimage","getlocation","openlocation","generateqrcode","startrecord","stoprecord","playvoice","pausevoice","stopvoice","changescreenorientation","restorescreenorientation","setstorage","getstorage","removestorage","clearstorage","uploadfile","downloadfile","doservice","load","org","initdefaultactions","commandline","edit","addrow","table2dbtnclick","insertrow","deleterow","copyrow","shiftuprow","shiftdownrow","delete","invalid","unaudit","movefirst","movelast","moveprev","movenext","columnsetting","checkapprove","cellcheck","cellscheck","referrowscheck","lineopen","lineclose","selecttpl","saveandadd","saveandaudit","localprint","selfdefineaction","savedraft","savedatatemp","voucherdo","batchmodify","printpreview","printdesign","printnow","batchoutput","batchimport","tempexport","openpage","goback","voucherattachment","rowdetail","staterule","billsetting","formularule","autocomplete","customdo","namespace","common"],"mappings":"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","file":"public/javascripts/2.bundle.js?_=d566ad53-de75-49ba-965f-44adb4dd2a09","sourcesContent":["import mtl from 'mtl-js-sdk'\n\nfunction _getParams (params) {\n  let data = {};\n  if (params) {\n    if (params.cParameter) {\n      data = JSON.parse(params.cParameter);\n    } else {\n      data = params;\n    }\n  }\n  return data;\n}\n\nfunction _showPrompt (result) {\n  if (mtl.platform !== 'upesn') {\n    cb.utils.alert('当前平台： ' + mtl.platform + ' ，结果：' + result);\n  } else {\n    console.log('当前平台： ' + mtl.platform + ' ，结果：' + result);\n  }\n}\n\nexport function mtlScan (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.needResult = newParams.needResult ? parseInt(newParams.needResult) : 1;\n    if (newParams.scanType === 'all') {\n      data.scanType = ['qrCode', 'barCode'];\n    } else {\n      if (!Array.isArray(data.scanType)) {\n        data.scanType = [newParams.scanType];\n      }\n    }\n  }\n  mtl.scanQRCode({\n    ...data,\n    success: function (res) {\n      const result = res.resultStr;\n      cb.invoker.publish('mtl', { action: 'scan', result: result });\n      _showPrompt(result);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlShare (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.upesn.showShareMenu({\n    ...data,\n    success: function (res) {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'share', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlPlatform (billNo, viewmodel, params, beforeAct, afterAct) {\n  const result = mtl.platform;\n  cb.invoker.publish('mtl', { action: 'platform', result: result });\n  _showPrompt(mtl.platform);\n};\n\nexport function mtlNetworkType (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getNetworkType({\n    success: function (res) {\n      const networkType = res.networkType;// 返回网络类型2g，3g，4g，wifi,无网状态下通过fail回调返回错误信息\n      cb.invoker.publish('mtl', { action: 'getNetworkType', networkType });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// 错误信息\n      _showPrompt(message);\n    }\n  });\n}\nexport function mtlGetMac (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getMac({\n    success: function (res) {\n      const macAddress = res.macAddress;\n      cb.invoker.publish('mtl', { action: 'getMac', result: macAddress });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlDail (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.dail({\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'dail', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlChooseImage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.count = newParams.count;\n    if (newParams.sourceType === 'all') {\n      data.sourceType = ['album', 'camera'];\n    } else {\n      if (!Array.isArray(data.sourceType)) {\n        data.sourceType = [newParams.sourceType];\n      }\n    }\n  }\n  mtl.chooseImage({\n    ...data,\n    success: function (res) {\n      // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片\n      const localIds = res.localIds; // ['wxLocalResource://imageid123456789987654321', ...]\n      cb.invoker.publish('mtl', { action: 'chooseImage', result: localIds });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGetLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getLocation({\n    // type: 'wgs84',//默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'\n    ...data,\n    success: function (res) {\n      // var latitude = res.latitude;// 纬度，浮点数，范围为90~-90\n      // var longitude = res.longitude;// 经度，浮点数，范围为180~-180。\n      cb.invoker.publish('mtl', { action: 'getLocation', result: res });\n      _showPrompt(res);\n    },\n    fail (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlOpenLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.openLocation({\n    // latitude: 40.07573,//纬度，浮点数，范围为90~-90\n    // longitude: 116.245412,//经度，浮点数，范围为180~-180。\n    // name: '',//位置名\n    // address: '',//地址详情说明\n    // scale: 1,//地图缩放级别,整形值,范围从1~28。默认为最大\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'openLocation', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGenerateQRCode (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.generateQRCode({\n    // str: 'hello',//用于生成二维码的字符串\n    // size: 200,//生成图片大小，默认100*100\n    ...data,\n    success: function (res) {\n      // imgSrc为base64字符串\n      // var src = res.imgSrc;\n      cb.invoker.publish('mtl', { action: 'generateQRCode', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlRequest (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  if (data.headers && typeof data.headers === 'string') {\n    try {\n      data.headers = JSON.parse(data.headers);\n    } catch (e) {\n      alert('headers 参数错误')\n      return\n    }\n  }\n  if (data.params && typeof data.params === 'string') {\n    try {\n      data.params = JSON.parse(data.params);\n    } catch (e) {\n      alert('params 参数错误')\n      return\n    }\n  }\n  mtl.request({\n    // url: 'https://some-domain.com/api/user',\n    // method: 'get',\n    // headers: { 'X-Requested-With': 'XMLHttpRequest' },\n    // params: {\n    //   ID: 12345\n    // },\n    ...data,\n    success: function (res) {\n      const data = res.data; // 返回数据\n      cb.invoker.publish('mtl', { action: 'request', result: data });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  })\n}\n\nexport function mtlStartRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.startRecord({\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'startRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.stopRecord({\n    success: function (res) {\n      // var localId = res.localId;// 微信音频的本地ID,用空间是BASE64加密处理后的音频数据字符串\n      cb.invoker.publish('mtl', { action: 'stopRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPlayVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.playVoice({\n    // localId: '', // 需要播放的音频的本地ID，由stopRecord接口获得\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'playVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPauseVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.pauseVoice({\n    // localId: '', // 需要暂停的音频的本地ID，由stopRecord接口获得\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'pauseVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.stopVoice({\n    // localId: '', // 需要停止的音频的本地ID，由stopRecord接口获得\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'stopVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // 错误信息\n      _showPrompt(message);\n    }\n  });\n}\n/**\n * 修改屏幕方向，横屏或者竖屏\n */\nexport function mtlChangeScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.changeScreenOrientation({\n    // orientation: true,\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'changeScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * 恢复屏幕方向\n */\nexport function mtlRestoreScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.restoreScreenOrientation({\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'restoreScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * 存储数据\n */\nexport function mtlSetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.setStorage({\n    // domain: '',\n    // key: '',\n    // data: {},\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'setStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * 读取数据\n */\nexport function mtlGetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'getStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * 删除数据\n */\nexport function mtlRemoveStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.removeStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'removeStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * 清除所有数据\n */\nexport function mtlClearStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.clearStorage({\n    // domain: '',\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'clearStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * 上传文件\n */\nexport function mtlUploadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.uploadFile({\n    // url: '必填',\n    // filePath: '必填',\n    // header: { 'content-type': 'multipart/form-data' },\n    // formData: '',\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'uploadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * 下载文件\n */\nexport function mtlDownloadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.downloadFile({\n    // url: '必填',\n    // fileType: '必填',\n    // header: '',\n    // formBody: '',\n    // jsonBody: '',\n    // autoPreview: '',\n    // fileName: '',\n    ...data,\n    success: res => {\n      // 成功回调\n      cb.invoker.publish('mtl', { action: 'downloadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n","import { runRule } from './rule';\n\nexport default function formulaRule (billNo, viewmodel, params, beforeAct, afterAct) {\n  const rules = [];\n  viewmodel.get('propertyNames').forEach(function (property) {\n    if (viewmodel.get(property) instanceof cb.models.BaseModel) {\n      // GridModel 和 SimpleModel\n      if (viewmodel.get(property).modelType === 'GridModel') {\n        viewmodel.get(property).get('fieldNames').forEach(function (fieldName) {\n          const model = viewmodel.get(property).getEditRowModel().get(fieldName);\n          if (model.get('iSystem') === 2) {\n            rules.push({\n              type: 0,\n              // triggers: '',\n              actionGroups: [{\n                actions: [{\n                  exprType: 0,\n                  target: property + '.' + model.get('cItemName'),\n                  scrExprType: 0,\n                  srcExpression: model.get('formula')\n                }]\n              }]\n            })\n          }\n        })\n      } else {\n        const model = viewmodel.get(property);\n        if (model.get('iSystem') === 2) { // 非系统字段 配置了公式\n          rules.push({\n            type: 0,\n            // triggers: '',\n            actionGroups: [{\n              actions: [{\n                exprType: 0,\n                target: model.get('cItemName'),\n                scrExprType: 0,\n                srcExpression: model.get('formula')\n              }]\n            }]\n          })\n        }\n      }\n    }\n  })\n  viewmodel.setCache('formulaRules', rules);\n  runRule(viewmodel, rules, 'listener');\n}\n","/* eslint max-lines: [\"error\", 5000] */\n\nimport * as common from '../common'\nimport env from '../../helpers/env'\nimport uuid from 'uuid/v1';\nimport { runRules } from '../../staterule/rule';\nimport formularule from '../../staterule/formularule';\nimport mtl from 'mtl-js-sdk';\nimport {\n  mtlScan, mtlShare, mtlPlatform, mtlNetworkType,\n  mtlGetMac, mtlDail, mtlChooseImage, mtlGetLocation, mtlOpenLocation,\n  mtlGenerateQRCode, mtlRequest, mtlStartRecord, mtlStopRecord, mtlPlayVoice,\n  mtlPauseVoice, mtlStopVoice, mtlChangeScreenOrientation, mtlRestoreScreenOrientation, mtlSetStorage, mtlGetStorage, mtlRemoveStorage, mtlClearStorage, mtlUploadFile, mtlDownloadFile\n} from '../mtlapi'\n\nconst themeType = process.env.__THEMETYPE__;\n// 判断审批的环境\nconst submitUrls = {\n  daily: 'https://ys-u8c-daily.yyuap.com',\n  pre: 'https://ys-yonsuite-pre.diwork.com',\n  production: 'https://ys.diwork.com',\n  2020: 'http://ys-2020.yonyoucloud.com'\n}\nconsole.log('yyarchive server_env: ', process.env.SERVER_ENV)\nconst submitUrl = submitUrls[process.env.SERVER_ENV] || 'https://ys-u8c-daily.yyuap.com';\n// FLH u8cdev\nconst yyarchive = (function () {\n  const renderData = function (billNo, viewModel, params) {\n    render(viewModel, params.data, params.dirty, true);\n  }\n  const render = (viewmodel, data, dirty, isNewData) => {\n    if (viewmodel.getParams().menuId && !viewmodel.getParams().mode)\n      viewmodel.getParams().mode = env.VOUCHER_STATE_EDIT;\n    common.setRenderReadOnly(viewmodel)\n    if (dirty) {\n      viewmodel.setDirty(true)\n      viewmodel.loadDirtyData(data)\n      // common.getGridModel(viewmodel) && common.getGridModel(viewmodel).initRowState(cb.models.DataStates.Insert)\n      const gridModels = viewmodel.getGridModels();\n      gridModels.forEach(gridModel => {\n        gridModel.initRowState(cb.models.DataStates.Insert);\n      });\n      /* add by jinzh1 新增单据时，bIsNull为true的表格自动新增一行\n        条件：组织bCheck 时  check后  增行   清空组织不增\n              组织bCheck 为false时   afterLoadData后 增行\n        问题：是否存在无组织的业务单据也需要此功能\n      */\n      const { masterOrgField, autoAddRow } = viewmodel.getParams();\n      const isNcc = process.env.__THEMETYPE__ == 'ncc' // ncc不要自动增行\n      if (autoAddRow !== false && !isNcc)/* 扩展脚本支持控制去掉新增 自动增行功能 */\n        if (!cb.utils.isEmpty(masterOrgField) && viewmodel.get(masterOrgField).get('bCheck')) {\n          viewmodel.on('afterCheck', args => {\n            const { value, key } = args.params;\n            const { masterOrgField } = viewmodel.getParams();\n            if (key == masterOrgField) {\n              viewmodel.setCache('checkOrgReturnCache');/* 增加组织check后缓存 公共afterCheck和业务组afterCheck顺序导致可能发生的问题 */\n              if (value != 'null' && !cb.utils.isEmpty(value))\n                gridModels.forEach(gridModel => {\n                  if (viewmodel.getParams().mode === 'add' && !gridModel.get('bIsNull') && gridModel.getRowsCount() == 0 && gridModel.t2DInfo_Bus_IsShow2D() == false) {\n                    viewmodel.getParams().bInitAddRow = true;\n                    gridModel.appendRow({});\n                    viewmodel.getParams().bInitAddRow = false;\n                  }\n                });\n            }\n          });\n        } else {\n          viewmodel.on('afterLoadData', data => {\n            gridModels.forEach(gridModel => {\n              if (viewmodel.getParams().mode === 'add' && !gridModel.get('bIsNull') && gridModel.getRowsCount() == 0 && gridModel.t2DInfo_Bus_IsShow2D() == false) {\n                viewmodel.getParams().bInitAddRow = true;\n                gridModel.appendRow({});\n                viewmodel.getParams().bInitAddRow = false;\n              }\n            });\n          });\n        }\n    } else {\n      viewmodel.loadData(data)\n    }\n    if (isNewData)\n      _beforeRender(viewmodel);\n    common.setState(viewmodel)\n    if (isNewData)\n      _afterRender(viewmodel);\n    viewmodel.execute('afterLoadData', data, isNewData);\n    viewmodel.setCache('dataLoaded', true)\n    if (viewmodel.getParams().metaType !== 'treevoucher' || dirty) return;\n    viewmodel.validate(true);\n  }\n\n  const _beforeRender = function (viewModel) {\n    const { masterOrgField, masterOrgKeyField, mode } = viewModel.getParams();\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    masterOrgModel._set_data('bCanModify', mode === env.VOUCHER_STATE_ADD);\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    const orgId = model.getValue();\n    if (orgId && mode !== env.VOUCHER_STATE_BROWSE)\n      viewModel.setDisabled(false);\n    viewModel.biz.do('depends', viewModel) // merge: @liyc: merge YXYFrame\n  }\n\n  const _afterRender = function (viewModel) {\n    const { mode, hasBuildCoded, billNo, masterOrgField, masterOrgKeyField } = viewModel.getParams();\n    if (mode === env.VOUCHER_STATE_ADD && hasBuildCoded)\n      _createCode(billNo, viewModel);\n    viewModel.biz.do('depends', viewModel);\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    const orgId = model.getValue();\n    if (!orgId) {\n      viewModel.setDisabled(true);\n      viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n      masterOrgModel.setDisabled(false);\n    }\n  }\n\n  const _reloadVoucher = (bSwitchTpl, data, viewmodel, billNo, afterAct) => {\n    if (bSwitchTpl) {\n      const vmParams = {\n        tplid: data.tplid\n      }\n      vmParams.billData = data\n      const cbk = function (err, meta) {\n        const reloadVoucherCallback = (vm, view) => {\n          viewmodel.communication({\n            payload: {\n              menuName: view.cBillName,\n              vm: vm,\n              refresh: true,\n              metaData: view\n            }\n          })\n        }\n        _fetchMetaCallback(err, meta, billNo, reloadVoucherCallback, vmParams)\n      }\n      common.fetchMeta(billNo, vmParams, cbk)\n    } else {\n      _resetData(viewmodel, data, afterAct)\n    }\n  }\n\n  const _getTreeSelectNode = (viewmodel) => {\n    let selectNode,\n      node\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      selectNode = treeModel.getSelectedNodes()\n    }\n    if (selectNode && selectNode.length && selectNode[0]) {\n      node = selectNode[0]\n    }\n    return node\n  }\n\n  const _doService = (billNo, viewmodel, params, beforeAct, afterAct, allData) => {\n    if (viewmodel.getParams().metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel);\n      if (!node) {\n        cb.utils.alert('请选择有效数据', 'warning');\n        return;\n      }\n    }\n    common.doService(billNo, viewmodel, params, beforeAct, afterAct, _doServiceByData, allData)\n  }\n\n  const _doServiceByData = (viewmodel, postData, params, afterAct, successCallback) => {\n    const callback = function (err, res) {\n      if (!err) {\n        if (params.cShowCaption)\n          cb.utils.alert(`${params.cShowCaption}成功`, 'success')\n        else {\n          const msg = params.cAction == 'open' ? '启用' : '停用';\n          cb.utils.alert(`${msg}成功`, 'success')\n        }\n        if (viewmodel.getCache('banRenderNewData')) {\n          console.log('已禁止根据返回数据render')\n        } else {\n          const oldData = viewmodel.collectData(true)\n          res = Array.isArray(res) && res.length > 0 ? res[0] : res; // 兼容批量启用\n          const newData = common.billMerge(oldData, res)\n          if (viewmodel.getParams().metaType === 'treevoucher') {\n            // common.setMode(viewmodel, env.VOUCHER_STATE_EDIT);\n            viewmodel.getTreeModel().updateNode(newData);\n          }\n          render(viewmodel, newData)\n          if (newData && newData.isWfControlled) {\n            viewmodel.biz.do('refresh', viewmodel)\n          }\n        }\n        if (successCallback)\n          successCallback();\n      }\n      const afterActData = {\n        err: err,\n        res: res\n      }\n      if (afterAct) afterAct(afterActData, common.afterAct)\n    }\n    common.doProxy(params, callback, postData)\n  }\n\n  const _tplIsEquql = (data, viewmodel) => {\n    let result = false\n    if (!viewmodel.get(env.VOUCHER_TPL_KEY)) {\n      result = false\n    } else {\n      if (data[env.VOUCHER_TPL_KEY] != viewmodel.get(env.VOUCHER_TPL_KEY).getValue()) {\n        result = true\n      } else {\n        result = false\n      }\n    }\n    return result\n  }\n\n  const _resetData = (viewmodel, data, afterAct) => {\n    common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n    render(viewmodel, data)\n    if (!afterAct) return\n    afterAct({\n      res: data\n    }, common.afterAct)\n  }\n\n  const _loadVm = function (oldVM, newVM) {\n    newVM.originalVM = oldVM.originalVM\n    newVM.originalViewMeta = oldVM.originalViewMeta\n    newVM.biz.do('rule', newVM)\n    newVM.biz.do('initDefaultActions', newVM)\n  }\n\n  const _loadTree = (viewmodel, params, afterAct) => {\n    params = Object.assign({}, params, viewmodel.getCache('lastSearchCondition'));\n    const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n      return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdquerytree'\n    });\n    const proxyParams = configParams && configParams.cSvcUrl ? {\n      url: configParams.cSvcUrl,\n      method: configParams.cHttpMethod || 'POST'\n    } : {\n      url: 'bill/querytree',\n      method: 'POST'\n    };\n    const treeModel = viewmodel.getTreeModel();\n    if (!treeModel) return;\n    treeModel.promiseExecute('beforeLoad', params, function () {\n      treeModel.setDataSource(proxyParams, params);\n      if (afterAct)\n        treeModel.setCache('afterAct', afterAct);\n    });\n  }\n  const search = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.setCache('execFilter', true);\n    viewmodel.setCache('lastSearchCondition', params);\n    let data = {\n      billnum: billNo,\n      treename: common.getVmParams(viewmodel, 'treeName')\n    }\n    if (params && params instanceof Object) {\n      data = Object.assign(data, params)\n    }\n    const beforeActData = {\n      params: params,\n      data: params\n    }\n    beforeAct(beforeActData, function () {\n      _loadTree(viewmodel, data, afterAct)\n    })\n  }\n  const getModeDirtyData = function (viewmodel, ignoreConfirm = false, func) {\n    const data = viewmodel.getDirtyData(false);\n    if (data && !ignoreConfirm) {\n      cb.utils.confirm('确定要放弃当前修改吗？', function () {\n        func(true);\n      }, function () { // 取消\n        func(false);\n        const cancelEditFun = viewmodel.getCache('cancelEditFun');\n        if (cancelEditFun instanceof Function) {\n          cancelEditFun();\n        }\n      });\n    } else {\n      func(true);\n    }\n  }\n\n  const _bindTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel();\n    if (!treeModel) return;\n    treeModel.on('select', function (args, manually, ignoreConfirm) {\n      viewmodel.promiseExecute('beforeTreeSelect', args, function () {\n        if (args.length) {\n          getModeDirtyData(viewmodel, ignoreConfirm, (status) => {\n            if (status) {\n              common.setMode(viewmodel, manually && viewmodel.getParams().mode || env.VOUCHER_STATE_BROWSE);\n              _renderTreeVoucherData(billNo, viewmodel, args[0]);\n              viewmodel.setCache('lastMode', env.VOUCHER_STATE_BROWSE);\n            }\n          });\n        } else {\n          if (!cb.extendConfig.yyarchive.treeCard) {\n            // common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            viewmodel.biz.do('add', viewmodel);\n            // viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n          }\n        }\n      });\n    });\n    treeModel.on('afterSetDataSource', () => {\n      const afterAct = treeModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n    });\n  }\n\n  const _renderTreeVoucherData = (billNo, viewmodel, params) => {\n    const id = params[viewmodel.getTreeModel().getState('keyField')];\n    viewmodel.setCache('lastId', id && id.toString());\n    const hasChildren = viewmodel.getParams().hasChildren;\n    if (hasChildren) {\n      const data = {\n        billnum: billNo,\n        id\n      }\n      const callback = function (err, data) {\n        if (!err) {\n          if (!cb.extendConfig.yyarchive.treeCard || viewmodel.getParams().mode !== env.VOUCHER_STATE_ADD) {\n            render(viewmodel, data);\n          }\n        }\n      }\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n        return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmddetail';\n      });\n      const options = configParams && configParams.cSvcUrl ? {\n        cSvcUrl: configParams.cSvcUrl,\n        cHttpMethod: configParams.cHttpMethod || 'GET'\n      } : {\n        cSvcUrl: 'bill/detail',\n        cHttpMethod: 'GET'\n      };\n      common.doProxy(options, callback, data);\n    } else {\n      render(viewmodel, params);\n    }\n  }\n\n  const _fetchMetaCallback = function (err, meta, billNo, viewCallback, params, resolve, retryCallback) {\n    const extendCallback = (vm, view) => {\n      vm.viewCallback = viewCallback\n      vm.originalVM = vm\n      vm.originalParams = params\n      vm.originalViewMeta = meta.viewmeta\n      const data = {\n        vm,\n        view\n      }\n      resolve(data)\n    }\n    // const vmAndView =\n    common.initVM(err, meta, billNo, params, extendCallback, function (vm) {\n      vm.setCache('entryMode', params.mode);\n      vm.setCache('condition', params.condition);\n      vm.initData()\n      // _afterViewCallback(vm, params);\n    }, retryCallback)\n  }\n\n  const _afterViewCallback = function (billNo, vm, params) {\n    const backRefresh = (vm) => {\n      const params = JSON.parse(JSON.stringify(vm.getParams()));\n      Object.assign(params, { mode: env.VOUCHER_STATE_EDIT, id: vm.get('id').getValue() }); // fangqg: 临时删除 mode: env.VOUCHER_STATE_EDIT,\n      _getInitdata(billNo, params, function (err, billData) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        _resetData(vm, billData);\n      });\n    }\n    common.setMode(vm, params.mode);\n    // vm.setCache('entryMode', params.mode);\n    vm.on('refresh', function () {\n      backRefresh(vm);\n    });\n    vm.on('back', function () {\n      if (common.getMode(vm) !== env.VOUCHER_STATE_BROWSE) return;\n      backRefresh(vm);\n    });\n    const returnPromise = new cb.promise();\n    vm.on('return', function (caption) {\n      if (common.getMode(vm) === env.VOUCHER_STATE_BROWSE || !vm.getDirtyData(false))\n        return true;\n      if (caption && typeof caption === 'object') {\n        caption.prompt = {};\n        return true;\n      }\n      // returnSave(billNo, vm, function () {\n      //   returnPromise.resolve();\n      //   const parentViewModel = vm.getCache('parentViewModel');\n      //   if (parentViewModel)\n      //     parentViewModel.execute('refresh');\n      // });\n      // return returnPromise;\n      cb.utils.confirm(`确定要${caption}吗`, function () {\n        returnPromise.resolve();\n      }, function () {\n        returnPromise.reject();\n      });\n      return returnPromise;\n    });\n    // common.setRenderReadOnly(vm)\n    vm.biz.do('initDefaultActions', vm)\n    vm.on('afterRule', function () {\n      if (params.mode === env.VOUCHER_STATE_EDIT)\n        vm.execute('afterEdit');\n      if (params.action === 'copy')\n        vm.execute('afterCopy');\n    });\n    vm.on('afterCode', function () {\n      if (params.mode === env.VOUCHER_STATE_EDIT && vm.getParams().workflowNoCtrl) {\n        vm.setDisabled(true);\n        vm.get('btnAbandon') && vm.get('btnAbandon').setDisabled(false);\n      }\n    });\n  }\n\n  const _getInitdata = function (billNo, params, callback, beforeAct) {\n    const proxy = cb.rest.DynamicProxy.create({ getCmdList: { url: 'billmeta/getbillcommands', method: 'GET' } });\n    proxy.getCmdList({ billno: billNo }, function (_err, result) {\n      const postData = {\n        billnum: billNo\n      }\n      let cmdName, cSvcUrl, cHttpMethod\n      const mode = params && params.mode || env.VOUCHER_STATE_BROWSE\n      // if (mode === env.VOUCHER_STATE_BROWSE && params && params.readOnly) {\n      //   // 浏览态卡片刷新当前页面需要重置mode\n      //   mode = env.VOUCHER_STATE_EDIT;\n      // }\n      switch (mode) {\n        case env.VOUCHER_STATE_ADD:\n          cmdName = 'cmdadd';\n          cSvcUrl = 'bill/add'\n          cHttpMethod = 'POST'\n          Object.assign(postData, params.carryParams);\n          break\n        case env.VOUCHER_STATE_BROWSE:\n        case env.VOUCHER_STATE_EDIT:\n          cmdName = 'cmddetail';\n          cSvcUrl = 'bill/detail'\n          cHttpMethod = 'GET'\n          if (!params.id) {\n            callback();\n            return;\n          }\n          postData.id = params.id;\n          if (params.isSum)\n            postData.isSum = params.isSum;\n          Object.assign(postData, params.carryParams);\n          break\n        // case env.VOUCHER_STATE_BROWSE:\n        //   cmdName = 'cmdenter';\n        //   cSvcUrl = 'bill/enter'\n        //   cHttpMethod = 'GET'\n        //   postData.subid = params && params.subId\n        //   break\n      }\n      if (cmdName && result) {\n        const configParams = result.find(x => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === cmdName;\n        });\n        if (configParams && configParams.cSvcUrl) {\n          cSvcUrl = configParams.cSvcUrl;\n          cHttpMethod = configParams.cHttpMethod || 'GET'\n        }\n      }\n      if (params && params.readOnly === true) {\n        params.mode = env.VOUCHER_STATE_BROWSE\n      }\n      const par = {\n        cSvcUrl: cSvcUrl,\n        cHttpMethod: cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      if (beforeAct) {\n        beforeAct(beforeActData, function () {\n          common.doProxy(par, callback, postData)\n        })\n      } else {\n        common.doProxy(par, callback, postData)\n      }\n    });\n  }\n\n  const cellsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const args = [];\n    params.forEach(item => {\n      const column = viewModel.get(item.childrenField).getColumn(item.cellName);\n      if (!column.bCheck) return;\n      args.push({\n        location: item.rowIndex,\n        key: item.cellName,\n        childrenField: item.childrenField,\n        value: JSON.stringify(item.value),\n        type: item.cControlType,\n        fieldname: item.cFieldName,\n      });\n    });\n    common.batchCheck(billNo, viewModel, args);\n  }\n\n  const referRowsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const { childrenField, columnName, index, rows } = params;\n    const gridModel = viewModel.get(childrenField);\n    const column = gridModel.getColumn(columnName);\n    if (!column.bBatchCheck) return;\n    const data = {\n      location: index,\n      key: columnName,\n      childrenField,\n      value: JSON.stringify(rows),\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      mergeAll: true,\n    };\n    common.check(billNo, viewModel, data, beforeAct, afterAct, true);\n  }\n\n  const cellCheck = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = common.getGridModel(viewmodel, params)\n    const cellName = params.cellName\n    const column = gridModel.getColumn(cellName)\n    if (!column.bCheck) return;\n    const data = {\n      location: params.rowIndex,\n      key: cellName,\n      childrenField: params.childrenField,\n      value: JSON.stringify(params.value),\n      oldValue: params.oldValue,\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      async: params.async,\n      callback: params.callback,\n      context: params.context,\n    }\n\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      if (column.bCheck === true) {\n        const ruleItems = gridModel.getCache('ruleItems');\n        if (ruleItems && ruleItems.indexOf(cellName) > -1)\n          data.async = false;\n        common.check(billNo, viewmodel, data, beforeAct, afterAct, true)\n      }\n    })\n  }\n\n  const lineOpenOrClose = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) {\n      return\n    }\n    // let selectData = common.getGridModel(viewmodel, params).getSelectedRows()\n    const selectData = common.getGridModel(viewmodel, params).getRowsByIndexes(rowIndexes)\n    const index = rowIndexes[0]\n    const childrenField = common.getGridModel(viewmodel, params).getName()\n    const data = viewmodel.collectData(true)\n    data[childrenField] = selectData\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('操作成功', 'success')\n          const condition = {};\n          if (params && params.childrenField)\n            condition[params.childrenField] = [index];\n          const oldData = viewmodel.collectData(true)\n          const newData = common.billMerge(oldData, res, condition)\n          render(viewmodel, newData)\n          common.getGridModel(viewmodel, params).select([index])\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  const copy = function (billNo, viewModel, params, beforeAct, afterAct) {\n    if (!params || !params.cSvcUrl) return;\n    if (viewModel) {\n      params.mode = env.VOUCHER_STATE_EDIT;\n      params.id = viewModel.get('id').getValue();\n    }\n    const callback = function (err, emptyData) {\n      if (err) {\n        common.afterAct({ err });\n        return;\n      }\n      _getInitdata(billNo, params, function (err1, copyData) {\n        if (err1) {\n          common.afterAct({ err: err1 });\n          return;\n        }\n        const data = common.billCopy(copyData, emptyData);\n        if (viewModel) {\n          common.setMode(viewModel, env.VOUCHER_STATE_ADD);\n          render(viewModel, data, true, true);\n          afterAct();\n        } else {\n          params.mode = env.VOUCHER_STATE_ADD;\n          afterAct(null, data);\n        }\n      });\n    };\n    const postData = { billnum: billNo };\n    common.doProxy(params, callback, postData);\n  }\n\n  const refresh = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const refreshCallback = function (err, billData) {\n      if (!err && billData) {\n        const bSwitchTpl = _tplIsEquql(billData, viewmodel)\n        _reloadVoucher(bSwitchTpl, billData, viewmodel, billNo, afterAct)\n      } else {\n        const afterActData = {\n          err: err,\n          res: billData\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n    }\n    const pm = {\n      mode: env.VOUCHER_STATE_EDIT,\n      id: viewmodel.get('id').getValue(),\n      isSum: params && params.isSum\n    }\n    const beforeActData = {\n      params: params,\n      data: pm\n    };\n    beforeAct(beforeActData, function () {\n      _getInitdata(billNo, pm, refreshCallback, beforeAct)\n    })\n  }\n\n  const loadData = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const data = para.data// || {}\n    const mode = common.getMode(viewmodel)\n    const parent = common.getVmParams(viewmodel, 'parent')\n    let cCarry = common.getVmParams(viewmodel, 'cCarry')\n    const carryKeys = []\n    if (cCarry && parent) {\n      try {\n        cCarry = JSON.parse(cCarry)\n      } catch (error) {\n        console.error('列表cCarry JSON格式错误-->' + cCarry)\n        return\n      }\n\n      if (typeof (cCarry) === 'object') {\n        for (const key in cCarry) {\n          const value = cCarry[key]\n          data[key] = parent[value]\n          carryKeys.push(key)\n        }\n      }\n    }\n    // 携带需要setdirty true  否则保存不收集\n    carryKeys.map(key => {\n      const model = viewmodel.get(key)\n      if (model) {\n        model.setDirty(true)\n      }\n    })\n    const beforeActData = {\n      params: para,\n      data: data\n    }\n    beforeAct(beforeActData, function () {\n      render(viewmodel, data, mode == env.VOUCHER_STATE_ADD);\n    })\n    let whiteBillNo = billNo;\n    if (billNo.indexOf('Mobile') !== -1) {\n      whiteBillNo = billNo.split('Mobile')[0];\n    }\n    if (data.verifystate && data.verifystate !== 0) {\n      if (viewmodel.get('id')?.getValue()) {\n        const businessKey = `${whiteBillNo}_${viewmodel.get('id').getValue()}`;\n        _showApproveFlow(viewmodel, businessKey);\n      }\n    }\n  }\n  const buildDepends = function (billNo, viewModel) {\n    const depends = viewModel.get('depends');\n    if (!depends) return;\n    let model = null;\n    for (const attr in depends) {\n      try {\n        const _obj = JSON.parse(attr);\n        let _EditRowModel = null;\n        let _gridModel = null;\n        let _name = null;\n        const _grid = attr;\n        for (const i in _obj) {\n          _name = i;\n          _gridModel = viewModel.get(_obj[i])\n          _EditRowModel = _gridModel.getEditRowModel();\n          model = _EditRowModel.get(i);\n        }\n        _buildDepends(depends[_grid], _EditRowModel, model.getValue());\n        _EditRowModel.on('afterUpdateEditRowModel', (args) => {\n          if (!cb.utils.isEmpty(args[_name])) {\n            _buildDepends(depends[_grid], _EditRowModel, (args[_name] || 0));\n          }\n        }, depends[attr]);\n      } catch (e) {\n        model = viewModel.get(attr);\n        if (!model) continue;\n        model._set_data('needCheck', true);\n        _buildDepends(depends[attr], viewModel, model.getValue());\n        model.on('afterValueChange', function (args) {\n          _buildDepends(this, viewModel, args.value);\n        }, depends[attr]);\n      }\n    }\n  }\n  const _buildDepends = function (depends, viewModel, value) {\n    if (cb.utils.isEmpty(value)) return;\n    value = typeof value === 'string' ? Number(value) : value;\n    depends.forEach(item => {\n      if (item.childrenField) {\n        const gridModel = viewModel.get(item.childrenField);\n        if (gridModel instanceof cb.models.GridModel) {\n          gridModel.getEditRowModel().get(item.field).setState('iNumPoint', value);\n          gridModel.setColumnState(item.field, 'iNumPoint', value);\n        }\n      } else {\n        const simpleModel = viewModel.get(item.field);\n        if (simpleModel instanceof cb.models.SimpleModel)\n          simpleModel.setState('iNumPoint', value);\n      }\n    });\n  }\n  const buildOrg = function (billNo, viewModel) {\n    const { masterOrgField, carryParams } = viewModel.getParams();\n    if (!masterOrgField) return;\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    if (viewModel.getParams().mode !== env.VOUCHER_STATE_ADD) {\n      masterOrgModel._set_data('bCanModify', false);\n      masterOrgModel.setReadOnly(true);\n    }\n    masterOrgModel.on('beforeValueChange', function (args) {\n      orgId = model && model.getValue();\n      if (!orgId || args.value && args.value.id == orgId) return;\n      const promise = new cb.promise();\n      viewModel.promiseExecute('beforeChangeMasterOrg', function () {\n        cb.utils.confirm('切换主组织将清空数据，是否继续？', function () {\n          // if (model._get_data('needCheck'))\n          viewModel.setCache('delayCode', true);\n          promise.resolve();\n        });\n      });\n      return promise;\n    });\n    masterOrgModel.on('afterValueChange', function (args) {\n      if (!orgId && !cb.utils.isArray(args.value) && args.value) {\n        viewModel.setDisabled(false);\n        // common.setState(viewModel);\n        viewModel.execute('afterMasterOrgChange', model.getValue());\n      }\n      if (!orgId || args.value && args.value.id == orgId) return;\n      // if (model._get_data('needCheck'))\n      viewModel.clearCache('delayCode');\n      const carryData = {};\n      carryData[masterOrgKeyField] = args.value && args.value.id || null;\n      if (viewModel.get('code') && viewModel.getParams().hasBuildCoded) // && model._get_data('needCheck'))\n        carryData.code = viewModel.get('code').getValue();\n      viewModel.biz.do('add', viewModel, {\n        carryParams,\n        carryData,\n        callback: function () {\n          if (model._get_data('needCheck'))\n            _createCode(billNo, viewModel);\n          if (!cb.utils.isArray(args.value) && args.value) {\n            masterOrgModel.setValue([args.value]);\n          } else {\n            model.setValue(null, model._get_data('needCheck'));\n            viewModel.setDisabled(true);\n            viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n            masterOrgModel.setDisabled(false);\n          }\n          orgId = model.getValue();\n          masterOrgModel.execute('afterValueChange', args);\n          viewModel.execute('afterMasterOrgChange', orgId);\n        }\n      });\n    });\n    const keyMap = masterOrgModel.getState('bill2ReferKeyFieldMap') || {};\n    let masterOrgKeyField = null;\n    for (const attr in keyMap) {\n      if (masterOrgKeyField) break;\n      masterOrgKeyField = attr;\n    }\n    if (!masterOrgKeyField)\n      masterOrgKeyField = 'org';\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    viewModel.getParams().masterOrgKeyField = masterOrgKeyField;\n    let orgId = model.getValue();\n    if (!orgId) {\n      viewModel.setDisabled(true);\n      viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n      masterOrgModel.setDisabled(false);\n      return;\n    }\n    const { mode, realAdd, action } = viewModel.getParams();\n    if (mode !== env.VOUCHER_STATE_ADD || realAdd === false || action === 'copy') return;\n    masterOrgModel.browse(false, function (vm) {\n      vm.on('getRefMetaReady', function () {\n        const condition = {\n          isExtend: true,\n          simpleVOs: [{ field: 'id', op: 'in', value1: orgId }]\n        };\n        const errCallBack = function () {\n          model.setValue(null);\n          orgId = model.getValue();\n          viewModel.setDisabled(true);\n          viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n          masterOrgModel.setDisabled(false);\n          return false;\n        }\n        vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n      });\n    });\n  }\n\n  const buildCode = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const { isCoded, mode, realAdd } = viewModel.getParams();\n    if (!isCoded || realAdd === false) return;\n    const billNoIndexOf = billNo.toLocaleLowerCase().indexOf('mobile');\n    const data = { billNum: billNoIndexOf >= 0 ? billNo.substr(0, billNoIndexOf) : billNo };\n    const beforeActData = { params, data };\n    beforeAct(beforeActData, function () {\n      const proxy = cb.rest.DynamicProxy.create({ getCode: { url: 'billNumber/findByBillNum', method: 'GET' } });\n      proxy.getCode(data, function (err, result) {\n        if (err || !result) {\n          cb.utils.alert('获取单据编码规则错误: ' + err ? err.message : 'empty', 'error');\n          return;\n        }\n        const model = viewModel.get('code');\n        if (!model) return;\n        const canModify = !!result.ballowhandwork;\n        model._set_data('bCanModify', canModify);\n        model.setDisabled(!canModify);\n        afterAct();\n        if (canModify && !result.brepeatredo || !result.billPrefix || !result.billPrefix.length) return;\n        viewModel.getParams().hasBuildCoded = true;\n        if (mode === env.VOUCHER_STATE_ADD)\n          _createCode(data.billNum, viewModel);\n        const prefixes = [];\n        result.billPrefix.forEach(item => {\n          if (!item.cfieldname) return;\n          _buildCode(item.cfieldname, viewModel, data.billNum);\n          prefixes.push(item.cfieldname);\n        });\n        viewModel.setCache('prefixes', prefixes);\n      });\n    });\n  }\n\n  const _buildCode = function (fieldName, viewModel, billNo) {\n    const model = viewModel.get(fieldName);\n    if (!model) return;\n    model._set_data('needCheck', true);\n    model.on('afterValueChange', function () {\n      _createCode(billNo, viewModel);\n    });\n  }\n\n  const _createCode = function (billNo, viewModel) {\n    if (viewModel.getCache('delayCode')) return;\n    const proxy = cb.rest.DynamicProxy.create({ createCode: { url: 'billNumber/createCode?billNum=' + billNo, method: 'POST' } });\n    const data = viewModel.collectData();\n    proxy.createCode(data, function (err, result) {\n      if (err || !result) {\n        cb.utils.alert('设置单据编码规则错误: ' + err ? err.message : 'empty', 'error');\n        return;\n      }\n      viewModel.get('code').setValue(result);\n    });\n  }\n\n  const buildRule = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const postData = {\n      billNumber: billNo,\n      language: 'javascript'\n    }\n    const beforeActData = {\n      params: para,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.doProxy({\n        cSvcUrl: '/itemrule/script',\n        cHttpMethod: 'GET'\n      }, function (_err, data) {\n        // eslint-disable-next-line no-eval\n        data = eval(data) || {};\n        data && (data.rules || []).forEach(function (rule) {\n          const fields = {}\n          rule.triggers.forEach(function (trigger) {\n            const fieldName = trigger.ds\n            if (fieldName) {\n              if (!fields[fieldName])\n                fields[fieldName] = []\n              fields[fieldName].push(trigger.item)\n            } else {\n              if (!viewmodel.get(trigger.item)) return\n              viewmodel.get(trigger.item).on('afterValueChange', function () {\n                this.run(this.param)\n              }, {\n                run: data.run,\n                param: {\n                  ruleid: rule.id,\n                  vm: viewmodel,\n                  trigger: {\n                    ds: fieldName,\n                    item: trigger.item,\n                    lineid: '0'\n                  }\n                }\n              })\n            }\n          })\n          for (const attr in fields) {\n            if (!viewmodel.get(attr)) continue\n            viewmodel.get(attr).setCache('ruleItems', fields[attr]);\n            const callback = function (args) {\n              if (this.items.indexOf(args.cellName) === -1) return\n              this.param.trigger.item = args.cellName\n              this.param.trigger.lineid = '0:' + args.rowIndex\n              this.run(this.param)\n            }\n            const context = {\n              items: fields[attr],\n              run: data.run,\n              param: {\n                ruleid: rule.id,\n                vm: viewmodel,\n                trigger: {\n                  ds: attr\n                }\n              }\n            };\n            viewmodel.get(attr).on('afterCellValueChange', callback, context);\n            viewmodel.get(attr).on('innerCellValueChange', callback, context);\n            // fangqg: 删行、增行后重新执行公式计算\n            viewmodel.get(attr).on('afterDeleteRows', function () {\n              const childrenField = this.childrenField;\n              this.items.forEach(function (cellName) {\n                viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName });\n              });\n            }, {\n              items: fields[attr],\n              childrenField: attr\n            });\n            viewmodel.get(attr).on('afterInsertRow', function () {\n              const childrenField = this.childrenField;\n              this.items.forEach(function (cellName) {\n                viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName });\n              });\n            }, {\n              items: fields[attr],\n              childrenField: attr\n            });\n          }\n        })\n        const jointFields = {};\n        (data.jointFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!jointFields[fieldName])\n              jointFields[fieldName] = []\n            jointFields[fieldName].push(field.item)\n          } else {\n            if (!viewmodel.get(field.item)) return\n            viewmodel.get(field.item).on('jointQuery', function () {\n              let config = null;\n              try {\n                config = JSON.parse(this.param.vm.get(this.param.trigger.item).getState('cStyle'));\n              } catch (e) {\n                config = {};\n              }\n              const queryData = this.jointQuery(this.param)\n              const items = [];\n              for (const attr in queryData.paras) {\n                items.push(attr + '=' + queryData.paras[attr]);\n              }\n              config.menuCode = 'SJ0201';\n              if (config.menuCode) {\n                viewmodel.communication({ type: 'menu', payload: { menuCode: config.menuCode, menuUrl: '?' + items.join(',') } });\n                return;\n              }\n              const parent = this.param.vm\n              const dt = {\n                billtype: 'yyarchive',\n                billno: queryData.target,\n                params: cb.utils.extend(true, queryData.paras, {\n                  mode: env.VOUCHER_STATE_EDIT\n                })\n              }\n              cb.loader.runCommandLine('bill', dt, parent)\n            }, {\n              jointQuery: data.jointQuery,\n              param: {\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in jointFields) {\n          if (!viewmodel.get(attr)) continue\n          viewmodel.get(attr).on('cellJointQuery', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            const parent = this.param.vm\n            const dt = {\n              billtype: 'yyarchive',\n              billno: queryData.target,\n              params: cb.utils.extend(true, queryData.paras, {\n                mode: env.VOUCHER_STATE_EDIT\n              })\n            }\n            cb.loader.runCommandLine('bill', dt, parent)\n          }, {\n            items: jointFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n        const refFields = {};\n        (data.refFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!refFields[fieldName])\n              refFields[fieldName] = []\n            refFields[fieldName].push(field.item)\n          } else {\n            const referModel = viewmodel.get(field.item);\n            if (!referModel) return\n            referModel.on('beforeBrowse', function () {\n              const queryData = this.jointQuery(this.param)\n              if (!queryData) return\n              _setReferRule(queryData, this.referModel)\n            }, {\n              referModel: referModel,\n              jointQuery: data.jointQuery,\n              param: {\n                action: 'ref',\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in refFields) {\n          const referModel = viewmodel.get(attr);\n          if (!referModel) continue\n          referModel.on('beforeBrowse', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            if (!queryData) return\n            _setReferRule(queryData, args.context)\n          }, {\n            referModel: referModel,\n            items: refFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              action: 'ref',\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n\n        afterAct()\n      }, postData)\n    })\n  }\n  const _setReferRule = (queryData, referModel) => {\n    const target = queryData.target\n    if (target) {\n      if (target.cRefType) {\n        referModel.setRefCode(target.cRefType)\n      }\n      if (target.cRefRetId) {\n        referModel.setReturnFields(target.cRefRetId.refid)\n      }\n    }\n    referModel.setFilter({\n      isExtend: true,\n      simpleVOs: queryData.paras\n    })\n  }\n\n  const _resetOriginal = (viewmodel, afterAct) => {\n    const newVM = viewmodel.originalVM || viewmodel;\n    if (newVM.get(env.VOUCHER_TPL_KEY) && viewmodel.get(env.VOUCHER_TPL_KEY) && (newVM.getOriginalData()[env.VOUCHER_TPL_KEY] != viewmodel.get(env.VOUCHER_TPL_KEY).getValue())) {\n      viewmodel.communication({\n        payload: {\n          menuName: newVM.originalViewMeta.cBillName,\n          vm: newVM,\n          refresh: true,\n          metaData: newVM.originalViewMeta\n        }\n      })\n      _loadVm(viewmodel, newVM)\n    }\n    const mode = env.VOUCHER_STATE_BROWSE;\n    if (viewmodel.getCache('lastMode'))\n      common.setMode(newVM, viewmodel.getCache('lastMode'))\n    else if (viewmodel.getCache('entryMode') === env.VOUCHER_STATE_BROWSE || !viewmodel.getParams().menuId)\n      common.setMode(newVM, mode)\n    let newData = newVM.getOriginalData()\n    // 2019-11-27 Jarvan 如果有树且树节点有选中，则使用选中树的数据，否则使用原始数据\n    const treeModel = newVM.getTreeModel();\n    if (treeModel) {\n      const selectData = treeModel.getSelectedNodes();\n      if (selectData.length > 0) {\n        newData = selectData[0];\n      }\n    }\n\n    // end\n    if (newVM.get(env.VOUCHER_TPL_KEY) && !newData[env.VOUCHER_TPL_KEY]) {\n      newData[env.VOUCHER_TPL_KEY] = newVM.get(env.VOUCHER_TPL_KEY).get('cDefaultValue')\n    }\n    render(newVM, newData, mode === env.VOUCHER_STATE_ADD, true)\n    const afterActData = {\n      res: newData\n    }\n    afterAct(afterActData, common.afterAct)\n  }\n\n  const check = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (viewmodel.getParams().metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel)\n      if (node) {\n        const treeModel = viewmodel.getTreeModel();\n        params[treeModel.getState('parentField')] = node[treeModel.getState('keyField')];\n      }\n    }\n    const beforeActData = {\n      params: params,\n    }\n    beforeAct(beforeActData, function () {\n      const nullMsg = cb.extendConfig.theme === 'ncc';\n      common.check(billNo, viewmodel, params, beforeAct, afterAct, false, nullMsg)\n    })\n  }\n\n  const getAbandonText = cParameter => {\n    const parsedCParameter = cParameter ? JSON.parse(cParameter) : {};\n    return parsedCParameter.cAbandonText || '取消' // ncc没有cShowCaption的icon button显示cAbandonText字段\n  }\n\n  const abandon = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const beforeActData = {\n      params: params\n    }\n    beforeAct(beforeActData, function () {\n      const mode = common.getMode(viewmodel);\n      if (mode === env.VOUCHER_STATE_BROWSE && !viewmodel.getParams().menuId) {\n        // todo 移动处理\n        cb.route.goBack();\n        // viewmodel.communication({ type: 'return' });\n        return;\n      }\n      let data = viewmodel.getDirtyData(false);\n      const { metaType } = viewmodel.getParams();\n      if (metaType === 'treevoucher' && cb.extendConfig.yyarchive.treeCard) { // 树卡编辑态数据未修改,点击取消,需要有弹出信息\n        if (!data) {\n          data = viewmodel.getNecessaryData();\n        }\n      }\n      if (!data) {\n        _abandon(viewmodel, afterAct, billNo);\n        return;\n      }\n      const abandonText = params.cShowCaption || getAbandonText(params.cParameter)\n      cb.utils.confirm(`确定要${abandonText}么`, function () {\n        _abandon(viewmodel, afterAct, billNo);\n      }, function () {\n        if (params && params.enabledCallback)\n          params.enabledCallback();\n      });\n\n      // returnSave(billNo, viewmodel, _abandon);\n    });\n  }\n  const _abandon = function (viewmodel, afterAct, billNo) {\n    const { multitpl, metaType, menuId } = viewmodel.getParams();\n    if (multitpl || viewmodel.getCache('entryMode') !== env.VOUCHER_STATE_BROWSE && metaType !== 'treevoucher' && !menuId) {\n      // todo\n      cb.route.goBack();\n      // viewmodel.communication({ type: 'return' });\n      return;\n    }\n    _resetOriginal(viewmodel, afterAct);\n    if (metaType === 'treevoucher') {\n      const lastId = viewmodel.getCache('lastId');\n      if (!lastId) {\n        common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n        viewmodel.setDirty(false);\n        _resetOriginal(viewmodel, afterAct);\n        return;\n      };\n      const treeModel = viewmodel.getTreeModel();\n      if (!treeModel) return;\n      treeModel.select(lastId, undefined, true);\n      viewmodel.setDirty(false);\n      return;\n    }\n    // 兼容无流程取消后，按钮不显示问题\n    if (!viewmodel.get('verifystate')) {\n      if (viewmodel.get('btnEdit')) {\n        viewmodel.get('btnEdit').setVisible(true)\n      }\n      if (viewmodel.get('btnSaveAndAdd')) {\n        viewmodel.get('btnSaveAndAdd').setVisible(false)\n      }\n      if (viewmodel.get('btnSave')) {\n        viewmodel.get('btnSave').setVisible(false)\n      }\n      if (viewmodel.get('btnAbandon')) {\n        viewmodel.get('btnAbandon').setVisible(false)\n      }\n    } else {\n      if (viewmodel.get('verifystate') && viewmodel.get('verifystate').getValue() !== 0) {\n        let whiteBillNo = billNo;\n        if (billNo.indexOf('Mobile') !== -1) {\n          whiteBillNo = billNo.split('Mobile')[0];\n        }\n        if (viewmodel.get('id')?.getValue()) {\n          const businessKey = `${whiteBillNo}_${viewmodel.get('id').getValue()}`;\n          _showApproveFlow(viewmodel, businessKey);\n        }\n      }\n    }\n    viewmodel.validate(true);\n  }\n\n  const inValid = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const invalidReason = window.prompt('请输入作废理由', '')\n    let data = viewmodel.getNecessaryData()\n    if (invalidReason) {\n      data = cb.utils.extend(data, {\n        invalidReason\n      })\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      _doServiceByData(viewmodel, postData, params, afterAct)\n    })\n  }\n  const batchModify = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.communication({\n      type: 'modal',\n      payload: {\n        key: 'batchModify',\n        data: {\n          billType: 'yyarchive',\n          billNo: billNo,\n          model: viewmodel,\n          params: params\n        }\n      }\n    });\n  }\n  const submit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    console.log('submit ---->')\n    if (!viewmodel.get('id').getValue()) {\n      cb.invoker.publishLoadData(false)\n      cb.utils.alert('单据id属性不存在，请检查数据建模')\n      return\n    }\n    // if (mtl.platform !== 'upesn') {\n    //   cb.invoker.publishLoadData(false)\n    //   cb.utils.alert('pc预览端不支持审批流程，请用手机友空间扫码使用~')\n    //   return\n    // }\n    params.cShowCaption = '提交'\n    const data = viewmodel.collectData(true)\n    data.mobileBillNo = billNo;\n    data.mobileBillType = 'yyarchive';\n    if (billNo.indexOf('Mobile') !== -1) {\n      billNo = billNo.split('Mobile')[0];\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    const businessKey = `${billNo}_${viewmodel.get('id').getValue()}`;\n    beforeAct(beforeActData, function () {\n      // 提交成功回调\n      _doServiceByData(viewmodel, postData, params, afterAct, function () {\n        _showApproveFlow(viewmodel, businessKey);\n      });\n    })\n  }\n\n  const _showApproveFlow = (viewmodel, businessKey) => {\n    if (mtl.platform === 'upesn') {\n      mtl.upesn.getUserYHTInfo({\n        success: function(res) {\n          const modelData = {\n            appsource: 'developplatform',\n            businessKey,\n            sourceType: 'actionInit', // 判断是审批动作\n            bpmHost: submitUrl,\n            userId: res.yht_userid,\n            tenantId: res.tenant_id\n          }\n          console.log(JSON.stringify(res));\n          // 找审批组件\n          const models = cb.utils.getViewModelByType(viewmodel, 'approveflow');\n          if (models?.length > 0) {\n            models.forEach(model => {\n              model.setData(modelData)\n              console.log('modelData : ', JSON.stringify(modelData))\n            })\n          } else {\n            console.log('未找到审批组件');\n          }\n        },\n        fail: err => {\n          console.log(JSON.stringify(err));\n        }\n      });\n    } else {\n      // pc预览取userId和tenantId\n      const userId = _getcookie('yonyou_uid')\n      let tenantId\n      if (window.location.search.substring(1)) {\n        const tenantIdTemp = window.location.search.substring(1).split('tenantId=')\n        if (tenantIdTemp && tenantIdTemp.length > 1) {\n          tenantId = tenantIdTemp[1].split('&')[0]\n        }\n      }\n      console.log('pc submit => tenantId:', tenantId, ' ; userId:', userId)\n      const modelData = {\n        appsource: 'developplatform',\n        businessKey,\n        sourceType: 'actionInit', // 判断是审批动作\n        bpmHost: 'https://ys-u8c-daily.yyuap.com',\n        userId: userId,\n        tenantId: tenantId\n      }\n      const models = cb.utils.getViewModelByType(viewmodel, 'approveflow');\n      if (models?.length > 0) {\n        models.forEach(model => {\n          model.setData(modelData)\n        })\n      } else {\n        console.log('未找到审批组件');\n      }\n    }\n  }\n\n  const _getcookie = (objname) => {\n    const arrstr = document.cookie.split('; ');\n    for (let i = 0; i < arrstr.length; i++) {\n      const temp = arrstr[i].split('=')\n      if (temp[0] == objname) return unescape(temp[1]);\n    }\n  }\n\n  const unsubmit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    console.log('unsubmit --->')\n    let data = viewmodel.collectData()\n\n    if (process.env.__THEMETYPE__ == 'ncc') {\n      // ncc 需要收集子表信息\n      data = viewmodel.collectData(true);\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      _doServiceByData(viewmodel, postData, params, afterAct, function () {\n        if (viewmodel.getParams().workflowNoCtrl)\n          delete viewmodel.getParams().workflowNoCtrl;\n      })\n    })\n  }\n  const checkApprove = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const postData = {\n      billNum: billNo,\n      billId: viewmodel.get('id'),\n      billCode: viewmodel.get('code')\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          type: 'platform',\n          url: 'checkapprove',\n          model: viewmodel,\n          data: postData\n        }\n      })\n      afterAct()\n    })\n  }\n\n  const workflow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const businessKey = `${billNo}_${viewmodel.get('id').getValue()}`;\n    const data = {\n      width: 850,\n      height: 510,\n      appsource: env.appCode,\n      businessKey\n    };\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      const flowCompIns = window.flowComp(data);\n      flowCompIns.showFlowBox({\n        onClose(callbackData) {\n          // viewmodel.communication({ type: 'refresh' });\n          refresh(billNo, viewmodel, params, beforeAct, afterAct);\n        }\n      });\n    });\n  }\n\n  const audit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (viewmodel.get('isWfControlled') && viewmodel.get('isWfControlled').getValue()) {\n      if (!(viewmodel.get('verifystate') && viewmodel.get('verifystate').getValue() === 1)) {\n        cb.utils.alert('请先提交', 'error')\n        return;\n      }\n      const businessKey = `${billNo}_${viewmodel.get('id').getValue()}`;\n      const flowCompIns = window.flowComp({\n        width: 850,\n        height: 510,\n        appsource: 'u8c',\n        businessKey\n      });\n      flowCompIns.showFlowBox({\n        onClose(callbackData) {\n          viewmodel.communication({ type: 'refresh' });\n        }\n      });\n\n      // let postData = {\n      //   billNum: billNo,\n      //   billId: viewmodel.get('id'),\n      //   billCode: viewmodel.get('code')\n      // }\n      // let beforeActData = {\n      //   params: params,\n      //   data: postData\n      // }\n      // beforeAct(beforeActData, function () {\n      //   viewmodel.communication({\n      //     type: 'modal',\n      //     payload: {\n      //       type: 'platform',\n      //       url: 'approve',\n      //       model: viewmodel,\n      //       data: postData\n      //     }\n      //   })\n      //   afterAct()\n      // })\n    } else {\n      const data = viewmodel.collectData(true)\n      const postData = {\n        billnum: billNo,\n        data: JSON.stringify(data)\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      beforeAct(beforeActData, function () {\n        _doServiceByData(viewmodel, postData, params, afterAct)\n      })\n    }\n  }\n\n  // 启用\n  const open = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'open';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(`是否确认${params.cShowCaption}此记录`, function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n    }\n  };\n  // 停用\n  const close = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'close';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(`是否确认${params.cShowCaption}此记录`, function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n    }\n  };\n  const table2DBtnClick = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    viewmodel.execute('table2DBtnClick');\n  }\n  const addRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    // viewmodel.communication({\n    //   type: 'modal',\n    //   payload: {\n    //     key: 'openTable2D',\n    //     data: {\n    //       billNo: billNo,\n    //       gridModel: common.getGridModel(viewmodel, params),\n    //       params: params\n    //     }\n    //   }\n    // });\n    // return;\n    const gridModel = common.getGridModel(viewmodel, params);\n    const support2D = gridModel.t2DInfo_Bus_Get('support2D');\n    const show2D = gridModel.t2DInfo_Bus_Get('show2D');\n    if (support2D && show2D) {\n      viewmodel.execute('table2DAddRowClick');\n    }\n    else {\n      const beforeActData = {\n        params: params\n      }\n      beforeAct(beforeActData, function () {\n        const data = common.getGridModel(viewmodel, params).appendRow()\n        beforeActData.data = data;\n        afterAct(beforeActData)\n      })\n    }\n  }\n\n  const deleteRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('请选择行', 'warning');\n\n      return;\n    }\n    delete params.params;\n    const beforeActData = {\n      params: params,\n      data: rowIndexes\n    }\n    beforeAct(beforeActData, function () {\n      const data = common.getGridModel(viewmodel, params).deleteRows(rowIndexes)\n      afterAct(data)\n    })\n  }\n\n  const insertRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('请选择行', 'warning');\n      return;\n    }\n    const beforeActData = {\n      params: params,\n      data: rowIndexes\n    }\n    beforeAct(beforeActData, function () {\n      if (!rowIndexes.length) {\n        return\n      }\n      // const data = common.getGridModel(viewmodel, params).insertRow(rowIndexes[0])\n      common.getGridModel(viewmodel, params).insertRow(rowIndexes[0])\n      afterAct(beforeActData)\n    })\n  }\n\n  const copyRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('请选择行', 'warning');\n      return;\n    }\n    // let rowData = common.getGridModel(viewmodel, params).getSelectedRows()\n    const rowData = common.getGridModel(viewmodel, params).getRow(rowIndexes[0])\n    const beforeActData = {\n      params: params,\n      data: {\n        rowIndexes,\n        rowData\n      }\n    }\n    beforeAct(beforeActData, function () {\n      const data = common.getGridModel(viewmodel, params).insertRow(rowIndexes[0], beforeActData.data.rowData);// fixbug：wuxlr select 值展示有问题\n      beforeActData.data.rowData = data;\n      afterAct(beforeActData)\n    })\n  }\n\n  const shiftUpRow = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewModel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) return;\n    const rowIndex = rowIndexes[0];\n    const args = {\n      params: params,\n      data: rowIndex\n    };\n    beforeAct(args, function () {\n      common.getGridModel(viewModel, params).shiftUpRow(rowIndex);\n      afterAct(args);\n    });\n  };\n\n  const shiftDownRow = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewModel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) return;\n    const rowIndex = rowIndexes[0];\n    const args = {\n      params: params,\n      data: rowIndex\n    };\n    beforeAct(args, function () {\n      common.getGridModel(viewModel, params).shiftDownRow(rowIndex);\n      afterAct(args);\n    });\n  };\n\n  const localPrint = function (billNo, viewModel, params, beforeAct, afterAct) {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'localprint';\n      });\n      Object.assign(params, configParams);\n    }\n    const id = viewModel.get('id').getValue();\n    if (cb.utils.isEmpty(id)) {\n      cb.utils.alert('未找到具体单据', 'error');\n      return;\n    }\n    const route = params && params.cSvcUrl || '/bill';\n    const { disabledCallback, enabledCallback } = params;\n    let printTplItemName = '';\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      printTplItemName = cParameter && cParameter.printTplItemName;\n    }\n    if (!printTplItemName) {\n      cb.utils.alert('请预置打印按钮的cParameter信息 { printTplItemName : 打印模板的cItemName}', 'warning');\n      return;\n    }\n\n    const templatesModel = viewModel.get(printTplItemName);\n    if (templatesModel) {\n      const templateCode = templatesModel.getValue();\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('请选择打印模板', 'error');\n        return;\n      }\n      if (disabledCallback) {\n        disabledCallback();\n        params.disabledCallback = false;\n      }\n      _localPrint(billNo, templateCode, id, route, beforeAct, enabledCallback);\n    } else {\n      if (disabledCallback) {\n        disabledCallback();\n        params.disabledCallback = false;\n      }\n      const proxy = cb.rest.DynamicProxy.create({\n        getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } }\n      });\n      proxy.getTemplate({ billno: billNo }, function (err, data) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          if (enabledCallback)\n            enabledCallback();\n          return;\n        }\n        const template = data.length === 1 ? data[0] : data.find(item => {\n          return item.isdefault;\n        });\n        if (cb.utils.isEmpty(template)) {\n          cb.utils.alert('没有设置打印模板，请检查', 'error');\n          if (enabledCallback)\n            enabledCallback();\n          return;\n        }\n        _localPrint(billNo, template.templatecode, id, route, beforeAct, enabledCallback);\n      });\n    }\n  }\n\n  const _localPrint = function (billno, templateCode, id, route, beforeAct, enabledCallback) {\n    const proxy = cb.rest.DynamicProxy.create({\n      print: { url: route + '/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    const params = { billno, templateCode, ids: [id] };\n    proxy.print(params, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        if (enabledCallback)\n          enabledCallback();\n        return;\n      }\n      beforeAct(result, function () {\n        cb.utils.localPrint(result);\n        if (enabledCallback)\n          enabledCallback();\n      });\n    });\n  }\n  const isInWorkBench = function (model) {\n    let bReturn = false;\n    const key = 'isInWorkBench';\n    bReturn = isModelHasKey(model, key);\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    return bReturn;\n  }\n  const isHideAlert = function (model) {\n    let bReturn = false;\n    const key = 'isHideAlert';\n    bReturn = isModelHasKey(model, key);\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    return bReturn || false;\n  }\n\n  const isModelHasKey = function (model, key) {\n    return (model && (model.getCache(key) == true)) || false;\n  }\n\n  const save = function (billNo, viewmodel, params, beforeAct, afterAct, caption) {\n    let requestBillNo = billNo;\n    if (requestBillNo.indexOf('Mobile') !== -1) {\n      requestBillNo = billNo.split('Mobile')[0];\n    }\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'save';\n      });\n      Object.assign(params, configParams);\n    }\n    const invalidMsg = viewmodel.validate();\n    if (invalidMsg) {\n      // if (params.dimensionGroupCode)\n      if (isHideAlert(viewmodel) == true)\n        afterAct({ err: { message: '以下数据项校验失败：' + invalidMsg.join(',') } })\n      /* delete by jinzh1 去掉校验提示 */\n      else if (cb.extendConfig.theme === 'ncc')\n        cb.utils.alert(viewmodel.getCache('customErrorMessage') || '以下数据项校验失败：' + invalidMsg.join(','), 'error');\n      else {\n        const invalidFields = viewmodel.getCache('invalidFields');\n        if (invalidFields) {\n          const msg = []; let bHasMoreMsg = false;\n          invalidFields.forEach(field => {\n            const property = viewmodel.get(field);\n            const bShowIt = property.get('bShowIt');\n            const bHidden = property.get('bHidden');\n            if (bShowIt === false || bHidden) {\n              msg.push(property._get_data('cShowCaption') || property._get_data('cCaption') || property._get_data('cFieldName'))\n            } else {\n              bHasMoreMsg = true;\n            }\n          });\n          if (msg.length > 0 && !bHasMoreMsg)\n            cb.utils.alert('存在隐藏必输数据项：' + msg.join(','), 'error');\n          else\n            cb.utils.alert('存在必输项，请填写完整！', 'error');\n        }\n      }\n      console.log('保存失败---以下数据项校验失败：' + invalidMsg.join(','));\n      cb.invoker.publishLoadData(false)\n      return;\n    }\n    const mode = common.getMode(viewmodel)\n    const { metaType } = viewmodel.getParams();\n    let data = viewmodel.collectData()\n    if (!data) {\n      if (metaType !== 'treevoucher') {\n        cb.utils.alert('未作任何修改')\n        viewmodel.setReadOnly(true)\n        common.setState(viewmodel)\n      }\n      cb.invoker.publishLoadData(false)\n      return\n    }\n    if (metaType == 'editablevoucherlist') {\n      data = data[viewmodel.getGridModel().getName()]\n    }\n    if (mode == env.VOUCHER_STATE_ADD) {\n      data._status = cb.models.DataStates.Insert\n      if (metaType === 'treevoucher') {\n        const treeModel = viewmodel.getTreeModel();\n        const parentData = data[treeModel.getState('parentField')];\n        if (parentData) {\n          if (treeModel) {\n            const parentNode = treeModel.getNodesByKeys(parentData);\n            if (parentNode && parentNode.length)\n              data.level = parentNode[0].level + 1;\n          }\n        } else {\n          data.level = 1;\n        }\n      }\n      const parentId = common.getVmParams(viewmodel, 'parentId') // 树表新建时的父类\n      if (parentId != undefined) {\n        const key = common.getVmParams(viewmodel, 'foreignKey') // 档案的parentid\n        if (key) {\n          data[key] = parentId\n        }\n      }\n    } else {\n      data._status = cb.models.DataStates.Update\n    }\n\n    for (const val in data) {\n      if (Array.isArray(data[val]) && data[val].length > 0) {\n        for (const item of data[val]) {\n          if (item.id && item._status == cb.models.DataStates.Insert) {\n            item._status = cb.models.DataStates.Update\n          }\n        }\n      }\n    }\n\n    const postData = Object.assign({\n      billnum: requestBillNo,\n      data: JSON.stringify(data)\n    }, params.defineParams);\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        // if (err) {\n        //   cb.utils.alert(err.message, 'error');\n        //   return;\n        // }\n        let newData = res;\n        const afterActData = {\n          params,\n          err: err,\n          res: newData\n        }\n        if (!err) {\n          // 解决单据ID赋值出错 主要原有saveandaudit 状态没处理好\n          // if (newData) {\n          //   for (const val in newData) {\n          //     if (Array.isArray(newData[val]) && newData[val].length > 0) {\n          //       for (let itemVal = 0; itemVal < newData[val].length; itemVal++) {\n          //         if (viewmodel.get(val) && viewmodel.get(val).get('dataSource') &&\n          //           viewmodel.get(val).get('dataSource')[itemVal] &&\n          //           newData[val][itemVal]) {\n          //           const childData = viewmodel.get(val).get('dataSource')[itemVal]\n          //           childData.tenant_id = newData[val][itemVal].tenant_id\n          //           childData.id = newData[val][itemVal].id\n          //         }\n          //       }\n          //     }\n          //   }\n          // }\n          viewmodel.setDirty(false);// 解决保存的时候，出现弹框的问题\n          // 处理分页显示状态\n          _handlePageInfoStatus(viewmodel, params, res);\n          if (metaType === 'treevoucher' && viewmodel.getTreeModel) {\n            _loadTree(viewmodel, {\n              billnum: billNo,\n              treename: common.getVmParams(viewmodel, 'treeName')\n            }, function () { });\n          }\n          if (isHideAlert(viewmodel) == false) {\n            const content = `${caption || params.cShowCaption || params.cCaption || '保存'}成功`;\n            if (window.parent !== window && cb.rest.AppContext.query.random)\n              window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random, msg: { type: 'success', content } }, '*');\n            else\n              cb.utils.alert(content, 'success')\n          }\n          /* 生单工作台 */\n          //   if (params.dimensionGroupCode) {\n          if (isInWorkBench(viewmodel) == true) {\n            afterAct(afterActData, common.afterAct);\n            return\n          }\n          const { menuId } = viewmodel.getParams();\n          if (viewmodel.getCache('entryMode') === env.VOUCHER_STATE_BROWSE || !menuId)\n            common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n          const currentAction = params.cAction.trim().toLocaleLowerCase();\n          if (currentAction === 'saveandadd') {\n            // 更新树数据\n            if (metaType === 'treevoucher') {\n              const treeModel = viewmodel.getTreeModel();\n              viewmodel.execute('updateTreeRefer')\n              if (viewmodel.getParams().saveRefresh) {\n                // 通过设置 defaultSelectedKeys，避免tree刷新后请求第一个节点的数据(造成二次请求)，直接请求要选中的节点的数据。\n                const key = newData[treeModel.getState('keyField')];\n                treeModel._set_data('defaultSelectedKeys', [key])\n                _loadTree(viewmodel, {\n                  billnum: billNo,\n                  treename: common.getVmParams(viewmodel, 'treeName')\n                }, function () { });\n              } else {\n                if (mode !== env.VOUCHER_STATE_ADD) {\n                  treeModel.updateNode(newData)\n                } else {\n                  treeModel.addNode(newData)\n                }\n              }\n            }\n\n            afterAct(afterActData, common.afterAct);\n            return/* 保存并新增 */\n          }\n          //  暂时去除，saveandaudit 该逻辑在新增后数据的各种状态问题没有做任何处理，有很多问题。该内部逻辑与作者咨询无用\n          //  if (currentAction !== 'saveandaudit' && viewmodel.getParams().saveReturn !== false && (viewmodel.getParams().multitpl ||\n          //  viewmodel.getCache('entryMode') !== env.VOUCHER_STATE_BROWSE) && metaType !== 'treevoucher' && !menuId) {\n          //   // 移动的详情保存后直接进入详情\n          //   if (res.id) {\n          //     cb.route.replacePage(`/view/yyarchive/${billNo}?mode=browse&_id=${res.id}&readOnly=true`);\n          //   }\n          //   if (viewmodel.get('verifystate')) {\n          //     if (typeof (viewmodel.get('verifystate').getValue()) === 'undefined') {\n          //       viewmodel.get('verifystate').setValue(0);\n          //     } else {\n          //       if (viewmodel.get('verifystate').getValue() === 0) {\n          //         if (viewmodel.get('btnSubmit')) {\n          //           viewmodel.get('btnSubmit').setVisible(true)\n          //         }\n          //       }\n          //       if (viewmodel.get('btnEdit')) {\n          //         viewmodel.get('btnEdit').setVisible(true)\n          //       }\n          //       if (viewmodel.get('btnSaveAndAdd')) {\n          //         viewmodel.get('btnSaveAndAdd').setVisible(false)\n          //       }\n          //       if (viewmodel.get('btnSave')) {\n          //         viewmodel.get('btnSave').setVisible(false)\n          //       }\n          //       if (viewmodel.get('btnAbandon')) {\n          //         viewmodel.get('btnAbandon').setVisible(false)\n          //       }\n          //     }\n          //   } else {\n          //     if (viewmodel.get('btnEdit')) {\n          //       viewmodel.get('btnEdit').setVisible(true)\n          //     }\n          //     if (viewmodel.get('btnSaveAndAdd')) {\n          //       viewmodel.get('btnSaveAndAdd').setVisible(false)\n          //     }\n          //     if (viewmodel.get('btnSave')) {\n          //       viewmodel.get('btnSave').setVisible(false)\n          //     }\n          //     if (viewmodel.get('btnAbandon')) {\n          //       viewmodel.get('btnAbandon').setVisible(false)\n          //     }\n          //   }\n          //   if (cb.utils.isEmpty(viewmodel.get('id')?.getValue()) && res) {\n          //     viewmodel.get('id') && viewmodel.get('id').setValue(res.id);\n          //   }\n          //   afterAct(afterActData, common.afterAct);\n          //   viewmodel.communication({ type: 'return', payload: viewmodel.get('id')?.getValue() });\n          //   return;\n          // }\n          if (!viewmodel.get('verifystate')) {\n            if (viewmodel.get('btnEdit')) {\n              viewmodel.get('btnEdit').setVisible(true)\n            }\n            if (viewmodel.get('btnSaveAndAdd')) {\n              viewmodel.get('btnSaveAndAdd').setVisible(false)\n            }\n            if (viewmodel.get('btnSave')) {\n              viewmodel.get('btnSave').setVisible(false)\n            }\n            if (viewmodel.get('btnAbandon')) {\n              viewmodel.get('btnAbandon').setVisible(false)\n            }\n          }\n          // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n          const gridModels = viewmodel.getGridModels();\n          gridModels.forEach(gridModel => {\n            gridModel.unselectAll()\n          });\n          const oldData = viewmodel.collectData(true)\n          let condition;\n          const arrayKeys = []\n          for (const key in res) {\n            if (Array.isArray(res[key]) && viewmodel.get(key)?.getDirtyRowIndexes?.()?.length > 0) {\n              arrayKeys.push(key)\n              condition = {};\n            }\n          }\n\n          arrayKeys.forEach((key) => {\n            condition[key] = viewmodel.get(key).getDirtyRowIndexes()\n          })\n          newData = common.billMerge(oldData, res, condition)\n          render(viewmodel, newData)\n          if (metaType === 'treevoucher') {\n            const treeModel = viewmodel.getTreeModel();\n            common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n            viewmodel.execute('updateTreeRefer')\n            if (viewmodel.getParams().saveRefresh) {\n              // 通过设置 defaultSelectedKeys，避免tree刷新后请求第一个节点的数据(造成二次请求)，直接请求要选中的节点的数据。\n              const key = newData[treeModel.getState('keyField')];\n              treeModel._set_data('defaultSelectedKeys', [key])\n              _loadTree(viewmodel, {\n                billnum: billNo,\n                treename: common.getVmParams(viewmodel, 'treeName')\n              }, function () { });\n            } else {\n              if (mode !== env.VOUCHER_STATE_ADD) {\n                treeModel.updateNode(newData)\n              } else {\n                treeModel.addNode(newData, true)\n              }\n            }\n          }\n          // render(viewmodel, newData)\n        }\n        // let afterActData = {\n        //   params,\n        //   err: err,\n        //   res: newData\n        // }\n        afterAct(afterActData, common.afterAct)\n      }\n      params.options = { mask: true };\n      common.doProxy(params, callback, postData)\n    })\n    // }\n  }\n  const _delete = function (viewmodel, params, postData, afterAct, isReturn) {\n    const { metaType } = viewmodel.getParams();\n    common.doProxy(params, function (err, suc) {\n      if (!err) {\n        viewmodel.setCache('deleteError', false);\n        cb.utils.alert('操作成功', 'success')\n        if (metaType === 'treevoucher') {\n          const treeModel = viewmodel.getTreeModel()\n          if (treeModel) {\n            const key = treeModel.getSelectedKeys()\n            if (key && key.length == 1) {\n              const selectedNode = treeModel.getSelectedNodes()[0];\n              const nextNode = treeModel.getNextSibling(selectedNode);\n              const prevNode = treeModel.getPrevSibling(selectedNode);\n              const parentNode = treeModel.getParentNode(selectedNode);\n              treeModel.deleteNode(key)\n              if (cb.extendConfig.yyarchive.treeCard || (cb.extendConfig.treeVoucher || {}).selectAfterDelete === null) {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel)\n              } else if ((cb.extendConfig.treeVoucher || {}).selectAfterDelete === 'prev') {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel, treeModel._get_data('dataSource'));\n                treeModel.selectNodes(prevNode || nextNode || parentNode);\n              } else if ((cb.extendConfig.treeVoucher || {}).selectAfterDelete === 'next') {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel, treeModel._get_data('dataSource'));\n                treeModel.selectNodes(nextNode || prevNode || parentNode);\n              }\n              else {\n                const dataSource = treeModel._get_data('dataSource') || [];\n                if (dataSource.length > 0) {\n                  common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                  render(viewmodel, treeModel._get_data('dataSource'));\n                  treeModel.selectNodes(nextNode || prevNode || parentNode);\n                } else {\n                  // viewmodel.clear()\n                  common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n                  // _render(viewmodel);\n                  viewmodel.biz.do('add', viewmodel);\n                }\n              }\n            }\n          }\n        } else {\n          // ncc 没有查询条件删除返回列表\n          if (!viewmodel.getCache('condition') && process.env.__THEMETYPE__ == 'ncc') {\n            viewmodel.communication({ type: 'return' });\n            return;\n          }\n\n          if (viewmodel.getParams().menuId) {\n            if (window.parent !== window && window.jDiwork)\n              jDiwork.closeWin();\n            else\n              render(viewmodel);\n          }\n          else if (!isReturn)\n            viewmodel.communication({ type: 'return' });\n        }\n        // viewmodel.execute('moveprev')\n        if (viewmodel.getCache('returnList')) {\n          viewmodel.communication({\n            type: 'return'\n          });\n          viewmodel.setCache('returnList', false);\n        }\n      }\n      else {\n        viewmodel.setCache('deleteError', true);\n      }\n      const afterActData = {\n        err: err,\n        res: suc\n      }\n      afterAct(afterActData, common.afterAct)\n    }, postData)\n  }\n  const doDelete = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const { metaType } = viewmodel.getParams();\n    if (metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel)\n      if (!node) {\n        cb.utils.alert('请选择有效数据', 'warning');\n        return;\n      }\n      if (node && node.children && node.children.length > 0) {\n        if (!cb.extendConfig.yyarchive.treeCard) {\n          cb.utils.alert('有下级，不能删除', 'warning')\n          return\n        }\n      }\n    }\n    let data = viewmodel.getNecessaryData();\n    if (metaType === 'treevoucher' && cb.extendConfig.yyarchive.treeCard) { // ncc树删除,需要特殊处理一下数据\n      const node = _getTreeSelectNode(viewmodel);\n      data = node;\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const text = viewmodel.getParams().caption;\n      let isReturn = false;\n      cb.utils.confirm(`是否确认删除此${text}`, function () {\n        // 支持用户动态跳转前一个卡片还是后一个卡片\n        let deleteReturn = cb.extendConfig.yyarchive.deleteReturn;\n        if (deleteReturn && !viewmodel.getParams().menuId && metaType !== 'treevoucher') {\n          // 重新判断加载规则\n          if (themeType == 'ncc') {\n            deleteReturn = _handlePageInfoStatus(viewmodel, params);\n          }\n          const nextAction = viewmodel.allActions.find((x) => {\n            const cmdDelRe = `cmd${deleteReturn}`;\n            return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === cmdDelRe\n          });\n          if (nextAction) {\n            viewmodel.biz.do(deleteReturn, viewmodel, nextAction);\n            isReturn = true;\n          }\n        }\n        if (viewmodel.getCache('isReturn')) {\n          isReturn = true;\n        }\n        if (metaType === 'treevoucher' && cb.extendConfig.yyarchive.treeCard) { // ncc树卡删除需要特殊处理\n          cb.utils.confirm('删除时要做业务引用校验，可能等待的时间较长，是否确认删除？', function () {\n            if (data && data.children && data.children.length > 0) {\n              cb.utils.confirm(`该操作将会删除当前${text}及其子${text}，是否继续？`, function () {\n                _delete(viewmodel, params, postData, afterAct, isReturn);\n              });\n            }\n            else {\n              _delete(viewmodel, params, postData, afterAct, isReturn);\n            }\n          });\n        }\n        else {\n          _delete(viewmodel, params, postData, afterAct, isReturn);\n        }\n      }, function () {\n        if (params && params.enabledCallback)\n          params.enabledCallback();\n      })\n    });\n  }\n\n  const moveFirstOrLast = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const postData = {\n      billnum: billNo,\n      condition: viewmodel.getCache('condition')\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct);\n        if (!err) {\n          // 处理分页按钮显示状态\n          _handlePageInfoStatus(viewmodel, params);\n          render(viewmodel, res)\n        }\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  const movePrevOrNext = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    viewmodel.setCache('deleteError', false);\n    // ncc 没有查询条件不在请求数据\n    if (!viewmodel.getCache('condition') && process.env.__THEMETYPE__ == 'ncc') return;\n    const httpMethod = params.cHttpMethod ? params.cHttpMethod.toLocaleLowerCase() : 'get';\n    // get请求 传的过滤参数需要转换\n    const condition = httpMethod == 'get' ? encodeURI(JSON.stringify(viewmodel.getCache('condition'))) : viewmodel.getCache('condition');\n\n    const postData = {\n      billnum: billNo,\n      id: viewmodel.get('id').getValue(),\n      condition: condition\n    }\n    // cb.utils.extend(postData, viewmodel.getNecessaryData())\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          const bSwitchTpl = _tplIsEquql(res, viewmodel);\n          const deleteError = viewmodel.getCache('deleteError')\n          if (!deleteError) {\n            _reloadVoucher(bSwitchTpl, res, viewmodel, billNo, afterAct)\n          }\n          // 处理分页显示状态；\n          _handlePageInfoStatus(viewmodel, params);\n        } else {\n          const afterActData = {\n            err: err,\n            res: res\n          }\n          if (err && !res) {\n            viewmodel.setCache('returnList', true);\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  // 拉单\n  const pull = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    const targetCode = queryString.get('code')\n    const targetBillNo = queryString.get('targetBillNo')\n    if (targetCode && targetBillNo) {\n      const queryData = {\n        code: targetCode,\n        isMainSelect: 1,\n        childIds: [viewmodel.get('id').getValue()]\n      }\n      const par = {\n        cSvcUrl: queryString.pathname + queryString.toStr(),\n        cHttpMethod: params.cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: queryData\n      }\n      beforeAct(beforeActData, function () {\n        const callback = function (err, data) {\n          if (!err) {\n            const params = {\n              mode: env.VOUCHER_STATE_ADD,\n              carryData: data\n            }\n            const dt = {\n              billtype: 'yyarchive',\n              billno: targetBillNo,\n              params: params\n            }\n            cb.loader.runCommandLine('bill', dt, viewmodel)\n          }\n          const afterActData = {\n            err: err,\n            res: data\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        common.doProxy(par, callback, queryData)\n      })\n    }\n  }\n  const saveAndAdd = (billNo, viewModel, params) => {\n    let saveParams = viewModel.allActions && viewModel.allActions.find(item => {\n      return item.cAction.trim().toLocaleLowerCase() === 'save';\n    });\n    if (!saveParams) {\n      cb.utils.alert('没有取到保存参数', 'error');\n      return;\n    }\n    saveParams = Object.assign({}, saveParams, { cAction: params.cAction });\n    const beforeSave = (beforeActData, callback) => {\n      viewModel.promiseExecute('beforeSave', beforeActData, callback);\n    };\n    const afterSave = (afterActData, callback) => {\n      viewModel.promiseExecute('afterSave', afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    save(billNo, viewModel, saveParams, beforeSave, function (afterSaveData) {\n      afterSave(afterSaveData, function () {\n        cb.invoker && cb.invoker.publishLoadData(false)\n        if (afterSaveData.err) {\n          common.afterAct(afterSaveData);\n          return;\n        }\n        viewModel.clear(false);\n        let addParams = viewModel.allActions && viewModel.allActions.find(item => {\n          return item.cAction.trim().toLocaleLowerCase() === 'add';\n        });\n        // if (!addParams) {\n        //   cb.utils.alert('没有取到提交参数', 'error');\n        //   return;\n        // }\n        addParams = Object.assign({}, addParams, { cAction: params.cAction });\n        const beforeAdd = (beforeActData, callback) => {\n          viewModel.promiseExecute('beforeAdd', beforeActData, callback);\n        };\n        const afterAdd = (afterActData, callback) => {\n          viewModel.promiseExecute('afterAdd', afterActData, function () {\n            callback && callback(afterActData);\n            const propertyNames = viewModel._get_data('propertyNames');\n            propertyNames.forEach(function (propertyName) {\n              const property = viewModel.get(propertyName);\n              if (property instanceof cb.models.BaseModel) {\n                property.doPropertyChange('validate', {\n                  type: '',\n                  message: ''\n                });\n              }\n            }, viewModel);\n          });\n        };\n        addParams.saveData = afterSaveData.res;/* add by jinzh1 新增并保存 增加保存后数据为入参 */\n        add(billNo, viewModel, addParams, beforeAdd, afterAdd);\n        window.location.reload()\n      });\n    });\n  }\n  const saveAndAudit = (billNo, viewModel, params) => {\n    let saveParams = viewModel.allActions && viewModel.allActions.find(item => {\n      return item.cAction.trim().toLocaleLowerCase() === 'save';\n    });\n    if (!saveParams) {\n      cb.utils.alert('没有取到保存参数', 'error');\n      return;\n    }\n    saveParams = Object.assign({}, saveParams, { cAction: params.cAction });\n    const beforeSave = (beforeActData, callback) => {\n      viewModel.promiseExecute('beforeSave', beforeActData, callback);\n    };\n    const afterSave = (afterActData, callback) => {\n      viewModel.promiseExecute('afterSave', afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    save(billNo, viewModel, saveParams, beforeSave, function (afterSaveData) {\n      afterSave(afterSaveData, function () {\n        if (afterSaveData.err) {\n          common.afterAct(afterSaveData);\n          return;\n        }\n        let auditParams = viewModel.allActions && viewModel.allActions.find(item => {\n          return item.cAction.trim().toLocaleLowerCase() === 'audit';\n        });\n        if (!auditParams) {\n          cb.utils.alert('没有取到提交参数', 'error');\n          return;\n        }\n        auditParams = Object.assign({}, auditParams, { cAction: params.cAction });\n        const beforeAudit = (beforeActData, callback) => {\n          viewModel.promiseExecute('beforeAudit', beforeActData, callback);\n        };\n        const afterAudit = (afterActData, callback) => {\n          viewModel.promiseExecute('afterAudit', afterActData, function () {\n            callback && callback(afterActData);\n          });\n        };\n        audit(billNo, viewModel, auditParams, beforeAudit, afterAudit);\n      });\n    });\n  }\n  const add = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (!viewmodel) {\n      return _getInitdata(billNo, params, afterAct);\n      // const { cSvcUrl, cHttpMethod } = params.params;\n      // const callback = function (err, emptyData) {\n      //   if (err) {\n      //     common.afterAct({ err });\n      //     return;\n      //   }\n      //   afterAct(null, emptyData);\n      // };\n      // const postData = Object.assign({ billnum: billNo }, params.carryParams);\n      // common.doProxy({ cSvcUrl, cHttpMethod }, callback, postData);\n      // return;\n    }\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'add';\n      });\n      Object.assign(params, configParams);\n    }\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    let callbackdata = []\n    if (queryString.has('code')) {\n      const dt = {\n        billtype: 'billmaker',\n        billno: queryString.get('billno'),\n        params: {\n          code: queryString.get('code'),\n          makeBilltype: queryString.get('makeBilltype')\n        }\n      }\n      cb.loader.runCommandLine('bill', dt, null, function (vm, viewmeta) {\n        const callback = function (err, suc) {\n          callbackdata = suc\n          const afterActData = {\n            err: err,\n            params: params,\n            res: suc\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        const postData = {\n          billnum: billNo\n        }\n        const beforeActData = {\n          params: params,\n          data: postData\n        };\n        beforeAct(beforeActData, function () {\n          common.emptyBill(postData, params, callback)\n          vm.on('afterOkClick', function (args) {\n            if (args.data) {\n              common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n              const newdata = common.billMerge(args.data, callbackdata)\n              render(viewmodel, newdata, true)\n            }\n          })\n          vm.on('close', function () {\n            viewmodel.communication({\n              type: 'modal',\n              payload: false\n            })\n          })\n          viewmodel.communication({\n            type: 'modal',\n            payload: {\n              type: 'platform',\n              url: 'billmaker',\n              model: viewmodel,\n              data: {\n                vm: vm,\n                viewmeta: viewmeta\n              }\n            }\n          })\n        })\n      })\n    } else {\n      let selectedNode;\n      const { metaType } = viewmodel.getParams();\n      if (metaType === 'treevoucher') {\n        const maxLevel = viewmodel.getTreeModel().getState('maxLevel');\n        const level = maxLevel === false ? 65536 : (maxLevel || 3);\n        selectedNode = _getTreeSelectNode(viewmodel)\n        if (selectedNode && selectedNode.level > level) {\n          cb.utils.alert(`分类最多${level + 1}级`, 'error');\n          return;\n        }\n        // common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n      }\n      let postData = {\n        billnum: billNo\n      }\n      Object.assign(postData, params.carryParams);\n      if (metaType === 'treevoucher' && cb.extendConfig.yyarchive.treeCard) {\n        const treeModel = viewmodel.getTreeModel();\n        const parentId = treeModel.getState('keyField');\n        postData = Object.assign({}, postData, {\n          [parentId]: selectedNode && selectedNode[treeModel.getState('keyField')]\n        });\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      };\n      beforeAct(beforeActData, function () {\n        common.emptyBill(postData, params, function (err, suc) {\n          const afterActData = {\n            err: err,\n            params: params,\n            res: suc\n          }\n          if (!err) {\n            common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            viewmodel.addData = suc\n            if (viewmodel.get(env.VOUCHER_TPL_KEY)) {\n              const currentTpl = viewmodel.get(env.VOUCHER_TPL_KEY).getValue()\n              suc[env.VOUCHER_TPL_KEY] = currentTpl\n            }\n            if (metaType === 'treevoucher') {\n              const treeModel = viewmodel.getTreeModel();\n              const parentField = treeModel.getState('parentField');\n              if (cb.extendConfig.yyarchive.treeCard && suc)\n                if (suc[parentField] == null) {\n                  if (selectedNode) {\n                    suc[parentField] = selectedNode[treeModel.getState('keyField')];\n                    suc.parent_name = selectedNode.name;\n                  }\n                }\n            }\n            if (cb.extendConfig && cb.extendConfig.theme == 'ncc') {\n              render(viewmodel, suc, true);\n            } else {\n              render(viewmodel, Object.assign({}, suc, params.carryData), true, !params.carryData);\n            }\n            // render(viewmodel, suc);\n            if (params.callback)\n              params.callback();\n            else {\n              const { masterOrgField, masterOrgKeyField } = viewmodel.getParams();\n              const masterOrgModel = viewmodel.get(masterOrgField);\n              if (masterOrgModel) {\n                const model = viewmodel.get(masterOrgKeyField);\n                if (model) {\n                  const orgId = model.getValue();\n                  if (orgId) {\n                    const condition = {\n                      isExtend: true,\n                      simpleVOs: [{ field: 'id', op: 'in', value1: orgId }]\n                    };\n                    const errCallBack = function () {\n                      model.setValue(null);\n                      viewmodel.setDisabled(true);\n                      viewmodel.get('btnAbandon') && viewmodel.get('btnAbandon').setDisabled(false);\n                      masterOrgModel.setDisabled(false);\n                      return false;\n                    }\n                    const vm = masterOrgModel.getCache('vm');\n                    if (vm) {\n                      vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n                    } else {\n                      masterOrgModel.browse(false, function (vm) {\n                        vm.on('getRefMetaReady', function () {\n                          vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n                        });\n                      });\n                    }\n                  }\n                }\n              }\n            }\n          }\n          afterAct(afterActData, common.afterAct)\n        })\n      })\n    }\n  }\n  const getPredicateValue = formatValue => {\n    const exp = /<%.*?%>/g;\n    const items = formatValue.match(exp);\n    if (!items)\n      return formatValue;\n    const values = {};\n    let valid = true;\n    items.forEach(item => {\n      const predicate = item.substring(2, item.length - 2).split('.');\n      if (predicate.length !== 2) {\n        valid = false;\n        return;\n      }\n      const obj = cb.rest.AppContext[predicate[0]];\n      values[item] = obj && (cb.utils.isEmpty(obj[predicate[1]]) ? '' : obj[predicate[1]]);\n    });\n    if (!valid)\n      return formatValue;\n    return formatValue.replace(exp, function (key) {\n      return values[key];\n    });\n  }\n  const localoutput = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const XLSX = require('xlsx');\n    const outputData = viewmodel.get(`${params.childrenField}`).getData();\n    const dataColumns = viewmodel.get(`${params.childrenField}`).getColumns();\n    const res = [];\n    const tmpObj = {};\n    // 取每一行需要导出的数据\n    for (let i = 0; i < outputData.length; i++) {\n      const resObj = {};\n      for (const key in dataColumns) {\n        const keyName = dataColumns[key].cShowCaption ? dataColumns[key].cShowCaption : dataColumns[key].cCaption;\n        if (dataColumns[key].bShowIt && !dataColumns[key].bHidden) {\n          const resDetails = outputData[i];\n          const resSonObj = {};\n          resSonObj.cShowCaption = keyName;\n          resSonObj.cControlType = dataColumns[key].cControlType;\n          resSonObj.cFormatData = dataColumns[key].cFormatData;\n          resSonObj.iNumPoint = dataColumns[key].iNumPoint;\n          resSonObj.cEnumString = dataColumns[key].cEnumString;\n          let enumValue = null;\n          if (dataColumns[key].cEnumString) {\n            const enumString = dataColumns[key].cEnumString;\n            const lookupVector = Object.keys(eval('(' + enumString + ')')); // eslint-disable-line no-eval\n            const resultVector = Object.values(eval('(' + enumString + ')')); // eslint-disable-line no-eval\n            const thisLoc = lookupVector.indexOf(resDetails[key].toString());\n            enumValue = resultVector[thisLoc];\n          }\n          resSonObj.iColWidth = dataColumns[key].iColWidth;\n          tmpObj[key] = resSonObj;\n          resObj[keyName] = enumValue || resDetails[key];\n        }\n      }\n      res.push(resObj);\n    }\n    // 导出文件的文件名\n    const fileName = `${billNo}.xlsx`;\n    const sheet = XLSX.utils.json_to_sheet(res);\n    // 行数(除header)\n    const sheetRowCount = res.length;\n    // 列数\n    const colCount = Object.keys(res[0]).length;\n    sheet['!cols'] = new Array(colCount);\n    const rowRange = XLSX.utils.decode_range(sheet['!ref']);\n    for (let R = 0; R <= 1; ++R) {\n      for (let C = rowRange.s.c; C <= rowRange.e.c; ++C) {\n        if (R == 0) {\n          const cell_address = { c: C, r: R };\n          /* if an A1-style address is needed, encode the address */\n          const cell_ref = XLSX.utils.encode_cell(cell_address);\n          const value = sheet[cell_ref].v;\n          for (const key in tmpObj) {\n            if (tmpObj[key].cShowCaption === value) {\n              const controlType = tmpObj[key].cControlType;\n              const cellConfig = tmpObj[key];\n              let cFormatData = cellConfig.cFormatData;\n              sheet['!cols'][C] = { wpx: cellConfig.iColWidth };\n              if (cFormatData === 'YYYY-MM-DD') {\n                const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                  const thisCell_address = { c: C, r: R };\n                  const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                  sheet[thisCell_ref].t = 'd';\n                }\n              }\n              // 枚举\n              // let enumString = cellConfig.cEnumString;\n              // if (enumString) {\n              //   let lookupVector = Object.keys(eval(\"(\" + enumString + \")\"));\n              //   let resultVector = Object.values(eval(\"(\" + enumString + \")\"));\n              //   let strLookup = JSON.stringify(lookupVector).replace(/\\[(.*)\\]/, \"$1\");\n              //   let strResult = JSON.stringify(resultVector).replace(/\\[(.*)\\]/, \"$1\");\n              //   let colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n              //   for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n              //     let thisCell_address = { c: C, r: R };\n              //     let thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n              //     let cellValue = sheet[thisCell_ref].v;\n              //     // let thisLoc = lookupVector.indexOf(cellValue.toString());\n              //     // sheet[thisCell_ref].v = resultVector[thisLoc];\n              //     let func = `LOOKUP(\"${cellValue}\",{${strLookup}},{${strResult}})`;\n              //     sheet[thisCell_ref].f = func;\n              //   }\n\n              // }\n\n              switch (controlType && controlType.trim().toLocaleLowerCase()) {\n                case 'inputnumber':\n                case 'money':\n                case 'price': {\n                  try {\n                    if (!cFormatData || cFormatData == '') {\n                      cFormatData = {};\n                    } else {\n                      cFormatData = JSON.parse(cFormatData);\n                    }\n                  } catch (e) {\n                    cb.utils.alert('数量/金额/单价，预制错误！', 'error');\n                  }\n                  let iNumPoint = cellConfig.iNumPoint;\n                  const decimal = cFormatData.decimal ? getPredicateValue(cFormatData.decimal) : null;\n                  if (controlType === 'money') {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                      iNumPoint = cb.rest.AppContext.option.amountofdecimal;\n                  } else if (controlType === 'price') {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                      iNumPoint = cb.rest.AppContext.option.monovalentdecimal;\n                  } else {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                    if (cb.utils.isEmpty(iNumPoint)) iNumPoint = null;\n                  }\n                  if (controlType === 'money' || (cFormatData.decimal && cFormatData.decimal.indexOf('amountofdecimal'))) {\n                    cFormatData.splitter = true\n                    // 千分位处理(无小数位)\n                    if (!iNumPoint) {\n                      const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                      for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                        // eslint-disable-next-line camelcase\n                        const thisCell_address = { c: C, r: R };\n                        // eslint-disable-next-line camelcase\n                        const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                        sheet[thisCell_ref].z = XLSX.SSF._table[3];\n                      }\n                    }\n                  }\n                  if (iNumPoint) {\n                    // 小数位处理(有无千分位)\n                    const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                    for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                      const thisCell_address = { c: C, r: R };\n                      const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                      let decimalCount = cFormatData.splitter ? '#,##0.0' : '0.0'\n                      for (let i = 1; i < iNumPoint; i++) {\n                        decimalCount = decimalCount + '0';\n                      }\n                      sheet[thisCell_ref].z = decimalCount;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        } else if (R === 1) {\n          const cell_address = { c: C, r: R };\n          /* if an A1-style address is needed, encode the address */\n          const cell_ref = XLSX.utils.encode_cell(cell_address);\n          if (sheet[cell_ref].t === 'n') {\n            let length = sheet[cell_ref].v.toString().length;\n            if (sheet[cell_ref].z) {\n              const re = /[0-9]+\\.([0-9]*)/;\n              // 小数位数\n              const deciLength = sheet[cell_ref].v.toString().replace(re, '$1').length;\n              length = length + deciLength;\n            } else if (length >= 12) {\n              // 解决科学计数法\n              const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n              for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                const thisCell_address = { c: C, r: R };\n                const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                sheet[thisCell_ref].z = XLSX.SSF._table[1];\n              }\n            }\n          } else if (sheet[cell_ref].t === 'b') {\n            const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n            for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n              const thisCell_address = { c: C, r: R };\n              const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n              sheet[thisCell_ref].t = 's';\n              sheet[thisCell_ref].v = sheet[thisCell_ref].v ? '是' : '否';\n              // sheet[thisCell_ref].f = `IF(${sheet[thisCell_ref].v},\"是\",\"否\")`;\n            }\n          }\n        }\n      }\n    }\n    const wb = XLSX.utils.book_new();\n    // wb中增加一个sheet\n    XLSX.utils.book_append_sheet(wb, sheet, `${params.childrenField}`);\n    // 导出 Excel\n    XLSX.writeFile(wb, fileName);\n  }\n  const output = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    if (!queryString) {\n      return\n    }\n    const inputParams = {\n      // bill: {\n      billnum: billNo,\n      ids: [viewmodel.get('id').getValue()].join(),\n      id: viewmodel.get('id').getValue(),\n      data: params.data,\n      partParam: params.partParam\n      //   tplid: printID\n      // },\n      // type: 'yyarchive',\n      // format: format\n    }\n    const url = queryString && queryString.pathname + queryString.toStr()\n\n    const beforeActData = {\n      params: params,\n      data: inputParams\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, inputParams);\n      afterAct()\n    })\n  }\n\n  const savebo = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const proxy = cb.rest.DynamicProxy.create({\n      saveBo: { url: 'print/saveBo', method: 'GET' }\n    })\n    proxy.saveBo({ billno: billNo }, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      cb.utils.alert('保存业务对象成功', 'success');\n    });\n  }\n\n  const preview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const actionName = params.params && params.params.cAction;\n    if (actionName === 'localPrint') {\n      const localPrintButtonModel = viewmodel.get('btnLocalPrint');\n      if (localPrintButtonModel) {\n        params.disabledCallback = function () {\n          localPrintButtonModel.setDisabled(true);\n        }\n        params.enabledCallback = function () {\n          localPrintButtonModel.setDisabled(false);\n        }\n      }\n      viewmodel.biz.do(actionName, viewmodel, params);\n      return;\n    }\n    beforeAct({ params }, function () {\n      let printTplItemName = '';\n      let template = '';\n      let errInfo = '';\n\n      if (params.cParameter) {\n        const cParameter = JSON.parse(params.cParameter);\n        printTplItemName = cParameter && cParameter.printTplItemName;\n      }\n      if (!printTplItemName) {\n        errInfo = '请预置打印按钮的cParameter信息{printTplItemName : 打印模板的cItemName}';\n      }\n      else {\n        template = viewmodel.get(printTplItemName).getValue();\n        if (!template) {\n          errInfo = '请选择打印模板。';\n        }\n      }\n      if (errInfo != '') {\n        cb.utils.alert(errInfo, 'warning');\n        afterAct({ err: errInfo });\n        return;\n      }\n\n      const newTab = window.open('about:blank');\n      const proxy = cb.rest.DynamicProxy.create({\n        preview: { url: 'print/printPreview', method: 'POST' }\n      })\n      proxy.preview({\n        route: params.cSvcUrl || '/bill',\n        billno: billNo,\n        template: template,\n        ids: [viewmodel.get('id').getValue()]\n      }, function (err, result) {\n        if (!err)\n          newTab.location.href = result;\n        const afterActData = {\n          err: err,\n          res: result\n        };\n        afterAct(afterActData, common.afterAct);\n      });\n    });\n  }\n\n  const print = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const postData = {\n      json: {\n        bill: {\n          billnum: billNo,\n          ids: [viewmodel.get('id').getValue()],\n          tplid: printID\n        },\n        type: 'yyarchive'\n      }\n    }\n\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n\n  const initDefaultActions = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const allActions = viewmodel.allActions\n    const beforeActData = {\n      params: params,\n      data: allActions\n    };\n    beforeAct(beforeActData, function () {\n      viewmodel.on('moveprev', function () {\n        const prevAction = allActions.find((x) => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdmoveprev'\n        })\n        if (prevAction) {\n          movePrevOrNext(billNo, viewmodel, prevAction)\n        }\n      })\n      viewmodel.on('movenext', function () {\n        const nextAction = allActions.find((x) => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdmovenext'\n        })\n        if (nextAction) {\n          movePrevOrNext(billNo, viewmodel, nextAction)\n        }\n      })\n      if (viewmodel.get(env.VOUCHER_TPL_KEY)) {\n        viewmodel.get(env.VOUCHER_TPL_KEY).on('afterValueChange', function (data) {\n          if (data && data.value) {\n            viewmodel.biz.do('selecttpl', viewmodel, data)\n          }\n        })\n      }\n      afterAct()\n    })\n  }\n\n  const selectTpl = function (billNo, oldVM, params, beforeAct, afterAct) {\n    params.tplid = params.value.value\n    const cbk = (err, result) => {\n      const vmAndView = common.initVM(err, result, billNo, params)\n      if (vmAndView) {\n        const { vm: newVM, view: newView } = vmAndView\n        oldVM.communication({\n          payload: {\n            menuName: newView.cBillName,\n            vm: newVM,\n            refresh: true,\n            metaData: newView\n          }\n        })\n        _loadVm(oldVM, newVM)\n        common.setMode(newVM, common.getMode(oldVM))\n        let loadData,\n          setData\n        if (common.getMode(newVM) == env.VOUCHER_STATE_ADD) {\n          loadData = oldVM.collectData(true)\n          setData = oldVM.addData\n        } else {\n          loadData = oldVM.getOriginalData()\n          setData = oldVM.collectData(true)\n        }\n        newVM.setData(setData)\n        render(newVM, loadData, common.getMode(newVM) == env.VOUCHER_STATE_ADD)\n\n        if (afterAct) afterAct()\n      }\n    }\n    const beforeActData = {\n      params: params,\n    };\n    beforeAct(beforeActData, function () {\n      common.fetchMeta(billNo, params, cbk)\n    })\n  }\n\n  const push = function (billNo, viewModel, params, beforeAct, afterAct) {\n    console.log('begin-push--' + new Date().valueOf())\n    if (viewModel) {\n      common.push(viewModel, params, viewModel.collectData(true), beforeAct, afterAct);\n      return;\n    }\n    if (!params || !params.cSvcUrl) return;\n    const queryString = new cb.utils.queryString(params.cSvcUrl);\n    const groupCode = queryString.get('groupCode'); const targetCode = queryString.get('code');\n    if (!targetCode) return;\n    const callback = function (err, pushData) {\n      if (err) {\n        if (window.parent !== window && cb.rest.AppContext.query.random)\n          window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random, args: err.message }, '*');\n        else\n          common.afterAct({ err });\n        return;\n      }\n      if (window.parent !== window && cb.rest.AppContext.query.random)\n        window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random }, '*');\n      if (!pushData.targetData) return;\n      // fangqg: 默认新增，加上状态值会认为是假新增\n      delete pushData.targetData._status;\n      params.carryParams = params.carryParams || {};\n      params.carryParams.externalData = pushData.targetData;\n      params.targetData = pushData.targetData;\n      /* 肖静说  一条数据直接进单据 */\n      if (pushData.dimensionKeys && pushData.dimensionKeys.length > 1)\n        params.dimensionKeys = pushData.dimensionKeys;\n      params.dimensionGroupCode = groupCode;\n      params.groupTaskKey = pushData.dimensionKeys && pushData.dimensionKeys.length && pushData.dimensionKeys[0].groupTaskKey;\n      params.bWorkbench = !!groupCode;\n      /* delete by jinzh1 非工作台模式  saveReturn不可为false */\n      // if (params.bWorkbench == false)\n      // if (params.bWorkbench)\n      // params.saveReturn = false;\n      pushData.targetData.dimensionKey = pushData.dimensionKeys && pushData.dimensionKeys[0] && pushData.dimensionKeys[0].key\n      _getInitdata(billNo, params, function (err1, emptyData) {\n        if (err1) {\n          common.afterAct({ err1 });\n          return;\n        }\n        console.log('_getInitdata-push--' + new Date().valueOf())\n        afterAct(null, common.billMerge(emptyData, pushData.targetData));\n        console.log('afterAct-push--' + new Date().valueOf())\n      });\n    };\n    if (!cb.utils.isArray(params.data))\n      params.data = [params.data];\n    const ids = []; const detailIds = [];\n    params.data.forEach(item => {\n      ids.push(item.id);\n      if (params.pushKey)\n        detailIds.push(item[params.pushKey]);\n    });\n    const childIds = params.pushKey ? detailIds : Array.from(new Set(ids));\n    const mainIds = params.pushKey ? Array.from(new Set(ids)) : undefined;\n    const postData = {\n      code: targetCode,\n      isMainSelect: params.pushKey ? 0 : 1,\n      childIds, // cb.utils.isArray(params.data) ? params.data : [params.data.id],\n      mainIds,\n      data: params.data,\n      groupCode: groupCode\n    };\n    Object.assign(postData, params.carryParams);\n    console.log('doProxy-push--' + new Date().valueOf())\n    common.doProxy(params, callback, postData);\n  }\n  const compositeAction = (billNo, viewModel, params) => {\n    let firstAction = null;\n    let Act = null;\n    try {\n      const defineParams = JSON.parse(params.cParameter);\n      firstAction = defineParams.action.split('&')[0].replace(/(\\w)/, function (v) {\n        return v.toUpperCase()\n      });\n      Act = viewModel.biz.action()[firstAction.trim().toLocaleLowerCase()];\n      if (!Act) return;\n      params.defineParams = defineParams;\n    } catch (e) {\n      console.error('compositeAction error: ' + e.message);\n      return;\n    }\n    const beforeAct = (beforeActData, callback) => {\n      viewModel.promiseExecute('before' + firstAction, beforeActData, callback);\n    };\n    const afterAct = (afterActData, callback) => {\n      viewModel.promiseExecute('after' + firstAction, afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    Act(billNo, viewModel, params, beforeAct, afterAct, params.cShowCaption);\n  }\n\n  const saveDraft = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'Savedraft',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n  const saveDatatemp = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'Savedatatemp',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n\n  const getYhtUserIds = function (items, callback) {\n    if (!items) return;\n    if (items.user && items.person) {\n      getYhtUserId('user', items.user, function (userIds) {\n        getYhtUserId('person', items.person, function (personIds) {\n          callback(userIds.concat(personIds));\n        })\n      })\n      return;\n    }\n    if (items.user)\n      getYhtUserId('user', items.user, callback);\n    if (items.person || items.id)\n      getYhtUserId('person', items.person || items.id, callback);\n  }\n\n  const getYhtUserId = (type, models, callback) => {\n    let refCode = ''; let yhtField = '';\n    switch (type) {\n      case 'user':\n        refCode = 'productcenter.aa_user';\n        yhtField = 'yhtUserId';\n        break;\n      case 'person':\n      case 'id':\n        refCode = 'ucf-staff-center.bd_staff_ref';\n        yhtField = 'userId';\n        break;\n    }\n    if (!refCode) return;\n    const proxy = cb.rest.DynamicProxy.create({\n      getYhtUserId: { url: '/bill/ref/getRefData', method: 'POST' }\n    });\n    const ids = [];\n    models.forEach(model => {\n      const id = model.getValue();\n      if (!id) return;\n      ids.push(id);\n    })\n    const params = {\n      refCode,\n      dataType: 'grid',\n      condition: {\n        isExtend: true,\n        simpleVOs: [{\n          field: 'id',\n          op: 'in',\n          value1: ids\n        }]\n      }\n    }\n    proxy.getYhtUserId(params, (_err, result) => {\n      if (result && result.recordList && result.recordList.length) {\n        const yhtIds = [];\n        result.recordList.forEach(item => {\n          yhtIds.push(item[yhtField]);\n        });\n        callback(yhtIds);\n      }\n    });\n  }\n\n  const _getNotice = function (viewModel, fieldName, special) {\n    const model = viewModel.get(fieldName);\n    if (!model) return;\n    let value = model.getValue();\n    if (value && special)\n      value = new Date(value).format('yyyy-MM-dd');\n    return {\n      key: model.getState('cShowCaption'),\n      value\n    };\n  }\n\n  const ecsuite = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const actionMap = (params.cParameter && JSON.parse(params.cParameter)) || {};\n    const action = actionMap.action;\n    const id = viewModel.get('id').getValue();\n    const origin = location.origin;\n    const webUrl = `${origin}/meta/yyarchive/${billNo}/${id}`;\n    const mobileUrl = webUrl;\n    const name = viewModel.getParams().caption;\n    const notice = [];\n    ['code', 'vouchdate', 'creator'].forEach(field => {\n      const special = field === 'vouchdate';\n      const item = _getNotice(viewModel, field, special);\n      if (!item) return;\n      notice.push(item);\n    });\n    switch (action) {\n      case 'cooperation':\n        /* 发起协作流程 */\n        YYCooperationBridge.YYLanuchFlow({\n          name, // 单据名称\n          objectName: 'YonSuite', // 单据类型 菜单名称\n          objectId: id, // 单据ID 主表id\n          webUrl, // web端打开地址\n          mobileUrl,\n        })\n        break;\n      case 'task':\n        /* 创建任务 */\n        YYCooperationBridge.YYRenderCreateTask({\n          objectName: 'YonSuite', // 单据类型 菜单名称\n          objectId: id, // 单据ID 主表id\n          idList: [], // 单据相关人员id\n        })\n        break;\n      case 'discussion': {\n        const ecsuiteItems = viewModel.getCache('ecsuiteItems');\n        /* modify by jinzh1 无关联人员也允许 发起讨论 */\n        // if(!ecsuiteItems) return;\n        if (!ecsuiteItems) {\n          YYCooperationBridge.YYGroupChat({\n            objectId: id, // 单据ID 主表id\n            docCode: viewModel.get('code') && viewModel.get('code').getValue(),\n            webUrl, // 跳转链接\n            mobileUrl,\n            name, // 单据名称\n            notice,\n            idList: [], // 群组有互通id\n          })\n        } else {\n          getYhtUserIds(ecsuiteItems, function (yhtIds) {\n            /* 群聊 */\n            YYCooperationBridge.YYGroupChat({\n              objectId: id, // 单据ID 主表id\n              docCode: viewModel.get('code') && viewModel.get('code').getValue(),\n              webUrl, // 跳转链接\n              mobileUrl,\n              name, // 单据名称\n              notice,\n              idList: yhtIds, // 群组有互通id\n            })\n          })\n        }\n        break;\n      }\n      case 'chat':\n        getYhtUserId(params.type, [params.model], function (yhtIds) {\n          /* 单聊 */\n          YYCooperationBridge.YYChat({\n            id: yhtIds[0], // 有互通id\n            webUrl, // 跳转链接\n            mobileUrl,\n            name, // 单据名称\n            notice\n          })\n        })\n    }\n  }\n\n  const voucherDo = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const data = viewModel.getNecessaryData();\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    };\n    const beforeActData = {\n      params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(`${params.cShowCaption}成功`, 'success');\n          if (res) {\n            const oldData = viewModel.collectData(true);\n            const newData = common.billMerge(oldData, res);\n            render(viewModel, newData);\n          }\n        }\n        const afterActData = { err, res };\n        afterAct(afterActData, common.afterAct);\n      }\n      common.doProxy(params, callback, postData);\n    });\n  }\n\n  const asyncMeta = function (billNo, params, billData, viewCallback) {\n    return new Promise(function (resolve) {\n      const { cardViewModel } = params;\n      if (cardViewModel) {\n        cardViewModel.biz.do('load', cardViewModel, {\n          data: billData\n        });\n        cb.utils.loadingControl.end();\n        return;\n      }\n      const vmParams = Object.assign({}, params)\n      if (billData && billData.tplid && params && !params.tplid) {\n        vmParams.tplid = billData.tplid\n      }\n      if (params && params.carryData) {\n        billData = Object.assign(billData, params.carryData)\n      }\n      const cbk = function (err, meta) {\n        vmParams.billData = billData\n        // if (billData && billData['_status'] === cb.models.DataStates.Insert) {\n        //   vmParams.mode = env.VOUCHER_STATE_ADD;\n        //   vmParams.realAdd = false;\n        // }\n        _fetchMetaCallback(err, meta, billNo, viewCallback, vmParams, resolve, function () {\n          common.fetchMeta(billNo, vmParams, cbk)\n        })\n      }\n      common.fetchMeta(billNo, vmParams, cbk)\n    });\n  }\n\n  // const asyncWorkflow = function (businessKey) {\n  //   return new Promise(function (resolve) {\n  //     window.flowComp({\n  //       width: 850,\n  //       height: 510,\n  //       appsource: env.appCode,\n  //       businessKey,\n  //       onload(callbackData) {\n  //         resolve(callbackData.fieldAuth || 'workflownoctrl');\n  //       }\n  //     });\n  //   });\n  // }\n\n  const processWorkflow = function (vm, view, fieldAuths) {\n    parseViewModel(vm, fieldAuths);\n    parseContainer(view.view, fieldAuths);\n  }\n\n  const parseViewModel = function (vm, fieldAuths) {\n    for (const attr in fieldAuths) {\n      if (attr === 'mainTable') {\n        parseMainEntity(vm, fieldAuths[attr]);\n      } else {\n        parseChildEntity(vm, attr, fieldAuths[attr]);\n      }\n    }\n  }\n\n  const parseMainEntity = function (vm, fieldAuthObj) {\n    for (const attr in fieldAuthObj) {\n      const model = vm.get(attr);\n      if (!(model instanceof cb.models.BaseModel)) continue;\n      const { visible, editable } = fieldAuthObj[attr];\n      model._set_data('bShowIt', visible);\n      model._set_data('bCanModify', editable);\n    }\n  }\n\n  const parseChildEntity = function (vm, childrenField, fieldAuthObj) {\n    const model = vm.get(childrenField);\n    if (!(model instanceof cb.models.BaseModel)) return;\n    const columns = model._get_data('columns');\n    if (!columns) return;\n    for (const attr in fieldAuthObj) {\n      const column = columns[attr];\n      if (!column) continue;\n      const { visible, editable } = fieldAuthObj[attr];\n      column.bShowIt = visible;\n      column.bCanModify = editable;\n    }\n  }\n\n  const parseContainer = function (container, fieldAuths) {\n    if (container.containers) {\n      container.containers.forEach(function (item) {\n        parseContainer(item, fieldAuths);\n      });\n    } else if (container.controls) {\n      parseControls(container, fieldAuths);\n    }\n  }\n\n  const parseControls = function (container, fieldAuths) {\n    const fieldAuthObj = fieldAuths[container.childrenField || 'mainTable'];\n    if (!fieldAuthObj) return;\n    const controls = [];\n    container.controls.forEach(function (control) {\n      const fieldAuth = fieldAuthObj[control.cItemName];\n      if (fieldAuth && !fieldAuth.visible) return;\n      controls.push(control);\n    });\n    container.controls = controls;\n  }\n\n  const getAllControls = function (groupIds, selectors) {\n    const arr = [];\n    const xNum = groupIds.length;\n    for (let i = 0; i < xNum; i++) {\n      const groupDom = document.getElementById(groupIds[i]);\n      if (!groupDom) return;\n      const groupControls = groupDom.querySelectorAll(selectors.join(','));\n      const yNum = groupControls.length;\n      arr[i] = [];\n      for (let j = 0; j < yNum; j++) {\n        arr[i][j] = groupControls[j];\n      }\n    }\n    return arr;\n  };\n\n  const afterInitData = async function (billNo, params, billData, viewCallback) {\n    const promises = [];\n    promises.push(asyncMeta(billNo, params, billData, viewCallback));\n    // if (billData && billData.isWfControlled && billData.verifystate > 0)\n    //   promises.push(asyncWorkflow(`${billNo}_${billData.id}`));\n    const results = [];\n    for (let i = 0, len = promises.length; i < len; i++)\n      results.push(await promises[i]);\n    const data = results[0];\n    const { vm, view } = data;\n    if (results[1]) {\n      if (results[1] === 'workflownoctrl') {\n        vm.getParams().workflowNoCtrl = true;\n      } else {\n        processWorkflow(vm, view, results[1]);\n      }\n    }\n    vm.promiseExecute('afterLoadMeta', data, function () {\n      const title = view.cBillName;\n      // switch (params.mode) {\n      //   case env.VOUCHER_STATE_ADD:\n      //     title = '新增' + title;\n      //     break;\n      //   case env.VOUCHER_STATE_EDIT:\n      //     title = '编辑' + title;\n      //     break;\n      //   case env.VOUCHER_STATE_BROWSE:\n      //     title += '详情';\n      //     break;\n      // }\n      viewCallback(vm, view, title) // 先绑定view防止extend中 viewmode addProperty\n      // vm.execute('afterMount');\n      // ====== 添加快捷键 start ======\n      const allGroupId = vm.getCache('groupIds') || [];\n      const allSelector = vm.getCache('selectors') || [];\n      if (allGroupId.length && allSelector.length) {\n        const allControls = getAllControls(allGroupId, allSelector);\n        vm.execute('afterInitKeyboard', allControls);\n      }\n      // ====== 添加快捷键 end ======\n      const gridModels = vm.getGridModels();\n      // 添加孙表开关addGrandSonTable\n      const addGrandSonTable = vm.get('addGrandSonTable');\n      const billNo = vm.getParams().billNo;\n      const userId = (cb.rest.AppContext.user || {}).id;\n      gridModels.forEach(gridModel => {\n        const childrenField = gridModel.getName();\n        const cacheKey = `${billNo}_${userId}_${childrenField}`;\n        let cacheWidth = null;\n        cb.indexDB.openDB('cacheInfo', 1, ['billInfo'])\n          .then(result => {\n            if (result) {\n              cb.indexDB.IDB_getData({ dbTableName: 'billInfo', dbName: 'cacheInfo', key: cacheKey }).then(result => {\n                cacheWidth = result;\n                if (cacheWidth)\n                  for (const key in cacheWidth) {\n                    if (key != 'indexedDB_id') gridModel.setColumnState(key, 'iColWidth', cacheWidth[key]);\n                  }\n              })\n            } else {\n              console.error('打开数据库失败，缓存功能不可用！')\n            }\n          })\n          .catch(e => {\n            console.error(e)\n          })\n\n        gridModel.on('afterSetDataSource', () => {\n          const afterAct = gridModel.getCache('afterAct');\n          if (afterAct)\n            afterAct();\n          setTimeout(function () {\n            common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n          });\n        });\n        gridModel.on('afterMount', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRow', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRows', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRowsFromRefer', args => {\n          vm.biz.do('referrowscheck', vm, Object.assign({ childrenField: childrenField }, args));\n        });\n        if (addGrandSonTable && process.env.__THEMETYPE__ == 'ncc') {\n          gridModel.on('beforeSetDataSource', function (dataList) {\n            dataList.forEach(item => {\n              if (item.id) {\n                if (!item.rid) {\n                  item.rid = item.id\n                }\n              } else {\n                if (!item.rid) item.attachmentId = uuid();\n              }\n            });\n            return dataList;\n          });\n          gridModel.on('beforeInsertRow', function (rowData) {\n            rowData.row.rid = uuid();\n            return rowData\n          });\n          gridModel.on('beforeInsertRows', function (data) {\n            const list = data.rows;\n\n            list.forEach(item => {\n              if (item.id) {\n                if (!item.rid) {\n                  item.rid = item.id\n                }\n              } else {\n                if (!item.rid) item.attachmentId = uuid();\n              }\n            });\n            return list;\n          });\n        }\n\n        // vm.on('afterEdit', () => {\n        //   common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n        // });\n        gridModel.on('colWidthResize', args => {\n          const { columnKey, width } = args;\n          if (!cacheWidth) cacheWidth = { indexedDB_id: cacheKey };\n          cacheWidth[columnKey] = width;\n          cb.indexDB.IDB_saveData(cacheWidth, 'billInfo', 'cacheInfo');\n        });\n        gridModel.on('colWidthReturn', args => {\n          cacheWidth = { id: cacheKey, dbTableName: 'billInfo', dbName: 'cacheInfo' };\n          cb.indexDB.IDB_deleteOneData(cacheWidth);\n        })\n      });\n\n      // 关联附件管理\n      const addAttachment = vm.get('addAttachment');\n      if (addAttachment && process.env.__THEMETYPE__ == 'ncc') {\n        gridModels.forEach(gridModel => {\n          gridModel.on('beforeSetDataSource', function (dataList) {\n            dataList.forEach(item => {\n              if (item.id) {\n                if (!item.attachmentId) {\n                  item.attachmentId = item.id\n                }\n              } else {\n                if (!item.attachmentId) item.attachmentId = uuid();\n              }\n            });\n            return dataList;\n          });\n          gridModel.on('beforeInsertRow', function (rowData) {\n            rowData.row.attachmentId = uuid();\n            return rowData\n          });\n        })\n      }\n      // 管理分页按钮状态；\n      _managePageInfoStatue(vm, billNo);\n      const { billData, metaType } = vm.getParams();\n      if (metaType === 'treevoucher') {\n        const treeModel = vm.getTreeModel();\n        _bindTreeAttachment(vm);\n        if (treeModel && treeModel.getState('banQuery')) {\n        } else {\n          _loadTree(vm, {\n            billnum: billNo,\n            treename: common.getVmParams(vm, 'treeName')\n          });\n          _bindTreeSelect(vm, billNo);\n        }\n        // vm.biz.do('add', vm);\n        // vm.setCache('lastMode', env.VOUCHER_STATE_ADD);\n        if (vm.getParams().mode !== env.VOUCHER_STATE_ADD) {\n          const treeModel = vm.getTreeModel();\n          if (treeModel && !treeModel.getState('defaultSelectedKeys'))\n            treeModel.setState('defaultSelectedKeys', true);\n        } else {\n          vm.biz.do('add', vm);\n        }\n      } else {\n        vm.biz.do('load', vm, {\n          data: billData\n        })\n      }\n      if (vm.getCache('bindTreeSelect') && vm.getTreeModel()) {\n        _bindTreeSelect(vm, billNo);\n      }\n      vm.biz.do('code', vm)\n      vm.biz.do('org', vm)\n      vm.biz.do('depends', vm)\n      vm.biz.do('rule', vm)\n      if (env.USEFORMULARULE) {\n        vm.biz.do('formularule', vm)\n      }\n      if (env.USESTATERULE) {\n        vm.biz.do('staterule', vm)\n      }\n      if (params.copy)\n        vm.biz.do('copy', vm);\n      _afterViewCallback(billNo, vm, params);\n    })\n  }\n  const _handlePageInfoStatus = async function (viewmodel, params, result) {\n    if (themeType != 'ncc') return false;\n    const btnMovefirst = viewmodel.get('btnMovefirst');\n    const btnMovelast = viewmodel.get('btnMovelast');\n    const btnMoveprev = viewmodel.get('btnMoveprev');\n    const btnMovenext = viewmodel.get('btnMovenext');\n    const parentViewmodel = viewmodel.getCache('parentViewModel')\n    const lastSearchCondition = parentViewmodel && parentViewmodel.getCache('lastSearchCondition');\n    let curVoucherIndex = viewmodel.getCache('curVoucherIndex');\n    let recordCount = viewmodel.getCache('recordCount');\n    if (!lastSearchCondition || (cb.utils.isEmpty(curVoucherIndex) || !recordCount)) {\n      btnMovefirst && btnMovefirst.setState('disabled', true);\n      btnMovelast && btnMovelast.setState('disabled', true);\n      btnMoveprev && btnMoveprev.setState('disabled', true);\n      btnMovenext && btnMovenext.setState('disabled', true);\n      return false;\n    }\n    let canLoad = null;// 是否可加载相邻单据\n    if (params) {\n      const { cAction } = params;\n      switch (cAction) {\n        case 'movenext':\n          curVoucherIndex = curVoucherIndex + 1;\n          break;\n        case 'moveprev':\n          curVoucherIndex = curVoucherIndex - 1;\n          break;\n        case 'movelast':\n          curVoucherIndex = recordCount - 1;\n          break;\n        case 'movefirst':\n          curVoucherIndex = 0;\n          break;\n        case 'delete': {\n          recordCount = recordCount - 1;\n          const deleteReturn = cb.extendConfig.yyarchive.deleteReturn;\n          canLoad = deleteReturn;\n          if (deleteReturn == 'movenext') {\n            // 删除最后一条\n            if (curVoucherIndex == recordCount) {\n              canLoad = 'moveprev'\n              curVoucherIndex = recordCount - 1;\n            }\n          } else if (deleteReturn == 'moveprev') {\n            // 删除第一条\n            if (curVoucherIndex == 0) {\n              canLoad = 'movenext';\n            }\n            curVoucherIndex = curVoucherIndex - 1 < 0 ? 0 : curVoucherIndex - 1;\n          }\n          if (recordCount == 0) {\n            canLoad = false;\n            // 交互待定\n          }\n          viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n          viewmodel.setCache('recordCount', recordCount);\n          return canLoad;\n        }\n        case 'save': {\n          const mode = common.getMode(viewmodel);\n          if (mode == env.VOUCHER_STATE_EDIT) {\n            return;\n          }\n          /* const billno=parentViewmodel.getParams().billNo;\n             parentViewmodel.biz.action().refresh(billno,parentViewmodel) */\n          const info = await _getParentAllList(parentViewmodel);\n          const recordList = info.recordList || [];\n          const index = recordList.findIndex(item => {\n            return item.id == result.id;\n          });\n          if (index > -1) {\n            recordCount = info.recordCount || recordList.length;\n            curVoucherIndex = index;\n          } else {\n            recordCount = 1;\n            curVoucherIndex = 0\n          }\n        }\n      }\n      viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n      viewmodel.setCache('recordCount', recordCount);\n    }\n\n    if (recordCount == 1) {\n      btnMovefirst && btnMovefirst.setState('disabled', true);\n      btnMovelast && btnMovelast.setState('disabled', true);\n      btnMoveprev && btnMoveprev.setState('disabled', true);\n      btnMovenext && btnMovenext.setState('disabled', true);\n    } else {\n      if (curVoucherIndex == -1) {\n        // 新增\n        btnMoveprev && btnMoveprev.setState('disabled', true);\n        btnMovenext && btnMovenext.setState('disabled', true);\n        btnMovefirst && btnMovefirst.setState('disabled', true);\n        btnMovelast && btnMovelast.setState('disabled', true);\n      } else if (curVoucherIndex == 0) {\n        btnMovefirst && btnMovefirst.setState('disabled', true);\n        btnMoveprev && btnMoveprev.setState('disabled', true);\n        btnMovelast && btnMovelast.setState('disabled', false);\n        btnMovenext && btnMovenext.setState('disabled', false);\n      } else if (curVoucherIndex < recordCount - 1) {\n        btnMovefirst && btnMovefirst.setState('disabled', false);\n        btnMovelast && btnMovelast.setState('disabled', false);\n        btnMoveprev && btnMoveprev.setState('disabled', false);\n        btnMovenext && btnMovenext.setState('disabled', false);\n      } else if (curVoucherIndex == recordCount - 1) {\n        btnMovelast && btnMovelast.setState('disabled', true);\n        btnMovenext && btnMovenext.setState('disabled', true);\n        btnMovefirst && btnMovefirst.setState('disabled', false);\n        btnMoveprev && btnMoveprev.setState('disabled', false);\n      }\n    }\n  }\n  const _getParentAllList = function (viewmodel) {\n    return new Promise((resolve) => {\n      const gridmodel = viewmodel.getGridModel();\n      const proxyConfig = gridmodel._get_data('proxyConfig');\n      if (!proxyConfig) return;\n      const queryParams = gridmodel._get_data('queryParams');\n      const proxy = cb.rest.DynamicProxy.create({ queryData: proxyConfig });\n      delete queryParams.page;\n      proxy.queryData(queryParams, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        resolve(result);\n      });\n    });\n  }\n  const _managePageInfoStatue = function (viewmodel, billNo) {\n    if (themeType !== 'ncc') {\n      return;\n    }\n    viewmodel.on('afterLoadData', function () {\n      let curVoucherIndex = viewmodel.getCache('curVoucherIndex');\n      let recordCount = viewmodel.getCache('recordCount');\n      if (cb.utils.isEmpty(curVoucherIndex) || !recordCount) {\n        const parentViewmodel = viewmodel.getCache('parentViewModel');\n        if (parentViewmodel) {\n          const parentCurVoucherIndex = parentViewmodel.getCache('curVoucherIndex');\n          const parentPageInfo = parentViewmodel.getCache('pageInfo');\n\n          if (!cb.utils.isEmpty(parentCurVoucherIndex) && parentPageInfo) {\n            const { pageIndex, pageSize, recordCount: count } = parentPageInfo\n            curVoucherIndex = (pageIndex - 1) * pageSize + parentCurVoucherIndex;\n            recordCount = count;\n            viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n            viewmodel.setCache('recordCount', recordCount);\n          }\n        }\n      }\n      _handlePageInfoStatus(viewmodel);\n    })\n  }\n  const rowDetail = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const curGridModel = common.getGridModel(viewmodel, params);\n    const cSunBillNo = curGridModel.getCache('cSunBillNo');\n    if (!cSunBillNo) {\n      return;\n    }\n    const rowIndex = params && params.params && !cb.utils.isEmpty(params.params.index)\n      ? params.params.index : '';\n    if (cb.utils.isEmpty(rowIndex)) {\n      cb.utils.alert('未获取到行号', 'error');\n      return;\n    }\n    const selectedRow = curGridModel.getRow(rowIndex);\n    const rid = selectedRow.rid;\n    if (!rid) {\n      console.error('缺少子表id');\n      return;\n    }\n    const mode = common.getMode(viewmodel);\n    const param = {\n      mode: env.VOUCHER_STATE_EDIT,\n      id: rid,\n      rowData: selectedRow,\n      carryParams: {},\n    }\n    if (mode == env.VOUCHER_STATE_BROWSE) {\n      param.readOnly = true;\n    }\n    const dt = {\n      billtype: 'yyarchive',\n      billno: cSunBillNo,\n      params: param\n    }\n    const beforeActData = {\n      params: params,\n      data: dt\n    }\n    beforeAct(beforeActData, function () {\n      cb.loader.runCommandLine('bill', dt, viewmodel);\n      afterAct()\n    })\n  }\n  const jointquery = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let data = {\n      params: { editType: 'jointquery' },\n      parentViewModel: viewmodel,\n      billNum: billNo,\n      billId: viewmodel.get('id').getValue(),\n    };\n    if (params && params.childrenField) {\n      const childArray = [];\n      childArray.push(viewmodel.getGridModel().getRow(params.params.index).id);\n      const childIds = { childIds: childArray };\n      const childKey = { childKey: params.childrenField };\n      data = Object.assign(data, childIds, childKey);\n    }\n    beforeAct(data, function () {\n      viewmodel.communication({\n        payload: {\n          title: '单据联查结果显示',\n          type: 'platform',\n          url: 'voucher-search/ShowFlow',\n          // url: 'voucher-search/useShowFlow',\n          checkReturn: true,\n          modal: viewmodel,\n          data: data\n        }\n      });\n    })\n  }\n\n  // 打印预览\n  const printPreview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      // let gridModel = viewmodel.getGridModel()\n      // if (!gridModel) {\n      //   return\n      // }\n      const { currentParams, url } = common.getPrintParamers(params, 'preview', viewmodel);\n      if (!currentParams)\n        return false;\n      window.open(url + common.combineParams(currentParams), '_blank')\n      afterAct()\n    })\n  }\n  // 打印设计\n  const printDesign = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      // const gridModel = viewmodel.getGridModel();\n      // if (!gridModel) {\n      //   return\n      // }\n      const { currentParams, url } = common.getPrintParamers(params, 'design', viewmodel);\n      window.open(url + common.combineParams(currentParams), '_blank')\n    })\n  }\n\n  // 直接打印\n  const printNow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      common.printNow(params, viewmodel);\n      afterAct()\n    })\n  }\n  const batchOutputVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    // let printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const gridModel = viewmodel.getGridModel();\n    // 支持树卡，树节点的导出；\n    const treeModel = viewmodel.getTreeModel();\n    // if (!gridModel) return\n    // let queryString = new cb.utils.queryString(\"/files\" + params.cSvcUrl)\n    // let format = queryString.has('type') ? queryString.get('type') : 'pdf'\n    // let ids = _getSelectRowIds(gridModel)\n    // if (!ids || ids.length == 0) {\n    //   cb.utils.alert('请选择有效数据', 'warning')\n    //   return\n    // }\n    // let postData = {\n    //   bill: {\n    //     billnum: common.getVmParams(viewmodel, 'cardKey'),\n    //     ids: ids,\n    //     tplid: printID\n    //   },\n    //   format: format,\n    //   type: 'yyarchive'\n    // }\n    const postData = { billnum: billNo };\n    if (treeModel) {\n      let selectedDatas = treeModel.getSelectedKeys();\n      if (selectedDatas.includes('main')) {\n        // 根节点取所有值\n        const keyMap = treeModel._get_data('keyMap');\n        selectedDatas = Object.keys(keyMap);\n      }\n      if (cb.utils.isArray(selectedDatas)) postData.ids = selectedDatas.join();\n      else if (typeof selectedDatas === 'string') postData.ids = selectedDatas;\n    } else if (gridModel) {\n      const selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length == 0) {\n        cb.utils.alert('请选择', 'warning')\n        return\n      }\n      const data = []\n      selectDatas.forEach(function (row) {\n        if (row.id && row.pubts) {\n          data.push(row.id)\n        }\n      }, this)\n      postData.ids = data.join();\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString && queryString.pathname + queryString.toStr()\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, postData)\n      afterAct()\n    })\n  }\n\n  const exportVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = {\n      billnum: common.getVmParams(viewModel, 'cardKey')\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, postData);\n      afterAct();\n    });\n  }\n\n  const importVoucher = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const btnCallBack = {\n      disabledCallback: params.disabledCallback,\n      enabledCallback: params.enabledCallback\n    }\n    params.disabledCallback = false;\n    params.enabledCallback = false;\n    const beforeActData = { params, data: {} };\n    let isAsync = false;\n    let asyncInterval = 1;\n    const asyncKey = 'asyncImport_' + cb.utils.getNewGuid().replace(/-/g, '');\n    let acceptedFileType = ''\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      if (cParameter) {\n        isAsync = cParameter.isAsync;\n        asyncInterval = cParameter.interval || asyncInterval;\n        acceptedFileType = cParameter.acceptedFileType || ''\n      }\n    }\n    // isAsync = true;\n    beforeAct(beforeActData, function () {\n      const eleInput = document.createElement('input');\n      eleInput.type = 'file';\n      if (acceptedFileType) {\n        eleInput.accept = acceptedFileType // 限定导入文件的类型\n      }\n      eleInput.style.display = 'none';\n      eleInput.onchange = function (e) {\n        btnCallBack.disabledCallback && btnCallBack.disabledCallback();\n        const formData = new FormData();\n        formData.enctype = 'multipart/form-data';\n        const file = e.target.files[0];\n        const fileName = file && file.name;\n        const fileSize = file && file.size;\n        formData.append('file', file);\n        if (beforeActData.data.mapCondition)\n          formData.append('mapCondition', JSON.stringify(beforeActData.data.mapCondition));\n        const xhr = new XMLHttpRequest();\n        let url = `${params.cSvcUrl}?billnum=${common.getVmParams(viewModel, 'cardKey')}`;\n        if (isAsync) {\n          url = url + '&asyncKey=' + asyncKey;\n        }\n        const _url = window._baseUrl ? `${window._baseUrl}${url}` : url;\n        xhr.open('POST', _url, true);\n        xhr.send(formData);\n        if (isAsync) {\n          btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n          xhr.onreadystatechange = function () {\n            let bError = false;\n            let errorInfo = '';\n            if (xhr.readyState !== 4) return;\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                bError = true;\n                errorInfo = '模板内容导入失败,返回信息：' + xhr.responseText;\n              }\n              if (ajaxResult.code === 200) {\n              } else {\n                bError = true;\n                errorInfo = `模板内容导入失败，${ajaxResult.message}。`;\n              }\n            }\n            else {\n              bError = true;\n              errorInfo = '模板内容导入返回信息： xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText;\n            }\n            if (bError) {\n              // let _timer = viewModel.getCache(asyncKey);\n              // viewModel.clearCache(asyncKey);\n              // _timer && clearTimeout(_timer);\n              cb.utils.alert(errorInfo);\n            }\n            else {\n              const curTime = cb.utils.getNowFormatDate();\n              const busName = viewModel.getParams() && (viewModel.getParams().name || viewModel.getParams().caption);\n              const asyncParams = { asyncKey, fileSize, fileName, curTime, busName, percentage: 0, asyncData: '{}' };\n              viewModel.communication({\n                type: 'asyncImport',\n                payload: asyncParams\n              })\n              const _timer = setInterval(() => {\n                asyncImportQuery(viewModel, asyncParams, btnCallBack);\n              }, asyncInterval * 1000);\n              viewModel.setCache(asyncKey, _timer);\n              cb.utils.alert('导入已转入后台处理，可进行其它操作！');\n            }\n          }\n        }\n        else {\n          xhr.onreadystatechange = function () {\n            if (xhr.readyState !== 4) return;\n            btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                cb.utils.alert('模板内容导入失败,返回信息：' + xhr.responseText);\n                return;\n              }\n              if (ajaxResult.code === 200) {\n                const res = ajaxResult.data;\n                if (res.sucessCount) {\n                  viewModel.execute('refresh');\n                  viewModel.execute('afterImport', res);\n                }\n\n                viewModel.communication({\n                  type: 'modal',\n                  payload: {\n                    key: 'BatchMsg',\n                    data: {\n                      type: 2,\n                      res\n                    }\n                  }\n                });\n              } else {\n                cb.utils.alert(`模板内容导入失败，${ajaxResult.message}。`, 'error');\n              }\n            }\n            else {\n              console.log('模板内容导入返回信息： xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText);\n            }\n          };\n        }\n        document.body.removeChild(eleInput);\n      }\n      document.body.appendChild(eleInput);\n      eleInput.click();\n    });\n  }\n\n  const asyncImportQuery = (viewModel, asyncParams, btnCallBack) => {\n    const asyncKey = asyncParams.asyncKey;\n    const url = 'billtemp/getImportProcess?';\n    const proxy = cb.rest.DynamicProxy.create({\n      getImportProcess: {\n        url: url,\n        method: 'GET',\n        options: { mask: false }\n      }\n    })\n\n    proxy.getImportProcess({ asyncKey: asyncKey }, function (err, result) {\n      let errStr = '';\n      if (err) {\n        errStr = err.message;\n        handleAsyncImportOver(viewModel, asyncParams, errStr);\n        return;\n      }\n      if (result) {\n        let res;\n        try {\n          res = JSON.parse(result);\n        }\n        catch (e) {\n          errStr = '模板内容导入失败,返回信息：' + result;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n          return;\n        }\n        const percentage = parseFloat(res.percentage || '0');\n        if (res.flag == '0') {\n          errStr = '模板内容导入失败';\n          if (res.data)\n            errStr = errStr + ',返回信息：' + res.data;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n        }\n        else if (res.flag == 1 && percentage >= 100) {\n          handleAsyncImportOver(viewModel, asyncParams);\n          viewModel.execute('refresh');\n          viewModel.execute('afterImport', res);\n          viewModel.execute('openNotification', Object.assign({ res: res.data }, asyncParams));\n        }\n        asyncParams.asyncData = result;\n        asyncParams.percentage = percentage;\n        viewModel.communication({\n          type: 'asyncImport',\n          payload: asyncParams\n        });\n      }\n    });\n  }\n\n  const handleAsyncImportOver = (viewModel, asyncParams, errStr) => {\n    const _timer = viewModel.getCache(asyncParams.asyncKey);\n    viewModel.clearCache(asyncParams.asyncKey);\n    _timer && clearTimeout(_timer);\n    if (errStr) {\n      cb.utils.alert(errStr);\n      asyncParams.bDelTask = true;\n      asyncParams.errStr = errStr;\n      viewModel.communication({\n        type: 'asyncImport',\n        payload: asyncParams\n      });\n    }\n  }\n  const doCommunication = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    common.doCommunication(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  // 子表行附件管理\n  const attachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment) {\n      console.log('扩展脚本需要配置addAttachment')\n      return;\n    }\n    const gridModel = common.getGridModel(viewmodel, params);\n    const selectDatas = params && params.params && params.params.index != null\n      ? [gridModel.getRow(params.params.index)]\n      : gridModel.getSelectedRows();\n    if (selectDatas.length == 0) {\n      cb.utils.alert('请选择行', 'warning');\n      return\n    }\n    if (selectDatas.length > 1) {\n      cb.utils.alert('附件管理只能单行显示', 'warning');\n      return;\n    }\n    const selectRow = selectDatas[0];\n    if (!selectRow.attachmentId) {\n      cb.utils.alert('行缺少附件id', 'warning');\n      return;\n    }\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// 附件管理权限\n    const rowData = Object.assign({\n      id: selectRow.attachmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // 按钮大小(lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  // 树卡附件管理\n  const _bindTreeAttachment = function (viewmodel) {\n    const treeModel = viewmodel.getTreeModel();\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment || process.env.__THEMETYPE__ !== 'ncc') {\n      return;\n    }\n    treeModel.on('beforeSetDataSource', function (list) {\n      const childrenField = treeModel._get_data('childrenField') || 'children';\n      const keyField = treeModel._get_data('keyField') || 'id';\n      function loopData(data) {\n        data.forEach(item => {\n          const children = item[childrenField];\n          if (!item.attachmentId) {\n            item.attachmentId = item[keyField]\n          }\n          if (children && cb.utils.isArray(children) && children.length > 0) {\n            loopData(children);\n          }\n        })\n      }\n      loopData(list);\n      return list;\n    })\n  }\n  // 单据附件管理\n  const voucherAttachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment) {\n      console.log('扩展脚本需要配置addAttachment')\n      return;\n    }\n    const mode = common.getMode(viewmodel);\n    let newAttchmentId = '';\n    // const value=\n    switch (mode) {\n      case env.VOUCHER_STATE_BROWSE:\n      case env.VOUCHER_STATE_EDIT: {\n        const attachmentId = viewmodel.get('attachmentId').getValue();\n        if (attachmentId) {\n          newAttchmentId = attachmentId\n        } else {\n          const id = viewmodel.get('id').getValue();\n          if (id) {\n            viewmodel.get('attachmentId').setValue(id);\n            newAttchmentId = id;\n          } else {\n            const newId = uuid();\n            viewmodel.get('attachmentId').setValue(newId);\n            newAttchmentId = newId;\n          }\n        }\n        break;\n      }\n      case env.VOUCHER_STATE_ADD: {\n        const id = viewmodel.get('attachmentId').getValue();\n        if (id) {\n          newAttchmentId = id\n        } else {\n          const newId = uuid();\n          viewmodel.get('attachmentId').setValue(newId);\n          newAttchmentId = newId;\n        }\n        break;\n      }\n    }\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// 附件管理权限\n    const rowData = Object.assign({\n      id: newAttchmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // 按钮大小(lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  const stateRule = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    runRules(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  const formulaRule = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    formularule(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n\n  const newback = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    cb.route.goBack()\n  };\n\n  return {\n    init: function (billNo, params, viewCallback) {\n      params = params || {};\n      if (!params.mode && params.query && params.query.mode)\n        params.mode = params.query.mode;\n      if (!params.id && params.query && params.query.id)\n        params.id = params.query.id;\n      // params 中没有saveReturn属性，则以扩展脚本为主\n      if (!cb.extendConfig.yyarchive) {\n        cb.extendConfig.yyarchive = {};\n      }\n      if (!params.hasOwnProperty('saveReturn') && cb.extendConfig.yyarchive.hasOwnProperty('saveReturn')) {\n        params.saveReturn = cb.extendConfig.yyarchive.saveReturn\n      }\n      // const self = this\n      const initDataCallback = function (err, billData) {\n        if (!err) {\n          billData = billData || {};\n          if (billData._status === cb.models.DataStates.Insert) {\n            params.mode = env.VOUCHER_STATE_ADD;\n            params.realAdd = false;\n          }\n          afterInitData(billNo, params, billData, viewCallback);\n        } else {\n          common.afterAct({\n            err: err\n          })\n        }\n      }\n      _getInitdata(billNo, params, initDataCallback)\n    },\n    do: function (act, viewmodel, params) {\n      common.todo(this, act, viewmodel, params)\n    },\n    action: function () {\n      // 增加扩展机制，没有配置传入容错处理 yueming\n      let voucherExtend = {}\n      try {\n        voucherExtend = cb.extendConfig.voucherExtendConfig;\n      } catch (error) {\n        console.log(error);\n        voucherExtend = {};\n      }\n      const voucherAction = {\n        newback: newback,\n        scan: mtlScan,\n        share: mtlShare,\n        platform: mtlPlatform,\n        getnetworktype: mtlNetworkType,\n        getmac: mtlGetMac,\n        dail: mtlDail,\n        chooseimage: mtlChooseImage,\n        getlocation: mtlGetLocation,\n        openlocation: mtlOpenLocation,\n        generateqrcode: mtlGenerateQRCode,\n        request: mtlRequest,\n        startrecord: mtlStartRecord,\n        stoprecord: mtlStopRecord,\n        playvoice: mtlPlayVoice,\n        pausevoice: mtlPauseVoice,\n        stopvoice: mtlStopVoice,\n        changescreenorientation: mtlChangeScreenOrientation,\n        restorescreenorientation: mtlRestoreScreenOrientation,\n        setstorage: mtlSetStorage,\n        getstorage: mtlGetStorage,\n        removestorage: mtlRemoveStorage,\n        clearstorage: mtlClearStorage,\n        uploadfile: mtlUploadFile,\n        downloadfile: mtlDownloadFile,\n        render: renderData,\n        doservice: _doService,\n        load: loadData,\n        search: search,\n        code: buildCode,\n        org: buildOrg,\n        depends: buildDepends,\n        rule: buildRule,\n        initdefaultactions: initDefaultActions,\n        commandline: common.commandLine,\n        abandon: abandon,\n        copy: copy,\n        push: push,\n        edit: common.edit,\n        save: save,\n        addrow: addRow,\n        table2dbtnclick: table2DBtnClick,\n        insertrow: insertRow,\n        deleterow: deleteRow,\n        copyrow: copyRow,\n        shiftuprow: shiftUpRow,\n        shiftdownrow: shiftDownRow,\n        delete: doDelete,\n        invalid: inValid,\n        workflow: workflow,\n        audit: audit,\n        submit: submit,\n        unsubmit: unsubmit,\n        unaudit: audit,\n        close: close,\n        open: open,\n        movefirst: moveFirstOrLast,\n        movelast: moveFirstOrLast,\n        moveprev: movePrevOrNext,\n        movenext: movePrevOrNext,\n        add: add,\n        create: add,\n        pull: pull,\n        check: check,\n        refresh: refresh,\n        columnsetting: common.columnsetting,\n        checkapprove: checkApprove,\n        cellcheck: cellCheck,\n        cellscheck: cellsCheck,\n        referrowscheck: referRowsCheck,\n        lineopen: lineOpenOrClose,\n        lineclose: lineOpenOrClose,\n        localoutput: localoutput,\n        output: output,\n        print: print,\n        selecttpl: selectTpl,\n        saveandadd: saveAndAdd,\n        saveandaudit: saveAndAudit,\n        savebo: savebo,\n        preview: preview,\n        localprint: localPrint,\n        selfdefineaction: compositeAction,\n        savedraft: saveDraft,\n        savedatatemp: saveDatatemp,\n        ecsuite,\n        voucherdo: voucherDo,\n        batchmodify: batchModify,\n        jointquery: jointquery,\n        printpreview: printPreview, // 打印预览\n        printdesign: printDesign, // 打印设计\n        printnow: printNow, // 直接打印\n        batchoutput: batchOutputVoucher,\n        batchimport: importVoucher,\n        tempexport: exportVoucherTemplate,\n        openpage: doCommunication, // 打开弹框\n        goback: doCommunication, // 返回上一级\n        attachment: attachment, // 单行附件管理\n        voucherattachment: voucherAttachment, // 单据附件管理\n        rowdetail: rowDetail, // 展示孙表\n        staterule: stateRule, // 公式联动\n        billsetting: common.openBillModal,\n        formularule: formulaRule,\n        autocomplete: common.autoComplete, // 自动补全\n        customdo: common.customDo\n      }\n      return Object.assign(voucherAction, voucherExtend);\n    }\n  }\n})()\n\ncb.namespace('biz.common')\ncb.biz.common.yyarchive = yyarchive\n\nexport default yyarchive\n"],"sourceRoot":""}