(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{2435:function(e,t,a){"use strict";a.r(t);var l,o,d,i,c,n,r,s,u,h,g,f,m,v=a(191),y=function(e,t,a){return!e||new Function("src","dst","return "+e)(t,a)},B=(l=function(e,t,a){var l=t.get("MakeBillCache"),o=t.get("RuleCache"),d=o.mainAndChildId.mainId,i=o.mainAndChildId.childForId,c=o.mainAndChildId.childId;if("head"===a.type){var n,r={},s=[],u=[],h=[],g=t.get(t.get("Head")).getData(),f=t.get(t.get("Head")).getSelectedRows();if(f.forEach((function(e){s.push(e[d]),l[e[d]]||(u.push(e[d]),n=e)})),f.length>1&&!y(o.rulePolicyList.head[0],o.HeadRuleData,n)){for(var m=0;m<g.length;m++)g[m][d]===u[0]&&h.push(m);return t.get(t.get("Head")).unselect(h),void cb.utils.alert("所选数据不符合生单规则，请重新选择数据！")}if(1===f.length&&(o.HeadRuleData=n),0===o.isSingleVoucher){r.headIds=u,r.code=t.get("MakeBill").code;var B=function(e,a){if(e&&e.message)cb.utils.alert(e.message,"error");else{a.forEach((function(e){l[e[i]]||(l[e[i]]=[]),l[e[i]].push(e)}));var o=[];s.forEach((function(e){var t=l[e];t&&t.forEach((function(e){o.push(e)}))}));var c=t.get(t.get("Body"));if(c.setDataSource(o),c.getState("showCheckbox")){var n=[];for(var r in l.BodySelectIds){for(var u=function(e){l.BodySelectIds[r].forEach((function(t){t===o[e][d.mainId]&&n.push(e)}))},h=0;h<o.length;h++)u(h);t.get(t.get("Body")).select(n)}}}};u.length?v.p({cSvcUrl:"makeBill/getBodyData",cHttpMethod:"POST"},B,r):B(null,[])}}else t.get(t.get("Body")).getSelectedRows().forEach((function(e){l.BodySelectIds[e[i]]?-1===l.BodySelectIds[e[i]].indexOf(e[c])&&l.BodySelectIds[e[i]].push(e[c]):(l.BodySelectIds[e[i]]=[],l.BodySelectIds[e[i]].push(e[c]))}))},o=function(e,t,a){var l=t.get("MakeBillCache"),o=t.get("RuleCache"),d=o.mainAndChildId.mainId,i=o.mainAndChildId.childForId,c=o.mainAndChildId.childId;if("head"===a.type&&0===o.isSingleVoucher){var n=t.get(t.get("Head")).getRowsByIndexes(a.rowIndexes);l[n[0][d]]&&delete l[n[0][d]],l.BodySelectIds[n[0][d]]&&delete l.BodySelectIds[n[0][d]];var r=t.get(t.get("Head")).getSelectedRows(),s=[];if(r.forEach((function(e){s.push(e[d])})),0!==s.length){var u=[];s.forEach((function(e){var t=l[e];t&&t.forEach((function(e){u.push(e)}))}));var h=t.get(t.get("Body"));if(h.setDataSource(u),!h.getState("showCheckbox"))return;var g=[];for(var f in l.BodySelectIds){for(var m=function(e){l.BodySelectIds[f].forEach((function(t){t===u[e][d]&&g.push(e)}))},v=0;v<u.length;v++)m(v);t.get(t.get("Body")).select(g)}}else t.get(t.get("Body")).setDataSource([])}else{var y=t.get(t.get("Body")).getData();if(0===t.get(t.get("Body")).getSelectedRows().length)return void(l.BodySelectIds={});var B=y[a.rowIndexes[0]][c],I=y[a.rowIndexes[0]][i];for(var f in l.BodySelectIds)f===I&&l.BodySelectIds[f].push(B)}},d=function(e,t,a){var l=t.get("MakeBillCache"),o=t.get("RuleCache"),d=o.mainAndChildId.mainId,i=o.mainAndChildId.childForId,c=o.mainAndChildId.childId;if("head"===a.type){var n={},r=[],s=[],u=[],h=t.get(t.get("Head")).getData(),g=l.BodySelectIds;if((l={}).BodySelectIds=g,o.HeadRuleData&&delete o.HeadRuleData,h.forEach((function(e,t){if(o.HeadRuleData){if(!y(o.rulePolicyList.head[0],o.HeadRuleData,e))return s.push(e[d]),void(o.HeadRuleData[d]!==e[d]&&u.push(t));r.push(e[d])}else o.HeadRuleData=e,r.push(e[d])})),u.length>0)return t.get(t.get("Head")).unselect(u),void cb.utils.alert("所选数据中存在不符合生单规则的数据！");0===o.isSingleVoucher&&(n.headIds=r,n.code=t.get("MakeBill").code,v.p({cSvcUrl:"makeBill/getBodyData",cHttpMethod:"POST"},(function(e,a){a.forEach((function(e){l[e[i]]||(l[e[i]]=[]),l[e[i]].push(e)}));var o=[];r.forEach((function(e){l[e]&&l[e].forEach((function(e){o.push(e)}))}));var c=t.get(t.get("Body"));if(c.setDataSource(o),c.getState("showCheckbox")){var n=[];for(var s in l.BodySelectIds){for(var u=function(e){l.BodySelectIds[s].forEach((function(t){t===o[e][d]&&n.push(e)}))},h=0;h<o.length;h++)u(h);t.get(t.get("Body")).select(n)}}}),n))}else{var f=t.get(t.get("Body")).getData();null!==f&&f.forEach((function(e){l.BodySelectIds[e[i]]?-1===l.BodySelectIds[e[i]].indexOf(e[c])&&l.BodySelectIds[e[i]].push(e[c]):(l.BodySelectIds[e[i]]=[],l.BodySelectIds[e[i]].push(e[c]))}))}},i=function(e,t,a){var l=t.get("MakeBillCache"),o=t.get("RuleCache");t.get(t.get("Head")).getData().forEach((function(e){l[e[o.mainAndChildId.mainId]]&&delete l[e[o.mainAndChildId.mainId]]})),"head"===a.type&&0===o.isSingleVoucher&&t.get(t.get("Body")).setDataSource([])},c=function(e,t,a){},n=function(e,t,a){var l=t.get("RuleCache"),o=l.mainAndChildId.childId,d=[],i="",c={};if(c.code=t.get("MakeBill").code,0===l.isSingleVoucher){i=t.get("Body");var n=t.get("Head"),r=l.mainAndChildId.mainId,s=[],u=t.get(n).getSelectedRows();if(0===u.length)return void cb.utils.alert("未选择数据，请选择数据后重试！");for(var h=0;h<u.length;h++)s.push(u[h][r]);c.mainIds=s}else o=l.mainAndChildId.mainId,i=t.get("Head");var g=t.get(i).getSelectedRows();if(0!==g.length){for(h=0;h<g.length;h++)d.push(g[h][o]);c.childIds=d,cb.rest.DynamicProxy.create({makeBill:{url:"/makeBill/pullVoucher",method:"POST"}}).makeBill(c,(function(e,a){e?e.message?cb.utils.alert("出错啦后台->"+e.message):cb.utils.alert("出错啦后台->"+e.code):(t.execute("afterOkClick",{data:a}),t.execute("close"))}))}else cb.utils.alert("未选择数据，请选择数据后重试！")},r=function(e,t,a){},s=function(e,t,a){var l=t.get("FilterCache");if(l.hasFilter){t.get(t.get("Body")).setDataSource([]);var o={condition:l.condition};this.search(e,t,o)}else this.load(e,t,a)},u=function(e,t,a){},h=function(e,t,a){},g=function(e,t,a){t.execute("close")},f=function(e,t,a){delete a.showSearch,t.get("FilterCache").condition=a.condition,a.code=t.get("MakeBill").code,v.p({cSvcUrl:"makeBill/getMakeVoucherShowData",cHttpMethod:"POST"},(function(e,a){t.get("MakeBillCache").BodySelectIds={};var l=t.get("Head");t.get(l).setDataSource(a.headData)}),a)},m=function(e,t,a){var l=t.get("FilterCache");null==t.get("MakeBill").code||""==t.get("MakeBill").code?(l.hasFilter=!1,a.code=t.get("MakeBill").code,v.p({cSvcUrl:"makeBill/getMakeVoucherShowData",cHttpMethod:"POST"},(function(e,a){t.get("MakeBillCache").BodySelectIds={};var l=t.get("Head");t.get(l).setDataSource(a.headData)}),a)):l.hasFilter=!0},{init:function(e,t,a){if(void 0!==t.menu_url){var l=new cb.utils.queryString(t.menu_url);t.code=l.get("code"),t.makeBilltype=l.get("makeBilltype")}var o=this,d=cb.rest.DynamicProxy.create({getMeta:{url:"/meta",method:"POST",options:{uniform:!1}}}),i=Object.assign({},t,{type:"billmaker",billNo:e,code:t.code,makeBilltype:t.makeBilltype});d.getMeta(i,(function(e,l){e?console.error(e):cb.requireInner(l.vmurl,(function(){var e={billNo:l.viewmeta.cBillNo,subId:l.viewmeta.cSubId};!l.vmurl&&l.vm&&new Function(l.vm)();var d=new cb.viewmodels[l.viewmeta.vmName];cb.utils.extend(!0,d.getParams(),e,t);var i=d.get("RuleCache"),c=d.get("MakeBill");if(c.code=t.code,c.makeBilltype=t.makeBilltype,i.isSingleVoucher=l.makeBill.isSingleVoucher,i.mainAndChildId=l.makeBill.mainAndChildId,i.rulePolicyList=l.makeBill.rulePolicyList,i.makeBilltype=t.makeBilltype,0===i.isSingleVoucher){var n=d.get("Body");d.get(n).on("afterSelect",(function(e){var t={};t.rowIndexes=e,t.type="body",o.do("selectgrid",d,t)})),d.get(n).on("afterUnselect",(function(e){var t={};t.rowIndexes=e,t.type="body",o.do("unselectgrid",d,t)})),d.get(n).on("afterSelectAll",(function(e){var t={};t.rows=e,t.type="body",o.do("selectall",d,t)})),d.get(n).on("afterUnselectAll",(function(){var e={type:"body"};o.do("unselectall",d,e)}))}var r=d.get("Head");d.get(r).on("afterSelect",(function(e){var t={};t.rowIndexes=e,t.type="head",o.do("selectgrid",d,t)})),d.get(r).on("afterUnselect",(function(e){var t={};t.rowIndexes=e,t.type="head",o.do("unselectgrid",d,t)})),d.get(r).on("afterSelectAll",(function(e){var t={};t.rows=e,t.type="head",o.do("selectall",d,t)})),d.get(r).on("afterUnselectAll",(function(){var e={type:"head"};o.do("unselectall",d,e)})),a(d,l.viewmeta,l.viewmeta.cBillName),o.do("load",d)}))}))},do:function(e,t,a){v.K(this,e,t,a)},action:function(){return{selectgrid:l,unselectgrid:o,selectall:d,unselectall:i,scress:c,sure:n,position:r,fresh:s,item:u,help:h,out:g,search:f,load:m,columnsetting:v.h}}});cb.namespace("biz.common"),cb.biz.common.billmaker=B,t.default=B}}]);
//# sourceMappingURL=7.bundle.js.map?_=d566ad53-de75-49ba-965f-44adb4dd2a09