{"version":3,"sources":["webpack:///./node_modules/@mdf/cube/src/bizmodel/editvoucherlist.js"],"names":["themeType","editvoucherlist","_render","viewmodel","data","dirty","setDirty","loadDirtyData","loadData","execute","validate","_getTreeSelectNode","selectNode","node","treeModel","getTreeModel","getSelectedNodes","length","singleDo","billNo","viewModel","params","beforeAct","afterAct","rowIndex","index","gridModel","getGridModel","currentRow","getRow","postData","billnum","JSON","stringify","err","res","cb","utils","alert","_doService","getCache","oldData","collectData","newData","VOUCHER_STATE_EDIT","updateNode","open","cAction","configParams","allActions","find","item","trim","toLocaleLowerCase","Object","assign","extendConfig","allConfirm","cShowCaption","confirm","locale","close","_addCard","maxLevel","getState","level","selectedNode","suc","VOUCHER_STATE_ADD","parentField","parent_name","name","_addVoucher","rest","interMode","clearCache","cardKey","parentId","mode","action","carryParams","parent","args","externalData","loader","runCommandLine","billtype","billno","_loadGrid","queryItems","forEach","field","replace","v","toUpperCase","reportId","setColumns","getParams","query","setState","showSearch","bFromNav","x","cCommand","proxyParams","cSvcUrl","url","method","cHttpMethod","options","mask","pageSize","setPageInfo","setDataSource","result","isShowPagination","_get_data","recordCount","setPagination","columns","getColumnsData","this","fieldNames","setCache","columnArray","entities","filter","bMain","cType","fields","i","cItemName","push","switchGroupSchema","paramss","groupSchemaId","undefined","groupSchemaName","dimensionId","isIncludeMeta","_bindUpdateCondition","on","condition","_bindGridDblClick","cellInfo","getParent","readOnly","doubleEdit","id","rowData","cardViewModel","dt","_bindFilterControl","filterViewModel","propertyNames","propertyName","property","get","models","FilterModel","fromModel","getFromModel","toModel","getToModel","VOUCHER_STATE_BROWSE","_loadTree","promiseExecute","_renderTreeArchiveData","hasChildren","_bindTreeSelect","billType","path","ids","toString","biz","do","_bindTreeDblClick","_bindCompareTreeSelect","parameter","split","operator","_treeDetailSelect","dataSource","select","_setQueryItems","indexOf","_initPage","filterId","autoLoad","_","treename","isDistinct","buildRule","para","billNumber","language","beforeActData","_err","eval","rules","rule","attr","triggers","trigger","fieldName","ds","run","param","ruleid","vm","lineid","callback","items","cellName","context","childrenField","jointFields","config","parse","e","queryData","jointQuery","paras","menuCode","communication","type","payload","menuUrl","join","target","extend","refFields","referModel","_setReferRule","cRefType","setRefCode","cRefRetId","setReturnFields","refid","setFilter","isExtend","simpleVOs","_getSelectRowIds","distinct","selectDatas","getSelectedRows","map","row","Array","from","Set","check4List","metaType","nullMsg","theme","referRowsCheck","columnName","rows","column","getColumn","bBatchCheck","location","key","value","cControlType","fieldname","cFieldName","mergeAll","cellCheck","bCheck","oldValue","async","ruleItems","cellsCheck","abandon","afterActData","getOriginalData","abandonText","table","doPropertyChange","originalData","currentData","currentModel","originDsMode","_set_data","setData","k","setReadOnly","unselectAll","pageInfo","pageIndex","total","current","resetOrginalData","confirmAbandonFun","Function","_hasList","toLowerCase","add","console","error","addRow","appendRow","deleteRow","rowIndexes","getSelectedRowIndexes","deleteRows","save","invalidMsg","_status","DataStates","Update","Insert","parentData","parentNode","getNodesByKeys","arrayKeys","isArray","getDirtyRowIndexes","saveRefresh","addNode","batchDelete","batchDo","primaryKeyField","cmdParameter","primarykey","message","getNecessaryDataForRows","pubts","code","text","caption","cCaption","_batchDo","enabledCallback","batchsubmit","_invalidMsg","getDirtyData","errMsg","actionText","failCount","messages","getAllData","infos","gridList","clear","newStates","Unchanged","info","findIndex","splice","dblClick","copy","carry","refresh","obj","isSum","queryTree","search","editTree","cTarget","detailId","log","moveUp","selectedNodes","isFirst","keyField","moveDown","isLast","singlePush","batchPush","queryString","targetCode","isMainSelect","childIds","pathname","toStr","output","baseUrl","window","_baseUrl","substr","queryUrl","inputParams","format","has","bill","page","getPageSize","getPageIndex","HTTP_OUTPUT_BILL","importVoucher","btnCallBack","disabledCallback","isAsync","asyncInterval","asyncKey","getNewGuid","acceptedFileType","cParameter","interval","eleInput","document","createElement","accept","style","display","onchange","formData","FormData","enctype","file","files","fileName","fileSize","size","append","mapCondition","xhr","XMLHttpRequest","serviceCode","AppContext","send","onreadystatechange","bError","errorInfo","readyState","status","ajaxResult","responseText","queryAsyncProcess","sucessCount","body","removeChild","appendChild","click","exportVoucherTemplate","exportStaticVoucherTemplate","openUrl","exportReport","getRowsCount","subscribeMessage","model","batchOutputVoucher","print","json","token","preview","template","getValue","newTab","proxy","DynamicProxy","create","route","href","batchPrintVoucher","printID","VOUCHER_PRINT_KEY","tplid","savebo","saveBo","doDelete","children","getNecessaryData","getSelectedKeys","deleteNode","localPrint","isEmpty","getTemplate","templateCode","isdefault","templatecode","localPrintReport","sumSwitch","lastSearchCondition","batchModify","workflow","isWfControlled","verifystate","businessKey","width","height","appsource","appCode","flowComp","showFlowBox","onClose","callbackData","printPreview","currentParams","_morePrintPreview","urlParams","cacheData","uniform","newUrlParams","rs","sendType","newTempUrlParams","printDesign","printNow","doCommunication","attachment","selectRow","attachmentCondition","attachmentId","init","viewCallback","initCallback","view","Boolean","parentModel","ReferModel","dataList","cBillName","initData","terminalType","op","value1","recordList","updateRow","setPageIndex","rowKey","isExpand","returnPromise","promise","resolve","reject","act","optionExtend","editVoucherListExtendConfig","editVoucherListAction","doservice","cellcheck","cellscheck","referrowscheck","check","addrow","singlepush","edit","dblclick","delete","batchdelete","batchaudit","batchunaudit","batchdo","batchoutput","batchimport","tempexport","statictempexport","reportexport","messagesubscribe","batchprint","columnsetting","edittree","querytree","moveup","movedown","commandLine","switchgroupschema","localprint","batchpush","sumswitch","batchmodify","printpreview","printdesign","printnow","openpage","goback","billsetting","namespace","common"],"mappings":"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","file":"public/javascripts/8.bundle.js?_=d566ad53-de75-49ba-965f-44adb4dd2a09","sourcesContent":["/* eslint max-lines: [\"error\", 2700] */\n\nimport * as common from './common'\nimport env from '../helpers/env'\nimport uuid from 'uuid/v1';\nimport * as staterule from '../staterule/rule';\nconst themeType = process.env.__THEMETYPE__;\n\nconst editvoucherlist = (function () {\n  const _render = (viewmodel, data, dirty) => {\n    common.setRenderReadOnly(viewmodel)\n    common.setState(viewmodel)\n    staterule.runState(viewmodel)\n    if (dirty) {\n      viewmodel.setDirty(true)\n      viewmodel.loadDirtyData(data)\n    } else {\n      viewmodel.loadData(data)\n      if (data) {\n        viewmodel.execute('afterLoadData', data);\n        viewmodel.validate(true);\n      }\n    }\n  }\n  const _getTreeSelectNode = (viewmodel) => {\n    let selectNode,\n      node\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      selectNode = treeModel.getSelectedNodes()\n    }\n    if (selectNode && selectNode.length && selectNode[0]) {\n      node = selectNode[0]\n    }\n    return node\n  }\n  const singleDo = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const rowIndex = params && params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(currentRow)\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('操作成功', 'success');\n          viewModel.execute('refresh');\n        }\n        const afterActData = { err, res };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, postData);\n    });\n  };\n  const _doService = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (!viewmodel.getCache('lastMode')) {\n      singleDo(billNo, viewmodel, params, beforeAct, afterAct);\n      return;\n    }\n    const node = _getTreeSelectNode(viewmodel)\n    if (!node) {\n      cb.utils.alert('请选择有效数据', 'warning');\n      return;\n    }\n    common.doService(billNo, viewmodel, params, beforeAct, afterAct, function (viewmodel, postData, params) {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('操作成功', 'success')\n          const oldData = viewmodel.collectData(true)\n          const newData = common.billMerge(oldData, res)\n          common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n          _render(viewmodel, newData)\n          viewmodel.getTreeModel().updateNode(newData);\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n  // 启用\n  const open = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'open';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026042', {cShowCaption: params.cShowCaption}), function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct);\n    }\n  };\n  // 停用\n  const close = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'close';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026042', {cShowCaption: params.cShowCaption}), function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct);\n    }\n  };\n  // 树卡\n  const _addCard = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const maxLevel = viewmodel.getTreeModel().getState('maxLevel');\n    const level = maxLevel === false ? 65536 : (maxLevel || 3);\n    const selectedNode = _getTreeSelectNode(viewmodel)\n    if (selectedNode && selectedNode.level > level) {\n      cb.utils.alert(cb.locale('P_YS_FED_FW_0001026057', {level: (level + 1)}), 'error');\n      return;\n    }\n    const postData = {\n      billnum: billNo\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.emptyBill(postData, params, function (err, suc) {\n        if (suc) {\n          // viewmodel.clear()\n          common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n          const treeModel = viewmodel.getTreeModel();\n          const parentField = treeModel.getState('parentField');\n          if (suc[parentField] == null) {\n            if (selectedNode) {\n              suc[parentField] = selectedNode[treeModel.getState('keyField')];\n              suc.parent_name = selectedNode.name;\n            }\n          }\n          _render(viewmodel, suc, true)\n        }\n        const afterActData = {\n          err: err,\n          res: suc\n        }\n        afterAct(afterActData, common.afterAct)\n      })\n    })\n  }\n\n  // 树表添加要跳页\n  const _addVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (cb.rest.interMode === 'touch') {\n      const gridModel = viewmodel.getGridModel();\n      if (gridModel)\n        gridModel.clearCache('backData');\n    }\n    const cardKey = common.getVmParams(viewmodel, 'cardKey')\n    if (!cardKey) {\n      cb.utils.alert('元数据未配置cCardKey', 'warning')\n      return\n    }\n    let parentId\n    const node = _getTreeSelectNode(viewmodel)\n    if (node) {\n      parentId = node[viewmodel.getTreeModel().getState('keyField')]\n    }\n    const postData = {\n      params: params,\n      mode: env.VOUCHER_STATE_ADD,\n      action: 'add',\n      carryParams: {},\n      parentId: parentId,\n      parent: node\n    };\n    const beforeActData = { params: postData };\n    beforeAct(beforeActData, function (args) {\n      if (args)\n        postData.carryParams.externalData = args;\n      cb.loader.runCommandLine('bill', {\n        billtype: 'voucher',\n        billno: cardKey,\n        params: postData\n      }, viewmodel);\n      afterAct();\n    })\n  }\n\n  const _loadGrid = (viewmodel, params, afterAct) => {\n    const queryItems = viewmodel.getCache('queryItems') || [];\n    if (!cb.extendConfig.editvoucherlist) {\n      cb.extendConfig.editvoucherlist = {};\n    }\n    if (queryItems.length) {\n      let flag = false;\n      queryItems.forEach(item => {\n        const field = item.replace(/(\\w)/, function (v) {\n          return v.toUpperCase()\n        }) // 首字母大写\n        if (viewmodel.getCache(`exec${field}`)) return;\n        flag = true;\n      });\n      if (flag) {\n        /* 恢复刷新按钮的状态 */\n        if (afterAct) {\n          afterAct();\n        }\n        return;\n      }\n    }\n    const billType = common.getVmParams(viewmodel, 'billType');\n    if (billType === 'Report') {\n      viewmodel.execute('firstQueryDone', true);\n    }\n    const { reportId } = viewmodel.getParams().query;\n    const gridModel = viewmodel.getGridModel()\n    if (reportId && !params.reportId)\n      gridModel.setColumns(gridModel.getState('columns'));\n    Object.assign(params, viewmodel.getParams().query);\n    if (gridModel) {\n      gridModel.setState('showSearch', params.showSearch);\n      delete params.showSearch;\n      // 下面四行代码，是为了在显示维度导航时，列表数据不再在点击过滤控件时取，而是在点击维度导航时取列表数据\n      const bDisplay = viewmodel.getCache('bDisplayNavTree');\n      if (bDisplay == true && !params.bFromNav) {\n        return;\n      }\n      if (!gridModel.execute('beforeLoad', params)) return true\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n        return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdlist'\n      });\n      const proxyParams = configParams && configParams.cSvcUrl ? {\n        url: configParams.cSvcUrl,\n        method: configParams.cHttpMethod || 'POST',\n        options: { mask: true }\n      } : {\n        url: 'bill/list',\n        method: 'POST',\n        options: { mask: true }\n      };\n      if (cb.extendConfig.editvoucherlist.pageSize)\n        gridModel.setPageInfo({pageSize: cb.extendConfig.editvoucherlist.pageSize});\n      gridModel.setDataSource(proxyParams, params, function (result) {\n        const isShowPagination = gridModel._get_data('delayLoadPageInfo') || result.recordCount > cb.extendConfig.editvoucherlist.pageSize // 当查询数据大于最大显示条数时，显示分页栏\n        gridModel.setPagination(isShowPagination);\n        const columns = getColumnsData(result);\n\n        if (!columns) return;\n        this.setColumns(columns.columns, columns.fieldNames);\n      });\n      gridModel.setCache('afterAct', afterAct);\n      viewmodel.getCache('cardViewModel') && gridModel.execute('dblClick', {});\n    }\n  }\n\n  const getColumnsData = function (result) {\n    if (!result.viewmodel) return;\n    const columns = {}; const fieldNames = [];\n    const columnArray = result.viewmodel.entities.filter(function (item) {\n      return item.bMain && item.cType === 'Bill';\n    })[0].fields;\n    for (let i = 0; i < columnArray.length; i++) {\n      const item = columnArray[i];\n      columns[item.cItemName] = item;\n      fieldNames.push(item.cItemName);\n    }\n    return { columns, fieldNames };\n  };\n\n  const switchGroupSchema = (billNo, viewModel, paramss, beforeAct, afterAct) => {\n    const groupSchemaId = paramss ? paramss.groupSchemaId : undefined;\n    const groupSchemaName = paramss ? paramss.groupSchemaName : undefined;\n    const dimensionId = paramss ? paramss.dimensionId || 9999 : undefined;\n    viewModel.execute('refreshEChartConfig', { billnum: billNo, groupSchemaId, groupSchemaName, dimensionId });\n    viewModel.setCache('execSchema', true);\n    viewModel.setCache('groupSchemaId', groupSchemaId);\n    viewModel.getGridModel().setState('showColumnSetting', !groupSchemaId);\n    const params = Object.assign({\n      billnum: billNo,\n      groupSchemaId,\n      isIncludeMeta: true\n    }, viewModel.getCache('lastSearchCondition'));\n    Object.assign(params, viewModel.getParams().query);\n    _loadGrid(viewModel, params, afterAct);\n  }\n\n  const _bindUpdateCondition = (viewModel, billNo) => {\n    viewModel.on('updateCondition', function (args) {\n      _loadGrid(viewModel, {\n        billnum: billNo,\n        condition: args\n      });\n    });\n  }\n  const _bindGridDblClick = (viewmodel, billNo) => {\n    const gridModel = viewmodel.getGridModel()\n    if (!gridModel) return\n    // let dblClickItemName = null;\n    // const columns = gridModel.getColumns();\n    // for (var attr in columns) {\n    //   if (columns[attr].bJointQuery) {\n    //     dblClickItemName = attr;\n    //     break;\n    //   }\n    // }\n    // 去掉监听，扩展脚本自行跳转吧\n    // gridModel.on('cellJointQuery', function (args) {\n    //   const rowData = gridModel.getRow(args.rowIndex);\n    //   if (args.cellName === dblClickItemName) {\n    //     gridModel.execute('dblClick', rowData, args);\n    //     gridModel.setCache('backData', { rowIndex: args.rowIndex, id: rowData.id });\n    //   } else {\n    //     gridModel.execute('jointQuery', Object.assign(args, { rowData }));\n    //   }\n    // });\n    /* gridModel.on('afterInsertRowsFromRefer', args => {\n      viewmodel.biz.do('referrowscheck', viewmodel, Object.assign({ childrenField: childrenField }, args));\n    }); */\n    gridModel.on('dblClick', function (args, cellInfo) {\n      const parent = this.getParent()\n      const params = {\n        mode: env.VOUCHER_STATE_EDIT,\n        readOnly: !viewmodel.getParams().doubleEdit,\n        id: args.id,\n        rowData: args,\n        cellInfo,\n        carryParams: {},\n        cardViewModel: parent.getCache('cardViewModel')\n      }\n      if (!gridModel.execute('beforeDblClick', params)) return true\n      const cardKey = common.getVmParams(viewmodel, 'cardKey')\n      if (!cardKey)\n        return\n      const dt = {\n        billtype: 'voucher',\n        billno: cardKey,\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, parent)\n    })\n\n    gridModel.on('afterSetDataSource', () => {\n      // 设置数据dirty\n      gridModel.setDirty(false);\n      const afterAct = gridModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n      common.setGridActionStates(gridModel, viewmodel);\n      staterule.runGridActionStates(gridModel, viewmodel);\n    });\n  }\n  // 根据页面状态控制过滤区按钮可用性\n  const _bindFilterControl = (viewmodel, billno) => {\n    const filterViewModel = viewmodel.getCache('FilterViewModel');\n    if (filterViewModel) {\n      viewmodel.on('modeChange', (mode) => {\n        const propertyNames = filterViewModel._get_data('propertyNames');\n        for (let i = 0; i < propertyNames.length; i++) {\n          const propertyName = propertyNames[i];\n          const property = filterViewModel.get(propertyName);\n          if (!(property instanceof cb.models.FilterModel)) continue;\n          const fromModel = property.getFromModel && property.getFromModel();\n          const toModel = property.getToModel && property.getToModel();\n          fromModel && fromModel.setState('disabled', mode !== env.VOUCHER_STATE_BROWSE);\n          toModel && toModel.setState('disabled', mode !== env.VOUCHER_STATE_BROWSE);\n        }\n      })\n    }\n  }\n  const _loadTree = (viewmodel, params, afterAct) => {\n    const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n      return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdquerytree'\n    });\n    const proxyParams = configParams && configParams.cSvcUrl ? {\n      url: configParams.cSvcUrl,\n      method: configParams.cHttpMethod || 'POST'\n    } : {\n      url: 'bill/querytree',\n      method: 'POST'\n    };\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      treeModel.promiseExecute('beforeLoad', params, function () {\n        treeModel.setDataSource(proxyParams, params)\n        if (afterAct) treeModel.setCache('afterAct', afterAct)\n      })\n    }\n  }\n\n  const _renderTreeArchiveData = (billNo, viewmodel, params) => {\n    const hasChildren = viewmodel.getParams().hasChildren;\n    if (hasChildren) {\n      const data = {\n        billnum: billNo,\n        id: params[viewmodel.getTreeModel().getState('keyField')]\n      }\n      const callback = function (err, data) {\n        if (!err)\n          _render(viewmodel, data);\n      }\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n        return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmddetail';\n      });\n      const options = configParams && configParams.cSvcUrl ? {\n        cSvcUrl: configParams.cSvcUrl,\n        cHttpMethod: configParams.cHttpMethod || 'GET'\n      } : {\n        cSvcUrl: 'bill/detail',\n        cHttpMethod: 'GET'\n      };\n      common.doProxy(options, callback, data)\n    } else {\n      _render(viewmodel, params);\n    }\n  }\n\n  const _bindTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel) return\n    const gridModel = viewmodel.getGridModel()\n    const { billType } = viewmodel.getParams();\n    treeModel.on('select', function (args) {\n      viewmodel.promiseExecute('beforeTreeSelect', args, function () {\n        if (gridModel || billType === 'TreeList') { // 树表\n          if (!gridModel) return;\n          // if (!args.length) return;\n          viewmodel.setCache('execTree', true);\n          const condition = { billnum: billNo };\n          if (args.length) {\n            const { path, id } = args[0];\n            if (path)\n              condition.path = path;\n            else if (id)\n              condition.ids = id.toString();\n          }\n          Object.assign(condition, viewmodel.getCache('lastSearchCondition'));\n          _loadGrid(viewmodel, condition);\n        } else { // 树卡\n          if (args.length) {\n            common.setMode(viewmodel, env.VOUCHER_STATE_EDIT);\n            // _render(viewmodel, args[0]);\n            _renderTreeArchiveData(billNo, viewmodel, args[0]);\n            viewmodel.setCache('lastMode', env.VOUCHER_STATE_EDIT);\n          } else {\n            common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            // _render(viewmodel);\n            viewmodel.biz.do('add', viewmodel);\n            viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n          }\n        }\n        // common.setState(viewmodel)\n      })\n    })\n\n    treeModel.on('afterSetDataSource', () => {\n      if (!gridModel) {\n        const afterAct = treeModel.getCache('afterAct');\n        if (afterAct)\n          afterAct();\n        return;\n      }\n      const afterAct = gridModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n    });\n  }\n  const _bindTreeDblClick = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel) return\n\n    treeModel.on('cellJointQuery', function (args) {\n      const rowData = args.rowData;\n      treeModel.execute('dblClick', rowData);\n      // gridModel.setCache('backData', { rowIndex: args.rowIndex, id: rowData.id });\n    });\n    treeModel.on('dblClick', function (args) {\n      const parent = this.getParent()\n      const params = {\n        mode: env.VOUCHER_STATE_EDIT,\n        readOnly: true,\n        id: args.id,\n        cardViewModel: parent.getCache('cardViewModel')\n      }\n      if (!treeModel.execute('beforeDblClick', params)) return true\n      const dt = {\n        billtype: 'voucher',\n        billno: common.getVmParams(parent, 'cardKey'),\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, parent)\n    })\n  }\n  const _bindCompareTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel) return\n    treeModel.on('select', function (args) {\n      const gridModel = viewmodel.getGridModel()\n      if (gridModel && args.length) {\n        let parameter = common.getVmParams(viewmodel, 'foreignKey')\n        if (parameter) {\n          const args = parameter.split('.')\n          if (args && args.length > 1) {\n            parameter = args[1]\n          }\n        }\n        const postData = {\n          billnum: billNo,\n          path: args[0][parameter],\n          operator: 'eq'\n        }\n        _loadGrid(viewmodel, postData)\n      }\n      const data = args[0]\n      common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n      _render(viewmodel, data)\n    })\n  }\n\n  const _treeDetailSelect = (viewmodel, billNo, id) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      treeModel.on('afterSetDataSource', function (dataSource) {\n        treeModel.select(id)\n      })\n    }\n  }\n\n  const _setQueryItems = (viewModel, item) => {\n    const queryItems = viewModel.getCache('queryItems') || [];\n    if (queryItems.indexOf(item) === -1)\n      queryItems.push(item);\n    viewModel.setCache('queryItems', queryItems);\n  }\n\n  const _initPage = (viewmodel, billNo) => {\n    const billType = common.getVmParams(viewmodel, 'billType')\n    const filterId = common.getVmParams(viewmodel, 'filterId')\n    const condition = common.getVmParams(viewmodel, 'condition');\n    const autoLoad = common.getVmParams(viewmodel, 'autoLoad');\n    const id = common.getVmParams(viewmodel, 'detailId')\n    // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n    // _render(viewmodel)\n\n    switch (billType) {\n      case 'Report': {\n        const viewid = _.get(viewmodel.getParams(), 'query.viewid');\n        if (condition || !filterId) {\n          // viewmodel.setCache('firstQuery', true);\n          _loadGrid(viewmodel, { billnum: billNo, condition: condition });\n        }\n        if (viewid) {\n          // viewmodel.setCache('firstQuery', true);\n          // _loadGrid(viewmodel, { billnum: billNo, condition: condition });\n        }\n        _bindGridDblClick(viewmodel, billNo);\n        break;\n      }\n      case ('VoucherList'):\n      case ('ArchiveList'):\n      case ('EditVoucherList'):\n        if (!filterId && autoLoad !== false) {\n          _loadGrid(viewmodel, {\n            billnum: billNo,\n            condition: condition\n          })\n        }\n        if (!filterId)\n          _bindUpdateCondition(viewmodel, billNo);\n        _bindGridDblClick(viewmodel, billNo);\n        _bindFilterControl(viewmodel, billNo)\n        break\n      case ('EditTreeVoucherList'):\n      case ('TreeList'): {\n        const treeModel = viewmodel.getTreeModel();\n        if (treeModel && treeModel.getState('defaultSelectedKeys'))\n          _setQueryItems(viewmodel, 'tree');\n        _loadTree(viewmodel, {\n          billnum: billNo,\n          treename: common.getVmParams(viewmodel, 'treeName')\n        })\n        _bindTreeSelect(viewmodel, billNo)\n        _bindTreeDblClick(viewmodel, billNo)\n        _bindGridDblClick(viewmodel, billNo)\n        break\n      }\n      case ('TreeArchive'):\n        // common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n        _loadTree(viewmodel, {\n          billnum: billNo,\n          treename: common.getVmParams(viewmodel, 'treeName')\n        })\n        _bindTreeSelect(viewmodel, billNo)\n        // _render(viewmodel)\n        viewmodel.biz.do('add', viewmodel);\n        viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n        break\n      case ('Compare'):\n        common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n        _loadTree(viewmodel, {\n          billnum: billNo,\n          treename: common.getVmParams(viewmodel, 'treeName'),\n          isDistinct: true\n        })\n        _bindCompareTreeSelect(viewmodel, billNo)\n        _bindGridDblClick(viewmodel, billNo)\n        _render(viewmodel)\n        break\n    }\n    // common.setState(viewmodel)\n    if (id) {\n      _treeDetailSelect(viewmodel, billNo, id)\n    }\n  }\n  // 规则\n  const buildRule = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const postData = {\n      billNumber: billNo,\n      language: 'javascript'\n    }\n    const beforeActData = {\n      params: para,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.doProxy({\n        cSvcUrl: '/itemrule/script',\n        cHttpMethod: 'GET'\n      }, function (_err, data) {\n        // eslint-disable-next-line no-eval\n        data = eval(data) || {};\n        data && (data.rules || []).forEach(function (rule) {\n          const fields = {}\n          rule.triggers.forEach(function (trigger) {\n            const fieldName = trigger.ds\n            if (fieldName) {\n              if (!fields[fieldName])\n                fields[fieldName] = []\n              fields[fieldName].push(trigger.item)\n            } else {\n              if (!viewmodel.get(trigger.item)) return\n              viewmodel.get(trigger.item).on('afterValueChange', function () {\n                this.run(this.param)\n              }, {\n                run: data.run,\n                param: {\n                  ruleid: rule.id,\n                  vm: viewmodel,\n                  trigger: {\n                    ds: fieldName,\n                    item: trigger.item,\n                    lineid: '0'\n                  }\n                }\n              })\n            }\n          })\n          for (const attr in fields) {\n            if (!viewmodel.get(attr)) continue\n            viewmodel.get(attr).setCache('ruleItems', fields[attr]);\n            const callback = function (args) {\n              if (this.items.indexOf(args.cellName) === -1) return\n              this.param.trigger.item = args.cellName\n              this.param.trigger.lineid = '0:' + args.rowIndex\n              this.run(this.param)\n            }\n            const context = {\n              items: fields[attr],\n              run: data.run,\n              param: {\n                ruleid: rule.id,\n                vm: viewmodel,\n                trigger: {\n                  ds: attr\n                }\n              }\n            };\n            viewmodel.get(attr).on('afterCellValueChange', callback, context);\n            viewmodel.get(attr).on('innerCellValueChange', callback, context);\n            // fangqg: 删行、增行后重新执行公式计算\n            viewmodel.get(attr).on('afterDeleteRows', function () {\n              const childrenField = this.childrenField;\n              this.items.forEach(function (cellName) {\n                viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName });\n              });\n            }, {\n              items: fields[attr],\n              childrenField: attr\n            });\n            viewmodel.get(attr).on('afterInsertRow', function () {\n              const childrenField = this.childrenField;\n              this.items.forEach(function (cellName) {\n                viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName });\n              });\n            }, {\n              items: fields[attr],\n              childrenField: attr\n            });\n          }\n        })\n        const jointFields = {};\n        (data.jointFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!jointFields[fieldName])\n              jointFields[fieldName] = []\n            jointFields[fieldName].push(field.item)\n          } else {\n            if (!viewmodel.get(field.item)) return\n            viewmodel.get(field.item).on('jointQuery', function () {\n              let config = null;\n              try {\n                config = JSON.parse(this.param.vm.get(this.param.trigger.item).getState('cStyle'));\n              } catch (e) {\n                config = {};\n              }\n              const queryData = this.jointQuery(this.param)\n              const items = [];\n              for (const attr in queryData.paras) {\n                items.push(attr + '=' + queryData.paras[attr]);\n              }\n              config.menuCode = 'SJ0201';\n              if (config.menuCode) {\n                viewmodel.communication({ type: 'menu', payload: { menuCode: config.menuCode, menuUrl: '?' + items.join(',') } });\n                return;\n              }\n              const parent = this.param.vm\n              const dt = {\n                billtype: 'voucher',\n                billno: queryData.target,\n                params: cb.utils.extend(true, queryData.paras, {\n                  mode: env.VOUCHER_STATE_EDIT\n                })\n              }\n              cb.loader.runCommandLine('bill', dt, parent)\n            }, {\n              jointQuery: data.jointQuery,\n              param: {\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in jointFields) {\n          if (!viewmodel.get(attr)) continue\n          viewmodel.get(attr).on('cellJointQuery', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            const parent = this.param.vm\n            const dt = {\n              billtype: 'voucher',\n              billno: queryData.target,\n              params: cb.utils.extend(true, queryData.paras, {\n                mode: env.VOUCHER_STATE_EDIT\n              })\n            }\n            cb.loader.runCommandLine('bill', dt, parent)\n          }, {\n            items: jointFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n        const refFields = {};\n        (data.refFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!refFields[fieldName])\n              refFields[fieldName] = []\n            refFields[fieldName].push(field.item)\n          } else {\n            const referModel = viewmodel.get(field.item);\n            if (!referModel) return\n            referModel.on('beforeBrowse', function () {\n              const queryData = this.jointQuery(this.param)\n              if (!queryData) return\n              _setReferRule(queryData, this.referModel)\n            }, {\n              referModel: referModel,\n              jointQuery: data.jointQuery,\n              param: {\n                action: 'ref',\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in refFields) {\n          const referModel = viewmodel.get(attr);\n          if (!referModel) continue\n          referModel.on('beforeBrowse', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            if (!queryData) return\n            _setReferRule(queryData, args.context)\n          }, {\n            referModel: referModel,\n            items: refFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              action: 'ref',\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n\n        afterAct()\n      }, postData)\n    })\n  }\n  const _setReferRule = (queryData, referModel) => {\n    const target = queryData.target\n    if (target) {\n      if (target.cRefType) {\n        referModel.setRefCode(target.cRefType)\n      }\n      if (target.cRefRetId) {\n        referModel.setReturnFields(target.cRefRetId.refid)\n      }\n    }\n    referModel.setFilter({\n      isExtend: true,\n      simpleVOs: queryData.paras\n    })\n  }\n\n  const _getSelectRowIds = (gridModel, para, distinct = true) => { // 默认去重\n    if (!gridModel) return\n    const selectDatas = para && para.params && para.params.index != null\n      ? [gridModel.getRow(para.params.index)]\n      : gridModel.getSelectedRows();\n    const ids = []\n    if (selectDatas && selectDatas.length > 0) {\n      selectDatas.map(function (row) {\n        if (row.id) {\n          ids.push(row.id)\n        }\n      })\n    }\n    return distinct ? Array.from(new Set(ids)) : ids\n  }\n\n  const check4List = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (viewmodel.getParams().metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel)\n      if (node) {\n        const treeModel = viewmodel.getTreeModel();\n        params[treeModel.getState('parentField')] = node[treeModel.getState('keyField')];\n      }\n    }\n    const beforeActData = {\n      params: params,\n    }\n    beforeAct(beforeActData, function () {\n      const nullMsg = cb.extendConfig.theme === 'ncc';\n      common.check(billNo, viewmodel, params, beforeAct, afterAct, false, nullMsg)\n    })\n  }\n  const referRowsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const { childrenField, columnName, index, rows } = params;\n    const gridModel = viewModel.get(childrenField);\n    const column = gridModel.getColumn(columnName);\n    if (!column.bBatchCheck) return;\n    const data = {\n      location: index,\n      key: columnName,\n      childrenField,\n      value: JSON.stringify(rows),\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      mergeAll: true,\n    };\n    common.check(billNo, viewModel, data, beforeAct, afterAct, true);\n  }\n  const cellCheck = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = common.getGridModel(viewmodel, params)\n    const cellName = params.cellName\n    const column = gridModel.getColumn(cellName)\n    if (!column.bCheck) return;\n    const data = {\n      location: params.rowIndex,\n      key: cellName,\n      childrenField: params.childrenField,\n      value: JSON.stringify(params.value),\n      oldValue: params.oldValue,\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      async: params.async,\n      callback: params.callback,\n      context: params.context,\n    }\n\n    const ruleItems = gridModel.getCache('ruleItems');\n    if (ruleItems && ruleItems.indexOf(cellName) > -1)\n      data.async = false;\n    common.check(billNo, viewmodel, data, beforeAct, afterAct, true)\n  }\n  const cellsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const args = [];\n    params.forEach(item => {\n      const column = viewModel.get(item.childrenField).getColumn(item.cellName);\n      if (!column.bCheck) return;\n      args.push({\n        location: item.rowIndex,\n        key: item.cellName,\n        childrenField: item.childrenField,\n        value: JSON.stringify(item.value),\n        type: item.cControlType,\n        fieldname: item.cFieldName,\n      });\n    });\n    common.batchCheck(billNo, viewModel, args);\n  }\n  const abandon = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const afterActData = {\n      res: viewmodel.getOriginalData()\n    }\n    const resetOrginalData = (viewmodel) => {\n      // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n      const originalData = viewmodel.getOriginalData();\n      for (const propertyName in originalData) {\n        const currentData = originalData[propertyName];\n        const currentModel = viewmodel.get(propertyName);\n        const originDsMode = viewmodel._get_data('dataSourceMode');\n        currentModel._set_data('dataSourceMode', 'local');\n        if (currentModel.setData) {\n          currentModel.setData(currentData);\n        } else {\n          currentModel.setDataSource(currentData);\n        }\n        currentModel._set_data('dataSourceMode', originDsMode);\n      }\n      viewmodel.setReadOnly(true);\n      common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n      common.setState(viewmodel);\n      staterule.runState(viewmodel);\n\n      // 恢复行按钮状态\n      // let gridModel=viewmodel.getGridModel();\n      for (const k in originalData) {\n        const currentData = originalData[k];\n        const currentModel = viewmodel.get(k);\n        currentModel.execute('afterSetDataSource', currentData);\n        currentModel.unselectAll();\n      }\n      // 恢复分页数\n      const gridModel = viewmodel.getGridModel();\n      const pageInfo = gridModel.get('pageInfo');\n      const pagination = gridModel.get('pagination');\n      if (pagination && pageInfo) {\n        const recordCount = pageInfo && pageInfo.recordCount ? pageInfo.recordCount : 0;\n        const pageIndex = pageInfo && pageInfo.pageIndex ? pageInfo.pageIndex : 1;\n        const pageSize = pageInfo && pageInfo.pageSize ? pageInfo.pageSize : 50;\n        gridModel.setState('pagination', {\n          total: recordCount,\n          current: pageIndex,\n          pageSize: pageSize\n        })\n      }\n    }\n    const beforeActData = {\n      params: params\n    }\n    beforeAct(beforeActData, function () {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026058', {abandonText: params.cShowCaption}), function () {\n        const table = viewmodel.getGridModel();\n        if (table) {\n          table.doPropertyChange('clearnColError');\n        }\n        resetOrginalData(viewmodel)\n        const confirmAbandonFun = viewmodel.getCache('confirmAbandonFun');\n        if (confirmAbandonFun instanceof Function) {\n          confirmAbandonFun();\n        }\n      }, () => {\n        afterAct(afterActData, common.afterAct)\n      });\n    })\n  }\n  const _hasList = (billType) => {\n    return (billType.indexOf('ist') > -1 || billType.toLowerCase() == 'compare') // ArchiveList,TreeList,VoucherList,compare\n  }\n  const add = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'add';\n      });\n      Object.assign(params, configParams);\n    }\n    const billType = viewmodel.getParams() && viewmodel.getParams().billType\n    if (billType) {\n      if (_hasList(billType)) { // ArchiveList,TreeList,VoucherList,compare\n        _addVoucher(billNo, viewmodel, params, beforeAct, afterAct)\n      } else {\n        _addCard(billNo, viewmodel, params, beforeAct, afterAct)\n      }\n    } else {\n      console.error('未获得billType')\n    }\n  }\n\n  const addRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const beforeActData = {\n      params: params\n    }\n    beforeAct(beforeActData, function () {\n      const mode = common.getMode(viewmodel);\n      if (mode !== env.VOUCHER_STATE_EDIT) {\n        common.edit(billNo, viewmodel, params, beforeAct, afterAct);\n      }\n      const data = common.getGridModel(viewmodel, params).appendRow()\n      afterAct(data)\n    })\n  }\n\n  const deleteRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (!rowIndexes || rowIndexes.length < 1) {\n      cb.utils.alert('请选择', 'warning');\n      return\n    }\n    const beforeActData = {\n      params: params,\n      data: rowIndexes\n    }\n    beforeAct(beforeActData, function () {\n      const data = common.getGridModel(viewmodel, params).deleteRows(rowIndexes)\n      afterAct(data)\n    })\n  }\n  const save = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const invalidMsg = viewmodel.validate();\n    if (invalidMsg) {\n      cb.utils.alert('以下数据项校验失败：' + invalidMsg.join(','), 'error');\n      return;\n    }\n    const data = viewmodel.collectData()\n    if (!data) return\n    const mode = common.getMode(viewmodel)\n    if (mode != env.VOUCHER_STATE_ADD) {\n      data._status = cb.models.DataStates.Update\n    } else {\n      data._status = cb.models.DataStates.Insert\n      const treeModel = viewmodel.getTreeModel();\n      const parentData = data[treeModel.getState('parentField')];\n      if (parentData) {\n        if (treeModel) {\n          const parentNode = treeModel.getNodesByKeys(parentData);\n          if (parentNode && parentNode.length)\n            data.level = parentNode[0].level + 1;\n        }\n      } else {\n        data.level = 1;\n      }\n      // let node = _getTreeSelectNode(viewmodel)\n      // if (node) {\n      //   data.parent = node.id\n      //   let level = !node.level || 1\n      //   data.level = parseInt(level) + 1\n      //   data.path = node.path\n      // }\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          // let necessaryData = viewmodel.getNecessaryData()\n          const oldData = viewmodel.collectData(true)\n          let condition;\n          const arrayKeys = []\n          for (const key in res) {\n            if (Array.isArray(res[key]) &&\n              viewmodel.get(key) &&\n              viewmodel.get(key).getDirtyRowIndexes &&\n              viewmodel.get(key).getDirtyRowIndexes() &&\n              viewmodel.get(key).getDirtyRowIndexes().length > 0) {\n              arrayKeys.push(key)\n              condition = {};\n            }\n          }\n\n          arrayKeys.forEach((key) => {\n            condition[key] = viewmodel.get(key).getDirtyRowIndexes()\n          })\n          const newData = common.billMerge(oldData, res, condition)\n          common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n          _render(viewmodel, newData)\n          viewmodel.execute('updateTreeRefer')\n          const treeModel = viewmodel.getTreeModel();\n          if (viewmodel.getParams().saveRefresh) {\n            _loadTree(viewmodel, {\n              billnum: billNo,\n              treename: common.getVmParams(viewmodel, 'treeName')\n            }, function () {\n              const key = newData[treeModel.getState('keyField')];\n              if (key)\n                treeModel.select(key.toString());\n            });\n          } else {\n            // if (necessaryData[treeModel.getState('keyField')]) {\n            if (mode !== env.VOUCHER_STATE_ADD) {\n              treeModel.updateNode(newData)\n            } else {\n              // let selectKey = treeModel.getSelectedKeys()\n              // let parentKey\n              // if (selectKey && selectKey.length && selectKey[0] != undefined) {\n              //   parentKey = selectKey[0]\n              // }\n              // treeModel.addNode(newData, parentKey)\n              treeModel.addNode(newData, true)\n            }\n          }\n          cb.utils.alert('保存成功', 'success')\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      params.options = { mask: true };\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  const batchDelete = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const mode = common.getMode(viewmodel);\n    if (mode == env.VOUCHER_STATE_EDIT) {\n      deleteRow(billNo, viewmodel, params, beforeAct, afterAct);\n    } else if (themeType == 'ncc') {\n      batchDo(billNo, viewmodel, params, beforeAct, afterAct);\n    } else {\n      batchDo(billNo, viewmodel, params, beforeAct, afterAct, true);\n    }\n  }\n\n  const batchDo = (billNo, viewmodel, params, beforeAct, afterAct, confirm) => {\n    // 行删除不实用确认框\n    if (params.cItemName !== 'btnDelete' && params.cItemName !== 'btnDeleteRow') {\n      if (confirm == undefined) {\n        confirm = !!cb.extendConfig.allConfirm;\n      }\n    }\n    let primaryKeyField;\n    try {\n      primaryKeyField = JSON.parse(params.cmdParameter).primarykey;\n    } catch (e) {\n      console.error('batchDo action parameter error: ' + e.message);\n    }\n    if (!primaryKeyField)\n      primaryKeyField = 'id';\n    const gridModel = viewmodel.getGridModel()\n    let selectDatas;\n    const treeModel = viewmodel.getTreeModel();\n    if (gridModel) {\n      selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n      gridModel._set_data('focusedRowIndex', -1, true);\n    } else {\n      if (treeModel)\n        selectDatas = treeModel.getSelectedNodes();\n    }\n    if (!selectDatas || selectDatas.length == 0) {\n      cb.utils.alert('请选择', 'warning')\n    } else {\n      let data;\n      if (gridModel) {\n        data = gridModel.getNecessaryDataForRows(selectDatas);\n      } else {\n        data = treeModel.getNecessaryDataForRows(selectDatas);\n      }\n      const paramsData = []; const primaryKeys = [];\n      selectDatas.forEach(function (row, index) {\n        if (row.id && row.pubts) {\n          Object.assign(data[index], {\n            code: row.code,\n            id: row.id,\n            pubts: row.pubts\n          })\n        }\n        if (primaryKeys.indexOf(row[primaryKeyField]) === -1) {\n          paramsData.push(data[index]);\n          primaryKeys.push(row[primaryKeyField]);\n        }\n      }, this)\n      const postData = {\n        billnum: billNo,\n        data: JSON.stringify(paramsData)\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      params.ids = data;\n      beforeAct(beforeActData, function () {\n        if (confirm) {\n          const text = viewmodel.getParams().caption;\n          cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026054', {cCaption: params.cCaption, text}), function () {\n            _batchDo(viewmodel, params, afterAct, paramsData, postData);\n          }, function () {\n            if (params && params.enabledCallback)\n              params.enabledCallback();\n          });\n        } else {\n          _batchDo(viewmodel, params, afterAct, paramsData, postData);\n        }\n      })\n    }\n  }\n  const batchsubmit = (billNo, viewmodel, params, beforeAct, afterAct, confirm) => {\n    const invalidMsg = viewmodel.validate();\n    if (invalidMsg) {\n      const _invalidMsg = invalidMsg && invalidMsg.join(',');\n      _invalidMsg && cb.utils.alert('以下数据项校验失败：' + _invalidMsg, 'error');\n      return;\n    }\n    const gridModel = viewmodel.getGridModel();\n    const data = gridModel.getDirtyData();\n    if (data && data.length > 0) {\n      const beforeActData = {\n        params: params,\n        data: data\n      }\n      beforeAct(beforeActData, function () {\n        // _batchDo(viewmodel, params, afterAct, data, postData);\n        const callback = function (err, res) {\n          if (!err && res) {\n            if (cb.utils.isArray(res)) {\n              cb.utils.alert('操作成功', 'success');\n            } else {\n              const actionText = params.cShowCaption;\n              if (data.length === 1) {\n                if (res.failCount) {\n                  cb.utils.alert(cb.locale('P_YS_FED_FW_0001026088', {actionText, messages: res.messages[0]}), 'error');\n                } else {\n                  cb.utils.alert(cb.locale('P_YS_FED_FW_0001026089', {actionText}), 'success');\n                }\n              } else {\n                if (themeType == 'ncc' && !viewmodel.getCache('showBatchMsg')) {\n                  if (res.failCount > 0) {\n                    cb.utils.alert(cb.locale('P_YS_FED_FW_0001026087', {actionText, ...res}), 'error')\n                  } else {\n                    cb.utils.alert(cb.locale('P_YS_FED_FW_0001026086', {actionText, ...res}), 'success')\n                  }\n                } else {\n                  viewmodel.communication({\n                    type: 'modal',\n                    payload: {\n                      key: 'BatchMsg',\n                      data: {\n                        type: 2,\n                        res,\n                      }\n                    }\n                  });\n                }\n              }\n            }\n          } else {\n            const errMsg = err && err.message ? err.message : '后台数据返回错误'\n            cb.utils.alert(errMsg, 'error');\n            afterAct()\n            return;\n          }\n\n          /* if (cb.extendConfig.theme === 'ncc') {\n            if (!err) {\n              cb.utils.alert('操作成功', 'success');\n            }else {\n              cb.utils.alert(err && err.message ? err.message : '保存出错', 'error');\n              afterAct()\n              return\n            }\n            if(!res) {\n              cb.utils.alert('后台数据返回错误', 'error');\n              return;\n            }\n          }else{\n            viewmodel.communication({\n              type: 'modal',\n              payload: {\n                key: 'BatchMsg',\n                data: {\n                  type: 2,\n                  res,\n                  //   model: viewmodel,\n                  // selectDatas,\n                  // bWhole: (primaryKeyField.toLowerCase() == \"id\") ? true : false,\n                  // dataType: \"voucher\"\n                }\n              }\n            });\n          } */\n\n          const afterActData = {\n            err: err,\n            res: res\n          }\n          if (viewmodel.getCache('batchSubmitErrorIntercept') && res.failCount) {\n            afterAct(afterActData, common.afterAct);\n            return\n          }\n\n          /* 新合并方法 */\n          const oldData = gridModel.getAllData(true);\n          const condition = gridModel.getDirtyRowIndexes();\n          let target = [];\n\n          if (cb.utils.isArray(res)) {\n            target = res;\n          } else {\n            target = res.infos || [];\n          }\n          const newData = common.billMerge({gridList: oldData}, {gridList: target}, {gridList: condition})\n          gridModel.clear(false);\n          gridModel._set_data('dataSourceMode', 'local');\n          gridModel.setData(newData.gridList);\n          gridModel._set_data('dataSourceMode', 'remote');\n          gridModel.setDirty(false);\n\n          // 更新行状态\n          const rowsDataState = gridModel._get_data('rowsDataState');\n\n          const newStates = rowsDataState.map(item => {\n            return cb.models.DataStates.Unchanged\n          });\n          gridModel._set_data('rowsDataState', newStates);\n\n          afterAct(afterActData, common.afterAct);\n          // viewmodel.execute('refresh');  //wuxlr 单表保存不需要刷新\n          viewmodel.setReadOnly(true);\n          common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n          common.setState(viewmodel)\n          staterule.runState(viewmodel);\n          // 恢复行按钮状态\n          gridModel.execute('afterSetDataSource', newData);\n          gridModel.unselectAll();\n        }\n\n        const postData = {\n          billnum: billNo,\n          data: JSON.stringify(data)\n        }\n        common.doProxy(params, callback, postData)\n      })\n    } else {\n      cb.utils.alert('操作成功', 'success');\n      viewmodel.setReadOnly(true);\n      common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n      common.setState(viewmodel);\n      staterule.runState(viewmodel);\n      // 恢复行按钮状态\n      const oldData = gridModel._get_data('dataSource');\n      gridModel.execute('afterSetDataSource', oldData);\n      gridModel.unselectAll();\n      afterAct()\n    }\n  }\n\n  const _batchDo = (viewmodel, params, afterAct, selectDatas, postData) => {\n    const callback = function (err, res) {\n      if (!err) {\n        const actionText = params.cShowCaption;\n        if (selectDatas.length === 1) {\n          if (res.failCount) {\n            cb.utils.alert(cb.locale('P_YS_FED_FW_0001026088', {actionText, messages: res.messages[0]}), 'error');\n          } else {\n            cb.utils.alert(cb.locale('P_YS_FED_FW_0001026089', {actionText}), 'success');\n            viewmodel.getGridModel().unselectAll(); // 操作完毕后，不选择Grid对号\n          }\n        } else {\n          if (themeType == 'ncc' && !viewmodel.getCache('showBatchMsg')) {\n            if (res.failCount > 0) {\n              cb.utils.alert(cb.locale('P_YS_FED_FW_0001026087', {actionText, ...res}), 'error')\n            } else {\n              cb.utils.alert(cb.locale('P_YS_FED_FW_0001026086', {actionText, ...res}), 'success')\n            }\n          } else {\n            viewmodel.communication({\n              type: 'modal',\n              payload: {\n                key: 'BatchMsg',\n                data: {\n                  type: 2,\n                  res,\n                }\n              }\n            });\n          }\n        }\n\n        const lastSearchCondition = viewmodel.getCache('lastSearchCondition');\n        if (lastSearchCondition) {\n          viewmodel.execute('back');\n        } else {\n          // 没有查询数据，本地同步删除\n          const cAction = params.cAction;\n          const ids = params.ids;\n          const gridModel = viewmodel.getGridModel();\n\n          if (cAction == 'batchdelete') {\n            const list = gridModel._get_data('dataSource');\n            ids.forEach(info => {\n              const index = list.findIndex(item => item.id == info.id);\n              list.splice(index, 1);\n            })\n            gridModel._set_data('dataSourceMode', 'local');\n            gridModel.setDataSource(list)\n            gridModel._set_data('dataSourceMode', 'remote');\n          }\n        }\n      }\n      const afterActData = {\n        err: err,\n        res: res\n      }\n      afterAct(afterActData, common.afterAct)\n    }\n    common.doProxy(params, callback, postData)\n  }\n\n  const dblClick = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    let id, rowData;\n    if (gridModel) {\n      const rowIndex = para && para.params && para.params.index;\n      const selectDatas = rowIndex != null ? [gridModel.getRow(para.params.index)] : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length !== 1) {\n        cb.utils.alert('请选择一条数据', 'warning');\n        return;\n      }\n      id = selectDatas[0].id;\n      rowData = selectDatas[0];\n      gridModel.setCache('backData', { rowIndex, id });\n    } else {\n      const node = _getTreeSelectNode(viewmodel);\n      if (!node) {\n        cb.utils.alert('请选择一条数据', 'warning');\n        return;\n      }\n      id = node.id;\n      rowData = node;\n    }\n    const params = {\n      mode: env.VOUCHER_STATE_EDIT,\n      copy: para.copy,\n      id,\n      rowData,\n      carryParams: {}\n    }\n    beforeAct({\n      params: para,\n      carry: params\n    }, function () {\n      const dt = {\n        billtype: 'voucher',\n        billno: common.getVmParams(viewmodel, 'cardKey'),\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, viewmodel)\n      afterAct()\n    })\n  }\n\n  const refresh = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const params = viewmodel.getCache('lastSearchCondition');\n    const treeModel = viewmodel.getTreeModel()\n    const gridModel = viewmodel.getGridModel();\n    if (!gridModel) {\n      queryTree(billNo, viewmodel);\n      return;\n    }\n    const obj = Object.assign({\n      billnum: billNo\n    }, para);\n    const isSum = viewmodel.getCache('isSum')\n    if (isSum != null)\n      obj.isSum = isSum\n    Object.assign(obj, viewmodel.getParams().query);\n    const groupSchemaId = viewmodel.getCache('groupSchemaId');\n    if (groupSchemaId)\n      obj.groupSchemaId = groupSchemaId;\n    if (treeModel) {\n      const node = _getTreeSelectNode(viewmodel)\n      if (node) {\n        const { path, id } = node;\n        if (path)\n          obj.path = path;\n        else if (id)\n          obj.ids = id.toString();\n      }\n    }\n    const data = cb.utils.extend(true, obj, params)\n    const beforeActData = {\n      params: params,\n      data: data\n    }\n    if (beforeAct) {\n      beforeAct(beforeActData, function () {\n        _loadGrid(viewmodel, data, afterAct)\n      })\n    } else {\n      _loadGrid(viewmodel, data, afterAct)\n    }\n  }\n\n  const search = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.setCache('execFilter', true);\n    viewmodel.setCache('lastSearchCondition', params);\n    const beforeActData = {\n      params: params,\n      data: params\n    }\n    beforeAct(beforeActData, function () {\n      refresh(billNo, viewmodel, params, beforeAct, afterAct)\n    })\n  }\n\n  const queryTree = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let data = {\n      billnum: billNo,\n      treename: common.getVmParams(viewmodel, 'treeName')\n    }\n    if (params && params instanceof Object) {\n      data = Object.assign(data, params)\n    }\n    const beforeActData = {\n      params: params,\n      data: data\n    }\n    if (beforeAct) {\n      beforeAct(beforeActData, function () {\n        _loadTree(viewmodel, data, afterAct)\n      })\n    } else {\n      _loadTree(viewmodel, data, afterAct)\n    }\n  }\n\n  const editTree = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel || !params) return\n    if (!params.cTarget) {\n      console.log('未配置tree 的billnumber ,在commend表的target中设置')\n      return\n    }\n    const node = _getTreeSelectNode(viewmodel)\n    if (node) {\n      const para = {}\n      para.detailId = node[treeModel.getState('keyField')];\n      const postData = cb.utils.extend(true, para, {\n        mode: env.VOUCHER_STATE_EDIT\n      })\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      beforeAct(beforeActData, function () {\n        const dt = {\n          billtype: 'voucherlist',\n          billno: params.cTarget,\n          params: postData\n        }\n        cb.loader.runCommandLine('bill', dt, viewmodel)\n        afterAct()\n      })\n    }\n  }\n\n  const moveUp = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const treeModel = viewModel.getTreeModel();\n    if (!treeModel) return;\n    const selectedNodes = treeModel.getSelectedNodes();\n    if (!selectedNodes.length) {\n      cb.utils.alert('请选择一条数据', 'warning');\n      return;\n    }\n    const selectNode = selectedNodes[0];\n    if (treeModel.isFirst(selectNode)) {\n      cb.utils.alert('分类已是同级次的第一个', 'warning');\n      return;\n    }\n    const keyField = treeModel.getState('keyField');\n    const data = {\n      billnum: billNo,\n      action: params.cAction,\n      id: selectNode[keyField]\n    };\n    const beforeActData = {\n      params,\n      data\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success');\n          viewModel.execute('back');\n        }\n        const afterActData = {\n          err,\n          res\n        };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, data);\n    });\n  }\n\n  const moveDown = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const treeModel = viewModel.getTreeModel();\n    if (!treeModel) return;\n    const selectedNodes = treeModel.getSelectedNodes();\n    if (!selectedNodes.length) {\n      cb.utils.alert('请选择一条数据', 'warning');\n      return;\n    }\n    const selectNode = selectedNodes[0];\n    if (treeModel.isLast(selectNode)) {\n      cb.utils.alert('分类已是同级次的最后一个', 'warning');\n      return;\n    }\n    const keyField = treeModel.getState('keyField');\n    const data = {\n      billnum: billNo,\n      action: params.cAction,\n      id: selectNode[keyField]\n    };\n    const beforeActData = {\n      params,\n      data\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success');\n          viewModel.execute('back');\n        }\n        const afterActData = {\n          err,\n          res\n        };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, data);\n    });\n  }\n\n  const singlePush = (billNo, viewModel, params, beforeAct, afterAct) => {\n    if (!params) return;\n    const rowIndex = params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    common.push(viewModel, params, currentRow, beforeAct, afterAct);\n  };\n  const batchPush = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const gridModel = viewModel.getGridModel()\n    const ids = _getSelectRowIds(gridModel)\n    if (!ids || ids.length == 0) {\n      cb.utils.alert('请选择有效数据', 'warning')\n      return\n    }\n    common.push(viewModel, params, ids, beforeAct, afterAct);\n  }\n  const copy = (billNo, viewModel, params, beforeAct, afterAct) => {\n    if (!params) return;\n    const rowIndex = params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    common.copy(viewModel, params, currentRow.id, beforeAct, afterAct);\n  };\n\n  // 推单\n  const push = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    const targetCode = queryString.get('code')\n    const gridModel = viewmodel.getGridModel()\n    const ids = _getSelectRowIds(gridModel)\n    if (!ids || ids.length == 0) {\n      cb.utils.alert('请选择有效数据', 'warning')\n      return\n    }\n    if (targetCode) {\n      const queryData = {\n        code: targetCode,\n        isMainSelect: 1,\n        childIds: ids\n      }\n      const par = {\n        cSvcUrl: queryString.pathname + queryString.toStr(),\n        cHttpMethod: params.cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: queryData\n      }\n      beforeAct(beforeActData, function () {\n        const callback = function (err, res) {\n          if (!err) {\n\n          }\n          const afterActData = {\n            err: err,\n            res: res\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        common.doProxy(par, callback, queryData)\n      })\n    }\n  }\n\n  const output = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel();\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const format = queryString.has('type') ? queryString.get('type') : 'pdf'\n    const inputParams = {\n      format: format,\n      type: 'voucherlist',\n      bill: {\n        page: {\n          pageSize: gridModel.getPageSize(),\n          pageIndex: gridModel.getPageIndex()\n        },\n        billnum: billNo\n      }\n    }\n\n    const url = env.HTTP_OUTPUT_BILL\n    const beforeActData = {\n      params: params,\n      data: inputParams\n    }\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, inputParams)\n      afterAct()\n    })\n  }\n\n  const importVoucher = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const btnCallBack = {\n      disabledCallback: params.disabledCallback,\n      enabledCallback: params.enabledCallback\n    }\n    params.disabledCallback = false;\n    params.enabledCallback = false;\n    const beforeActData = { params, data: {} };\n    let isAsync = false;\n    let asyncInterval = 1;\n    const asyncKey = 'asyncImport_' + cb.utils.getNewGuid().replace(/-/g, '');\n    let acceptedFileType = ''\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      if (cParameter) {\n        isAsync = cParameter.isAsync;\n        asyncInterval = cParameter.interval || asyncInterval;\n        acceptedFileType = cParameter.acceptedFileType || ''\n      }\n    }\n    // isAsync = true;\n    beforeAct(beforeActData, function () {\n      const eleInput = document.createElement('input');\n      eleInput.type = 'file';\n      if (acceptedFileType) {\n        eleInput.accept = acceptedFileType // 限定导入文件的类型\n      }\n      eleInput.style.display = 'none';\n      eleInput.onchange = function (e) {\n        btnCallBack.disabledCallback && btnCallBack.disabledCallback();\n        const formData = new FormData();\n        formData.enctype = 'multipart/form-data';\n        const file = e.target.files[0];\n        const fileName = file && file.name;\n        const fileSize = file && file.size;\n        formData.append('file', file);\n        if (beforeActData.data.mapCondition)\n          formData.append('mapCondition', JSON.stringify(beforeActData.data.mapCondition));\n        const xhr = new XMLHttpRequest();\n        let url = `${params.cSvcUrl}?billnum=${common.getVmParams(viewModel, 'cardKey')}`;\n        try {\n          if (common.getVmParams(viewModel, 'cardKey') === 'bd_staff_card') {\n            url = `${params.cSvcUrl}?billnum=${beforeActData.data.mapCondition.billnum}`;\n          }\n        } catch (error) {\n          console.error(error)\n        }\n        // 权限控制逻辑，需要Frame 提供新的传参机制\n        const serviceCode = viewModel.getState('serviceCode') || cb.rest.AppContext.query.serviceCode\n        if (serviceCode) {\n          // formData.append('externalData', JSON.stringify({serviceCode:viewModel.getState('serviceCode')}));\n          url = url + '&serviceCode=' + serviceCode;\n        }\n        if (isAsync) {\n          url = url + '&asyncKey=' + asyncKey;\n        }\n        xhr.open('POST', url, true);\n        xhr.send(formData);\n        if (isAsync) {\n          btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n          xhr.onreadystatechange = function () {\n            let bError = false;\n            let errorInfo = '';\n            if (xhr.readyState !== 4) return;\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                bError = true;\n                errorInfo = '模板内容导入失败,返回信息：' + xhr.responseText;\n              }\n              if (ajaxResult && ajaxResult.code === 200) {\n\n              } else {\n                bError = true;\n                errorInfo = `模板内容导入失败，${ajaxResult.message}。`;\n              }\n            }\n            else {\n              bError = true;\n              errorInfo = '模板内容导入返回信息： xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText;\n            }\n            if (bError) {\n              cb.utils.alert(errorInfo);\n            }\n            else {\n              const queryParams = {\n                asyncKey, asyncInterval, btnCallBack, fileSize, fileName\n              }\n              // eslint-disable-next-line no-undef\n              queryAsyncProcess(billNo, viewModel, queryParams);\n            }\n          };\n        }\n        else {\n          xhr.onreadystatechange = function () {\n            if (xhr.readyState !== 4) return;\n            btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                cb.utils.alert(cb.locale('P_YS_FED_FW_0001026084', {text: xhr.responseText}));\n                return;\n              }\n              if (ajaxResult && ajaxResult.code === 200) {\n                const res = ajaxResult.data;\n                if (res.sucessCount)\n                  viewModel.execute('refresh');\n                viewModel.communication({\n                  type: 'modal',\n                  payload: {\n                    key: 'BatchMsg',\n                    data: {\n                      type: 2,\n                      res\n                    }\n                  }\n                });\n              } else {\n                cb.utils.alert(cb.locale('P_YS_FED_FW_0001026083', {text: ajaxResult.message}), 'error');\n              }\n            }\n            else {\n              console.log('模板内容导入返回信息： xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText);\n            }\n          };\n        }\n        document.body.removeChild(eleInput);\n      }\n      document.body.appendChild(eleInput);\n      eleInput.click();\n    });\n  }\n\n  const exportVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = {\n      billnum: common.getVmParams(viewModel, 'cardKey')\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, postData);\n      afterAct();\n    });\n  }\n\n  const exportStaticVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const openUrl = params && params.cSvcUrl;\n    if (!openUrl) {\n      cb.utils.alert('导出模板的地址为空', 'error');\n      return;\n    }\n    const beforeActData = { params };\n    beforeAct(beforeActData, function () {\n      window.open(openUrl);\n      afterAct();\n    });\n  }\n\n  const exportReport = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const isSum = viewModel.getCache('isSum');\n    const gridModel = viewModel.getGridModel();\n    if (gridModel) {\n      const rowsCount = gridModel.getRowsCount();\n      if (!rowsCount) {\n        cb.utils.alert('导出数据不允许为空，请重新选择后重试！', 'error');\n        return;\n      }\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = Object.assign({\n      billnum: billNo || common.getVmParams(viewModel, 'cardKey'),\n      groupSchemaId: viewModel.getCache('groupSchemaId')\n    }, viewModel.getParams().query, viewModel.getCache('lastSearchCondition'));\n    delete postData.showSearch;\n    if (isSum != null)\n      postData.isSum = isSum\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, postData);\n      afterAct();\n    });\n  }\n\n  const subscribeMessage = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'MessageSubscribe',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n\n  const batchOutputVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    const postData = { billnum: billNo };\n    if (gridModel) {\n      const selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length == 0) {\n        cb.utils.alert('请选择', 'warning')\n        return\n      }\n      const data = []\n      selectDatas.forEach(function (row) {\n        if (row.id && row.pubts) {\n          data.push(row.id)\n        }\n      }, this)\n      postData.ids = data.join();\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString && queryString.pathname + queryString.toStr()\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      if (!postData.fileName) {\n        const fileName = viewmodel.getParams().caption\n        if (fileName) {\n          postData.fileName = fileName\n        }\n      }\n      common.createDownloadForm(url, postData)\n      afterAct()\n    })\n  }\n\n  const print = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    if (!gridModel) {\n      return\n    }\n    const pageSize = gridModel.getPageSize()\n    const pageIndex = gridModel.getPageIndex()\n    const postData = {\n      json: {\n        bill: {\n          page: {\n            pageSize: pageSize,\n            pageIndex: pageIndex\n          },\n          billnum: billNo\n        },\n        type: 'voucherlist',\n        token: true\n      }\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n  const preview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      const template = viewmodel.get('templates').getValue();\n      if (!template) {\n        cb.utils.alert('请选择打印模板', 'warning');\n        return;\n      }\n      const newTab = window.open('about:blank');\n      const proxy = cb.rest.DynamicProxy.create({\n        preview: { url: 'print/printPreview', method: 'POST' }\n      })\n      const ids = _getSelectRowIds(viewmodel.getGridModel())\n      const condition = viewmodel.getCache('lastSearchCondition') ? JSON.stringify(viewmodel.getCache('lastSearchCondition').condition) : null;\n      proxy.preview({\n        route: params.cSvcUrl || '/bill',\n        billno: billNo,\n        template: template,\n        ids: ids,\n        condition: condition\n      }, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        newTab.location.href = result;\n      });\n    });\n  }\n  const batchPrintVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const gridModel = viewmodel.getGridModel()\n    const ids = _getSelectRowIds(gridModel)\n    if (!ids || ids.length == 0) {\n      cb.utils.alert('请选择有效数据', 'warning')\n      return\n    }\n    const postData = {\n      json: {\n        bill: {\n          billnum: common.getVmParams(viewmodel, 'cardKey'),\n          ids: ids,\n          tplid: printID\n        },\n        type: 'voucher'\n      }\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n  const savebo = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const proxy = cb.rest.DynamicProxy.create({\n      saveBo: { url: 'print/saveBo', method: 'GET' }\n    })\n    proxy.saveBo({ billno: billNo }, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      cb.utils.alert('保存业务对象成功', 'success');\n    });\n  }\n  const doDelete = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const node = _getTreeSelectNode(viewmodel)\n    if (!node) {\n      cb.utils.alert('请选择有效数据', 'warning');\n      return;\n    }\n    if (node && node.children && node.children.length > 0) {\n      cb.utils.alert('有下级，不能删除', 'warning')\n      return\n    }\n    const data = viewmodel.getNecessaryData()\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      cb.utils.confirm('确定要删除么', function () {\n        common.doProxy(params, function (err, suc) {\n          if (!err) {\n            const treeModel = viewmodel.getTreeModel()\n            if (treeModel) {\n              const key = treeModel.getSelectedKeys()\n              if (key && key.length == 1) {\n                treeModel.deleteNode(key)\n                // viewmodel.clear()\n                common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n                // _render(viewmodel);\n                viewmodel.biz.do('add', viewmodel);\n              }\n            }\n            cb.utils.alert('操作成功', 'success')\n          }\n          const afterActData = {\n            err: err,\n            res: suc\n          }\n          afterAct(afterActData, common.afterAct)\n        }, postData)\n      })\n    })\n  }\n\n  const localPrint = function (billNo, viewModel, params, beforeAct, afterAct) {\n    if (viewModel.getParams().billType === 'Report') {\n      localPrintReport(billNo, viewModel, params, beforeAct, afterAct);\n      return;\n    }\n    const id = viewModel.get('id') && viewModel.get('id').getValue();\n    const code = viewModel.get('code') && viewModel.get('code').getValue();\n    if (cb.utils.isEmpty(id) && cb.utils.isEmpty(code)) {\n      cb.utils.alert('未找到具体单据', 'error');\n      return;\n    }\n    const cardKey = common.getVmParams(viewModel, 'cardKey');\n    if (cb.utils.isEmpty(cardKey)) {\n      cb.utils.alert('元数据未配置cCardKey', 'error');\n      return;\n    }\n    const proxy = cb.rest.DynamicProxy.create({\n      getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } },\n      print: { url: 'bill/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    proxy.getTemplate({ billno: cardKey }, function (err, data) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      const templateCode = data.length === 1 ? data[0] : data.find(item => {\n        return item.isdefault;\n      });\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('没有设置打印模板，请检查', 'error');\n        return;\n      }\n      const params = { billno: cardKey, templateCode: templateCode.templatecode };\n      if (code)\n        params.code = code;\n      else\n        params.ids = [id];\n      proxy.print(params, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        beforeAct(result, function () {\n          cb.utils.localPrint(result);\n        });\n      });\n    });\n  }\n\n  const sumSwitch = function (billNo, viewModel, params, beforeAct, afterAct) {\n    viewModel.setCache('isSum', viewModel.get('sumSwitch').getValue() || null);\n    refresh(billNo, viewModel, null, beforeAct, afterAct);\n  }\n\n  const localPrintReport = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const proxy = cb.rest.DynamicProxy.create({\n      getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } },\n      print: { url: 'report/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    proxy.getTemplate({ billno: billNo }, function (err, data) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      const templateCode = data.length === 1 ? data[0] : data.find(item => {\n        return item.isdefault;\n      });\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('没有设置打印模板，请检查', 'error');\n        return;\n      }\n      const lastSearchCondition = viewModel.getCache('lastSearchCondition');\n      const condition = lastSearchCondition ? JSON.stringify(lastSearchCondition.condition) : null;\n      const params = { billno: billNo, templateCode: templateCode.templatecode, condition, route: '/report/bill' };\n      proxy.print(params, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        beforeAct(result, function () {\n          cb.utils.localPrint(result);\n        });\n      });\n    });\n  }\n  const batchModify = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'batchModify',\n        data: {\n          billType: 'list',\n          billNo: billNo,\n          model: viewModel,\n          params: params\n        }\n      }\n    });\n  }\n\n  const workflow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel();\n    const rowIndex = params && params.params && params.params.index;\n    if (rowIndex == null) return;\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    if (!currentRow.isWfControlled || currentRow.verifystate === 0) { // 如果没走审批流程，或者审批状态是自由态\n      cb.utils.alert('暂无审批详情', 'warning')\n      return;\n    }\n    const cardKey = common.getVmParams(viewmodel, 'cardKey');\n    let businessKey = `${cardKey}_${currentRow.id}`;\n    if (!cardKey) {\n      businessKey = `${billNo}_${currentRow.id}`;\n    }\n    const data = {\n      width: 850,\n      height: 510,\n      appsource: env.appCode,\n      businessKey\n    };\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      const flowCompIns = window.flowComp(data);\n      flowCompIns.showFlowBox({\n        onClose (callbackData) {\n          if (process.env.__THEMETYPE__ == 'ncc') {\n            const queryItems = viewmodel.getCache('queryItems') || [];\n            queryItems.forEach(item => {\n              const field = item.replace(/(\\w)/, function (v) {\n                return v.toUpperCase()\n              }) // 首字母大写\n              viewmodel.setCache(`exec${field}`, true)\n            });\n            refresh(billNo, viewmodel);\n          }\n          // viewmodel.communication({ type: 'refresh' });\n        }\n      });\n    });\n  }\n\n  // 打印预览\n  const printPreview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      const gridModel = viewmodel.getGridModel()\n      if (!gridModel) {\n        return\n      }\n      const { currentParams, url } = common.getPrintParamers(params, 'preview', viewmodel);\n      // 优化性能\n      const selectedRow = gridModel.getSelectedRows();\n      if (selectedRow.length > 500) {\n        cb.utils.confirm('数据量较大，预览可能比较慢，是否使用打印插件，是否直接静默打印', function () {\n          common.printNow(params, viewmodel);\n        }, function () {\n          _morePrintPreview(currentParams, url);\n        });\n      } else {\n        _morePrintPreview(currentParams, url);\n      }\n      afterAct()\n    })\n  }\n  const _morePrintPreview = (currentParams, url) => {\n    const urlParams = common.combineParams(currentParams);\n    if (urlParams.length > 2000) {\n      const proxy = cb.rest.DynamicProxy.create({\n        cacheData: { url: '/cachePrint', method: 'post', options: { uniform: false } }\n      })\n      const newUrlParams = JSON.stringify(currentParams.params);\n      proxy.cacheData({param: newUrlParams}, function (_err, rs) {\n        if (rs) {\n          currentParams.sendType = 7;\n          currentParams.params = rs.key;\n          const newTempUrlParams = common.combineParams(currentParams);\n          window.open(url + newTempUrlParams, '_blank')\n        }\n      });\n    } else {\n      window.open(url + urlParams, '_blank')\n    }\n  }\n  // 打印设计\n  const printDesign = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      const gridModel = viewmodel.getGridModel()\n      if (!gridModel) {\n        return\n      }\n      const { currentParams, url } = common.getPrintParamers(params, 'design', viewmodel);\n      window.open(url + common.combineParams(currentParams), '_blank')\n    })\n  }\n\n  // 直接打印\n  const printNow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      common.printNow(params, viewmodel);\n      afterAct()\n    })\n  }\n  const doCommunication = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    common.doCommunication(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n\n  // 附件管理\n  const attachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel();\n    const selectDatas = params && params.params && params.params.index != null\n      ? [gridModel.getRow(params.params.index)]\n      : gridModel.getSelectedRows();\n    if (selectDatas.length == 0) {\n      cb.utils.alert('请选择行', 'warning');\n      return\n    }\n    if (selectDatas.length > 1) {\n      cb.utils.alert('附件管理只能单行显示', 'warning');\n      return;\n    }\n\n    const selectRow = selectDatas[0];\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// 附件管理权限\n    const rowData = Object.assign({\n      id: selectRow.attachmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // 按钮大小(lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  return {\n    init: function (billNo, params, viewCallback) {\n      const initCallback = (err, result) => {\n        // const vmAndview =\n        common.initVM(err, result, billNo, params, function (vm, view) {\n          const isSum = params && params.query && Boolean(params.query.isSum);\n          if (isSum)\n            vm.setCache('isSum', isSum);\n          const reportId = params && params.reportId;\n          if (reportId)\n            params.query.reportId = reportId;\n          const data = {\n            vm,\n            view\n          }\n          vm.promiseExecute('afterLoadMeta', data, function () {\n            const parentModel = vm.get('parent_name');\n            if (parentModel instanceof cb.models.ReferModel) {\n              const maxLevel = parentModel.getState('maxLevel');\n              const level = maxLevel === false ? 65536 : (maxLevel || 3);\n              parentModel.setState('maxLevel', level);\n            }\n            const gridModel = vm.getGridModel();\n            gridModel.on('afterInsertRow', () => {\n              common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n              staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n            });\n            // 关联附件管理\n            const addAttachment = vm.get('addAttachment');\n            if (addAttachment && process.env.__THEMETYPE__ == 'ncc') {\n              gridModel.on('beforeSetDataSource', function (dataList) {\n                dataList.forEach(item => {\n                  if (item.id) {\n                    if (!item.attachmentId) {\n                      item.attachmentId = item.id\n                    }\n                  } else {\n                    if (!item.attachmentId) item.attachmentId = uuid();\n                  }\n                });\n                return dataList;\n              });\n              gridModel.on('beforeInsertRow', function (rowData) {\n                rowData.row.attachmentId = uuid();\n                /* if(rowData.row && !rowData.row.attachmentId){\n                  rowData.row.attachmentId=uuid();\n                } */\n                return rowData\n              });\n            }\n            viewCallback(vm, view, view.cBillName)\n            _initPage(vm, billNo);\n            // wuxlr 添加规则校验\n            vm.biz.do('rule', vm)\n          })\n        }, function (vm) {\n          if (vm.getParams().billType === 'Report')\n            vm.getParams().autoLoad = false;\n          vm.initData()\n          common.setState(vm)\n          staterule.runState(vm)\n          vm.on('refresh', function () {\n            refresh(billNo, vm);\n          });\n          vm.on('back', function (args) {\n            const gridModel = vm.getGridModel();\n            if (!gridModel) {\n              queryTree(billNo, vm, null, null, function () {\n                if (!args) return;\n                vm.getTreeModel().doPropertyChange('setExpandRow', { rowKey: args, isExpand: true });\n              });\n              return;\n            }\n            if (cb.rest.interMode === 'touch' || cb.rest.terminalType == '3') {\n              const backData = gridModel.getCache('backData');\n              if (!backData) {\n                refresh(billNo, vm);\n                return;\n              }\n              gridModel.clearCache('backData');\n              const configParams = vm.allActions && vm.allActions.find(x => {\n                return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdlist'\n              });\n              const proxyParams = configParams && configParams.cSvcUrl ? {\n                url: configParams.cSvcUrl,\n                method: configParams.cHttpMethod || 'POST',\n                options: { mask: true }\n              } : {\n                url: 'bill/list',\n                method: 'POST',\n                options: { mask: true }\n              };\n              const proxy = cb.rest.DynamicProxy.create({ queryData: proxyParams });\n              const params = {\n                billnum: billNo,\n                page: { pageSize: gridModel.getPageSize(), pageIndex: 1 },\n                condition: {\n                  isExtend: true,\n                  simpleVOs: [\n                    { field: 'id', op: 'eq', value1: backData.id }\n                  ]\n                }\n              };\n              proxy.queryData(params, function (_err, result) {\n                if (result && result.recordList && result.recordList.length) {\n                  gridModel.updateRow(backData.rowIndex, result.recordList[0]);\n                  common.setGridActionStates(gridModel, vm);\n                  staterule.runGridActionStates(gridModel, vm);\n                }\n              });\n            } else {\n              gridModel.setPageIndex(gridModel.getPageIndex());\n            }\n          });\n          const returnPromise = new cb.promise();\n          vm.on('return', function (caption) {\n            if (common.getMode(vm) === env.VOUCHER_STATE_BROWSE || !vm.getDirtyData(false))\n              return true;\n            // returnSave(billNo, vm, function () {\n            //   returnPromise.resolve();\n            // });\n            // return returnPromise;\n            cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026058', {abandonText: caption}), function () {\n              returnPromise.resolve();\n            }, function () {\n              returnPromise.reject();\n            });\n            return returnPromise;\n          });\n        }, function () {\n          common.fetchMeta(billNo, params, initCallback)\n        })\n      }\n      common.fetchMeta(billNo, params, initCallback)\n    },\n    do: function (act, viewmodel, params) {\n      common.todo(this, act, viewmodel, params)\n    },\n    action: function () {\n      // 增加扩展机制，没有配置传入容错处理 yueming\n      let optionExtend = {}\n      try {\n        optionExtend = cb.extendConfig.editVoucherListExtendConfig || {};\n      } catch (error) {\n        console.log(error);\n        optionExtend = {};\n      }\n      const editVoucherListAction = {\n        doservice: _doService,\n        rule: buildRule,\n        cellcheck: cellCheck,\n        cellscheck: cellsCheck,\n        referrowscheck: referRowsCheck,\n        check: check4List,\n        copy: copy,\n        open: open,\n        close: close,\n        save: save,\n        add: add,\n        addrow: addRow,\n        deleteRow: deleteRow,\n        push: push,\n        singlepush: singlePush,\n        edit: common.edit,\n        dblclick: dblClick,\n        abandon: abandon,\n        delete: doDelete,\n        batchdelete: batchDelete,\n        batchaudit: batchDo,\n        batchunaudit: batchDo,\n        batchsubmit: batchsubmit,\n        batchdo: batchDo,\n        search: search,\n        refresh: refresh,\n        output: output,\n        batchoutput: batchOutputVoucher,\n        batchimport: importVoucher,\n        tempexport: exportVoucherTemplate,\n        statictempexport: exportStaticVoucherTemplate,\n        reportexport: exportReport,\n        messagesubscribe: subscribeMessage,\n        print: print,\n        batchprint: batchPrintVoucher,\n        columnsetting: common.columnsetting,\n        edittree: editTree,\n        querytree: queryTree,\n        moveup: moveUp,\n        movedown: moveDown,\n        commandLine: common.commandLine,\n        switchgroupschema: switchGroupSchema,\n        savebo: savebo,\n        preview: preview,\n        localprint: localPrint,\n        batchpush: batchPush,\n        sumswitch: sumSwitch,\n        batchmodify: batchModify,\n        printpreview: printPreview, // 打印预览\n        printdesign: printDesign, // 打印设计\n        printnow: printNow, // 直接打印\n        workflow: workflow,\n        openpage: doCommunication, // 打开弹框\n        goback: doCommunication, // 返回上一级\n        attachment: attachment, // 附件管理\n        billsetting: common.openBillModal\n      }\n      return Object.assign(editVoucherListAction, optionExtend);\n    }\n  }\n})()\n\ncb.namespace('biz.common')\ncb.biz.common.editvoucherlist = editvoucherlist\n\nexport default editvoucherlist\n"],"sourceRoot":""}