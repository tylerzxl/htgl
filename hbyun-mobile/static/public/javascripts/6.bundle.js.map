{"version":3,"sources":["webpack:///./node_modules/@mdf/cube/src/bizmodel/mtlapi.js","webpack:///./node_modules/@mdf/cube/src/bizmodel/voucherlist.js"],"names":["_getParams","params","data","cParameter","JSON","parse","_showPrompt","result","platform","cb","utils","alert","console","log","mtlScan","billNo","viewmodel","beforeAct","afterAct","newParams","needResult","parseInt","scanType","Array","isArray","scanQRCode","success","res","resultStr","invoker","publish","action","fail","err","message","mtlShare","upesn","showShareMenu","mtlPlatform","mtlNetworkType","getNetworkType","networkType","mtlGetMac","getMac","macAddress","mtlDail","dail","mtlChooseImage","count","sourceType","chooseImage","localIds","mtlGetLocation","getLocation","mtlOpenLocation","openLocation","mtlGenerateQRCode","generateQRCode","mtlRequest","headers","e","request","mtlStartRecord","startRecord","mtlStopRecord","stopRecord","mtlPlayVoice","playVoice","mtlPauseVoice","pauseVoice","mtlStopVoice","stopVoice","mtlChangeScreenOrientation","changeScreenOrientation","mtlRestoreScreenOrientation","restoreScreenOrientation","mtlSetStorage","setStorage","mtlGetStorage","getStorage","mtlRemoveStorage","removeStorage","mtlClearStorage","clearStorage","mtlUploadFile","uploadFile","mtlDownloadFile","downloadFile","voucherlist","_render","dirty","setDirty","loadDirtyData","loadData","execute","validate","_getTreeSelectNode","selectNode","node","treeModel","getTreeModel","getSelectedNodes","length","_doService","getCache","postData","oldData","collectData","newData","VOUCHER_STATE_EDIT","updateNode","viewModel","rowIndex","index","gridModel","getGridModel","currentRow","getRow","billnum","stringify","singleDo","open","cAction","configParams","allActions","find","item","trim","toLocaleLowerCase","Object","assign","extendConfig","allConfirm","cShowCaption","confirm","locale","close","_loadGrid","allGridmodel","getGridModels","i","clear","queryItems","forEach","field","replace","v","toUpperCase","reportId","setColumns","getState","getParams","query","isSum","setState","showSearch","bFromNav","promiseExecute","x","cCommand","url","cSvcUrl","rest","_appendUrl","proxyParams","method","cHttpMethod","options","mask","setDataSource","parent","getParent","pageInfo","delayLoadPageInfo","table","billType","includes","pageIndex","pageSize","setCache","recordCount","columns","getColumnsData","this","fieldNames","setSortColumn","_validateMustInput","_filterViewModel","propertyNames","_get_data","flag","propertyName","property","get","models","BaseModel","value","getAllData","getData","isEmpty","value1","value2","columnArray","entities","filter","bMain","cType","fields","cItemName","push","switchGroupSchema","paramss","groupSchemaId","undefined","groupSchemaName","dimensionId","isFirst","isIncludeMeta","filterVM","schemeId","model","fireEvent","solutionid","_bindGridAttachment","on","dataList","attachmentId","id","_bindGridDblClick","dblClickItemName","getColumns","attr","bJointQuery","args","rowData","cellName","cellInfo","mode","readOnly","doubleEdit","carryParams","cardViewModel","cardKey","findIndex","dt","billtype","billno","loader","runCommandLine","failCount","_loadTree","_bindTreeSelect","setReadOnly","condition","path","ids","toString","hasChildren","_renderTreeArchiveData","VOUCHER_STATE_ADD","biz","do","_initPage","filterId","gms","themeType","proxy","DynamicProxy","create","ensure","subGridModel","_set_data","un","selectedRow","rid","error","setData","_bindGrandSonTable","indexOf","treename","_bindTreeDblClick","VOUCHER_STATE_BROWSE","isDistinct","parameter","split","operator","_bindCompareTreeSelect","dataSource","select","_treeDetailSelect","_getSelectRowIds","para","distinct","selectDatas","getSelectedRows","map","row","from","Set","check4List","abandon","lastMode","getOriginalData","afterActData","resetOrginalData","communication","type","_hasList","toLowerCase","add","isTest_ImportProgressBall","Math","floor","random","setInterval","asyncParams","asyncData","percentage","totalCount","asyncKey","busName","curTime","fileName","fileSize","payload","clearInterval","interMode","clearCache","parentId","externalData","_addVoucher","maxLevel","level","selectedNode","suc","parentField","parent_name","name","_addCard","save","invalidMsg","join","_status","DataStates","Update","Insert","parentData","parentNode","getNodesByKeys","arrayKeys","key","getDirtyRowIndexes","saveRefresh","addNode","attachment","selectRow","attachmentCondition","size","batchDelete","batchDo","primaryKeyField","cmdParameter","primarykey","getNecessaryDataForRows","paramsData","primaryKeys","pubts","code","text","caption","cCaption","isAsync","_batchAsyncDo","_batchDo","enabledCallback","info","infos","queryParams","asyncName","queryAsyncProcess","actionText","messages","theme","dblClick","copy","carry","edit","refresh","obj","extend","queryTree","search","editTree","cTarget","detailId","moveUp","selectedNodes","keyField","moveDown","isLast","pull","pullBillNo","billnumber","source","pullx","singlePush","sumSwitchModel","pushKey","batchPush","queryString","targetCode","isMainSelect","childIds","pathname","toStr","asyncInterval","btnCallBack","getNowFormatDate","_timer","asyncImportQuery","output","baseUrl","window","_baseUrl","substr","queryUrl","inputParams","format","has","bill","page","getPageSize","getPageIndex","HTTP_OUTPUT_BILL","handleAsyncImportOver","errStr","clearTimeout","bDelTask","getImportProcess","parseFloat","importVoucher","disabledCallback","beforeActData","getNewGuid","acceptedFileType","interval","eleInput","document","createElement","accept","style","display","onchange","loadingControl","start","formData","FormData","enctype","file","target","files","append","mapCondition","xhr","XMLHttpRequest","serviceCode","AppContext","_url","send","onreadystatechange","end","bError","errorInfo","readyState","status","ajaxResult","responseText","sucessCount","body","removeChild","appendChild","click","exportVoucherTemplate","exportStaticVoucherTemplate","openUrl","exportReport","getRowsCount","subscribeMessage","batchOutputVoucher","getColumnState","set","print","json","token","preview","template","getValue","newTab","route","user","location","href","decodeURIComponent","addEventListener","event","tenantId","postMessage","origin","batchPrintVoucher","printID","VOUCHER_PRINT_KEY","tplid","printPreview","currentParams","_morePrintPreview","urlParams","cacheData","uniform","newUrlParams","param","_err","rs","sendType","newTempUrlParams","printDesign","printNow","savebo","saveBo","doDelete","children","getNecessaryData","getSelectedKeys","deleteNode","localPrint","getTemplate","templateCode","isdefault","templatecode","localPrintReport","sumSwitch","lastSearchCondition","batchModify","jointquery","editType","parentViewModel","billNum","billId","title","checkReturn","modal","workflow","isWfControlled","verifystate","businessKey","width","height","appsource","appCode","flowComp","showFlowBox","onClose","callbackData","doCommunication","openReport","getParamsUrl","URL","searchParams","encodeURI","globalization","HTTP_REPORT_SERVER_URL","jDiwork","targetParams","iframeTitle","openService","batchFlowPush","stateRule","scan","share","newadd","cCardKey","pushPage","newback","goBack","init","viewCallback","initCallback","vm","view","Boolean","parentModel","ReferModel","cBillName","sumSwitchKey","USESTATERULE","autoLoad","userId","setColumnState","initData","indexedDB_id","indexDB","IDB_saveData","columnKey","dbTableName","dbName","IDB_deleteOneData","terminalType","queryData","isExtend","simpleVOs","op","recordList","updateRow","setPageIndex","doPropertyChange","rowKey","isExpand","returnPromise","promise","getDirtyData","portal","getRudux","_","asyncImportArr","prompt","msg","abandonText","resolve","reject","act","voucherListExtend","voucherListExtendConfig","voucherAction","doservice","singlepush","dblclick","delete","batchdelete","batchaudit","batchunaudit","batchsubmit","batchunsubmit","batchdo","batchoutput","batchimport","tempexport","statictempexport","reportexport","messagesubscribe","batchprint","check","columnsetting","edittree","querytree","moveup","movedown","commandLine","switchgroupschema","localprint","batchpush","sumswitch","batchmodify","printpreview","printdesign","printnow","asyncprocess","openpage","openreport","goback","billsetting","staterule","autocomplete","customdo","bizflowbatchpush","namespace","common"],"mappings":"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","file":"public/javascripts/6.bundle.js?_=d566ad53-de75-49ba-965f-44adb4dd2a09","sourcesContent":["import mtl from 'mtl-js-sdk'\n\nfunction _getParams (params) {\n  let data = {};\n  if (params) {\n    if (params.cParameter) {\n      data = JSON.parse(params.cParameter);\n    } else {\n      data = params;\n    }\n  }\n  return data;\n}\n\nfunction _showPrompt (result) {\n  if (mtl.platform !== 'upesn') {\n    cb.utils.alert(' ' + mtl.platform + ' ' + result);\n  } else {\n    console.log(' ' + mtl.platform + ' ' + result);\n  }\n}\n\nexport function mtlScan (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.needResult = newParams.needResult ? parseInt(newParams.needResult) : 1;\n    if (newParams.scanType === 'all') {\n      data.scanType = ['qrCode', 'barCode'];\n    } else {\n      if (!Array.isArray(data.scanType)) {\n        data.scanType = [newParams.scanType];\n      }\n    }\n  }\n  mtl.scanQRCode({\n    ...data,\n    success: function (res) {\n      const result = res.resultStr;\n      cb.invoker.publish('mtl', { action: 'scan', result: result });\n      _showPrompt(result);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlShare (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.upesn.showShareMenu({\n    ...data,\n    success: function (res) {\n      // \n      cb.invoker.publish('mtl', { action: 'share', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlPlatform (billNo, viewmodel, params, beforeAct, afterAct) {\n  const result = mtl.platform;\n  cb.invoker.publish('mtl', { action: 'platform', result: result });\n  _showPrompt(mtl.platform);\n};\n\nexport function mtlNetworkType (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getNetworkType({\n    success: function (res) {\n      const networkType = res.networkType;// 2g3g4gwifi,fail\n      cb.invoker.publish('mtl', { action: 'getNetworkType', networkType });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\nexport function mtlGetMac (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getMac({\n    success: function (res) {\n      const macAddress = res.macAddress;\n      cb.invoker.publish('mtl', { action: 'getMac', result: macAddress });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlDail (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.dail({\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'dail', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlChooseImage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.count = newParams.count;\n    if (newParams.sourceType === 'all') {\n      data.sourceType = ['album', 'camera'];\n    } else {\n      if (!Array.isArray(data.sourceType)) {\n        data.sourceType = [newParams.sourceType];\n      }\n    }\n  }\n  mtl.chooseImage({\n    ...data,\n    success: function (res) {\n      // IDlocalIdimgsrc\n      const localIds = res.localIds; // ['wxLocalResource://imageid123456789987654321', ...]\n      cb.invoker.publish('mtl', { action: 'chooseImage', result: localIds });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGetLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getLocation({\n    // type: 'wgs84',//wgs84gpsopenLocation'gcj02'\n    ...data,\n    success: function (res) {\n      // var latitude = res.latitude;// 90~-90\n      // var longitude = res.longitude;// 180~-180\n      cb.invoker.publish('mtl', { action: 'getLocation', result: res });\n      _showPrompt(res);\n    },\n    fail (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlOpenLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.openLocation({\n    // latitude: 40.07573,//90~-90\n    // longitude: 116.245412,//180~-180\n    // name: '',//\n    // address: '',//\n    // scale: 1,//,,1~28\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'openLocation', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGenerateQRCode (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.generateQRCode({\n    // str: 'hello',//\n    // size: 200,//100*100\n    ...data,\n    success: function (res) {\n      // imgSrcbase64\n      // var src = res.imgSrc;\n      cb.invoker.publish('mtl', { action: 'generateQRCode', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlRequest (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  if (data.headers && typeof data.headers === 'string') {\n    try {\n      data.headers = JSON.parse(data.headers);\n    } catch (e) {\n      alert('headers ')\n      return\n    }\n  }\n  if (data.params && typeof data.params === 'string') {\n    try {\n      data.params = JSON.parse(data.params);\n    } catch (e) {\n      alert('params ')\n      return\n    }\n  }\n  mtl.request({\n    // url: 'https://some-domain.com/api/user',\n    // method: 'get',\n    // headers: { 'X-Requested-With': 'XMLHttpRequest' },\n    // params: {\n    //   ID: 12345\n    // },\n    ...data,\n    success: function (res) {\n      const data = res.data; // \n      cb.invoker.publish('mtl', { action: 'request', result: data });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  })\n}\n\nexport function mtlStartRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.startRecord({\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'startRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.stopRecord({\n    success: function (res) {\n      // var localId = res.localId;// ID,BASE64\n      cb.invoker.publish('mtl', { action: 'stopRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPlayVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.playVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'playVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPauseVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.pauseVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'pauseVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.stopVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'stopVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n/**\n * \n */\nexport function mtlChangeScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.changeScreenOrientation({\n    // orientation: true,\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'changeScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlRestoreScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.restoreScreenOrientation({\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'restoreScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlSetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.setStorage({\n    // domain: '',\n    // key: '',\n    // data: {},\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'setStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlGetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'getStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlRemoveStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.removeStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'removeStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlClearStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.clearStorage({\n    // domain: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'clearStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * \n */\nexport function mtlUploadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.uploadFile({\n    // url: '',\n    // filePath: '',\n    // header: { 'content-type': 'multipart/form-data' },\n    // formData: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'uploadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * \n */\nexport function mtlDownloadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.downloadFile({\n    // url: '',\n    // fileType: '',\n    // header: '',\n    // formBody: '',\n    // jsonBody: '',\n    // autoPreview: '',\n    // fileName: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'downloadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n","/* eslint max-lines: [\"error\", 2800] */\n\nimport * as common from './common'\nimport env from '../helpers/env'\nimport uuid from 'uuid/v1';\nimport { mtlScan, mtlShare } from './mtlapi'\nimport { compConfig } from '@mdf/cube/lib/extend'\nimport * as staterule from '../staterule/rule';\n\nconst themeType = process.env.__THEMETYPE__;\n\nconst voucherlist = (function () {\n  const _render = (viewmodel, data, dirty) => {\n    common.setRenderReadOnly(viewmodel)\n    common.setState(viewmodel)\n    staterule.runState(viewmodel)\n    if (dirty) {\n      viewmodel.setDirty(true)\n      viewmodel.loadDirtyData(data)\n    } else {\n      viewmodel.loadData(data)\n      if (data) {\n        viewmodel.execute('afterLoadData', data);\n        viewmodel.validate(true);\n      }\n    }\n  }\n  const _getTreeSelectNode = (viewmodel) => {\n    let selectNode,\n      node\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      selectNode = treeModel.getSelectedNodes()\n    }\n    if (selectNode && selectNode.length && selectNode[0]) {\n      node = selectNode[0]\n    }\n    return node\n  }\n  const singleDo = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const rowIndex = params && params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(currentRow)\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('', 'success');\n          viewModel.execute('back');\n        }\n        const afterActData = { err, res };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, postData);\n    });\n  };\n  const _doService = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (!viewmodel.getCache('lastMode')) {\n      singleDo(billNo, viewmodel, params, beforeAct, afterAct);\n      return;\n    }\n    const node = _getTreeSelectNode(viewmodel)\n    if (!node) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    common.doService(billNo, viewmodel, params, beforeAct, afterAct, function (viewmodel, postData, params) {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('', 'success')\n          const oldData = viewmodel.collectData(true)\n          const newData = common.billMerge(oldData, res)\n          common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n          _render(viewmodel, newData)\n          viewmodel.getTreeModel().updateNode(newData);\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n  // \n  const open = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'open';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026042', {cShowCaption: params.cShowCaption}), function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct);\n    }\n  };\n  // \n  const close = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'close';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm) {\n      cb.utils.confirm('', function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct);\n    }\n  };\n  // \n  const _addCard = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const maxLevel = viewmodel.getTreeModel() && viewmodel.getTreeModel().getState('maxLevel');\n    const level = maxLevel === false ? 65536 : (maxLevel || 3);\n    const selectedNode = _getTreeSelectNode(viewmodel)\n    if (selectedNode && selectedNode.level > level) {\n      cb.utils.alert(cb.locale('P_YS_FED_FW_0001026057', {level: (level + 1)}), 'error');\n      return;\n    }\n    const postData = {\n      billnum: billNo\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.emptyBill(postData, params, function (err, suc) {\n        if (suc) {\n          // viewmodel.clear()\n          common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n          const treeModel = viewmodel.getTreeModel();\n          const parentField = treeModel.getState('parentField');\n          if (suc[parentField] == null) {\n            if (selectedNode) {\n              suc[parentField] = selectedNode[treeModel.getState('keyField')];\n              suc.parent_name = selectedNode.name;\n            }\n          }\n          _render(viewmodel, suc, true)\n        }\n        const afterActData = {\n          err: err,\n          res: suc\n        }\n        afterAct(afterActData, common.afterAct)\n      })\n    })\n  }\n\n  // \n  const _addVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (cb.rest.interMode === 'touch') {\n      const gridModel = viewmodel.getGridModel();\n      if (gridModel)\n        gridModel.clearCache('backData');\n    }\n    params = params || {};\n    let cParameter = {};\n    let billno;\n    params = params || {};\n    if (params.cParameter) { try { cParameter = JSON.parse(params.cParameter); } catch (e) { } }\n    if (cParameter.billnum && cParameter.type === 'tree') {\n      billno = cParameter.billnum\n    } else {\n      billno = common.getVmParams(viewmodel, 'cardKey')\n    }\n    if (!billno) {\n      cb.utils.alert('cCardKey', 'warning')\n      return\n    }\n    let parentId\n    const node = _getTreeSelectNode(viewmodel)\n    if (node) {\n      parentId = node[viewmodel.getTreeModel().getState('keyField')]\n    }\n    let postData = {\n      params: params,\n      mode: env.VOUCHER_STATE_ADD,\n      action: 'add',\n      carryParams: {},\n      parentId: parentId,\n      parent: node\n    };\n    postData = Object.assign({}, postData, viewmodel.getCache('lastSearchCondition'))\n    const beforeActData = { params: postData };\n    beforeAct(beforeActData, function (args) {\n      if (args)\n        postData.carryParams.externalData = args;\n      cb.loader.runCommandLine('bill', {\n        billtype: 'voucher',\n        billno: billno,\n        params: postData\n      }, viewmodel);\n      afterAct();\n    })\n  }\n\n  const _loadGrid = (viewmodel, params, afterAct) => {\n    // \n    const allGridmodel = viewmodel.getGridModels();\n    for (let i = 1; i < allGridmodel.length; i++) {\n      allGridmodel[i].clear();\n    }\n    const queryItems = viewmodel.getCache('queryItems') || [];\n    if (queryItems.length) {\n      let flag = false;\n      queryItems.forEach(item => {\n        const field = item.replace(/(\\w)/, function (v) {\n          return v.toUpperCase()\n        }) // \n        if (viewmodel.getCache(`exec${field}`)) return;\n        flag = true;\n      });\n      if (flag) {\n        /*  */\n        if (afterAct) {\n          afterAct();\n        }\n        return;\n      }\n    }\n    const billType = common.getVmParams(viewmodel, 'billType');\n    if (billType === 'Report') {\n      viewmodel.execute('firstQueryDone', true);\n    }\n    const { reportId } = viewmodel.getParams().query;\n    const gridModel = viewmodel.getGridModel()\n    if (reportId && !params.reportId)\n      gridModel.setColumns(gridModel.getState('columns'));\n    Object.assign(params, viewmodel.getParams().query);\n    delete params.isSum;\n    const isSum = viewmodel.getCache('isSum');\n    if (isSum != null)\n      params.isSum = isSum;\n    if (gridModel) {\n      gridModel.setState('showSearch', params.showSearch);\n      delete params.showSearch;\n      // \n      const bDisplay = viewmodel.getCache('bDisplayNavTree');\n      if (bDisplay == true && !params.bFromNav) {\n        return;\n      }\n      gridModel.promiseExecute('beforeLoad', params, function () {\n        const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdlist'\n        });\n        let url = configParams && configParams.cSvcUrl || 'bill/list';\n        url = cb.rest._appendUrl(url, viewmodel.getParams().query);\n        const proxyParams = configParams && configParams.cSvcUrl ? {\n          url,\n          method: configParams.cHttpMethod || 'POST',\n          options: { mask: true }\n        } : {\n          url,\n          method: 'POST',\n          options: { mask: true }\n        };\n        gridModel.setDataSource(proxyParams, params, function (result) {\n          const parent = gridModel.getParent();\n          if (parent) {\n            const pageInfo = parent.getCache('pageInfo');\n            const delayLoadPageInfo = compConfig.table && compConfig.table.delayLoadPageInfo; // \n            let billType = parent.getParams().billType;\n            billType = billType.toLocaleLowerCase();\n            const lazyPageTypes = ['voucherlist', 'archivelist']; // \n            if (delayLoadPageInfo == false || !lazyPageTypes.includes(billType)) {\n              parent.setCache('pageInfo', { recordCount: result.recordCount, pageIndex: result.pageIndex, pageSize: result.pageSize });\n            } else {\n              if (pageInfo) {\n                pageInfo.pageIndex = result.pageIndex;\n                pageInfo.pageSize = result.pageSize\n              } else {\n                parent.setCache('pageInfo', { recordCount: result.recordCount, pageIndex: result.pageIndex, pageSize: result.pageSize });\n              }\n            }\n          }\n          const columns = getColumnsData(result);\n          if (!columns) return;\n          this.setColumns(columns.columns, columns.fieldNames);\n        });\n        // \n        gridModel.setSortColumn();\n        gridModel.setCache('afterAct', afterAct);\n        viewmodel.getCache('cardViewModel') && gridModel.execute('dblClick', {});\n      });\n    }\n  }\n\n  /**\n     * \n     */\n  const _validateMustInput = (viewmodel) => {\n    const _filterViewModel = viewmodel.getCache('FilterViewModel');\n    const propertyNames = _filterViewModel._get_data('propertyNames');\n    let flag = true;\n    for (let i = 0; i < propertyNames.length; i++) {\n      const propertyName = propertyNames[i];\n      const property = _filterViewModel.get(propertyName);\n      if (!(property instanceof cb.models.BaseModel) || property._get_data('needCollect') === false || property._get_data('needClear') === false) continue;\n      if (property._get_data('mustInput')) {\n        const value = property.getAllData ? property.getAllData() : property.getData();\n        if (typeof value === 'object') {\n          if (cb.utils.isEmpty(value.value1) && cb.utils.isEmpty(value.value2)) {\n            flag = false\n            break;\n          };\n        } else {\n          if (cb.utils.isEmpty(value)) {\n            flag = false\n            break;\n          }\n        }\n      }\n    }\n    return flag;\n  }\n\n  const getColumnsData = function (result) {\n    if (!result || !result.viewmodel) return;\n    const columns = {}; const fieldNames = [];\n    const columnArray = result.viewmodel.entities.filter(function (item) {\n      return item.bMain && item.cType === 'Bill';\n    })[0].fields;\n    for (let i = 0; i < columnArray.length; i++) {\n      const item = columnArray[i];\n      columns[item.cItemName] = item;\n      fieldNames.push(item.cItemName);\n    }\n    return { columns, fieldNames };\n  };\n\n  const switchGroupSchema = (billNo, viewModel, paramss, beforeAct, afterAct) => {\n    const groupSchemaId = paramss ? paramss.groupSchemaId : undefined;\n    const groupSchemaName = paramss ? paramss.groupSchemaName : undefined;\n    const dimensionId = paramss ? paramss.dimensionId || 9999 : undefined;\n    viewModel.execute('refreshEChartConfig', { billnum: billNo, groupSchemaId, groupSchemaName, dimensionId });\n    let isFirst = true;\n    if (viewModel.getCache('execSchema') === true) {\n      isFirst = false;\n    }\n    else {\n      viewModel.setCache('execSchema', true);\n    }\n    viewModel.setCache('groupSchemaId', groupSchemaId);\n    viewModel.getGridModel().setState('showColumnSetting', !groupSchemaId);\n    const params = Object.assign({\n      billnum: billNo,\n      groupSchemaId,\n      isIncludeMeta: true\n    }, viewModel.getCache('lastSearchCondition'));\n    Object.assign(params, viewModel.getParams().query);\n    if (isFirst === false && viewModel.getCache('lastSearchCondition') === undefined) {\n      const filterVM = viewModel.getCache('FilterViewModel');\n      const schemeId = filterVM.getCache('schemeId');\n      const model = filterVM && filterVM.get('search');\n      model && model.fireEvent('click', { solutionid: schemeId });//\n    }\n    else {\n      _loadGrid(viewModel, params, afterAct);\n    }\n  }\n  // const _bindUpdateCondition = (viewModel, billNo) => {\n  //   viewModel.on('updateCondition', function (args) {\n  //     _loadGrid(viewModel, {\n  //       billnum: billNo,\n  //       condition: args\n  //     });\n  //   });\n  // }\n  // \n  const _bindGridAttachment = (viewmodel, billNo) => {\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment) {\n      return;\n    }\n    const gridModels = viewmodel.getGridModels();\n    gridModels.forEach(gridModel => {\n      gridModel.on('beforeSetDataSource', function (dataList) {\n        dataList.forEach(item => {\n          if (!item.attachmentId) {\n            if (item.id) {\n              item.attachmentId = item.id\n            } else {\n              item.attachmentId = uuid();\n            }\n          }\n        });\n        return dataList;\n      });\n    })\n  }\n  const _bindGridDblClick = (viewmodel, billNo) => {\n    const gridModel = viewmodel.getGridModel()\n    if (!gridModel) return\n    let dblClickItemName = null;\n    const columns = gridModel.getColumns();\n    for (const attr in columns) {\n      if (columns[attr].bJointQuery) {\n        dblClickItemName = attr;\n        break;\n      }\n    }\n    gridModel.on('cellJointQuery', function (args) {\n      const rowData = gridModel.getRow(args.rowIndex);\n      if (args.cellName === dblClickItemName) {\n        gridModel.execute('dblClick', rowData, args);\n        gridModel.setCache('backData', { rowIndex: args.rowIndex, id: rowData.id });\n      } else {\n        gridModel.execute('jointQuery', Object.assign(args, { rowData }));\n      }\n    });\n    gridModel.on('dblClick', function (args, cellInfo) {\n      const parent = this.getParent()\n      let params = {\n        mode: env.VOUCHER_STATE_EDIT,\n        readOnly: !viewmodel.getParams().doubleEdit,\n        id: args.id,\n        rowData: args,\n        cellInfo,\n        carryParams: {},\n        cardViewModel: parent.getCache('cardViewModel')\n      }\n      params = Object.assign({}, params, viewmodel.getCache('lastSearchCondition'))\n      if (!gridModel.execute('beforeDblClick', params)) return true\n      const cardKey = common.getVmParams(viewmodel, 'cardKey')\n      if (!cardKey)\n        return\n      if (themeType == 'ncc') {\n        const rows = gridModel.get('dataSource'); // \n        const index = rows.findIndex(item => item.id == args.id);\n        parent.setCache('curVoucherIndex', index);\n      }\n      const dt = {\n        billtype: 'voucher',\n        billno: cardKey,\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, parent)\n    })\n\n    // TODO  (\n    viewmodel.on('afterBatchdelete', res => {\n      const allGridmodel = viewmodel.getGridModels();\n      if (!res.res.failCount) {\n        for (let i = 1; i < allGridmodel.length; i++) {\n          allGridmodel[i].clear();\n        }\n      }\n    });\n    gridModel.on('afterSetDataSource', () => {\n      const afterAct = gridModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n      common.setGridActionStates(gridModel, viewmodel);\n      staterule.runGridActionStates(gridModel, viewmodel);\n    });\n    // \n    gridModel.on('afterQueryPageInfo', (result) => {\n      if (themeType !== 'ncc') return;\n      const pageInfo = viewmodel.getCache('pageInfo');\n      pageInfo.recordCount = result.recordCount;\n    })\n  }\n  // \n  const _bindGrandSonTable = function (viewmodel, billno) {\n    const gridModel = viewmodel.getGridModel()\n    if (!gridModel) return\n    const gms = viewmodel.getGridModels();\n    // excel\n    if (gms.length < 2 || !gridModel.getCache('bMain')) {\n      return\n    }\n    if (themeType !== 'ncc') {\n      return\n    }\n    // \n    gridModel.on('masterTableRowClick', (index) => {\n      const id = gridModel.getRow(index).id;\n      const proxy = cb.rest.DynamicProxy.create({\n        ensure: {\n          url: '/bill/detail',\n          method: 'GET'\n        }\n      });\n      const cardKey = common.getVmParams(viewmodel, 'cardKey')\n      const params = {\n        billnum: cardKey,\n        id\n      }\n      proxy.ensure(params, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n        } else {\n          for (let i = 1; i < gms.length; i++) {\n            const subGridModel = gms[i];\n            subGridModel._set_data('dataSourceMode', 'local');\n            subGridModel.clear();\n            // \n            if (subGridModel.getCache('cSunBillNo') !== undefined) {\n              subGridModel.un('masterTableRowClick');\n              subGridModel.on('masterTableRowClick', function (index) {\n                const selectedRow = subGridModel.getRow(index);\n                const rid = selectedRow.rid;\n                if (!rid) {\n                  console.error('id');\n                  return;\n                }\n                const params = {\n                  mode: env.VOUCHER_STATE_EDIT,\n                  readOnly: !viewmodel.getParams().doubleEdit,\n                  id: rid,\n                  rowData: selectedRow,\n                  carryParams: {},\n                }\n                // if (!subGridModel.execute('beforeDblClick', params)) return true\n                const dt = {\n                  billtype: 'voucher',\n                  billno: subGridModel.getCache('cSunBillNo'),\n                  params\n                }\n                cb.loader.runCommandLine('bill', dt, viewmodel)\n              });\n            }\n          }\n          viewmodel.setData(result);\n        }\n      });\n    });\n    const addGrandSonTable = viewmodel.get('addGrandSonTable');\n    if (!addGrandSonTable || themeType !== 'ncc') {\n      return\n    }\n    gms.forEach((gridModel, index) => {\n      if (index > 0 && !gridModel.getCache('bMain')) {\n        gridModel.on('beforeSetDataSource', function (dataList) {\n          dataList.forEach(item => {\n            if (!item.rid) {\n              if (item.id) {\n                item.rid = item.id;\n              } else {\n                item.rid = uuid();\n              }\n            }\n          });\n          return dataList;\n        });\n      }\n    })\n  }\n  const _loadTree = (viewmodel, params, afterAct) => {\n    const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n      return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdquerytree'\n    });\n    const proxyParams = configParams && configParams.cSvcUrl ? {\n      url: configParams.cSvcUrl,\n      method: configParams.cHttpMethod || 'POST'\n    } : {\n      url: 'bill/querytree',\n      method: 'POST'\n    };\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      treeModel.promiseExecute('beforeLoad', params, function () {\n        treeModel.setDataSource(proxyParams, params)\n        if (afterAct) treeModel.setCache('afterAct', afterAct)\n      })\n    }\n  }\n\n  const _renderTreeArchiveData = (billNo, viewmodel, params) => {\n    const hasChildren = viewmodel.getParams().hasChildren;\n    if (hasChildren) {\n      const data = {\n        billnum: billNo,\n        id: params[viewmodel.getTreeModel().getState('keyField')]\n      }\n      const callback = function (err, data) {\n        if (!err)\n          _render(viewmodel, data);\n      }\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n        return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmddetail';\n      });\n      const options = configParams && configParams.cSvcUrl ? {\n        cSvcUrl: configParams.cSvcUrl,\n        cHttpMethod: configParams.cHttpMethod || 'GET'\n      } : {\n        cSvcUrl: 'bill/detail',\n        cHttpMethod: 'GET'\n      };\n      common.doProxy(options, callback, data)\n    } else {\n      _render(viewmodel, params);\n    }\n  }\n\n  const _bindTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel();\n    if (!treeModel) return\n    if (themeType == 'ncc') {\n      // ncc\n      treeModel.setReadOnly(true);\n    }\n    const gridModel = viewmodel.getGridModel()\n    const { billType } = viewmodel.getParams();\n    treeModel.on('select', function (args) {\n      viewmodel.promiseExecute('beforeTreeSelect', args, function () {\n        if (gridModel || billType === 'TreeList') { // \n          if (!gridModel) return;\n          // if (!args.length) return;\n          viewmodel.setCache('execTree', true);\n          const condition = { billnum: billNo };\n\n          if (args.length) {\n            let { path, id } = args[0];\n            /* id */\n            if (id == 'main')\n              id = ''\n            // fangqg: remove this if because it cause list service error\n            // if (path && id) {\n            //   condition.path = path\n            //   condition.ids = id.toString();\n            // }\n            // else if (path)\n            if (path)\n              condition.path = path;\n            else if (id)\n              condition.ids = id.toString();\n          }\n\n          Object.assign(condition, viewmodel.getCache('lastSearchCondition'));\n          _loadGrid(viewmodel, condition);\n        } else { // \n          if (args.length) {\n            common.setMode(viewmodel, env.VOUCHER_STATE_EDIT);\n            // _render(viewmodel, args[0]);\n            _renderTreeArchiveData(billNo, viewmodel, args[0]);\n            viewmodel.setCache('lastMode', env.VOUCHER_STATE_EDIT);\n          } else {\n            common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            // _render(viewmodel);\n            viewmodel.biz.do('add', viewmodel);\n            viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n          }\n        }\n        // common.setState(viewmodel)\n      })\n    })\n\n    treeModel.on('afterSetDataSource', () => {\n      if (!gridModel) {\n        const afterAct = treeModel.getCache('afterAct');\n        if (afterAct)\n          afterAct();\n        return;\n      }\n      const afterAct = gridModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n    });\n  }\n  const _bindTreeDblClick = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel) return\n\n    treeModel.on('cellJointQuery', function (args) {\n      const rowData = args.rowData;\n      treeModel.execute('dblClick', rowData);\n      // gridModel.setCache('backData', { rowIndex: args.rowIndex, id: rowData.id });\n    });\n    treeModel.on('dblClick', function (args) {\n      const parent = this.getParent()\n      const params = {\n        mode: env.VOUCHER_STATE_EDIT,\n        readOnly: true,\n        id: args.id,\n        rowData: args,\n        cardViewModel: parent.getCache('cardViewModel')\n      }\n      if (!treeModel.execute('beforeDblClick', params)) return true\n      const dt = {\n        billtype: 'voucher',\n        billno: common.getVmParams(parent, 'cardKey'),\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, parent)\n    })\n  }\n  const _bindCompareTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel) return\n    treeModel.on('select', function (args) {\n      const gridModel = viewmodel.getGridModel()\n      if (gridModel && args.length) {\n        let parameter = common.getVmParams(viewmodel, 'foreignKey')\n        if (parameter) {\n          const args = parameter.split('.')\n          if (args && args.length > 1) {\n            parameter = args[1]\n          }\n        }\n        const postData = {\n          billnum: billNo,\n          path: args[0][parameter],\n          operator: 'eq'\n        }\n        _loadGrid(viewmodel, postData)\n      }\n      const data = args[0]\n      common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n      _render(viewmodel, data)\n    })\n  }\n\n  const _treeDetailSelect = (viewmodel, billNo, id) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      treeModel.on('afterSetDataSource', function (dataSource) {\n        treeModel.select(id)\n      })\n    }\n  }\n\n  const _setQueryItems = (viewModel, item) => {\n    const queryItems = viewModel.getCache('queryItems') || [];\n    if (queryItems.indexOf(item) === -1)\n      queryItems.push(item);\n    viewModel.setCache('queryItems', queryItems);\n  }\n\n  const _initPage = (viewmodel, billNo) => {\n    const billType = common.getVmParams(viewmodel, 'billType')\n    const filterId = common.getVmParams(viewmodel, 'filterId')\n    const condition = common.getVmParams(viewmodel, 'condition');\n    // const autoLoad = common.getVmParams(viewmodel, 'autoLoad');\n    const id = common.getVmParams(viewmodel, 'detailId')\n    // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n    // _render(viewmodel)\n\n    switch (billType) {\n      case 'Report': {\n        // const viewid = _.get(viewmodel.getParams(), 'query.viewid');\n        if (condition || !filterId) {\n          // viewmodel.setCache('firstQuery', true);\n          _loadGrid(viewmodel, { billnum: billNo, condition: condition });\n        }\n\n        _bindGridDblClick(viewmodel, billNo);\n        break;\n      }\n      case ('VoucherList'):\n      case ('ArchiveList'):\n      case ('YYList'):\n        // if (!filterId && autoLoad !== false) {\n        _loadGrid(viewmodel, {\n          billnum: billNo,\n          condition: condition\n        })\n        // }\n        // if (!filterId)\n        //   _bindUpdateCondition(viewmodel, billNo);\n        _bindGridDblClick(viewmodel, billNo);\n        _bindGrandSonTable(viewmodel, billNo);\n        _bindGridAttachment(viewmodel, billNo);\n        break\n      case ('TreeList'): {\n        const treeModel = viewmodel.getTreeModel();\n        if (treeModel && treeModel.getState('defaultSelectedKeys'))\n          _setQueryItems(viewmodel, 'tree');\n        _bindGridAttachment(viewmodel, billNo)\n        if (treeModel && treeModel.getState('banQuery')) {\n        } else {\n          /* add by jinzh1 TreeList   loadtree */\n          const gridmodel = viewmodel.getGridModel();\n          if (gridmodel || !filterId)\n            _loadTree(viewmodel, {\n              billnum: billNo,\n              treename: common.getVmParams(viewmodel, 'treeName')\n            });\n        }\n        _bindTreeSelect(viewmodel, billNo)\n        _bindTreeDblClick(viewmodel, billNo)\n        _bindGridDblClick(viewmodel, billNo)\n        break\n      }\n      case ('TreeArchive'):\n        // common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n        _loadTree(viewmodel, {\n          billnum: billNo,\n          treename: common.getVmParams(viewmodel, 'treeName')\n        })\n        _bindTreeSelect(viewmodel, billNo)\n        // _render(viewmodel)\n        viewmodel.biz.do('add', viewmodel);\n        viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n        break\n      case ('Compare'):\n        common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n        _loadTree(viewmodel, {\n          billnum: billNo,\n          treename: common.getVmParams(viewmodel, 'treeName'),\n          isDistinct: true\n        })\n        _bindCompareTreeSelect(viewmodel, billNo)\n        _bindGridDblClick(viewmodel, billNo)\n        _render(viewmodel)\n        break\n    }\n    // common.setState(viewmodel)\n    if (id) {\n      _treeDetailSelect(viewmodel, billNo, id)\n    }\n  }\n\n  const _getSelectRowIds = (gridModel, para, distinct = true) => { // \n    if (!gridModel) return\n    const selectDatas = para && para.params && para.params.index != null\n      ? [gridModel.getRow(para.params.index)]\n      : gridModel.getSelectedRows();\n    const ids = []\n    if (selectDatas && selectDatas.length > 0) {\n      selectDatas.map(function (row) {\n        if (row.id) {\n          ids.push(row.id)\n        }\n      })\n    }\n    return distinct ? Array.from(new Set(ids)) : ids\n  }\n\n  const check4List = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const node = _getTreeSelectNode(viewmodel)\n    if (node) {\n      const treeModel = viewmodel.getTreeModel();\n      params[treeModel.getState('parentField')] = node[treeModel.getState('keyField')];\n    }\n    const beforeActData = {\n      params: params,\n    }\n    beforeAct(beforeActData, function () {\n      common.check(billNo, viewmodel, params, beforeAct, afterAct)\n    })\n  }\n\n  const abandon = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const lastMode = viewmodel.getCache('lastMode');\n    if (!lastMode) {\n      viewmodel.communication({ type: 'return' });\n      return;\n    }\n    const resetOrginalData = (viewmodel) => {\n      // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n      common.setMode(viewmodel, lastMode);\n      _render(viewmodel, viewmodel.getOriginalData())\n      const afterActData = {\n        res: viewmodel.getOriginalData()\n      }\n      afterAct(afterActData, common.afterAct)\n    }\n    const beforeActData = {\n      params: params\n    }\n    beforeAct(beforeActData, function () {\n      cb.utils.confirm('', function () {\n        resetOrginalData(viewmodel)\n      });\n    })\n  }\n  const _hasList = (billType) => {\n    return (billType.indexOf('ist') > -1 || billType.toLowerCase() == 'compare') // ArchiveList,TreeList,VoucherList,compare\n  }\n  const add = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (cb.isTest_ImportProgressBall === true) {\n      let tmp = 0;\n      const key = 'asyncImport_' + Math.floor(Math.random() * 10000000000);\n      const timer = setInterval(() => {\n        tmp = tmp + 1;\n        const asyncParams = {\n          asyncData: JSON.stringify({ flag: 1, percentage: tmp, count: tmp, totalCount: 100 }),\n          asyncKey: key,\n          busName: '' + key,\n          curTime: '2019-11-26 10:25:0',\n          fileName: '.xlsx',\n          fileSize: 327101,\n          percentage: tmp,\n          // itemsTitle:\"\" + key\n        }\n\n        viewmodel.communication({\n          type: 'asyncImport',\n          payload: asyncParams\n        });\n        if (tmp >= 100) {\n          clearInterval(timer);\n        }\n      }, 1000);\n    } else {\n      params = params || {};\n      if (!params.cAction) {\n        const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n          return item.cAction.trim().toLocaleLowerCase() === 'add';\n        });\n        Object.assign(params, configParams);\n      }\n      const billType = viewmodel.getParams() && viewmodel.getParams().billType;\n      viewmodel.setCache('curVoucherIndex', -1);\n      if (billType) {\n        if (_hasList(billType)) { // ArchiveList,TreeList,VoucherList,compare\n          _addVoucher(billNo, viewmodel, params, beforeAct, afterAct)\n        } else {\n          _addCard(billNo, viewmodel, params, beforeAct, afterAct)\n        }\n      } else {\n        console.error('billType')\n      }\n    }\n  }\n\n  const save = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const invalidMsg = viewmodel.validate();\n    if (invalidMsg) {\n      cb.utils.alert('' + invalidMsg.join(','), 'error');\n      return;\n    }\n    const data = viewmodel.collectData()\n    if (!data) return\n    const mode = common.getMode(viewmodel)\n    if (mode != env.VOUCHER_STATE_ADD) {\n      data._status = cb.models.DataStates.Update\n    } else {\n      data._status = cb.models.DataStates.Insert\n      const treeModel = viewmodel.getTreeModel();\n      const parentData = data[treeModel.getState('parentField')];\n      if (parentData) {\n        if (treeModel) {\n          const parentNode = treeModel.getNodesByKeys(parentData);\n          if (parentNode && parentNode.length)\n            data.level = parentNode[0].level + 1;\n        }\n      } else {\n        data.level = 1;\n      }\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          // let necessaryData = viewmodel.getNecessaryData()\n          const oldData = viewmodel.collectData(true)\n          let condition;\n          const arrayKeys = []\n          for (const key in res) {\n            if (Array.isArray(res[key]) &&\n              viewmodel.get(key) &&\n              viewmodel.get(key).getDirtyRowIndexes &&\n              viewmodel.get(key).getDirtyRowIndexes() &&\n              viewmodel.get(key).getDirtyRowIndexes().length > 0) {\n              arrayKeys.push(key)\n              condition = {};\n            }\n          }\n\n          arrayKeys.forEach((key) => {\n            condition[key] = viewmodel.get(key).getDirtyRowIndexes()\n          })\n          const newData = common.billMerge(oldData, res, condition)\n          common.setMode(viewmodel, env.VOUCHER_STATE_EDIT)\n          _render(viewmodel, newData)\n          viewmodel.execute('updateTreeRefer')\n          const treeModel = viewmodel.getTreeModel();\n          if (viewmodel.getParams().saveRefresh) {\n            _loadTree(viewmodel, {\n              billnum: billNo,\n              treename: common.getVmParams(viewmodel, 'treeName')\n            }, function () {\n              const key = newData[treeModel.getState('keyField')];\n              if (key)\n                treeModel.select(key.toString());\n            });\n          } else {\n            // if (necessaryData[treeModel.getState('keyField')]) {\n            if (mode !== env.VOUCHER_STATE_ADD) {\n              treeModel.updateNode(newData)\n            } else {\n              treeModel.addNode(newData, true)\n            }\n          }\n          cb.utils.alert('', 'success')\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      params.options = { mask: true };\n      common.doProxy(params, callback, postData)\n    })\n  }\n  // \n  const attachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel();\n    const selectDatas = params && params.params && params.params.index != null\n      ? [gridModel.getRow(params.params.index)]\n      : gridModel.getSelectedRows();\n    if (selectDatas.length == 0) {\n      cb.utils.alert('', 'warning');\n      return\n    }\n    if (selectDatas.length > 1) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n\n    const selectRow = selectDatas[0];\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// \n    const rowData = Object.assign({\n      id: selectRow.attachmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // (lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  const batchDelete = (billNo, viewModel, params, beforeAct, afterAct) => {\n    if (themeType == 'ncc') {\n      batchDo(billNo, viewModel, params, beforeAct, afterAct);\n    } else {\n      batchDo(billNo, viewModel, params, beforeAct, afterAct, true);\n    }\n  }\n\n  const batchDo = (billNo, viewmodel, params, beforeAct, afterAct, confirm) => {\n    // \n    if (params.cItemName !== 'btnDelete' && params.cItemName !== 'btnDeleteRow') {\n      if (confirm == undefined) {\n        confirm = !!cb.extendConfig.allConfirm;\n      }\n    }\n    let primaryKeyField;\n    if (params.cmdParameter) {\n      try {\n        primaryKeyField = JSON.parse(params.cmdParameter).primarykey;\n      } catch (e) {\n        console.error('batchDo action parameter error: ' + e.message);\n      }\n    }\n    if (!primaryKeyField)\n      primaryKeyField = 'id';\n    const gridModel = viewmodel.getGridModel();\n    const treeModel = viewmodel.getTreeModel();\n    let selectDatas;\n    let cParameter = {};\n    params = params || {};\n    if (params.cParameter) { try { cParameter = JSON.parse(params.cParameter); } catch (e) { } }\n    if (cParameter.billnum && cParameter.type === 'tree') {\n      selectDatas = treeModel.getSelectedNodes();\n      billNo = cParameter.billnum\n    } else if (gridModel) {\n      selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n    } else if (treeModel) {\n      selectDatas = treeModel.getSelectedNodes();\n    }\n    if (!selectDatas || selectDatas.length == 0) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    let data;\n    if (cParameter.billnum && cParameter.type === 'tree') {\n      data = treeModel.getNecessaryDataForRows(selectDatas);\n    } else if (gridModel) {\n      data = gridModel.getNecessaryDataForRows(selectDatas);\n    } else {\n      data = treeModel.getNecessaryDataForRows(selectDatas);\n    }\n    const paramsData = []; const primaryKeys = [];\n    selectDatas.forEach(function (row, index) {\n      if (row.id && row.pubts) {\n        Object.assign(data[index], {\n          code: row.code,\n          id: row.id,\n          pubts: row.pubts\n        })\n      }\n      if (primaryKeys.indexOf(row[primaryKeyField]) === -1) {\n        paramsData.push(data[index]);\n        primaryKeys.push(row[primaryKeyField]);\n      }\n    }, this)\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(paramsData)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      if (confirm) {\n        const text = viewmodel.getParams().caption;\n        cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026054', {cCaption: params.cShowCaption, text}), function () {\n          if (cParameter.isAsync) {\n            _batchAsyncDo(viewmodel, params, afterAct, paramsData, postData, primaryKeyField);\n          } else {\n            _batchDo(viewmodel, params, afterAct, paramsData, postData, primaryKeyField);\n          }\n        }, function () {\n          if (params && params.enabledCallback)\n            params.enabledCallback();\n        });\n      } else {\n        if (cParameter.isAsync) {\n          _batchAsyncDo(viewmodel, params, afterAct, paramsData, postData, primaryKeyField);\n        } else {\n          _batchDo(viewmodel, params, afterAct, paramsData, postData, primaryKeyField);\n        }\n      }\n    })\n  }\n\n  const _batchAsyncDo = (viewmodel, params, afterAct, selectDatas, postData, primaryKeyField) => {\n    postData.externalData = {\n      isAsync: true,\n      ...postData.externalData\n    }\n    const callback = function (err, res) {\n      if (!err) {\n        const info = res && Array.isArray(res.infos) && res.infos[0] || {};\n        const queryParams = {\n          asyncKey: info.asyncKey,\n          url: info.url,\n          asyncName: ''\n        }\n        queryAsyncProcess(postData.billnum, viewmodel, queryParams);\n        viewmodel.execute('back', params);\n      }\n      const afterActData = {\n        err: err,\n        res: res\n      }\n      afterAct(afterActData, common.afterAct)\n    }\n    common.doProxy(params, callback, postData)\n  }\n\n  const _batchDo = (viewmodel, params, afterAct, selectDatas, postData, primaryKeyField) => {\n    const callback = function (err, res) {\n      if (!err) {\n        const actionText = params.cShowCaption;\n        if (selectDatas.length === 1) {\n          if (res.failCount) {\n            cb.utils.alert(cb.locale('P_YS_FED_FW_0001026088', {actionText, messages: res.messages[0]}), 'error');\n          } else {\n            cb.utils.alert(cb.locale('P_YS_FED_FW_0001026089', {actionText}), 'success');\n          }\n          // } else if (true || \"batchaudit,batchunaudit\".indexOf(params.cAction.toLowerCase()) >= 0) {\n        } else {\n          if (cb.extendConfig.theme === 'ncc' && !viewmodel.getCache('showBatchMsg')) {\n            if (res.failCount > 0) {\n              cb.utils.alert(cb.locale('P_YS_FED_FW_0001026087', {actionText, ...res}), 'error')\n            } else {\n              cb.utils.alert(cb.locale('P_YS_FED_FW_0001026086', {actionText, ...res}), 'success')\n            }\n          } else {\n            viewmodel.communication({\n              type: 'modal',\n              payload: {\n                key: 'BatchMsg',\n                data: {\n                  type: 2,\n                  res,\n                }\n              }\n            });\n          }\n        }\n        viewmodel.execute('back', params);\n      }\n      const afterActData = {\n        err: err,\n        res: res\n      }\n      afterAct(afterActData, common.afterAct)\n    }\n    common.doProxy(params, callback, postData)\n  }\n\n  const dblClick = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    let id, rowData;\n    let cParameter = {};\n    let billno;\n    para = para || {};\n    if (para.cParameter) { try { cParameter = JSON.parse(para.cParameter); } catch (e) { } }\n    if (cParameter.billnum && cParameter.type === 'tree') {\n      billno = cParameter.billnum\n      const node = _getTreeSelectNode(viewmodel);\n      id = node.id;\n      rowData = node;\n    } else if (gridModel) {\n      const rowIndex = para && para.params && para.params.index;\n      const selectDatas = rowIndex != null ? [gridModel.getRow(para.params.index)] : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length !== 1) {\n        cb.utils.alert('', 'warning');\n        return;\n      }\n      id = selectDatas[0].id;\n      rowData = selectDatas[0];\n      gridModel.setCache('backData', { rowIndex, id });\n      billno = common.getVmParams(viewmodel, 'cardKey')\n    } else {\n      const node = _getTreeSelectNode(viewmodel);\n      if (!node) {\n        cb.utils.alert('', 'warning');\n        return;\n      }\n      id = node.id;\n      rowData = node;\n      billno = common.getVmParams(viewmodel, 'cardKey')\n    }\n\n    let params = {\n      params: para,\n      mode: env.VOUCHER_STATE_EDIT,\n      copy: para.copy,\n      id,\n      rowData,\n      carryParams: {}\n    }\n    //  \n    if (gridModel && themeType == 'ncc') {\n      const rows = gridModel.get('dataSource'); // \n      const index = rows.findIndex(item => item.id == id);\n      viewmodel.setCache('curVoucherIndex', index);\n      params = Object.assign({}, params, viewmodel.getCache('lastSearchCondition'))\n    }\n    beforeAct({\n      params: para,\n      carry: params\n    }, function () {\n      const dt = {\n        billtype: 'voucher',\n        billno: billno,\n        params: params\n      }\n      cb.loader.runCommandLine('bill', dt, viewmodel)\n      afterAct()\n    })\n  }\n  const edit = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const billType = viewmodel.getParams() && viewmodel.getParams().billType\n    if (billType) {\n      if (_hasList(billType)) { // ArchiveList,TreeList,VoucherList,compare\n        dblClick(billNo, viewmodel, para, beforeAct, afterAct)\n      } else {\n        common.edit(billNo, viewmodel, para, beforeAct, afterAct)\n      }\n    }\n  }\n\n  const refresh = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const params = viewmodel.getCache('lastSearchCondition');\n    const treeModel = viewmodel.getTreeModel()\n    const gridModel = viewmodel.getGridModel();\n    if (!gridModel) {\n      if (cb.extendConfig.theme == 'ncc') {\n        // \n        if (!_validateMustInput(viewmodel) || !params) {\n          return;\n        }\n      }\n      queryTree(billNo, viewmodel, params);\n      return;\n    }\n    const obj = Object.assign({\n      billnum: billNo\n    }, para);\n    const isSum = viewmodel.getCache('isSum')\n    if (isSum != null)\n      obj.isSum = isSum\n    Object.assign(obj, viewmodel.getParams().query);\n    const groupSchemaId = viewmodel.getCache('groupSchemaId');\n    if (groupSchemaId)\n      obj.groupSchemaId = groupSchemaId;\n    if (treeModel) {\n      const node = _getTreeSelectNode(viewmodel)\n      if (node) {\n        const { path, id } = node;\n        if (path && id) {\n          obj.path = path\n          obj.ids = id.toString();\n        }\n        else if (path)\n          obj.path = path;\n        else if (id)\n          obj.ids = id.toString();\n      }\n    }\n    const data = cb.utils.extend(true, obj, params)\n    const beforeActData = {\n      params: params,\n      data: data\n    }\n    if (beforeAct) {\n      beforeAct(beforeActData, function () {\n        _loadGrid(viewmodel, data, afterAct)\n      })\n    } else {\n      _loadGrid(viewmodel, data, afterAct)\n    }\n  }\n\n  const search = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.setCache('execFilter', true);\n    viewmodel.setCache('lastSearchCondition', params);\n    const beforeActData = {\n      params: params,\n      data: params\n    }\n    beforeAct(beforeActData, function () {\n      refresh(billNo, viewmodel, params, null, afterAct)\n    })\n  }\n\n  const queryTree = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let data = {\n      billnum: billNo,\n      treename: common.getVmParams(viewmodel, 'treeName')\n    }\n    if (params && params instanceof Object) {\n      data = Object.assign(data, params)\n    }\n    const beforeActData = {\n      params: params,\n      data: data\n    }\n    if (beforeAct) {\n      beforeAct(beforeActData, function () {\n        _loadTree(viewmodel, data, afterAct)\n      })\n    } else {\n      _loadTree(viewmodel, data, afterAct)\n    }\n  }\n\n  const editTree = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const treeModel = viewmodel.getTreeModel()\n    if (!treeModel || !params) return\n    if (!params.cTarget) {\n      console.log('tree billnumber ,commendtarget')\n      return\n    }\n    const node = _getTreeSelectNode(viewmodel)\n    if (node) {\n      const para = {}\n      para.detailId = node[treeModel.getState('keyField')];\n      const postData = cb.utils.extend(true, para, {\n        mode: env.VOUCHER_STATE_EDIT\n      })\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      beforeAct(beforeActData, function () {\n        const dt = {\n          billtype: 'voucherlist',\n          billno: params.cTarget,\n          params: postData\n        }\n        cb.loader.runCommandLine('bill', dt, viewmodel)\n        afterAct()\n      })\n    }\n  }\n\n  const moveUp = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const treeModel = viewModel.getTreeModel();\n    if (!treeModel) return;\n    const selectedNodes = treeModel.getSelectedNodes();\n    if (!selectedNodes.length) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const selectNode = selectedNodes[0];\n    if (treeModel.isFirst(selectNode)) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const keyField = treeModel.getState('keyField');\n    const data = {\n      billnum: billNo,\n      action: params.cAction,\n      id: selectNode[keyField]\n    };\n    const beforeActData = {\n      params,\n      data\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success');\n          viewModel.execute('back');\n        }\n        const afterActData = {\n          err,\n          res\n        };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, data);\n    });\n  }\n\n  const moveDown = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const treeModel = viewModel.getTreeModel();\n    if (!treeModel) return;\n    const selectedNodes = treeModel.getSelectedNodes();\n    if (!selectedNodes.length) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const selectNode = selectedNodes[0];\n    if (treeModel.isLast(selectNode)) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const keyField = treeModel.getState('keyField');\n    const data = {\n      billnum: billNo,\n      action: params.cAction,\n      id: selectNode[keyField]\n    };\n    const beforeActData = {\n      params,\n      data\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success');\n          viewModel.execute('back');\n        }\n        const afterActData = {\n          err,\n          res\n        };\n        afterAct(afterActData, common.afterAct);\n      };\n      common.doProxy(params, callback, data);\n    });\n  }\n\n  const pull = function (billNo, viewModel, params, beforeAct, afterAct) {\n    let pullBillNo, query;\n    try {\n      query = JSON.parse(params.cmdParameter);\n      pullBillNo = query.billnumber;\n      delete query.billnumber;\n    } catch (e) {\n      console.error('pull action parameter error: ' + e.message);\n    }\n    if (!pullBillNo) return;\n    const postData = {\n      source: 'pull',\n      query,\n    };\n    cb.loader.runCommandLine('bill', {\n      billtype: 'voucherlist',\n      billno: pullBillNo,\n      params: postData\n    }, viewModel);\n  }\n\n  const pullx = function (billNo, viewModel, params, beforeAct, afterAct) {\n    common.pull(viewModel, params);\n  }\n\n  const singlePush = (billNo, viewModel, params, beforeAct, afterAct) => {\n    if (!params) return;\n    const rowIndex = params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    const data = gridModel.getNecessaryDataForRows([currentRow]);\n    Object.assign(data[0], {\n      id: currentRow.id,\n      pubts: currentRow.pubts\n    });\n    let key;\n    const sumSwitchModel = viewModel.get('sumSwitch');\n    if (sumSwitchModel)\n      key = sumSwitchModel.getState('sumSwitchKey');\n    params.pushKey = key;\n    common.push(viewModel, params, data, beforeAct, afterAct);\n  };\n  const batchPush = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const gridModel = viewModel.getGridModel()\n    const selectDatas = gridModel.getSelectedRows();\n    if (!selectDatas.length) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    const data = gridModel.getNecessaryDataForRows(selectDatas);\n    selectDatas.forEach((row, index) => {\n      if (row.id && row.pubts) {\n        Object.assign(data[index], {\n          id: row.id,\n          pubts: row.pubts\n        });\n      }\n    });\n    let key;\n    const sumSwitchModel = viewModel.get('sumSwitch');\n    if (sumSwitchModel)\n      key = sumSwitchModel.getState('sumSwitchKey');\n    params.pushKey = key;\n    common.push(viewModel, params, data, beforeAct, afterAct);\n  }\n  const copy = (billNo, viewModel, params, beforeAct, afterAct) => {\n    if (!params) return;\n    const rowIndex = params.params && params.params.index;\n    if (rowIndex == null) return;\n    const gridModel = viewModel.getGridModel();\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    common.copy(viewModel, params, currentRow.id, beforeAct, afterAct);\n  };\n\n  // \n  const push = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    const targetCode = queryString.get('code')\n    const gridModel = viewmodel.getGridModel()\n    const ids = _getSelectRowIds(gridModel)\n    if (!ids || ids.length == 0) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    if (targetCode) {\n      const queryData = {\n        code: targetCode,\n        isMainSelect: 1,\n        childIds: ids\n      }\n      const par = {\n        cSvcUrl: queryString.pathname + queryString.toStr(),\n        cHttpMethod: params.cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: queryData\n      }\n      beforeAct(beforeActData, function () {\n        const callback = function (err, res) {\n          if (!err) {\n\n          }\n          const afterActData = {\n            err: err,\n            res: res\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        common.doProxy(par, callback, queryData)\n      })\n    }\n  }\n\n  const queryAsyncProcess = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const { asyncKey, asyncInterval = 1, btnCallBack, fileSize, fileName, url, asyncName = '', refresh = true } = params;\n\n    const curTime = cb.utils.getNowFormatDate();\n    const busName = viewModel.getParams() && (viewModel.getParams().name || viewModel.getParams().caption);\n    const asyncParams = { asyncKey, fileSize, fileName, curTime, busName, percentage: 0, asyncData: '{}', url, asyncName, refresh };\n    viewModel.communication({\n      type: 'asyncImport',\n      payload: asyncParams\n    });\n    const _timer = setInterval(() => {\n      asyncImportQuery(viewModel, asyncParams, btnCallBack);\n    }, asyncInterval * 1000);\n    viewModel.setCache(asyncKey, _timer);\n    cb.utils.alert(asyncName + '');\n  }\n\n  const output = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const format = queryString.has('type') ? queryString.get('type') : 'pdf'\n    const inputParams = {\n      format: format,\n      type: 'voucherlist',\n      bill: {\n        page: {\n          pageSize: gridModel.getPageSize(),\n          pageIndex: gridModel.getPageIndex()\n        },\n        billnum: billNo\n      }\n    }\n\n    const url = env.HTTP_OUTPUT_BILL\n    const beforeActData = {\n      params: params,\n      data: inputParams\n    }\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, inputParams)\n      afterAct()\n    })\n  }\n  const handleAsyncImportOver = (viewModel, asyncParams, errStr) => {\n    const _timer = viewModel.getCache(asyncParams.asyncKey);\n    viewModel.clearCache(asyncParams.asyncKey);\n    _timer && clearTimeout(_timer);\n    if (errStr) {\n      cb.utils.alert(errStr);\n      asyncParams.bDelTask = true;\n      asyncParams.errStr = errStr;\n      viewModel.communication({\n        type: 'asyncImport',\n        payload: asyncParams\n      });\n    }\n  }\n  const asyncImportQuery = (viewModel, asyncParams, btnCallBack) => {\n    const asyncKey = asyncParams.asyncKey;\n    const url = asyncParams.url || 'billtemp/getImportProcess?';\n    const proxy = cb.rest.DynamicProxy.create({\n      getImportProcess: {\n        url: url,\n        method: 'GET',\n        options: { mask: false }\n      }\n    })\n\n    proxy.getImportProcess({ asyncKey: asyncKey }, function (err, result) {\n      let errStr = '';\n      if (err) {\n        errStr = err.message;\n        handleAsyncImportOver(viewModel, asyncParams, errStr);\n        return;\n      }\n      if (result) {\n        let res;\n        try {\n          res = JSON.parse(result);\n        }\n        catch (e) {\n          errStr = ',' + result;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n          return;\n        }\n        const percentage = parseFloat(res.percentage || '0');\n        if (res.flag == '0') {\n          errStr = '';\n          if (res.data)\n            errStr = errStr + ',' + res.data;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n        }\n        else if (res.flag == 1 && percentage >= 100) {\n          handleAsyncImportOver(viewModel, asyncParams);\n          if (asyncParams.refresh) {\n            viewModel.execute('refresh');\n          }\n          viewModel.execute('openNotification', Object.assign({ res: res.data }, asyncParams));\n        }\n        asyncParams.asyncData = result;\n        asyncParams.percentage = percentage;\n        viewModel.communication({\n          type: 'asyncImport',\n          payload: asyncParams\n        });\n      }\n    });\n  }\n\n  const importVoucher = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const btnCallBack = {\n      disabledCallback: params.disabledCallback,\n      enabledCallback: params.enabledCallback\n    }\n    params.disabledCallback = false;\n    params.enabledCallback = false;\n    const beforeActData = { params, data: {} };\n    let isAsync = false;\n    let asyncInterval = 1;\n    const asyncKey = 'asyncImport_' + cb.utils.getNewGuid().replace(/-/g, '');\n    let acceptedFileType = ''\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      if (cParameter) {\n        isAsync = cParameter.isAsync;\n        asyncInterval = cParameter.interval || asyncInterval;\n        acceptedFileType = cParameter.acceptedFileType || ''\n      }\n    }\n    // isAsync = true;\n    beforeAct(beforeActData, function () {\n      const eleInput = document.createElement('input');\n      eleInput.type = 'file';\n      if (acceptedFileType) {\n        eleInput.accept = acceptedFileType // \n      }\n      eleInput.style.display = 'none';\n      eleInput.onchange = function (e) {\n        cb.utils.loadingControl.start('...');\n        btnCallBack.disabledCallback && btnCallBack.disabledCallback();\n        const formData = new FormData();\n        formData.enctype = 'multipart/form-data';\n        const file = e.target.files[0];\n        const fileName = file && file.name;\n        const fileSize = file && file.size;\n\n        formData.append('file', file);\n        if (beforeActData.data.mapCondition)\n          formData.append('mapCondition', JSON.stringify(beforeActData.data.mapCondition));\n        const xhr = new XMLHttpRequest();\n        let url = `${params.cSvcUrl}?billnum=${common.getVmParams(viewModel, 'cardKey')}`;\n        try {\n          if (common.getVmParams(viewModel, 'cardKey') === 'bd_staff_card') {\n            url = `${params.cSvcUrl}?billnum=${beforeActData.data.mapCondition.billnum}`;\n          }\n        } catch (error) {\n          console.error(error)\n        }\n        // Frame \n        const serviceCode = viewModel.getState('serviceCode') || cb.rest.AppContext.query.serviceCode\n        if (serviceCode) {\n          // formData.append('externalData', JSON.stringify({serviceCode:viewModel.getState('serviceCode')}));\n          url = url + '&serviceCode=' + serviceCode\n        }\n        if (isAsync) {\n          url = url + '&asyncKey=' + asyncKey;\n        }\n        const _url = window._baseUrl ? `${window._baseUrl}${url}` : url;\n        xhr.open('POST', _url, true);\n        xhr.send(formData);\n        if (isAsync) {\n          btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n          xhr.onreadystatechange = function () {\n            cb.utils.loadingControl.end();\n            let bError = false;\n            let errorInfo = '';\n            if (xhr.readyState !== 4) return;\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                bError = true;\n                errorInfo = ',' + xhr.responseText;\n              }\n              if (ajaxResult && ajaxResult.code === 200) {\n              } else {\n                bError = true;\n                errorInfo = `${ajaxResult.message}`;\n              }\n            }\n            else if (xhr.status == 0) {\n              bError = true;\n              errorInfo = 'offline';\n            }\n            else {\n              bError = true;\n              errorInfo = ' xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText;\n            }\n            if (bError) {\n              // let _timer = viewModel.getCache(asyncKey);\n              // viewModel.clearCache(asyncKey);\n              // _timer && clearTimeout(_timer);\n              cb.utils.alert(errorInfo);\n            }\n            else {\n              const queryParams = {\n                asyncKey, asyncInterval, btnCallBack, fileSize, fileName, asyncName: params.cShowCaption\n              }\n              if (!viewModel.execute('beforeQueryAsyncProcess', {billNo, viewmodel: viewModel, queryParams})) return false\n              queryAsyncProcess(billNo, viewModel, queryParams);\n            }\n          };\n        }\n        else {\n          xhr.onreadystatechange = function () {\n            cb.utils.loadingControl.end();\n            if (xhr.readyState !== 4) return;\n            btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                cb.utils.alert(',' + xhr.responseText);\n                return;\n              }\n              if (ajaxResult && ajaxResult.code === 200) {\n                const res = ajaxResult.data;\n                if (res.sucessCount)\n                  viewModel.execute('refresh');\n                viewModel.communication({\n                  type: 'modal',\n                  payload: {\n                    key: 'BatchMsg',\n                    data: {\n                      type: 2,\n                      res\n                    }\n                  }\n                });\n              } else {\n                cb.utils.alert(`${ajaxResult.message}`, 'error');\n              }\n            }\n            else {\n              console.log(' xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText);\n            }\n          };\n        }\n        document.body.removeChild(eleInput);\n      }\n      document.body.appendChild(eleInput);\n      eleInput.click();\n    });\n  }\n\n  const exportVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = {\n      billnum: common.getVmParams(viewModel, 'cardKey'),\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      if (!postData.fileName) {\n        const fileName = viewModel.getParams().caption\n        if (fileName) {\n          postData.fileName = `${fileName}`\n        }\n      }\n      common.createDownloadForm(url, beforeActData.data);\n      afterAct();\n    });\n  }\n\n  const exportStaticVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const openUrl = params && params.cSvcUrl;\n    if (!openUrl) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    const beforeActData = { params };\n    beforeAct(beforeActData, function () {\n      window.open(openUrl);\n      afterAct();\n    });\n  }\n\n  const exportReport = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const isSum = viewModel.getCache('isSum');\n    const gridModel = viewModel.getGridModel();\n    if (gridModel) {\n      const rowsCount = gridModel.getRowsCount();\n      if (!rowsCount) {\n        cb.utils.alert('', 'error');\n        return;\n      }\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = Object.assign({\n      billnum: billNo || common.getVmParams(viewModel, 'cardKey'),\n      groupSchemaId: viewModel.getCache('groupSchemaId')\n    }, viewModel.getParams().query, viewModel.getCache('lastSearchCondition'));\n    delete postData.showSearch;\n    if (isSum != null)\n      postData.isSum = isSum\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, postData);\n      afterAct();\n    });\n  }\n\n  const subscribeMessage = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'MessageSubscribe',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n\n  const batchOutputVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let key;\n    const sumSwitchModel = viewmodel.get('sumSwitch');\n    if (sumSwitchModel)\n      key = sumSwitchModel.getState('sumSwitchKey');\n    const gridModel = viewmodel.getGridModel()\n\n    const postData = { billnum: billNo };\n    if (key)\n      postData.key = gridModel.getColumnState(key, 'cFieldName');\n    const isSum = viewmodel.getCache('isSum');\n    if (isSum != null)\n      postData.isSum = isSum;\n    if (gridModel) {\n      const selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length == 0) {\n        cb.utils.alert('', 'warning')\n        return\n      }\n      /* add by jinzh1    2000 */\n      if (selectDatas.length > 2000) {\n        cb.utils.alert('2000,', 'warning')\n        return\n      }\n      const data = []\n      selectDatas.forEach(function (row) {\n        if (key) {\n          data.push(row[key]);\n        } else if (row.id && row.pubts) {\n          data.push(row.id)\n        }\n      }, this)\n      postData.ids = data.join();\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl);\n    queryString.set('serviceCode', cb.rest.AppContext.query.serviceCode || '')\n    const url = queryString && queryString.pathname + queryString.toStr()\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      if (!postData.fileName) {\n        const fileName = viewmodel.getParams().caption\n        if (fileName) {\n          postData.fileName = fileName\n        }\n      }\n\n      common.createDownloadForm(url, postData)\n      afterAct()\n    })\n  }\n\n  const print = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    if (!gridModel) {\n      return\n    }\n    const pageSize = gridModel.getPageSize()\n    const pageIndex = gridModel.getPageIndex()\n    const postData = {\n      json: {\n        bill: {\n          page: {\n            pageSize: pageSize,\n            pageIndex: pageIndex\n          },\n          billnum: billNo\n        },\n        type: 'voucherlist',\n        token: true\n      }\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n  const preview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      const template = viewmodel.get('templates').getValue();\n      if (!template) {\n        cb.utils.alert('', 'warning');\n        return;\n      }\n      const newTab = window.open('about:blank');\n      const proxy = cb.rest.DynamicProxy.create({\n        preview: { url: 'print/printPreview', method: 'POST' }\n      })\n      const ids = _getSelectRowIds(viewmodel.getGridModel())\n      const condition = viewmodel.getCache('lastSearchCondition') ? JSON.stringify(viewmodel.getCache('lastSearchCondition').condition) : null;\n      const args = {\n        route: params.cSvcUrl || '/bill',\n        billno: billNo,\n        template: template,\n        ids: ids,\n        condition: condition\n      };\n      proxy.preview(args, function (err, result) {\n        if (!err) {\n          const random = uuid();\n          const queryString = new cb.utils.queryString(result);\n          queryString.set('random', random);\n          queryString.set('params', null);\n          queryString.set('lang', cb.rest.AppContext.user && cb.rest.AppContext.user.locale || 'zh_CN');\n          newTab.location.href = queryString.pathname + decodeURIComponent(queryString.toStr());\n          window.addEventListener('message', (event) => {\n            if (event.data.key === 'context' && event.data.random === random) {\n              args.tenantId = queryString.get('tenantId');\n              newTab.postMessage({ key: 'params', value: args }, event.origin);\n            }\n          }, false);\n        }\n        const afterActData = {\n          err: err,\n          res: result\n        };\n        afterAct(afterActData, common.afterAct);\n      });\n    });\n  }\n  const batchPrintVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const gridModel = viewmodel.getGridModel()\n    const ids = _getSelectRowIds(gridModel)\n    if (!ids || ids.length == 0) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    const postData = {\n      json: {\n        bill: {\n          billnum: common.getVmParams(viewmodel, 'cardKey'),\n          ids: ids,\n          tplid: printID\n        },\n        type: 'voucher'\n      }\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n\n  // \n  const printPreview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      const gridModel = viewmodel.getGridModel()\n      // if (!gridModel) {\n      //     return\n      // }\n      const { currentParams, url } = common.getPrintParamers(params, 'preview', viewmodel);\n      if (!currentParams)\n        return false;\n      // \n      const selectedRow = (gridModel && gridModel.getSelectedRows()) || [];\n      if (selectedRow.length > 500) {\n        cb.utils.confirm('', function () {\n          common.printNow(params, viewmodel);\n        }, function () {\n          _morePrintPreview(currentParams, url);\n        });\n      } else {\n        _morePrintPreview(currentParams, url);\n      }\n      // \n\n      afterAct()\n    })\n  }\n  const _morePrintPreview = (currentParams, url) => {\n    const urlParams = common.combineParams(currentParams);\n    if (urlParams.length > 2000) {\n      const proxy = cb.rest.DynamicProxy.create({\n        cacheData: { url: '/cachePrint', method: 'post', options: { uniform: false } }\n      })\n      const newUrlParams = JSON.stringify(currentParams.params);\n      proxy.cacheData({ param: newUrlParams }, function (_err, rs) {\n        if (rs) {\n          currentParams.sendType = 7;\n          currentParams.params = rs.key;\n          const newTempUrlParams = common.combineParams(currentParams);\n          window.open(url + newTempUrlParams, '_blank')\n        }\n      });\n    } else {\n      window.open(url + urlParams, '_blank')\n    }\n  }\n  // \n  const printDesign = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      // let gridModel = viewmodel.getGridModel()\n      // if (!gridModel) {\n      //     return\n      // }\n      const { currentParams, url } = common.getPrintParamers(params, 'design', viewmodel);\n      window.open(url + common.combineParams(currentParams), '_blank')\n    })\n  }\n\n  // \n  const printNow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      common.printNow(params, viewmodel);\n      afterAct()\n    })\n  }\n  const savebo = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const proxy = cb.rest.DynamicProxy.create({\n      saveBo: { url: 'print/saveBo', method: 'GET' }\n    })\n    proxy.saveBo({ billno: billNo }, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      cb.utils.alert('', 'success');\n    });\n  }\n  const doDelete = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const node = _getTreeSelectNode(viewmodel)\n    if (!node) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    if (node && node.children && node.children.length > 0) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    const data = viewmodel.getNecessaryData()\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      cb.utils.confirm('', function () {\n        common.doProxy(params, function (err, suc) {\n          if (!err) {\n            const treeModel = viewmodel.getTreeModel()\n            if (treeModel) {\n              const key = treeModel.getSelectedKeys()\n              if (key && key.length == 1) {\n                treeModel.deleteNode(key)\n                // viewmodel.clear()\n                common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n                // _render(viewmodel);\n                viewmodel.biz.do('add', viewmodel);\n              }\n            }\n            cb.utils.alert('', 'success')\n          }\n          const afterActData = {\n            err: err,\n            res: suc\n          }\n          afterAct(afterActData, common.afterAct)\n        }, postData)\n      })\n    })\n  }\n\n  const localPrint = function (billNo, viewModel, params, beforeAct, afterAct) {\n    if (viewModel.getParams().billType === 'Report') {\n      localPrintReport(billNo, viewModel, params, beforeAct, afterAct);\n      return;\n    }\n    const id = viewModel.get('id') && viewModel.get('id').getValue();\n    const code = viewModel.get('code') && viewModel.get('code').getValue();\n    if (cb.utils.isEmpty(id) && cb.utils.isEmpty(code)) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    const cardKey = common.getVmParams(viewModel, 'cardKey');\n    if (cb.utils.isEmpty(cardKey)) {\n      cb.utils.alert('cCardKey', 'error');\n      return;\n    }\n    const proxy = cb.rest.DynamicProxy.create({\n      getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } },\n      print: { url: 'bill/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    proxy.getTemplate({ billno: cardKey }, function (err, data) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      const templateCode = data.length === 1 ? data[0] : data.find(item => {\n        return item.isdefault;\n      });\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('', 'error');\n        return;\n      }\n      const params = { billno: cardKey, templateCode: templateCode.templatecode };\n      if (code)\n        params.code = code;\n      else\n        params.ids = [id];\n      proxy.print(params, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        beforeAct(result, function () {\n          cb.utils.localPrint(result);\n        });\n      });\n    });\n  }\n\n  const sumSwitch = function (billNo, viewModel, params, beforeAct, afterAct) {\n    viewModel.setCache('isSum', viewModel.get('sumSwitch').getValue() || null);\n    refresh(billNo, viewModel, { isIncludeMeta: true }, beforeAct, afterAct);\n  }\n\n  const localPrintReport = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const proxy = cb.rest.DynamicProxy.create({\n      getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } },\n      print: { url: 'report/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    proxy.getTemplate({ billno: billNo }, function (err, data) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      const templateCode = data.length === 1 ? data[0] : data.find(item => {\n        return item.isdefault;\n      });\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('', 'error');\n        return;\n      }\n      const lastSearchCondition = viewModel.getCache('lastSearchCondition');\n      const condition = lastSearchCondition ? JSON.stringify(lastSearchCondition.condition) : null;\n      const params = { billno: billNo, templateCode: templateCode.templatecode, condition, route: '/report/bill' };\n      proxy.print(params, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        beforeAct(result, function () {\n          cb.utils.localPrint(result);\n        });\n      });\n    });\n  }\n  const batchModify = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'batchModify',\n        data: {\n          billType: 'list',\n          billNo: billNo,\n          model: viewModel,\n          params: params\n        }\n      }\n    });\n  }\n\n  const jointquery = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const cardKey = common.getVmParams(viewmodel, 'cardKey')\n    if (!cardKey) {\n      cb.utils.alert('cCardKey', 'warning')\n      return\n    }\n    const data = {\n      params: { editType: 'jointquery' },\n      parentViewModel: viewmodel,\n      billNum: cardKey,\n      billId: viewmodel.getGridModel().getRow(params.params.index).id\n    };\n    viewmodel.communication({\n      payload: {\n        title: '',\n        type: 'platform',\n        url: 'voucher-search/ShowFlow',\n        // url: 'voucher-search/useShowFlow',\n        checkReturn: true,\n        modal: viewmodel,\n        data: data\n      }\n    });\n  }\n\n  const workflow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel();\n    const rowIndex = params && params.params && params.params.index;\n    if (rowIndex == null) return;\n    if (!gridModel) return;\n    const currentRow = gridModel.getRow(rowIndex);\n    if (!currentRow) return;\n    if (!currentRow.isWfControlled || currentRow.verifystate === 0) { // \n      cb.utils.alert('', 'warning')\n      return;\n    }\n    const cardKey = common.getVmParams(viewmodel, 'cardKey');\n    let businessKey = `${cardKey}_${currentRow.id}`;\n    if (!cardKey) {\n      businessKey = `${billNo}_${currentRow.id}`;\n    }\n    const data = {\n      width: 850,\n      height: 510,\n      appsource: env.appCode,\n      businessKey\n    };\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      const flowCompIns = window.flowComp(data);\n      flowCompIns.showFlowBox({\n        onClose (callbackData) {\n          if (process.env.__THEMETYPE__ == 'ncc') {\n            const queryItems = viewmodel.getCache('queryItems') || [];\n            queryItems.forEach(item => {\n              const field = item.replace(/(\\w)/, function (v) {\n                return v.toUpperCase()\n              }) // \n              viewmodel.setCache(`exec${field}`, true)\n            });\n            refresh(billNo, viewmodel);\n          } else {\n            viewmodel.execute('back');\n          }\n        }\n      });\n    });\n  }\n\n  const doCommunication = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    common.doCommunication(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  // diwork\n  const openReport = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const getParamsUrl = (url) => {\n      const urlParams = new URL(url);\n      if (!urlParams.searchParams.has('_condition_')) {\n        const lastSearchCondition = viewmodel.getCache('lastSearchCondition');\n        if (lastSearchCondition && lastSearchCondition.condition) {\n          urlParams.searchParams.set('_condition_', encodeURI(JSON.stringify(lastSearchCondition.condition)));\n        }\n      }\n      const locale = cb.rest.AppContext.globalization && cb.rest.AppContext.globalization.locale || 'zh_CN';\n      urlParams.searchParams.set('locale', locale);\n      return urlParams.toString();\n    }\n\n    console.log('REPORT_SERVER:' + env.HTTP_REPORT_SERVER_URL);\n    const serviceCode = cb.rest.AppContext.query.serviceCode;\n    if (!env.HTTP_REPORT_SERVER_URL) return cb.utils.alert('', 'warning');\n    const url = env.HTTP_REPORT_SERVER_URL + '/analysis_server/analysis/lightAnalysis/open/' + billNo;\n    if ((window.parent !== window) && window.jDiwork && serviceCode) {\n      window.jDiwork.getData({serviceCode}, args => {\n        const targetParams = {\n          title: args.iframeTitle + '-',\n          code: billNo,\n          url: getParamsUrl(url)\n        };\n        beforeAct(targetParams, () => {\n          window.jDiwork.openService(serviceCode, {}, targetParams,\n            args => {\n              afterAct(args);\n            }\n          );\n        });\n      })\n    } else {\n      window && window.open(getParamsUrl(url));\n    }\n  }\n\n  const batchFlowPush = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = viewmodel.getGridModel()\n    const selectDatas = gridModel.getSelectedRows();\n    if (!selectDatas.length) {\n      cb.utils.alert('', 'warning')\n      return\n    }\n    const data = gridModel.getNecessaryDataForRows(selectDatas);\n    common.bizflowpush(billNo, viewmodel, params, beforeAct, afterAct, data);\n  }\n\n  const stateRule = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    staterule.runRules(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n\n  const scan = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    mtlScan(billNo, viewmodel, params, beforeAct, afterAct);\n  };\n  const share = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    mtlShare(billNo, viewmodel, params, beforeAct, afterAct)\n  };\n\n  const newadd = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const cCardKey = common.getVmParams(viewmodel, 'cardKey');\n    cb.route.pushPage(`/view/yyarchive/${cCardKey}MobileArchive`)\n  };\n  const newback = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    cb.route.goBack()\n  };\n\n  return {\n    init: function (billNo, params, viewCallback) {\n      if (!cb.extendConfig) {\n        cb.extendConfig = {};\n      }\n      const initCallback = (err, result) => {\n        // const vmAndview =\n        common.initVM(err, result, billNo, params, function (vm, view) {\n          delete vm.getParams().query.isSum;\n          const isSum = params && params.query && Boolean(params.query.isSum);\n          if (isSum)\n            vm.setCache('isSum', isSum);\n          const reportId = params && params.reportId;\n          if (reportId)\n            params.query.reportId = reportId;\n          const data = {\n            vm,\n            view\n          }\n          vm.promiseExecute('afterLoadMeta', data, function () {\n            const parentModel = vm.get('parent_name');\n            if (parentModel instanceof cb.models.ReferModel) {\n              const maxLevel = parentModel.getState('maxLevel');\n              const level = maxLevel === false ? 65536 : (maxLevel || 3);\n              parentModel.setState('maxLevel', level);\n            }\n            // \n            const gridModel = vm.getGridModel();\n            gridModel && gridModel.on('afterInsertRow', () => {\n              common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n              staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n            });\n            viewCallback(vm, view, view.cBillName)\n            _initPage(vm, billNo)\n            /*  */\n            const sumSwitchModel = vm.get('sumSwitch');\n            if (sumSwitchModel) {\n              const crossPageSelect = sumSwitchModel.getState('crossPageSelect');\n              if (crossPageSelect) {\n                const sumSwitchKey = sumSwitchModel.getState('sumSwitchKey');\n                if (!cb.utils.isEmpty(sumSwitchKey))\n                  gridModel.setState('rowKeyField', sumSwitchKey);\n                else\n                  gridModel.setState('rowKeyField', 'id');\n              }\n            }\n\n            if (env.USESTATERULE) {\n              vm.getCache('FilterViewModel') && vm.getCache('FilterViewModel').on('afterInit', function () {\n                vm.biz.do('staterule', vm)\n              })\n            }\n            // vm.execute('afterMount')\n          })\n        }, function (vm) {\n          if (vm.getParams().billType === 'Report' && vm.getParams().filterId && !vm.getParams().condition)\n            vm.getParams().autoLoad = false;\n          const model = vm.getGridModel();\n          if (model) {\n            const { billType } = vm.getParams();\n            const userId = (cb.rest.AppContext.user || {}).id;\n            const billTypes = ['Report', 'VoucherList', 'ArchiveList', 'TreeList'];\n            // \n            if (!['VoucherList', 'ArchiveList'].includes(billType)) {\n              model.setState('delayLoadPageInfo', false);\n            }\n            if (billTypes.indexOf(billType) > -1 && billNo && userId) {\n              const localDataKey = `${billNo}_${userId}`;\n              let curData;\n              common.getCacheFromIndexDB(localDataKey, function (result) {\n                curData = result;\n                if (curData) {\n                  for (const key in curData) {\n                    if (key != 'indexedDB_id' && key != 'pageSize') model.setColumnState(key, 'iColWidth', curData[key]);\n                  }\n                  if (curData.pageSize && model.get('pageInfo'))\n                    model.get('pageInfo').pageSize = curData.pageSize;\n                }\n                vm.initData()\n              })\n              model.on('pageInfoChange', function (pageInfo) {\n                const size = pageInfo.pageSize;\n                if (!curData) curData = { indexedDB_id: localDataKey };\n                curData.pageSize = size;\n                cb.indexDB.IDB_saveData(curData, 'billInfo', 'cacheInfo');\n              });\n              model.on('colWidthResize', args => {\n                const { columnKey, width } = args;\n                if (!curData) curData = { indexedDB_id: localDataKey };\n                curData[columnKey] = width;\n                cb.indexDB.IDB_saveData(curData, 'billInfo', 'cacheInfo');\n              });\n              model.on('colWidthReturn', args => {\n                curData = { id: localDataKey, dbTableName: 'billInfo', dbName: 'cacheInfo'};\n                cb.indexDB.IDB_deleteOneData(curData);\n              })\n            } else {\n              vm.initData()\n            }\n          } else {\n            vm.initData()\n          }\n          vm.on('refresh', function () {\n            refresh(billNo, vm);\n          });\n          vm.on('back', function (args) {\n            const gridModel = vm.getGridModel();\n            // \n            const allGridmodel = vm.getGridModels();\n            for (let i = 1; i < allGridmodel.length; i++) {\n              allGridmodel[i].clear();\n            }\n            if (!gridModel) {\n              if (cb.extendConfig.theme == 'ncc') {\n                // \n                if (!_validateMustInput(vm) || !vm.getCache('lastSearchCondition')) {\n                  return;\n                }\n              }\n              queryTree(billNo, vm, vm.getCache('lastSearchCondition'), null, function () {\n                if (!args) return;\n                vm.getTreeModel().doPropertyChange('setExpandRow', { rowKey: args, isExpand: true });\n              });\n              return;\n            }\n            if (args) {\n              let cParameter = {};\n              if (args.cParameter) {\n                try {\n                  cParameter = JSON.parse(args.cParameter);\n                  if (cParameter.type === 'tree') {\n                    vm.biz.do('queryTree', vm);\n                    return\n                  }\n                } catch (e) { }\n              }\n            }\n            if (cb.rest.interMode === 'touch' || cb.rest.terminalType == '3') {\n              const backData = gridModel.getCache('backData');\n              if (!backData) {\n                refresh(billNo, vm);\n                return;\n              }\n              gridModel.clearCache('backData');\n              const configParams = vm.allActions && vm.allActions.find(x => {\n                return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdlist'\n              });\n              const proxyParams = configParams && configParams.cSvcUrl ? {\n                url: configParams.cSvcUrl,\n                method: configParams.cHttpMethod || 'POST',\n                options: { mask: true }\n              } : {\n                url: 'bill/list',\n                method: 'POST',\n                options: { mask: true }\n              };\n              const proxy = cb.rest.DynamicProxy.create({ queryData: proxyParams });\n              const params = {\n                billnum: billNo,\n                page: { pageSize: gridModel.getPageSize(), pageIndex: 1 },\n                condition: {\n                  isExtend: true,\n                  simpleVOs: [\n                    { field: 'id', op: 'eq', value1: backData.id }\n                  ]\n                }\n              };\n              proxy.queryData(params, function (_err, result) {\n                if (result && result.recordList && result.recordList.length) {\n                  gridModel.updateRow(backData.rowIndex, result.recordList[0]);\n                  common.setGridActionStates(gridModel, vm);\n                  staterule.runGridActionStates(gridModel, vm);\n                }\n              });\n            } else {\n              gridModel.setPageIndex(gridModel.getPageIndex(), true);\n            }\n          });\n          const returnPromise = new cb.promise();\n          vm.on('return', function (caption) {\n            if (common.getMode(vm) === env.VOUCHER_STATE_BROWSE || !vm.getDirtyData(false)) {\n              const portal = vm.getRudux('portal');\n              if (portal && _.isEmpty(portal.asyncImportArr) == false) {\n                caption.prompt = { msg: '' };\n              }\n              return true;\n            }\n\n            if (caption && typeof caption === 'object') {\n              caption.prompt = {};\n              return true;\n            }\n            cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026058', {abandonText: caption}), function () {\n              returnPromise.resolve();\n            }, function () {\n              returnPromise.reject();\n            });\n            return returnPromise;\n          });\n        }, function () {\n          common.fetchMeta(billNo, params, initCallback)\n        })\n      }\n      common.fetchMeta(billNo, params, initCallback)\n    },\n    do: function (act, viewmodel, params) {\n      common.todo(this, act, viewmodel, params)\n    },\n    action: function () {\n      //  yueming\n      let voucherListExtend = {}\n      try {\n        voucherListExtend = cb.extendConfig.voucherListExtendConfig;\n      } catch (error) {\n        console.log(error);\n        voucherListExtend = {}\n      }\n      const voucherAction = {\n        newadd: newadd,\n        newback: newback,\n        scan: scan,\n        share: share,\n        doservice: _doService,\n        copy: copy,\n        open: open,\n        close: close,\n        save: save,\n        add: add,\n        push: push,\n        singlepush: singlePush,\n        edit: edit,\n        dblclick: dblClick,\n        abandon: abandon,\n        delete: doDelete,\n        batchdelete: batchDelete,\n        batchaudit: batchDo,\n        batchunaudit: batchDo,\n        batchsubmit: batchDo,\n        batchunsubmit: batchDo,\n        batchdo: batchDo,\n        search: search,\n        refresh: refresh,\n        output: output,\n        batchoutput: batchOutputVoucher,\n        batchimport: importVoucher,\n        tempexport: exportVoucherTemplate,\n        statictempexport: exportStaticVoucherTemplate,\n        reportexport: exportReport,\n        messagesubscribe: subscribeMessage,\n        print: print,\n        batchprint: batchPrintVoucher,\n        check: check4List,\n        columnsetting: common.columnsetting,\n        edittree: editTree,\n        querytree: queryTree,\n        moveup: moveUp,\n        movedown: moveDown,\n        commandLine: common.commandLine,\n        switchgroupschema: switchGroupSchema,\n        savebo: savebo,\n        preview: preview,\n        localprint: localPrint,\n        batchpush: batchPush,\n        sumswitch: sumSwitch,\n        pull: pull,\n        pullx: pullx,\n        jointquery: jointquery,\n        batchmodify: batchModify,\n        printpreview: printPreview, // \n        printdesign: printDesign, // \n        workflow: workflow,\n        printnow: printNow, // \n        asyncprocess: queryAsyncProcess, // Process,\n        openpage: doCommunication, // \n        openreport: openReport, // \n        goback: doCommunication, // \n        attachment: attachment, // \n        billsetting: common.openBillModal,\n        staterule: stateRule, // \n        autocomplete: common.autoComplete, // \n        customdo: common.customDo,\n        bizflowbatchpush: batchFlowPush\n      }\n      return Object.assign(voucherAction, voucherListExtend);\n    }\n  }\n})()\n\ncb.namespace('biz.common')\ncb.biz.common.voucherlist = voucherlist\n\nexport default voucherlist\n"],"sourceRoot":""}