{"version":3,"sources":["webpack:///./node_modules/@mdf/cube/src/bizmodel/mtlapi.js","webpack:///./node_modules/@mdf/cube/src/staterule/formularule.js","webpack:///./node_modules/@mdf/cube/src/bizmodel/voucher_M.ts","webpack:///./node_modules/@mdf/cube/src/bizmodel/voucher.js"],"names":["_getParams","params","data","cParameter","JSON","parse","_showPrompt","result","platform","cb","utils","alert","console","log","mtlScan","billNo","viewmodel","beforeAct","afterAct","newParams","needResult","parseInt","scanType","Array","isArray","scanQRCode","success","res","resultStr","invoker","publish","action","fail","err","message","mtlShare","upesn","showShareMenu","mtlPlatform","mtlNetworkType","getNetworkType","networkType","mtlGetMac","getMac","macAddress","mtlDail","dail","mtlChooseImage","count","sourceType","chooseImage","localIds","mtlGetLocation","getLocation","mtlOpenLocation","openLocation","mtlGenerateQRCode","generateQRCode","mtlRequest","headers","e","request","mtlStartRecord","startRecord","mtlStopRecord","stopRecord","mtlPlayVoice","playVoice","mtlPauseVoice","pauseVoice","mtlStopVoice","stopVoice","mtlChangeScreenOrientation","changeScreenOrientation","mtlRestoreScreenOrientation","restoreScreenOrientation","mtlSetStorage","setStorage","mtlGetStorage","getStorage","mtlRemoveStorage","removeStorage","mtlClearStorage","clearStorage","mtlUploadFile","uploadFile","mtlDownloadFile","downloadFile","formulaRule","rules","get","forEach","property","models","BaseModel","modelType","fieldName","model","getEditRowModel","push","type","actionGroups","actions","exprType","target","scrExprType","srcExpression","setCache","addproduct","postData","billNum","billId","billCode","childrenField","referField","gridModel","getParams","cancelCallBack","len","getData","length","deleteRows","setStatusBarStyle","route","goBack","pathList","rest","history","location","pathname","split","pushPage","bAddProduct","appendRow","scan","onScan","IsIMScanBar","isWeChat","wx","setValue","fireEvent","themeType","voucher","renderData","viewModel","render","dirty","isNewData","menuId","mode","VOUCHER_STATE_EDIT","setDirty","loadDirtyData","getGridModels","initRowState","DataStates","Insert","masterOrgField","autoAddRow","loadData","_beforeRender","_afterRender","execute","metaType","validate","masterOrgKeyField","masterOrgModel","_set_data","VOUCHER_STATE_ADD","getValue","VOUCHER_STATE_BROWSE","setDisabled","biz","do","hasBuildCoded","_createCode","isCoded","_reloadVoucher","bSwitchTpl","tplid","billData","meta","_fetchMetaCallback","vm","view","communication","payload","menuName","cBillName","refresh","metaData","_resetData","_getTreeSelectNode","selectNode","node","treeModel","getTreeModel","getSelectedNodes","_doService","allData","_doServiceByData","successCallback","cShowCaption","locale","text","msg","cAction","getCache","oldData","collectData","newData","updateNode","isWfControlled","_tplIsEquql","VOUCHER_TPL_KEY","_loadVm","oldVM","newVM","originalVM","originalViewMeta","_loadTree","Object","assign","configParams","allActions","find","x","cCommand","trim","toLocaleLowerCase","proxyParams","cSvcUrl","url","method","cHttpMethod","promiseExecute","setDataSource","search","billnum","treename","getModeDirtyData","ignoreConfirm","func","getDirtyData","clearCache","confirm","cancelEditFun","Function","_bindTreeSelect","on","args","manually","status","_renderTreeVoucherData","extendConfig","treeCard","id","getState","toString","hasChildren","options","viewCallback","resolve","retryCallback","originalParams","viewmeta","condition","initData","_afterViewCallback","backRefresh","stringify","_getInitdata","returnPromise","promise","caption","prompt","abandonText","reject","_bindKeyboard","workflowNoCtrl","callback","DynamicProxy","create","getCmdList","billno","_err","cmdName","carryParams","isSum","subid","subId","readOnly","par","cellsCheck","item","getColumn","cellName","bCheck","rowIndex","key","value","cControlType","fieldname","cFieldName","referRowsCheck","columnName","index","rows","column","bBatchCheck","mergeAll","cellCheck","oldValue","async","context","ruleItems","indexOf","lineOpenOrClose","rowIndexes","getSelectedRowIndexes","selectData","getRowsByIndexes","getName","select","copy","emptyData","err1","copyData","refreshCallback","pm","para","parent","cCarry","carryKeys","error","map","buildDepends","depends","attr","_obj","_gridModel","i","_buildDepends","isEmpty","this","Number","GridModel","field","setState","setColumnState","simpleModel","SimpleModel","buildOrg","setReadOnly","orgId","carryData","code","_get_data","keyMap","realAdd","browse","isExtend","simpleVOs","op","value1","errCallBack","buildCode","getCode","canModify","ballowhandwork","brepeatredo","billPrefix","prefixes","cfieldname","_buildCode","proxy","createCode","buildRule","billNumber","language","beforeActData","eval","fields","rule","triggers","trigger","ds","run","param","ruleid","lineid","ruleTriggers","items","jointFields","config","queryData","jointQuery","paras","menuCode","menuUrl","join","dt","billtype","extend","loader","runCommandLine","refFields","referModel","_setReferRule","cRefType","setRefCode","cRefRetId","setReturnFields","refid","setFilter","_resetOriginal","getOriginalData","check","nullMsg","theme","getAbandonText","cAbandonText","abandon","getNecessaryData","_abandon","enabledCallback","multitpl","lastId","undefined","inValid","invalidReason","window","batchModify","billType","submit","unsubmit","checkApprove","workflow","businessKey","width","height","appsource","appCode","flowComp","showFlowBox","onClose","callbackData","audit","open","allConfirm","close","table2DBtnClick","addRow","support2D","t2DInfo_Bus_Get","show2D","excludeFieldsWhenSave","deleteRow","insertRow","copyRow","rowData","getRow","shiftUpRow","shiftDownRow","localPrint","disabledCallback","printTplItemName","templatesModel","terminalType","templateCode","_localPrint","getTemplate","mask","template","isdefault","templatecode","ids","print","isInWorkBench","bReturn","isModelHasKey","getParent","isHideAlert","save","getGridModel","getRowsCount","invalidMsg","invalidFields","bShowIt","bHidden","_status","parentData","parentNode","getNodesByKeys","level","parentId","Update","defineParams","afterActData","_handlePageInfoStatus","content","cCaption","AppContext","query","random","domain","postMessage","saveReturn","currentAction","saveRefresh","addNode","unselectAll","arrayKeys","getDirtyRowIndexes","_delete","isReturn","suc","getSelectedKeys","selectedNode","nextNode","getNextSibling","prevNode","getPrevSibling","getParentNode","deleteNode","treeVoucher","selectAfterDelete","selectNodes","jDiwork","closeWin","doDelete","children","deleteReturn","nextAction","cmdDelRe","moveFirstOrLast","movePrevOrNext","encodeURI","pull","queryString","targetCode","targetBillNo","isMainSelect","childIds","toStr","saveAndAdd","saveParams","afterSaveData","clear","addParams","saveData","add","propertyName","doPropertyChange","saveAndAudit","auditParams","callbackdata","has","makeBilltype","newdata","maxLevel","addData","currentTpl","parentField","parent_name","name","getPredicateValue","formatValue","exp","match","values","valid","predicate","substring","obj","replace","localoutput","XLSX","outputData","dataColumns","getColumns","tmpObj","resObj","keyName","resDetails","resSonObj","cFormatData","iNumPoint","cEnumString","enumValue","enumString","lookupVector","keys","resultVector","thisLoc","iColWidth","fileName","sheet","json_to_sheet","sheetRowCount","colCount","rowRange","decode_range","R","C","s","c","cell_address","r","cell_ref","encode_cell","v","controlType","cellConfig","wpx","colRange","thisCell_address","thisCell_ref","t","decimal","option","amountofdecimal","monovalentdecimal","splitter","z","SSF","_table","decimalCount","re","deciLength","wb","book_new","book_append_sheet","writeFile","output","baseUrl","_baseUrl","substr","queryUrl","inputParams","partParam","savebo","saveBo","preview","actionName","errInfo","inElectronApp","electron","getSharedObject","newTab","user","serviceUrl","sendOrder","token","href","printID","VOUCHER_PRINT_KEY","json","bill","initDefaultActions","prevAction","selectTpl","cbk","vmAndView","newView","setData","Date","valueOf","groupCode","detailIds","pushKey","from","Set","mainIds","pushData","targetData","externalData","dimensionKeys","dimensionGroupCode","groupTaskKey","bWorkbench","dimensionKey","compositeAction","firstAction","Act","toUpperCase","saveDraft","saveDatatemp","getYhtUserIds","person","getYhtUserId","userIds","personIds","concat","refCode","yhtField","dataType","recordList","_getNotice","special","format","ecsuite","webUrl","origin","mobileUrl","notice","YYCooperationBridge","YYLanuchFlow","objectName","objectId","YYRenderCreateTask","idList","ecsuiteItems","yhtIds","YYGroupChat","docCode","YYChat","voucherDo","asyncMeta","Promise","cardViewModel","loadingControl","end","vmParams","asyncWorkflow","onload","fieldAuth","processWorkflow","fieldAuths","parseViewModel","parseContainer","parseMainEntity","parseChildEntity","fieldAuthObj","visible","editable","columns","bCanModify","container","containers","controls","parseControls","control","cItemName","process","env","__KEYBOARD__","allGroupCode","results","getContainers","containerCodes","idArr","domArr","firstEle","xNum","containerCode","containerMeta","getViewMeta","controlId","controlDom","getControls","resultId","resultDom","resultFirstEle","selectors","modelKey","document","getElementById","inputDom","querySelector","controlModel","isVisible","getVisible","notDisabled","getDisabled","notReadOnly","getReadOnly","afterInitData","promises","pk_procdefins","verifystate","title","gridModels","addGrandSonTable","userId","cacheKey","cacheWidth","indexDB","openDB","then","IDB_getData","dbTableName","dbName","catch","setTimeout","dataList","rid","attachmentId","row","list","columnKey","indexedDB_id","IDB_saveData","IDB_deleteOneData","_managePageInfoStatue","_bindTreeAttachment","USEFORMULARULE","USESTATERULE","btnMovefirst","btnMovelast","btnMoveprev","btnMovenext","parentViewmodel","lastSearchCondition","curVoucherIndex","recordCount","canLoad","_getParentAllList","info","findIndex","gridmodel","proxyConfig","queryParams","page","parentCurVoucherIndex","parentPageInfo","pageIndex","pageSize","rowDetail","curGridModel","cSunBillNo","selectedRow","jointquery","editType","parentViewModel","childArray","childKey","checkReturn","modal","printPreview","currentParams","printDesign","printNow","batchOutputVoucher","selectedDatas","includes","selectDatas","getSelectedRows","pubts","exportVoucherTemplate","importVoucher","btnCallBack","isAsync","asyncInterval","asyncKey","getNewGuid","acceptedFileType","interval","eleInput","createElement","accept","style","display","onchange","start","formData","FormData","enctype","file","files","fileSize","size","append","mapCondition","xhr","XMLHttpRequest","_url","send","onreadystatechange","bError","errorInfo","readyState","ajaxResult","responseText","curTime","getNowFormatDate","busName","percentage","asyncData","_timer","setInterval","asyncImportQuery","sucessCount","body","removeChild","appendChild","click","asyncParams","getImportProcess","errStr","handleAsyncImportOver","parseFloat","flag","clearTimeout","bDelTask","doCommunication","attachment","selectRow","attachmentCondition","keyField","loopData","voucherAttachment","newAttchmentId","newId","stateRule","showSon","DEFAULT_SHOW_SON","showHideSon","sonGroupCode","share","init","hasOwnProperty","self","initDataCallback","lowerMetaType","getTplList","systemCode","iTplId","filter","tpl","iTplMode","act","voucherExtend","voucherExtendConfig","voucherAction","doservice","load","org","initdefaultactions","commandline","edit","addrow","table2dbtnclick","insertrow","deleterow","copyrow","shiftuprow","shiftdownrow","delete","invalid","unaudit","movefirst","movelast","moveprev","movenext","columnsetting","checkapprove","cellcheck","cellscheck","referrowscheck","lineopen","lineclose","selecttpl","saveandadd","saveandaudit","localprint","selfdefineaction","savedraft","savedatatemp","voucherdo","batchmodify","printpreview","printdesign","printnow","batchoutput","batchimport","tempexport","openpage","goback","voucherattachment","rowdetail","staterule","billsetting","formularule","autocomplete","customdo","bizflowpush","showhideson","namespace","common"],"mappings":"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","file":"public/javascripts/1.bundle.js?_=d566ad53-de75-49ba-965f-44adb4dd2a09","sourcesContent":["import mtl from 'mtl-js-sdk'\n\nfunction _getParams (params) {\n  let data = {};\n  if (params) {\n    if (params.cParameter) {\n      data = JSON.parse(params.cParameter);\n    } else {\n      data = params;\n    }\n  }\n  return data;\n}\n\nfunction _showPrompt (result) {\n  if (mtl.platform !== 'upesn') {\n    cb.utils.alert(' ' + mtl.platform + ' ' + result);\n  } else {\n    console.log(' ' + mtl.platform + ' ' + result);\n  }\n}\n\nexport function mtlScan (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.needResult = newParams.needResult ? parseInt(newParams.needResult) : 1;\n    if (newParams.scanType === 'all') {\n      data.scanType = ['qrCode', 'barCode'];\n    } else {\n      if (!Array.isArray(data.scanType)) {\n        data.scanType = [newParams.scanType];\n      }\n    }\n  }\n  mtl.scanQRCode({\n    ...data,\n    success: function (res) {\n      const result = res.resultStr;\n      cb.invoker.publish('mtl', { action: 'scan', result: result });\n      _showPrompt(result);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlShare (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.upesn.showShareMenu({\n    ...data,\n    success: function (res) {\n      // \n      cb.invoker.publish('mtl', { action: 'share', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n};\n\nexport function mtlPlatform (billNo, viewmodel, params, beforeAct, afterAct) {\n  const result = mtl.platform;\n  cb.invoker.publish('mtl', { action: 'platform', result: result });\n  _showPrompt(mtl.platform);\n};\n\nexport function mtlNetworkType (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getNetworkType({\n    success: function (res) {\n      const networkType = res.networkType;// 2g3g4gwifi,fail\n      cb.invoker.publish('mtl', { action: 'getNetworkType', networkType });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\nexport function mtlGetMac (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.getMac({\n    success: function (res) {\n      const macAddress = res.macAddress;\n      cb.invoker.publish('mtl', { action: 'getMac', result: macAddress });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlDail (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.dail({\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'dail', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message;// \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlChooseImage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = {};\n  if (params?.cParameter) {\n    const newParams = JSON.parse(params.cParameter);\n    data.count = newParams.count;\n    if (newParams.sourceType === 'all') {\n      data.sourceType = ['album', 'camera'];\n    } else {\n      if (!Array.isArray(data.sourceType)) {\n        data.sourceType = [newParams.sourceType];\n      }\n    }\n  }\n  mtl.chooseImage({\n    ...data,\n    success: function (res) {\n      // IDlocalIdimgsrc\n      const localIds = res.localIds; // ['wxLocalResource://imageid123456789987654321', ...]\n      cb.invoker.publish('mtl', { action: 'chooseImage', result: localIds });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGetLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getLocation({\n    // type: 'wgs84',//wgs84gpsopenLocation'gcj02'\n    ...data,\n    success: function (res) {\n      // var latitude = res.latitude;// 90~-90\n      // var longitude = res.longitude;// 180~-180\n      cb.invoker.publish('mtl', { action: 'getLocation', result: res });\n      _showPrompt(res);\n    },\n    fail (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlOpenLocation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.openLocation({\n    // latitude: 40.07573,//90~-90\n    // longitude: 116.245412,//180~-180\n    // name: '',//\n    // address: '',//\n    // scale: 1,//,,1~28\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'openLocation', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlGenerateQRCode (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.generateQRCode({\n    // str: 'hello',//\n    // size: 200,//100*100\n    ...data,\n    success: function (res) {\n      // imgSrcbase64\n      // var src = res.imgSrc;\n      cb.invoker.publish('mtl', { action: 'generateQRCode', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlRequest (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  if (data.headers && typeof data.headers === 'string') {\n    try {\n      data.headers = JSON.parse(data.headers);\n    } catch (e) {\n      alert('headers ')\n      return\n    }\n  }\n  if (data.params && typeof data.params === 'string') {\n    try {\n      data.params = JSON.parse(data.params);\n    } catch (e) {\n      alert('params ')\n      return\n    }\n  }\n  mtl.request({\n    // url: 'https://some-domain.com/api/user',\n    // method: 'get',\n    // headers: { 'X-Requested-With': 'XMLHttpRequest' },\n    // params: {\n    //   ID: 12345\n    // },\n    ...data,\n    success: function (res) {\n      const data = res.data; // \n      cb.invoker.publish('mtl', { action: 'request', result: data });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  })\n}\n\nexport function mtlStartRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.startRecord({\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'startRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopRecord (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.stopRecord({\n    success: function (res) {\n      // var localId = res.localId;// ID,BASE64\n      cb.invoker.publish('mtl', { action: 'stopRecord', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPlayVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.playVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'playVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlPauseVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.pauseVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'pauseVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n\nexport function mtlStopVoice (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.stopVoice({\n    // localId: '', // IDstopRecord\n    ...data,\n    success: function (res) {\n      cb.invoker.publish('mtl', { action: 'stopVoice', result: res });\n      _showPrompt(res);\n    },\n    fail: function (err) {\n      const message = err.message; // \n      _showPrompt(message);\n    }\n  });\n}\n/**\n * \n */\nexport function mtlChangeScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.changeScreenOrientation({\n    // orientation: true,\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'changeScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlRestoreScreenOrientation (billNo, viewmodel, params, beforeAct, afterAct) {\n  mtl.restoreScreenOrientation({\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'restoreScreenOrientation', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlSetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.setStorage({\n    // domain: '',\n    // key: '',\n    // data: {},\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'setStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlGetStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.getStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'getStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlRemoveStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.removeStorage({\n    // domain: '',\n    // key: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'removeStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n\n/**\n * \n */\nexport function mtlClearStorage (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.clearStorage({\n    // domain: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'clearStorage', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * \n */\nexport function mtlUploadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.uploadFile({\n    // url: '',\n    // filePath: '',\n    // header: { 'content-type': 'multipart/form-data' },\n    // formData: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'uploadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n/**\n * \n */\nexport function mtlDownloadFile (billNo, viewmodel, params, beforeAct, afterAct) {\n  const data = _getParams(params);\n  mtl.downloadFile({\n    // url: '',\n    // fileType: '',\n    // header: '',\n    // formBody: '',\n    // jsonBody: '',\n    // autoPreview: '',\n    // fileName: '',\n    ...data,\n    success: res => {\n      // \n      cb.invoker.publish('mtl', { action: 'downloadFile', result: res });\n      _showPrompt(res);\n    },\n    fail: err => {\n      const message = err.message;\n      _showPrompt(message);\n    }\n  })\n};\n","import { runRule } from './rule';\n\nexport default function formulaRule (billNo, viewmodel, params, beforeAct, afterAct) {\n  const rules = [];\n  viewmodel.get('propertyNames').forEach(function (property) {\n    if (viewmodel.get(property) instanceof cb.models.BaseModel) {\n      // GridModel  SimpleModel\n      if (viewmodel.get(property).modelType === 'GridModel') {\n        viewmodel.get(property).get('fieldNames').forEach(function (fieldName) {\n          const model = viewmodel.get(property).getEditRowModel().get(fieldName);\n          if (model.get('iSystem') === 2) {\n            rules.push({\n              type: 0,\n              // triggers: '',\n              actionGroups: [{\n                actions: [{\n                  exprType: 0,\n                  target: property + '.' + model.get('cItemName'),\n                  scrExprType: 0,\n                  srcExpression: model.get('formula')\n                }]\n              }]\n            })\n          }\n        })\n      } else {\n        const model = viewmodel.get(property);\n        if (model.get('iSystem') === 2) { //  \n          rules.push({\n            type: 0,\n            // triggers: '',\n            actionGroups: [{\n              actions: [{\n                exprType: 0,\n                target: model.get('cItemName'),\n                scrExprType: 0,\n                srcExpression: model.get('formula')\n              }]\n            }]\n          })\n        }\n      }\n    }\n  })\n  viewmodel.setCache('formulaRules', rules);\n  runRule(viewmodel, rules, 'listener');\n}\n","export const addproduct = (billNo, viewmodel, params, beforeAct, afterAct) => {\n  const postData = {\n    billNum: billNo,\n    billId: viewmodel.get('id'),\n    billCode: viewmodel.get('code')\n  }\n  const beforeActData = {\n    params: params,\n    data: postData\n  }\n  beforeAct(beforeActData, function () {\n    let childrenField = null; let referField = null;\n    if (params.params) childrenField = params.params.childrenField;\n    const gridModel = viewmodel.get(childrenField);\n    const vmParams = viewmodel.getParams();\n    const cancelCallBack = () => {\n      const len = gridModel.getData().length;\n      gridModel.deleteRows([len - 1]);\n      // \n      cb.utils.setStatusBarStyle('light');\n      cb.route.goBack();\n    }\n    vmParams.cancelCallBack = cancelCallBack;\n    let cParameter = params.cParameter;\n    try {\n      cParameter = JSON.parse(cParameter);\n      referField = cParameter.referField;\n    } catch (e) {\n      cb.utils.alert('cParameter~', 'error');\n    }\n    const pathList = cb.rest.history.location.pathname.split('/');\n    const pathname = pathList[pathList.length - 1];\n    cb.route.pushPage(`/voucherRefer/${pathname}/${referField}/${childrenField}`)\n    cb.rest.bAddProduct = true;\n    if (gridModel) gridModel.appendRow({});\n    afterAct()\n  })\n}\n\nexport const scan = (billNo, viewmodel, params, beforeAct, afterAct) => {\n  const postData = {\n    billNum: billNo,\n    billId: viewmodel.get('id'),\n    billCode: viewmodel.get('code')\n  }\n  const beforeActData = {\n    params: params,\n    data: postData\n  }\n  beforeAct(beforeActData, function () {\n    let onScan = null;\n    if (params.params) onScan = params.params.onScan\n    const isImScanBar = cb.utils.IsIMScanBar();\n    if (isImScanBar) {\n      cb.utils.alert('', 'info');\n      return;\n    } else if (cb.rest.isWeChat) {\n      wx.scanQRCode({\n        needResult: 1, // 01\n        scanType: ['qrCode', 'barCode'], // \n        success: function (res) {\n          const model = viewmodel.get('barcode');\n          if (model) {\n            model.setValue(res.resultStr, true);\n            model.fireEvent('enter');\n          }\n        }\n      });\n    } else {\n      if (onScan) onScan();\n    }\n    afterAct()\n  })\n}\n","/* eslint max-lines: [\"error\", 4500] */\n\nimport * as common from './common'\nimport env from '../helpers/env'\nimport uuid from 'uuid/v1';\nimport formularule from '../staterule/formularule';\nimport { mtlScan, mtlShare } from './mtlapi'\nimport * as staterule from '../staterule/rule';\nimport * as mVoucher from './voucher_M'\nconst themeType = process.env.__THEMETYPE__;\n// FLH u8cdev\nconst voucher = (function () {\n  const renderData = function (billNo, viewModel, params) {\n    render(viewModel, params.data, params.dirty, true);\n  }\n\n  const render = (viewmodel, data, dirty, isNewData) => {\n    if (viewmodel.getParams().menuId && !viewmodel.getParams().mode)\n      viewmodel.getParams().mode = env.VOUCHER_STATE_EDIT;\n    common.setRenderReadOnly(viewmodel)\n    if (dirty) {\n      viewmodel.setDirty(true)\n      viewmodel.loadDirtyData(data)\n      const gridModels = viewmodel.getGridModels();\n      gridModels.forEach(gridModel => {\n        gridModel.initRowState(cb.models.DataStates.Insert);\n      });\n      /* add by jinzh1 bIsNulltrue\n        bCheck   check     \n              bCheck false   afterLoadData \n        \n      */\n      const { masterOrgField, autoAddRow } = viewmodel.getParams();\n      const isNcc = process.env.__THEMETYPE__ == 'ncc' // ncc\n      if (autoAddRow !== false && !isNcc)/*   */\n        if (!cb.utils.isEmpty(masterOrgField) && viewmodel.get(masterOrgField).get('bCheck')) {\n          viewmodel.on('afterCheck', args => {\n            const { value, key } = args.params;\n            const { masterOrgField } = viewmodel.getParams();\n            if (key == masterOrgField) {\n              viewmodel.setCache('checkOrgReturnCache');/* check afterCheckafterCheck */\n              if (value != 'null' && !cb.utils.isEmpty(value))\n                gridModels.forEach(gridModel => {\n                  if (viewmodel.getParams().mode === 'add' && !gridModel.get('bIsNull') && gridModel.getRowsCount() == 0 && gridModel.t2DInfo_Bus_IsShow2D() == false) {\n                    viewmodel.getParams().bInitAddRow = true;\n                    gridModel.appendRow({});\n                    viewmodel.getParams().bInitAddRow = false;\n                  }\n                });\n            }\n          });\n        } else {\n          viewmodel.on('afterLoadData', data => {\n            gridModels.forEach(gridModel => {\n              if (viewmodel.getParams().mode === 'add' && !gridModel.get('bIsNull') && gridModel.getRowsCount() == 0 && gridModel.t2DInfo_Bus_IsShow2D() == false) {\n                viewmodel.getParams().bInitAddRow = true;\n                gridModel.appendRow({});\n                viewmodel.getParams().bInitAddRow = false;\n              }\n            });\n          });\n        }\n    } else {\n      viewmodel.loadData(data)\n    }\n    if (isNewData || viewmodel.getParams().isNewData)\n      _beforeRender(viewmodel);\n    common.setState(viewmodel)\n    staterule.runState(viewmodel)\n    if (isNewData || viewmodel.getParams().isNewData)\n      _afterRender(viewmodel);\n    viewmodel.execute('afterLoadData', data, (isNewData || viewmodel.getParams().isNewData));\n    viewmodel.setCache('dataLoaded', true)\n    if (viewmodel.getParams().metaType !== 'treevoucher' || dirty) return;\n    viewmodel.validate(true);\n  }\n\n  const _beforeRender = function (viewModel) {\n    const { masterOrgField, masterOrgKeyField, mode } = viewModel.getParams();\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    masterOrgModel._set_data('bCanModify', mode === env.VOUCHER_STATE_ADD);\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    const orgId = model.getValue();\n    if (orgId && mode !== env.VOUCHER_STATE_BROWSE)\n      viewModel.setDisabled(false);\n    viewModel.biz.do('depends', viewModel) // merge: @liyc: merge YXYFrame\n  }\n\n  const _afterRender = function (viewModel) {\n    const { mode, hasBuildCoded, billNo, masterOrgField, masterOrgKeyField } = viewModel.getParams();\n    if (mode === env.VOUCHER_STATE_ADD && hasBuildCoded)\n      _createCode(billNo, viewModel);\n    else if (mode === env.VOUCHER_STATE_ADD && viewModel.getParams().isCoded === 0) {\n      viewModel.getParams().isCoded = true;\n      viewModel.biz.do('code', viewModel);\n    }\n    viewModel.biz.do('depends', viewModel);\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    const orgId = model.getValue();\n    if (!orgId) {\n      viewModel.setDisabled(true);\n      viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n      masterOrgModel.setDisabled(false);\n    }\n  }\n\n  const _reloadVoucher = (bSwitchTpl, data, viewmodel, billNo, afterAct) => {\n    if (bSwitchTpl) {\n      const vmParams = {\n        tplid: data.tplid\n      }\n      vmParams.billData = data\n      const cbk = function (err, meta) {\n        const reloadVoucherCallback = (vm, view) => {\n          viewmodel.communication({\n            payload: {\n              menuName: view.cBillName,\n              vm: vm,\n              refresh: true,\n              metaData: view\n            }\n          })\n        }\n        _fetchMetaCallback(err, meta, billNo, reloadVoucherCallback, vmParams)\n      }\n      common.fetchMeta(billNo, vmParams, cbk)\n    } else {\n      _resetData(viewmodel, data, afterAct)\n    }\n  }\n\n  const _getTreeSelectNode = (viewmodel) => {\n    let selectNode,\n      node\n    const treeModel = viewmodel.getTreeModel()\n    if (treeModel) {\n      selectNode = treeModel.getSelectedNodes()\n    }\n    if (selectNode && selectNode.length && selectNode[0]) {\n      node = selectNode[0]\n    }\n    return node\n  }\n\n  const _doService = (billNo, viewmodel, params, beforeAct, afterAct, allData) => {\n    if (viewmodel.getParams().metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel);\n      if (!node) {\n        cb.utils.alert('', 'warning');\n        return;\n      }\n    }\n    common.doService(billNo, viewmodel, params, beforeAct, afterAct, _doServiceByData, allData)\n  }\n\n  const _doServiceByData = (viewmodel, postData, params, afterAct, successCallback) => {\n    const callback = function (err, res) {\n      if (!err) {\n        if (params.cShowCaption)\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success')\n        else {\n          const msg = params.cAction == 'open' ? '' : '';\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: msg}), 'success')\n        }\n        if (viewmodel.getCache('banRenderNewData')) {\n          console.log('render')\n        } else {\n          const oldData = viewmodel.collectData(true)\n          res = Array.isArray(res) && res.length > 0 ? res[0] : res; // \n          const newData = common.billMerge(oldData, res)\n          if (viewmodel.getParams().metaType === 'treevoucher') {\n            // common.setMode(viewmodel, env.VOUCHER_STATE_EDIT);\n            viewmodel.getTreeModel().updateNode(newData);\n          }\n          render(viewmodel, newData)\n          if (newData && newData.isWfControlled) {\n            viewmodel.biz.do('refresh', viewmodel)\n          }\n        }\n        if (successCallback)\n          successCallback();\n      }\n      const afterActData = {\n        err: err,\n        res: res\n      }\n      if (afterAct) afterAct(afterActData, common.afterAct)\n    }\n    common.doProxy(params, callback, postData)\n  }\n\n  const _tplIsEquql = (data, viewmodel) => {\n    let result = false\n    if (!viewmodel.get(env.VOUCHER_TPL_KEY)) {\n      result = false\n    } else {\n      if (data[env.VOUCHER_TPL_KEY] != viewmodel.get(env.VOUCHER_TPL_KEY).getValue()) {\n        result = true\n      } else {\n        result = false\n      }\n    }\n    return result\n  }\n\n  const _resetData = (viewmodel, data, afterAct) => {\n    common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n    render(viewmodel, data)\n    if (!afterAct) return\n    afterAct({\n      res: data\n    }, common.afterAct)\n  }\n\n  const _loadVm = function (oldVM, newVM) {\n    newVM.originalVM = oldVM.originalVM\n    newVM.originalViewMeta = oldVM.originalViewMeta\n    newVM.biz.do('rule', newVM)\n    newVM.biz.do('initDefaultActions', newVM)\n  }\n\n  const _loadTree = (viewmodel, params, afterAct) => {\n    params = Object.assign({}, params, viewmodel.getCache('lastSearchCondition'));\n    const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n      return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdquerytree'\n    });\n    const proxyParams = configParams && configParams.cSvcUrl ? {\n      url: configParams.cSvcUrl,\n      method: configParams.cHttpMethod || 'POST'\n    } : {\n      url: 'bill/querytree',\n      method: 'POST'\n    };\n    const treeModel = viewmodel.getTreeModel();\n    if (!treeModel) return;\n    treeModel.promiseExecute('beforeLoad', params, function () {\n      treeModel.setDataSource(proxyParams, params);\n      if (afterAct)\n        treeModel.setCache('afterAct', afterAct);\n    });\n  }\n  const search = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.setCache('execFilter', true);\n    viewmodel.setCache('lastSearchCondition', params);\n    let data = {\n      billnum: billNo,\n      treename: common.getVmParams(viewmodel, 'treeName')\n    }\n    if (params && params instanceof Object) {\n      data = Object.assign(data, params)\n    }\n    const beforeActData = {\n      params: params,\n      data: params\n    }\n    beforeAct(beforeActData, function () {\n      _loadTree(viewmodel, data, afterAct)\n    })\n  }\n  const getModeDirtyData = function (viewmodel, ignoreConfirm = false, func) {\n    const data = viewmodel.getDirtyData(false);\n    /*  */\n    if (viewmodel.getParams().metaType == 'treevoucher' && viewmodel.getCache('actionType') == 'saveandadd') {\n      ignoreConfirm = true;\n      viewmodel.clearCache('actionType');\n    }\n    if (data && !ignoreConfirm) {\n      cb.utils.confirm('', function () {\n        func(true);\n      }, function () { // \n        func(false);\n        const cancelEditFun = viewmodel.getCache('cancelEditFun');\n        if (cancelEditFun instanceof Function) {\n          cancelEditFun();\n        }\n      });\n    } else {\n      func(true);\n    }\n  }\n\n  const _bindTreeSelect = (viewmodel, billNo) => {\n    const treeModel = viewmodel.getTreeModel();\n    if (!treeModel) return;\n    treeModel.on('select', function (args, manually, ignoreConfirm) {\n      viewmodel.promiseExecute('beforeTreeSelect', args, function () {\n        if (args.length) {\n          getModeDirtyData(viewmodel, ignoreConfirm, (status) => {\n            if (status) {\n              common.setMode(viewmodel, manually && viewmodel.getParams().mode || env.VOUCHER_STATE_BROWSE);\n              _renderTreeVoucherData(billNo, viewmodel, args[0]);\n              viewmodel.setCache('lastMode', env.VOUCHER_STATE_BROWSE);\n            }\n          });\n        } else {\n          if (!cb.extendConfig.voucher.treeCard) {\n            // common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            viewmodel.biz.do('add', viewmodel);\n            // viewmodel.setCache('lastMode', env.VOUCHER_STATE_ADD);\n          }\n        }\n      });\n    });\n    treeModel.on('afterSetDataSource', () => {\n      const afterAct = treeModel.getCache('afterAct');\n      if (afterAct)\n        afterAct();\n    });\n  }\n\n  const _renderTreeVoucherData = (billNo, viewmodel, params) => {\n    const id = params[viewmodel.getTreeModel().getState('keyField')];\n    viewmodel.setCache('lastId', id && id.toString());\n    const hasChildren = viewmodel.getParams().hasChildren;\n    if (hasChildren) {\n      const data = {\n        billnum: billNo,\n        id\n      }\n      const callback = function (err, data) {\n        if (!err) {\n          if (!cb.extendConfig.voucher.treeCard || viewmodel.getParams().mode !== env.VOUCHER_STATE_ADD) {\n            render(viewmodel, data);\n          }\n        }\n      }\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(x => {\n        return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmddetail';\n      });\n      const options = configParams && configParams.cSvcUrl ? {\n        cSvcUrl: configParams.cSvcUrl,\n        cHttpMethod: configParams.cHttpMethod || 'GET'\n      } : {\n        cSvcUrl: 'bill/detail',\n        cHttpMethod: 'GET'\n      };\n      common.doProxy(options, callback, data);\n    } else {\n      render(viewmodel, params);\n    }\n  }\n\n  const _fetchMetaCallback = function (err, meta, billNo, viewCallback, params, resolve, retryCallback) {\n    const extendCallback = (vm, view) => {\n      vm.viewCallback = viewCallback\n      vm.originalVM = vm\n      vm.originalParams = params\n      vm.originalViewMeta = meta.viewmeta\n      const data = {\n        vm,\n        view\n      }\n      resolve(data)\n    }\n    // const vmAndView =\n    common.initVM(err, meta, billNo, params, extendCallback, function (vm) {\n      vm.setCache('entryMode', params.mode);\n      vm.setCache('condition', params.condition);\n      vm.initData()\n      // _afterViewCallback(vm, params);\n    }, retryCallback)\n  }\n\n  const _afterViewCallback = function (billNo, vm, params) {\n    const backRefresh = (vm) => {\n      const params = JSON.parse(JSON.stringify(vm.getParams()));\n      Object.assign(params, { mode: env.VOUCHER_STATE_EDIT, id: vm.get('id').getValue() }); // fangqg:  mode: env.VOUCHER_STATE_EDIT,\n      _getInitdata(billNo, params, function (err, billData) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        _resetData(vm, billData);\n      });\n    }\n    common.setMode(vm, params.mode);\n    // vm.setCache('entryMode', params.mode);\n    vm.on('refresh', function () {\n      backRefresh(vm);\n    });\n    vm.on('back', function () {\n      if (common.getMode(vm) !== env.VOUCHER_STATE_BROWSE) return;\n      backRefresh(vm);\n    });\n    const returnPromise = new cb.promise();\n    vm.on('return', function (caption) {\n      if (common.getMode(vm) === env.VOUCHER_STATE_BROWSE || !vm.getDirtyData(false))\n        return true;\n      if (caption && typeof caption === 'object') {\n        caption.prompt = {};\n        return true;\n      }\n      // returnSave(billNo, vm, function () {\n      //   returnPromise.resolve();\n      //   const parentViewModel = vm.getCache('parentViewModel');\n      //   if (parentViewModel)\n      //     parentViewModel.execute('refresh');\n      // });\n      // return returnPromise;\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026058', {abandonText: caption}), function () {\n        returnPromise.resolve();\n      }, function () {\n        returnPromise.reject();\n      });\n      return returnPromise;\n    });\n    // common.setRenderReadOnly(vm)\n    vm.biz.do('initDefaultActions', vm)\n    vm.on('afterRule', function () {\n      if (params.mode === env.VOUCHER_STATE_EDIT)\n        vm.execute('afterEdit');\n      if (params.action === 'copy')\n        vm.execute('afterCopy');\n      if (params.mode === env.VOUCHER_STATE_ADD) {\n        if (vm.getCache('initKeyboardComplete')) return;\n        _bindKeyboard(vm);\n        vm.setCache('initKeyboardComplete', true);\n      }\n    });\n    // vm.on('afterCode', function () {\n    if (params.mode === env.VOUCHER_STATE_EDIT && vm.getParams().workflowNoCtrl) {\n      vm.setDisabled(true);\n      vm.get('btnAbandon') && vm.get('btnAbandon').setDisabled(false);\n    }\n    // });\n  }\n\n  const _getInitdata = function (billNo, params, callback, beforeAct) {\n    const proxy = cb.rest.DynamicProxy.create({ getCmdList: { url: 'billmeta/getbillcommands', method: 'GET' } });\n    proxy.getCmdList({ billno: billNo }, function (_err, result) {\n      const postData = {\n        billnum: billNo\n      }\n      let cmdName, cSvcUrl, cHttpMethod\n      const mode = params && params.mode || env.VOUCHER_STATE_BROWSE\n      // if (mode === env.VOUCHER_STATE_BROWSE && params && params.readOnly) {\n      //   // mode\n      //   mode = env.VOUCHER_STATE_EDIT;\n      // }\n      switch (mode) {\n        case env.VOUCHER_STATE_ADD:\n          cmdName = 'cmdadd';\n          cSvcUrl = 'bill/add'\n          cHttpMethod = 'POST'\n          Object.assign(postData, params.carryParams);\n          break\n        case env.VOUCHER_STATE_EDIT:\n          cmdName = 'cmddetail';\n          cSvcUrl = 'bill/detail'\n          cHttpMethod = 'GET'\n          if (!params.id) {\n            callback();\n            return;\n          }\n          postData.id = params.id;\n          if (params.isSum)\n            postData.isSum = params.isSum;\n          Object.assign(postData, params.carryParams);\n          break\n        case env.VOUCHER_STATE_BROWSE:\n          cmdName = 'cmdenter';\n          cSvcUrl = 'bill/enter'\n          cHttpMethod = 'GET'\n          postData.subid = params && params.subId\n          break\n      }\n      if (cmdName && result) {\n        const configParams = result.find(x => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === cmdName;\n        });\n        if (configParams && configParams.cSvcUrl) {\n          cSvcUrl = configParams.cSvcUrl;\n          cHttpMethod = configParams.cHttpMethod || 'GET'\n        }\n      }\n      if (params && params.readOnly === true) {\n        params.mode = env.VOUCHER_STATE_BROWSE\n      }\n      const par = {\n        cSvcUrl: cSvcUrl,\n        cHttpMethod: cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      if (beforeAct) {\n        beforeAct(beforeActData, function () {\n          common.doProxy(par, callback, postData)\n        })\n      } else {\n        common.doProxy(par, callback, postData)\n      }\n    });\n  }\n\n  const cellsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const args = [];\n    params.forEach(item => {\n      const column = viewModel.get(item.childrenField).getColumn(item.cellName);\n      if (!column.bCheck) return;\n      args.push({\n        location: item.rowIndex,\n        key: item.cellName,\n        childrenField: item.childrenField,\n        value: JSON.stringify(item.value),\n        type: item.cControlType,\n        fieldname: item.cFieldName,\n      });\n    });\n    common.batchCheck(billNo, viewModel, args);\n  }\n\n  const referRowsCheck = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const { childrenField, columnName, index, rows } = params;\n    const gridModel = viewModel.get(childrenField);\n    const column = gridModel.getColumn(columnName);\n    if (!column.bBatchCheck) return;\n    const data = {\n      location: index,\n      key: columnName,\n      childrenField,\n      value: JSON.stringify(rows),\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      mergeAll: true,\n    };\n    common.check(billNo, viewModel, data, beforeAct, afterAct, true);\n  }\n\n  const cellCheck = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const gridModel = common.getGridModel(viewmodel, params)\n    const cellName = params.cellName\n    const column = gridModel.getColumn(cellName)\n    if (!column.bCheck) return;\n    const data = {\n      location: params.rowIndex,\n      key: cellName,\n      childrenField: params.childrenField,\n      value: JSON.stringify(params.value),\n      oldValue: params.oldValue,\n      type: column.cControlType,\n      fieldname: column.cFieldName,\n      async: params.async,\n      callback: params.callback,\n      context: params.context,\n    }\n\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      if (column.bCheck === true) {\n        const ruleItems = gridModel.getCache('ruleItems');\n        if (ruleItems && ruleItems.indexOf(cellName) > -1)\n          data.async = false;\n        common.check(billNo, viewmodel, data, beforeAct, afterAct, true)\n      }\n    })\n  }\n\n  const lineOpenOrClose = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) {\n      return\n    }\n    // let selectData = common.getGridModel(viewmodel, params).getSelectedRows()\n    const selectData = common.getGridModel(viewmodel, params).getRowsByIndexes(rowIndexes)\n    const index = rowIndexes[0]\n    const childrenField = common.getGridModel(viewmodel, params).getName()\n    const data = viewmodel.collectData(true)\n    data[childrenField] = selectData\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert('', 'success')\n          const condition = {};\n          if (params && params.childrenField)\n            condition[params.childrenField] = [index];\n          const oldData = viewmodel.collectData(true)\n          const newData = common.billMerge(oldData, res, condition)\n          render(viewmodel, newData)\n          common.getGridModel(viewmodel, params).select([index])\n        }\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  const copy = function (billNo, viewModel, params, beforeAct, afterAct) {\n    if (!params || !params.cSvcUrl) return;\n    if (viewModel) {\n      params.mode = env.VOUCHER_STATE_EDIT;\n      params.id = viewModel.get('id').getValue();\n    }\n    const callback = function (err, emptyData) {\n      if (err) {\n        common.afterAct({ err });\n        return;\n      }\n      _getInitdata(billNo, params, function (err1, copyData) {\n        if (err1) {\n          common.afterAct({ err: err1 });\n          return;\n        }\n        const data = common.billCopy(copyData, emptyData);\n        if (viewModel) {\n          common.setMode(viewModel, env.VOUCHER_STATE_ADD);\n          render(viewModel, data, true, true);\n          afterAct();\n        } else {\n          params.mode = env.VOUCHER_STATE_ADD;\n          afterAct(null, data);\n        }\n      });\n    };\n    const postData = { billnum: billNo };\n    common.doProxy(params, callback, postData);\n  }\n\n  const refresh = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const refreshCallback = function (err, billData) {\n      if (!err && billData) {\n        const bSwitchTpl = _tplIsEquql(billData, viewmodel)\n        _reloadVoucher(bSwitchTpl, billData, viewmodel, billNo, afterAct)\n      } else {\n        const afterActData = {\n          err: err,\n          res: billData\n        }\n        afterAct(afterActData, common.afterAct)\n      }\n    }\n    const pm = {\n      mode: env.VOUCHER_STATE_EDIT,\n      id: viewmodel.get('id').getValue(),\n      isSum: params && params.isSum\n    }\n    const beforeActData = {\n      params: params,\n      data: pm\n    };\n    beforeAct(beforeActData, function () {\n      _getInitdata(billNo, pm, refreshCallback, beforeAct)\n    })\n  }\n\n  const loadData = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const data = para.data// || {}\n    const mode = common.getMode(viewmodel)\n    const parent = common.getVmParams(viewmodel, 'parent')\n    let cCarry = common.getVmParams(viewmodel, 'cCarry')\n    const carryKeys = []\n    if (cCarry && parent) {\n      try {\n        cCarry = JSON.parse(cCarry)\n      } catch (error) {\n        console.error('cCarry JSON-->' + cCarry)\n        return\n      }\n\n      if (typeof (cCarry) === 'object') {\n        for (const key in cCarry) {\n          const value = cCarry[key]\n          data[key] = parent[value]\n          carryKeys.push(key)\n        }\n      }\n    }\n    // setdirty true  \n    carryKeys.map(key => {\n      const model = viewmodel.get(key)\n      if (model) {\n        model.setDirty(true)\n      }\n    })\n    const beforeActData = {\n      params: para,\n      data: data\n    }\n    beforeAct(beforeActData, function () {\n      render(viewmodel, data, mode == env.VOUCHER_STATE_ADD);\n    })\n  }\n  const buildDepends = function (billNo, viewModel) {\n    const depends = viewModel.get('depends');\n    if (!depends) return;\n    let model = null;\n    for (const attr in depends) {\n      try {\n        const _obj = JSON.parse(attr);\n        let _EditRowModel = null;\n        let _gridModel = null;\n        let _name = null;\n        const _grid = attr;\n        for (const i in _obj) {\n          _name = i;\n          _gridModel = viewModel.get(_obj[i])\n          _EditRowModel = _gridModel.getEditRowModel();\n          model = _EditRowModel.get(i);\n        }\n        _buildDepends(depends[_grid], _EditRowModel, model.getValue());\n        _EditRowModel.on('afterUpdateEditRowModel', (args) => {\n          if (!cb.utils.isEmpty(args[_name])) {\n            _buildDepends(depends[_grid], _EditRowModel, (args[_name] || 0));\n          }\n        }, depends[attr]);\n      } catch (e) {\n        model = viewModel.get(attr);\n        if (!model) continue;\n        model._set_data('needCheck', true);\n        _buildDepends(depends[attr], viewModel, model.getValue());\n        model.on('afterValueChange', function (args) {\n          _buildDepends(this, viewModel, args.value);\n        }, depends[attr]);\n      }\n    }\n  }\n  const _buildDepends = function (depends, viewModel, value) {\n    if (cb.utils.isEmpty(value)) return;\n    value = typeof value === 'string' ? Number(value) : value;\n    depends.forEach(item => {\n      if (item.childrenField) {\n        const gridModel = viewModel.get(item.childrenField);\n        if (gridModel instanceof cb.models.GridModel) {\n          gridModel.getEditRowModel().get(item.field).setState('iNumPoint', value);\n          gridModel.setColumnState(item.field, 'iNumPoint', value);\n        }\n      } else {\n        const simpleModel = viewModel.get(item.field);\n        if (simpleModel instanceof cb.models.SimpleModel)\n          simpleModel.setState('iNumPoint', value);\n      }\n    });\n  }\n  const buildOrg = function (billNo, viewModel) {\n    const { masterOrgField, carryParams } = viewModel.getParams();\n    if (!masterOrgField) return;\n    const masterOrgModel = viewModel.get(masterOrgField);\n    if (!masterOrgModel) return;\n    if (viewModel.getParams().mode !== env.VOUCHER_STATE_ADD) {\n      masterOrgModel._set_data('bCanModify', false);\n      masterOrgModel.setReadOnly(true);\n    }\n    masterOrgModel.on('beforeValueChange', function (args) {\n      orgId = model && model.getValue();\n      if (!orgId || args.value && args.value.id == orgId) return;\n      const promise = new cb.promise();\n      viewModel.promiseExecute('beforeChangeMasterOrg', function () {\n        cb.utils.confirm('', function () {\n          // if (model._get_data('needCheck'))\n          viewModel.setCache('delayCode', true);\n          promise.resolve();\n        });\n      });\n      return promise;\n    });\n    masterOrgModel.on('afterValueChange', function (args) {\n      if (!orgId && !cb.utils.isArray(args.value) && args.value) {\n        viewModel.setDisabled(false);\n        // common.setState(viewModel);\n        viewModel.execute('afterMasterOrgChange', model.getValue());\n      }\n      if (!orgId || args.value && args.value.id == orgId) return;\n      // if (model._get_data('needCheck'))\n      viewModel.clearCache('delayCode');\n      const carryData = {};\n      carryData[masterOrgKeyField] = args.value && args.value.id || null;\n      if (viewModel.get('code') && viewModel.getParams().hasBuildCoded) // && model._get_data('needCheck'))\n        carryData.code = viewModel.get('code').getValue();\n      viewModel.biz.do('add', viewModel, {\n        carryParams,\n        carryData,\n        callback: function () {\n          if (model._get_data('needCheck'))\n            _createCode(billNo, viewModel);\n          if (!cb.utils.isArray(args.value) && args.value) {\n            masterOrgModel.setValue([args.value]);\n          } else {\n            model.setValue(null, model._get_data('needCheck'));\n            viewModel.setDisabled(true);\n            viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n            masterOrgModel.setDisabled(false);\n          }\n          orgId = model.getValue();\n          masterOrgModel.execute('afterValueChange', args);\n          viewModel.execute('afterMasterOrgChange', orgId);\n        }\n      });\n    });\n    const keyMap = masterOrgModel.getState('bill2ReferKeyFieldMap') || {};\n    let masterOrgKeyField = null;\n    for (const attr in keyMap) {\n      if (masterOrgKeyField) break;\n      masterOrgKeyField = attr;\n    }\n    if (!masterOrgKeyField)\n      masterOrgKeyField = 'org';\n    const model = viewModel.get(masterOrgKeyField);\n    if (!model) return;\n    viewModel.getParams().masterOrgKeyField = masterOrgKeyField;\n    let orgId = model.getValue();\n    if (!orgId) {\n      viewModel.setDisabled(true);\n      viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n      masterOrgModel.setDisabled(false);\n      return;\n    }\n    const { mode, realAdd, action } = viewModel.getParams();\n    if (mode !== env.VOUCHER_STATE_ADD || realAdd === false || action === 'copy') return;\n    masterOrgModel.browse(false, function (vm) {\n      vm.on('getRefMetaReady', function () {\n        const condition = {\n          isExtend: true,\n          simpleVOs: [{ field: 'id', op: 'in', value1: orgId }]\n        };\n        const errCallBack = function () {\n          model.setValue(null);\n          orgId = model.getValue();\n          viewModel.setDisabled(true);\n          viewModel.get('btnAbandon') && viewModel.get('btnAbandon').setDisabled(false);\n          masterOrgModel.setDisabled(false);\n          return false;\n        }\n        vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n      });\n    });\n  }\n\n  const buildCode = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const { isCoded, mode, realAdd } = viewModel.getParams();\n    if (!isCoded || realAdd === false) return;\n    const data = { billNum: billNo };\n    const beforeActData = { params, data };\n    beforeAct(beforeActData, function () {\n      const proxy = cb.rest.DynamicProxy.create({ getCode: { url: 'billNumber/findByBillNum', method: 'GET' } });\n      proxy.getCode(data, function (err, result) {\n        if (err || !result) {\n          cb.utils.alert(': ' + err ? err.message : 'empty', 'error');\n          return;\n        }\n        const model = viewModel.get('code');\n        if (!model) return;\n        const canModify = !!result.ballowhandwork;\n        model._set_data('bCanModify', canModify);\n        model.setDisabled(!canModify);\n        afterAct();\n        if (canModify && !result.brepeatredo || !result.billPrefix || !result.billPrefix.length) return;\n        viewModel.getParams().hasBuildCoded = true;\n        if (mode === env.VOUCHER_STATE_ADD)\n          _createCode(data.billNum, viewModel);\n        const prefixes = [];\n        result.billPrefix.forEach(item => {\n          if (!item.cfieldname) return;\n          _buildCode(item.cfieldname, viewModel, data.billNum);\n          prefixes.push(item.cfieldname);\n        });\n        viewModel.setCache('prefixes', prefixes);\n      });\n    });\n  }\n\n  const _buildCode = function (fieldName, viewModel, billNo) {\n    const model = viewModel.get(fieldName);\n    if (!model) return;\n    model._set_data('needCheck', true);\n    model.on('afterValueChange', function () {\n      _createCode(billNo, viewModel);\n    });\n  }\n\n  const _createCode = function (billNo, viewModel) {\n    if (viewModel.getCache('delayCode')) return;\n    const proxy = cb.rest.DynamicProxy.create({ createCode: { url: 'billNumber/createCode?billNum=' + billNo, method: 'POST' } });\n    const data = viewModel.collectData();\n    proxy.createCode(data, function (err, result) {\n      if (err || !result) {\n        cb.utils.alert(': ' + err ? err.message : 'empty', 'error');\n        return;\n      }\n      viewModel.get('code').setValue(result);\n    });\n  }\n\n  const buildRule = (billNo, viewmodel, para, beforeAct, afterAct) => {\n    const postData = {\n      billNumber: billNo,\n      language: 'javascript'\n    }\n    const beforeActData = {\n      params: para,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      common.doProxy({\n        cSvcUrl: '/itemrule/script',\n        cHttpMethod: 'GET'\n      }, function (_err, data) {\n        // eslint-disable-next-line no-eval\n        data = eval(data) || {};\n        const fields = {}\n        data && (data.rules || []).forEach(function (rule) {\n          rule.triggers.forEach(function (trigger) {\n            const fieldName = trigger.ds\n            if (fieldName) {\n              if (!fields[fieldName])\n                fields[fieldName] = []\n              if (fields[fieldName].indexOf(trigger.item) == -1)\n                fields[fieldName].push(trigger.item)\n            } else {\n              if (!viewmodel.get(trigger.item)) return\n              viewmodel.get(trigger.item).on('afterValueChange', function () {\n                this.run(this.param)\n              }, {\n                run: data.run,\n                param: {\n                  ruleid: rule.id,\n                  vm: viewmodel,\n                  trigger: {\n                    ds: fieldName,\n                    item: trigger.item,\n                    lineid: '0'\n                  }\n                }\n              })\n            }\n          })\n          for (const attr in fields) {\n            if (!viewmodel.get(attr)) continue\n            viewmodel.get(attr).setCache('ruleItems', fields[attr]);\n            const callback = function (args) {\n              if (args.cellName === null) {\n                if (!this.ruleTriggers || this.ruleTriggers.length == 0) return;\n                this.param.trigger.item = this.ruleTriggers[0].item;\n              } else {\n                if (this.items.indexOf(args.cellName) === -1) return\n                this.param.trigger.item = args.cellName\n              }\n              this.param.trigger.lineid = '0:' + args.rowIndex\n              this.run(this.param)\n            }\n            const context = {\n              items: fields[attr],\n              run: data.run,\n              param: {\n                ruleid: rule.id,\n                vm: viewmodel,\n                trigger: {\n                  ds: attr\n                }\n              },\n              ruleTriggers: rule.triggers\n            };\n            viewmodel.get(attr).on('afterCellValueChange', callback, context);\n            viewmodel.get(attr).on('innerCellValueChange', callback, context);\n          }\n        })\n\n        for (const attr in fields) {\n          // fangqg: \n          viewmodel.get(attr).on('afterDeleteRows', function () {\n            const childrenField = this.childrenField;\n            viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName: null });\n          }, {\n            childrenField: attr\n          });\n          viewmodel.get(attr).on('afterInsertRow', function () {\n            const childrenField = this.childrenField;\n            viewmodel.get(childrenField).execute('innerCellValueChange', { rowIndex: -1, cellName: null });\n          }, {\n            childrenField: attr\n          });\n        }\n\n        const jointFields = {};\n        (data.jointFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!jointFields[fieldName])\n              jointFields[fieldName] = []\n            jointFields[fieldName].push(field.item)\n          } else {\n            if (!viewmodel.get(field.item)) return\n            viewmodel.get(field.item).on('jointQuery', function () {\n              let config = null;\n              try {\n                config = JSON.parse(this.param.vm.get(this.param.trigger.item).getState('cStyle'));\n              } catch (e) {\n                config = {};\n              }\n              const queryData = this.jointQuery(this.param)\n              const items = [];\n              for (const attr in queryData.paras) {\n                items.push(attr + '=' + queryData.paras[attr]);\n              }\n              config.menuCode = 'SJ0201';\n              if (config.menuCode) {\n                viewmodel.communication({ type: 'menu', payload: { menuCode: config.menuCode, menuUrl: '?' + items.join(',') } });\n                return;\n              }\n              const parent = this.param.vm\n              const dt = {\n                billtype: 'voucher',\n                billno: queryData.target,\n                params: cb.utils.extend(true, queryData.paras, {\n                  mode: env.VOUCHER_STATE_EDIT\n                })\n              }\n              cb.loader.runCommandLine('bill', dt, parent)\n            }, {\n              jointQuery: data.jointQuery,\n              param: {\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in jointFields) {\n          if (!viewmodel.get(attr)) continue\n          viewmodel.get(attr).on('cellJointQuery', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            const parent = this.param.vm\n            const dt = {\n              billtype: 'voucher',\n              billno: queryData.target,\n              params: cb.utils.extend(true, queryData.paras, {\n                mode: env.VOUCHER_STATE_EDIT\n              })\n            }\n            cb.loader.runCommandLine('bill', dt, parent)\n          }, {\n            items: jointFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n        const refFields = {};\n        (data.refFields || []).forEach(function (field) {\n          const fieldName = field.ds\n          if (fieldName) {\n            if (!refFields[fieldName])\n              refFields[fieldName] = []\n            refFields[fieldName].push(field.item)\n          } else {\n            const referModel = viewmodel.get(field.item);\n            if (!referModel) return\n            referModel.on('beforeBrowse', function () {\n              const queryData = this.jointQuery(this.param)\n              if (!queryData) return\n              _setReferRule(queryData, this.referModel)\n            }, {\n              referModel: referModel,\n              jointQuery: data.jointQuery,\n              param: {\n                action: 'ref',\n                vm: viewmodel,\n                trigger: {\n                  ds: field.ds,\n                  item: field.item\n                }\n              }\n            })\n          }\n        })\n        for (const attr in refFields) {\n          const referModel = viewmodel.get(attr);\n          if (!referModel) continue\n          referModel.on('beforeBrowse', function (args) {\n            if (this.items.indexOf(args.cellName) === -1) return\n            this.param.trigger.item = args.cellName\n            this.param.trigger.lineid = '0:' + args.rowIndex\n            const queryData = this.jointQuery(this.param)\n            if (!queryData) return\n            _setReferRule(queryData, args.context)\n          }, {\n            referModel: referModel,\n            items: refFields[attr],\n            jointQuery: data.jointQuery,\n            param: {\n              action: 'ref',\n              vm: viewmodel,\n              trigger: {\n                ds: attr\n              }\n            }\n          })\n        }\n\n        afterAct()\n      }, postData)\n    })\n  }\n  const _setReferRule = (queryData, referModel) => {\n    const target = queryData.target\n    if (target) {\n      if (target.cRefType) {\n        referModel.setRefCode(target.cRefType)\n      }\n      if (target.cRefRetId) {\n        referModel.setReturnFields(target.cRefRetId.refid)\n      }\n    }\n    referModel.setFilter({\n      isExtend: true,\n      simpleVOs: queryData.paras\n    })\n  }\n\n  const _resetOriginal = (viewmodel, afterAct) => {\n    const newVM = viewmodel.originalVM || viewmodel;\n    if (newVM.get(env.VOUCHER_TPL_KEY) && viewmodel.get(env.VOUCHER_TPL_KEY) && (newVM.getOriginalData()[env.VOUCHER_TPL_KEY] != viewmodel.get(env.VOUCHER_TPL_KEY).getValue())) {\n      viewmodel.communication({\n        payload: {\n          menuName: newVM.originalViewMeta.cBillName,\n          vm: newVM,\n          refresh: true,\n          metaData: newVM.originalViewMeta\n        }\n      })\n      _loadVm(viewmodel, newVM)\n    }\n    const mode = env.VOUCHER_STATE_BROWSE;\n    if (viewmodel.getCache('lastMode'))\n      common.setMode(newVM, viewmodel.getCache('lastMode'))\n    else if (viewmodel.getCache('entryMode') === env.VOUCHER_STATE_BROWSE || !viewmodel.getParams().menuId)\n      common.setMode(newVM, mode)\n    let newData = newVM.getOriginalData()\n    // 2019-11-27 Jarvan \n    const treeModel = newVM.getTreeModel();\n    if (treeModel) {\n      const selectData = treeModel.getSelectedNodes();\n      if (selectData.length > 0) {\n        newData = selectData[0];\n      }\n    }\n\n    // end\n    if (newVM.get(env.VOUCHER_TPL_KEY) && cb.utils.isEmpty(newData[env.VOUCHER_TPL_KEY])) {\n      newData[env.VOUCHER_TPL_KEY] = newVM.get(env.VOUCHER_TPL_KEY).get('cDefaultValue')\n    }\n    render(newVM, newData, mode === env.VOUCHER_STATE_ADD, true)\n    const afterActData = {\n      res: newData\n    }\n    afterAct(afterActData, common.afterAct)\n  }\n\n  const check = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (viewmodel.getParams().metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel)\n      if (node) {\n        const treeModel = viewmodel.getTreeModel();\n        params[treeModel.getState('parentField')] = node[treeModel.getState('keyField')];\n      }\n    }\n    const beforeActData = {\n      params: params,\n    }\n    beforeAct(beforeActData, function () {\n      const nullMsg = cb.extendConfig.theme === 'ncc';\n      common.check(billNo, viewmodel, params, beforeAct, afterAct, false, nullMsg)\n    })\n  }\n\n  const getAbandonText = cParameter => {\n    const parsedCParameter = JSON.parse(cParameter);\n    return parsedCParameter.cAbandonText || '' // ncccShowCaptionicon buttoncAbandonText\n  }\n\n  const abandon = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const beforeActData = {\n      params: params\n    }\n    beforeAct(beforeActData, function () {\n      const mode = common.getMode(viewmodel);\n      if (mode === env.VOUCHER_STATE_BROWSE && !viewmodel.getParams().menuId) {\n        viewmodel.communication({ type: 'return' });\n        return;\n      }\n      let data = viewmodel.getDirtyData(false);\n      const { metaType } = viewmodel.getParams();\n      if (metaType === 'treevoucher' && cb.extendConfig.voucher.treeCard) { // ,,\n        if (!data) {\n          data = viewmodel.getNecessaryData();\n        }\n      }\n      if (!data) {\n        _abandon(viewmodel, afterAct);\n        return;\n      }\n      const abandonText = params.cShowCaption || getAbandonText(params.cParameter)\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026038', {abandonText}), function () {\n        _abandon(viewmodel, afterAct);\n      }, function () {\n        if (params && params.enabledCallback)\n          params.enabledCallback();\n      });\n\n      // returnSave(billNo, viewmodel, _abandon);\n    });\n  }\n  const _abandon = function (viewmodel, afterAct) {\n    const { multitpl, metaType, menuId } = viewmodel.getParams();\n    if (multitpl || viewmodel.getCache('entryMode') !== env.VOUCHER_STATE_BROWSE && metaType !== 'treevoucher' && !menuId) {\n      afterAct(); // \n      viewmodel.communication({ type: 'return' });\n      return;\n    }\n    _resetOriginal(viewmodel, afterAct);\n    if (metaType === 'treevoucher') {\n      const lastId = viewmodel.getCache('lastId');\n      if (!lastId) {\n        common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n        viewmodel.setDirty(false);\n        _resetOriginal(viewmodel, afterAct);\n        return;\n      };\n      const treeModel = viewmodel.getTreeModel();\n      if (!treeModel) return;\n      treeModel.select(lastId, undefined, true);\n      viewmodel.setDirty(false);\n      return;\n    }\n    viewmodel.validate(true);\n  }\n\n  const inValid = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const invalidReason = window.prompt('', '')\n    let data = viewmodel.getNecessaryData()\n    if (invalidReason) {\n      data = cb.utils.extend(data, {\n        invalidReason\n      })\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      _doServiceByData(viewmodel, postData, params, afterAct)\n    })\n  }\n  const batchModify = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    viewmodel.communication({\n      type: 'modal',\n      payload: {\n        key: 'batchModify',\n        data: {\n          billType: 'voucher',\n          billNo: billNo,\n          model: viewmodel,\n          params: params\n        }\n      }\n    });\n  }\n  const submit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    console.log('submit --->')\n    const data = viewmodel.collectData(true)\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      _doServiceByData(viewmodel, postData, params, afterAct)\n    })\n  }\n  const unsubmit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    console.log('unsubmit --->')\n    let data = viewmodel.collectData()\n\n    if (process.env.__THEMETYPE__ == 'ncc') {\n      // ncc \n      data = viewmodel.collectData(true);\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      _doServiceByData(viewmodel, postData, params, afterAct, function () {\n        if (viewmodel.getParams().workflowNoCtrl)\n          delete viewmodel.getParams().workflowNoCtrl;\n      })\n    })\n  }\n  const checkApprove = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const postData = {\n      billNum: billNo,\n      billId: viewmodel.get('id'),\n      billCode: viewmodel.get('code')\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          type: 'platform',\n          url: 'checkapprove',\n          model: viewmodel,\n          data: postData\n        }\n      })\n      afterAct()\n    })\n  }\n\n  const workflow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const businessKey = `${billNo}_${viewmodel.get('id').getValue()}`;\n    const data = {\n      width: 850,\n      height: 510,\n      appsource: env.appCode,\n      businessKey\n    };\n    const beforeActData = {\n      params: params,\n      data: data\n    };\n    beforeAct(beforeActData, function () {\n      const flowCompIns = window.flowComp(data);\n      flowCompIns.showFlowBox({\n        onClose (callbackData) {\n          // viewmodel.communication({ type: 'refresh' });\n          refresh(billNo, viewmodel, params, beforeAct, afterAct);\n        }\n      });\n    });\n  }\n\n  const audit = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (viewmodel.get('isWfControlled') && viewmodel.get('isWfControlled').getValue()) {\n      if (!(viewmodel.get('verifystate') && viewmodel.get('verifystate').getValue() === 1)) {\n        cb.utils.alert('', 'error')\n        return;\n      }\n      const businessKey = `${billNo}_${viewmodel.get('id').getValue()}`;\n      const flowCompIns = window.flowComp({\n        width: 850,\n        height: 510,\n        appsource: 'u8c',\n        businessKey\n      });\n      flowCompIns.showFlowBox({\n        onClose (callbackData) {\n          viewmodel.communication({ type: 'refresh' });\n        }\n      });\n\n      // let postData = {\n      //   billNum: billNo,\n      //   billId: viewmodel.get('id'),\n      //   billCode: viewmodel.get('code')\n      // }\n      // let beforeActData = {\n      //   params: params,\n      //   data: postData\n      // }\n      // beforeAct(beforeActData, function () {\n      //   viewmodel.communication({\n      //     type: 'modal',\n      //     payload: {\n      //       type: 'platform',\n      //       url: 'approve',\n      //       model: viewmodel,\n      //       data: postData\n      //     }\n      //   })\n      //   afterAct()\n      // })\n    } else {\n      const data = viewmodel.collectData(true)\n      const postData = {\n        billnum: billNo,\n        data: JSON.stringify(data)\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      }\n      beforeAct(beforeActData, function () {\n        _doServiceByData(viewmodel, postData, params, afterAct)\n      })\n    }\n  }\n\n  // \n  const open = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'open';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026042', {cShowCaption: params.cShowCaption}), function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n    }\n  };\n  // \n  const close = (billNo, viewModel, params, beforeAct, afterAct) => {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'close';\n      });\n      Object.assign(params, configParams);\n    }\n    if (cb.extendConfig.allConfirm && params.cShowCaption) {\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026042', {cShowCaption: params.cShowCaption}), function () {\n        _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n      })\n    } else {\n      _doService(billNo, viewModel, params, beforeAct, afterAct, true);\n    }\n  };\n  const table2DBtnClick = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    viewmodel.execute('table2DBtnClick');\n  }\n  const addRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    // viewmodel.communication({\n    //   type: 'modal',\n    //   payload: {\n    //     key: 'openTable2D',\n    //     data: {\n    //       billNo: billNo,\n    //       gridModel: common.getGridModel(viewmodel, params),\n    //       params: params\n    //     }\n    //   }\n    // });\n    // return;\n    const gridModel = common.getGridModel(viewmodel, params);\n    const support2D = gridModel.t2DInfo_Bus_Get('support2D');\n    const show2D = gridModel.t2DInfo_Bus_Get('show2D');\n    if (support2D && show2D) {\n      viewmodel.execute('table2DAddRowClick');\n    }\n    else {\n      const beforeActData = {\n        params: params\n      }\n      beforeAct(beforeActData, function () {\n        gridModel.setCache('excludeFieldsWhenSave', beforeActData.params.excludeFieldsWhenSave);\n        const data = common.getGridModel(viewmodel, params).appendRow()\n        beforeActData.data = data;\n        afterAct(beforeActData)\n      })\n    }\n  }\n\n  const deleteRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('', 'warning');\n\n      return;\n    }\n    const beforeActData = {\n      params: params,\n      data: rowIndexes\n    }\n    beforeAct(beforeActData, function () {\n      const data = common.getGridModel(viewmodel, params).deleteRows(rowIndexes)\n      afterAct(data)\n    })\n  }\n\n  const insertRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const beforeActData = {\n      params: params,\n      data: rowIndexes\n    }\n    beforeAct(beforeActData, function () {\n      if (!rowIndexes.length) {\n        return\n      }\n      // const data = common.getGridModel(viewmodel, params).insertRow(rowIndexes[0])\n      common.getGridModel(viewmodel, params).insertRow(rowIndexes[0], null, true)\n      afterAct(beforeActData)\n    })\n  }\n\n  const copyRow = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewmodel, params).getSelectedRowIndexes();\n    if (cb.utils.isArray(rowIndexes) && rowIndexes.length == 0) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    // let rowData = common.getGridModel(viewmodel, params).getSelectedRows()\n    const rowData = common.getGridModel(viewmodel, params).getRow(rowIndexes[0])\n    const beforeActData = {\n      params: params,\n      data: {\n        rowIndexes,\n        rowData\n      }\n    }\n    beforeAct(beforeActData, function () {\n      const data = common.getGridModel(viewmodel, params).insertRow(rowIndexes[0], beforeActData.data.rowData, null, true);// fixbugwuxlr select ; BUG\n      beforeActData.data.rowData = data;\n      afterAct(beforeActData)\n    })\n  }\n\n  const shiftUpRow = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewModel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) return;\n    const rowIndex = rowIndexes[0];\n    const args = {\n      params: params,\n      data: rowIndex\n    };\n    beforeAct(args, function () {\n      common.getGridModel(viewModel, params).shiftUpRow(rowIndex);\n      afterAct(args);\n    });\n  };\n\n  const shiftDownRow = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const rowIndexes = params && params.params && params.params.index != null\n      ? [params.params.index]\n      : common.getGridModel(viewModel, params).getSelectedRowIndexes();\n    if (!rowIndexes.length) return;\n    const rowIndex = rowIndexes[0];\n    const args = {\n      params: params,\n      data: rowIndex\n    };\n    beforeAct(args, function () {\n      common.getGridModel(viewModel, params).shiftDownRow(rowIndex);\n      afterAct(args);\n    });\n  };\n\n  const localPrint = function (billNo, viewModel, params, beforeAct, afterAct) {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewModel.allActions && viewModel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'localprint';\n      });\n      Object.assign(params, configParams);\n    }\n    const id = viewModel.get('id').getValue();\n    if (cb.utils.isEmpty(id)) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    const route = params && params.cSvcUrl || '/bill';\n    const { disabledCallback, enabledCallback } = params;\n    let printTplItemName = '';\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      printTplItemName = cParameter && cParameter.printTplItemName;\n    }\n    if (!printTplItemName) {\n      cb.utils.alert('cParameter { printTplItemName : cItemName}', 'warning');\n      return;\n    }\n\n    const templatesModel = viewModel.get(printTplItemName);\n    if (templatesModel && cb.rest.terminalType != 2) {\n      const templateCode = templatesModel.getValue();\n      if (cb.utils.isEmpty(templateCode)) {\n        cb.utils.alert('', 'error');\n        return;\n      }\n      if (disabledCallback) {\n        disabledCallback();\n        params.disabledCallback = false;\n      }\n      _localPrint(billNo, templateCode, id, route, beforeAct, enabledCallback);\n    } else {\n      if (disabledCallback) {\n        disabledCallback();\n        params.disabledCallback = false;\n      }\n      const proxy = cb.rest.DynamicProxy.create({\n        getTemplate: { url: 'print/getTemplateByBo', method: 'GET', options: { mask: true } }\n      });\n      proxy.getTemplate({ billno: billNo }, function (err, data) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          if (enabledCallback)\n            enabledCallback();\n          return;\n        }\n        const template = data.length === 1 ? data[0] : data.find(item => {\n          return item.isdefault;\n        });\n        if (cb.utils.isEmpty(template)) {\n          cb.utils.alert('', 'error');\n          if (enabledCallback)\n            enabledCallback();\n          return;\n        }\n        _localPrint(billNo, template.templatecode, id, route, beforeAct, enabledCallback);\n      });\n    }\n  }\n\n  const _localPrint = function (billno, templateCode, id, route, beforeAct, enabledCallback) {\n    const proxy = cb.rest.DynamicProxy.create({\n      print: { url: route + '/getTemplateStructure', method: 'POST', options: { mask: true } }\n    });\n    const params = { billno, templateCode, ids: [id] };\n    proxy.print(params, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        if (enabledCallback)\n          enabledCallback();\n        return;\n      }\n      beforeAct(result, function () {\n        cb.utils.localPrint(result);\n        if (enabledCallback)\n          enabledCallback();\n      });\n    });\n  }\n  const isInWorkBench = function (model) {\n    let bReturn = false;\n    const key = 'isInWorkBench';\n    bReturn = isModelHasKey(model, key);\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    return bReturn;\n  }\n  const isHideAlert = function (model) {\n    let bReturn = false;\n    const key = 'isHideAlert';\n    bReturn = isModelHasKey(model, key);\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    if (model && bReturn == false) {\n      model = model.getParent();\n      bReturn = isModelHasKey(model, key);\n    }\n    return bReturn || false;\n  }\n\n  const isModelHasKey = function (model, key) {\n    return (model && (model.getCache(key) == true)) || false;\n  }\n\n  const save = function (billNo, viewmodel, params, beforeAct, afterAct, caption) {\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'save';\n      });\n      Object.assign(params, configParams);\n    }\n    if (viewmodel.getGridModel() && viewmodel.getGridModel().getRowsCount()) {\n      viewmodel.getGridModel().select(0); // \n    }\n    const invalidMsg = viewmodel.validate();\n    if (invalidMsg) {\n      // if (params.dimensionGroupCode)\n      if (isHideAlert(viewmodel) == true)\n        afterAct({ err: { message: '' + invalidMsg.join(',') } })\n      /* delete by jinzh1  */\n      else if (cb.extendConfig.theme === 'ncc')\n        cb.utils.alert(viewmodel.getCache('customErrorMessage') || '' + invalidMsg.join(','), 'error');\n      else {\n        const invalidFields = viewmodel.getCache('invalidFields');\n        if (invalidFields) {\n          const msg = []; let bHasMoreMsg = false;\n          invalidFields.forEach(field => {\n            const property = viewmodel.get(field);\n            const bShowIt = property.get('bShowIt');\n            const bHidden = property.get('bHidden');\n            if (bShowIt === false || bHidden) {\n              msg.push(property._get_data('cShowCaption') || property._get_data('cCaption') || property._get_data('cFieldName'))\n            } else {\n              bHasMoreMsg = true;\n            }\n          });\n          if (msg.length > 0 && !bHasMoreMsg)\n            cb.utils.alert('' + msg.join(','), 'error');\n          else\n            cb.utils.alert('' + invalidMsg.join(','), 'error');\n        }\n      }\n      console.log('---' + invalidMsg.join(','));\n      return;\n    }\n    const mode = common.getMode(viewmodel)\n    const { metaType } = viewmodel.getParams();\n    let data = viewmodel.collectData()\n    if (!data) {\n      if (metaType !== 'treevoucher') {\n        cb.utils.alert('')\n        viewmodel.setReadOnly(true)\n        common.setState(viewmodel)\n        staterule.runState(viewmodel)\n      }\n      return\n    }\n    if (metaType == 'editablevoucherlist') {\n      data = data[viewmodel.getGridModel().getName()]\n    }\n    if (mode == env.VOUCHER_STATE_ADD) {\n      data._status = cb.models.DataStates.Insert\n      if (metaType === 'treevoucher') {\n        const treeModel = viewmodel.getTreeModel();\n        const parentData = data[treeModel.getState('parentField')];\n        if (parentData) {\n          if (treeModel) {\n            const parentNode = treeModel.getNodesByKeys(parentData);\n            if (parentNode && parentNode.length)\n              data.level = parentNode[0].level + 1;\n          }\n        } else {\n          data.level = 1;\n        }\n      }\n      const parentId = common.getVmParams(viewmodel, 'parentId') // \n      if (parentId != undefined) {\n        const key = common.getVmParams(viewmodel, 'foreignKey') // parentid\n        if (key) {\n          data[key] = parentId\n        }\n      }\n    } else {\n      data._status = cb.models.DataStates.Update\n    }\n\n    const postData = Object.assign({\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }, params.defineParams);\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        // if (err) {\n        //   cb.utils.alert(err.message, 'error');\n        //   return;\n        // }\n        let newData = res;\n        const afterActData = {\n          params,\n          err: err,\n          res: newData\n        }\n        if (!err) {\n          viewmodel.setDirty(false);// \n          // \n          _handlePageInfoStatus(viewmodel, params, res);\n          // if(metaType === 'treevoucher' && viewmodel.getTreeModel) {\n          //   _loadTree(viewmodel, {\n          //     billnum: billNo,\n          //     treename: common.getVmParams(viewmodel, 'treeName')\n          //   }, function () { });\n          // }\n          if (isHideAlert(viewmodel) == false) {\n            // const content = `${caption || params.cShowCaption || params.cCaption || ''}`;//\n            const content = cb.locale('P_YS_FED_FW_0001026085', {text: caption || params.cShowCaption || params.cCaption || ''})\n            if (window.parent !== window && cb.rest.AppContext.query.random && viewmodel.getParams().domain)\n              window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random, msg: { type: 'success', content } }, '*');\n            else\n              cb.utils.alert(content, 'success')\n          }\n          /*  */\n          //   if (params.dimensionGroupCode) {\n          if (isInWorkBench(viewmodel) == true) {\n            afterAct(afterActData, common.afterAct);\n            return\n          }\n          const { menuId, saveReturn } = viewmodel.getParams();\n          if (viewmodel.getCache('entryMode') === env.VOUCHER_STATE_BROWSE || !menuId || saveReturn === false || metaType === 'treevoucher')\n            common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n          const currentAction = params.cAction.trim().toLocaleLowerCase();\n          if (currentAction === 'saveandadd') {\n            // \n            if (metaType === 'treevoucher') {\n              const treeModel = viewmodel.getTreeModel();\n              viewmodel.execute('updateTreeRefer')\n              if (viewmodel.getParams().saveRefresh) {\n                //  defaultSelectedKeystree()\n                const key = newData[treeModel.getState('keyField')];\n                treeModel._set_data('defaultSelectedKeys', [key])\n                _loadTree(viewmodel, {\n                  billnum: billNo,\n                  treename: common.getVmParams(viewmodel, 'treeName')\n                }, function () { });\n              } else {\n                if (mode !== env.VOUCHER_STATE_ADD) {\n                  treeModel.updateNode(newData)\n                } else {\n                  treeModel.addNode(newData)\n                }\n              }\n            }\n\n            afterAct(afterActData, common.afterAct);\n            return/*  */\n          }\n          if (currentAction !== 'saveandaudit' && viewmodel.getParams().saveReturn !== false && (viewmodel.getParams().multitpl || viewmodel.getCache('entryMode') !== env.VOUCHER_STATE_BROWSE) && metaType !== 'treevoucher' && !menuId) {\n            if (cb.utils.isEmpty(viewmodel.get('id').getValue()) && res)\n              viewmodel.get('id').setValue(res.id);\n            afterAct(afterActData, common.afterAct);\n            viewmodel.communication({ type: 'return', payload: viewmodel.get('id').getValue() });\n            return;\n          }\n          // common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n          const gridModels = viewmodel.getGridModels();\n          gridModels.forEach(gridModel => {\n            gridModel.unselectAll()\n          });\n          const oldData = viewmodel.collectData(true)\n          let condition;\n          const arrayKeys = []\n          for (const key in res) {\n            if (Array.isArray(res[key]) && viewmodel.get(key) && viewmodel.get(key).getDirtyRowIndexes &&\n              viewmodel.get(key).getDirtyRowIndexes() && viewmodel.get(key).getDirtyRowIndexes().length > 0) {\n              arrayKeys.push(key)\n              condition = {};\n            }\n          }\n\n          arrayKeys.forEach((key) => {\n            condition[key] = viewmodel.get(key).getDirtyRowIndexes()\n          })\n          newData = common.billMerge(oldData, res, condition)\n          render(viewmodel, newData)\n          if (metaType === 'treevoucher') {\n            const treeModel = viewmodel.getTreeModel();\n            common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE)\n            viewmodel.execute('updateTreeRefer')\n            if (viewmodel.getParams().saveRefresh) {\n              //  defaultSelectedKeystree()\n              const key = newData[treeModel.getState('keyField')];\n              treeModel._set_data('defaultSelectedKeys', [key])\n              _loadTree(viewmodel, {\n                billnum: billNo,\n                treename: common.getVmParams(viewmodel, 'treeName')\n              }, function () { });\n            } else {\n              if (mode !== env.VOUCHER_STATE_ADD) {\n                treeModel.updateNode(newData)\n              } else {\n                treeModel.addNode(newData, true)\n              }\n            }\n          }\n          // render(viewmodel, newData)\n        }\n        // let afterActData = {\n        //   params,\n        //   err: err,\n        //   res: newData\n        // }\n        afterAct(afterActData, common.afterAct)\n      }\n      params.options = { mask: true };\n      common.doProxy(params, callback, postData)\n    })\n    // }\n  }\n  const _delete = function (viewmodel, params, postData, afterAct, isReturn) {\n    const { metaType } = viewmodel.getParams();\n    common.doProxy(params, function (err, suc) {\n      if (!err) {\n        viewmodel.setCache('deleteError', false);\n        cb.utils.alert('', 'success')\n        if (metaType === 'treevoucher') {\n          const treeModel = viewmodel.getTreeModel()\n          if (treeModel) {\n            const key = treeModel.getSelectedKeys()\n            if (key && key.length == 1) {\n              const selectedNode = treeModel.getSelectedNodes()[0];\n              const nextNode = treeModel.getNextSibling(selectedNode);\n              const prevNode = treeModel.getPrevSibling(selectedNode);\n              const parentNode = treeModel.getParentNode(selectedNode);\n              treeModel.deleteNode(key)\n              if (cb.extendConfig.voucher.treeCard || (cb.extendConfig.treeVoucher || {}).selectAfterDelete === null) {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel)\n              } else if ((cb.extendConfig.treeVoucher || {}).selectAfterDelete === 'prev') {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel, treeModel._get_data('dataSource'));\n                treeModel.selectNodes(prevNode || nextNode || parentNode);\n              } else if ((cb.extendConfig.treeVoucher || {}).selectAfterDelete === 'next') {\n                common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                render(viewmodel, treeModel._get_data('dataSource'));\n                treeModel.selectNodes(nextNode || prevNode || parentNode);\n              }\n              else {\n                const dataSource = treeModel._get_data('dataSource') || [];\n                if (dataSource.length > 0) {\n                  common.setMode(viewmodel, env.VOUCHER_STATE_BROWSE);\n                  render(viewmodel, treeModel._get_data('dataSource'));\n                  treeModel.selectNodes(nextNode || prevNode || parentNode);\n                } else {\n                  // viewmodel.clear()\n                  common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n                  // _render(viewmodel);\n                  viewmodel.biz.do('add', viewmodel);\n                }\n              }\n            }\n          }\n        } else {\n          // ncc \n          if (!viewmodel.getCache('condition') && process.env.__THEMETYPE__ == 'ncc') {\n            viewmodel.communication({ type: 'return' });\n            return;\n          }\n\n          if (viewmodel.getParams().menuId) {\n            if (window.parent !== window && window.jDiwork)\n              jDiwork.closeWin();\n            else\n              render(viewmodel);\n          }\n          else if (!isReturn)\n            viewmodel.communication({ type: 'return' });\n        }\n        // viewmodel.execute('moveprev')\n        if (viewmodel.getCache('returnList')) {\n          viewmodel.communication({\n            type: 'return'\n          });\n          viewmodel.setCache('returnList', false);\n        }\n      }\n      else {\n        viewmodel.setCache('deleteError', true);\n      }\n      const afterActData = {\n        err: err,\n        res: suc\n      }\n      afterAct(afterActData, common.afterAct)\n    }, postData)\n  }\n  const doDelete = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const { metaType } = viewmodel.getParams();\n    if (metaType === 'treevoucher') {\n      const node = _getTreeSelectNode(viewmodel)\n      if (!node) {\n        cb.utils.alert('', 'warning');\n        return;\n      }\n      if (node && node.children && node.children.length > 0) {\n        if (!cb.extendConfig.voucher.treeCard) {\n          cb.utils.alert('', 'warning')\n          return\n        }\n      }\n    }\n    let data = viewmodel.getNecessaryData();\n    if (metaType === 'treevoucher' && cb.extendConfig.voucher.treeCard) { // ncc,\n      const node = _getTreeSelectNode(viewmodel);\n      data = node;\n    }\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const text = viewmodel.getParams().caption;\n      let isReturn = false;\n      cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026053', {text}), function () {\n        // \n        let deleteReturn = cb.extendConfig.voucher.deleteReturn;\n        if (deleteReturn && !viewmodel.getParams().menuId && metaType !== 'treevoucher') {\n          // \n          if (themeType == 'ncc') {\n            deleteReturn = _handlePageInfoStatus(viewmodel, params);\n          }\n          const nextAction = viewmodel.allActions.find((x) => {\n            const cmdDelRe = `cmd${deleteReturn}`;\n            return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === cmdDelRe\n          });\n          if (nextAction) {\n            viewmodel.biz.do(deleteReturn, viewmodel, nextAction);\n            isReturn = true;\n          }\n        }\n        if (viewmodel.getCache('isReturn')) {\n          isReturn = true;\n        }\n        if (metaType === 'treevoucher' && cb.extendConfig.voucher.treeCard) { // ncc\n          cb.utils.confirm('', function () {\n            if (data && data.children && data.children.length > 0) {\n              cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026052', {text}), function () {\n                _delete(viewmodel, params, postData, afterAct, isReturn);\n              });\n            }\n            else {\n              _delete(viewmodel, params, postData, afterAct, isReturn);\n            }\n          });\n        }\n        else {\n          _delete(viewmodel, params, postData, afterAct, isReturn);\n        }\n      }, function () {\n        if (params && params.enabledCallback)\n          params.enabledCallback();\n      })\n    });\n  }\n\n  const moveFirstOrLast = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    const postData = {\n      billnum: billNo,\n      condition: viewmodel.getCache('condition')\n    }\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        const afterActData = {\n          err: err,\n          res: res\n        }\n        afterAct(afterActData, common.afterAct);\n        if (!err) {\n          // \n          _handlePageInfoStatus(viewmodel, params);\n          render(viewmodel, res)\n        }\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  const movePrevOrNext = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    viewmodel.setCache('deleteError', false);\n    // ncc \n    if (!viewmodel.getCache('condition') && process.env.__THEMETYPE__ == 'ncc') return;\n    const httpMethod = params.cHttpMethod ? params.cHttpMethod.toLocaleLowerCase() : 'get';\n    // get \n    const condition = httpMethod == 'get' ? encodeURI(JSON.stringify(viewmodel.getCache('condition'))) : viewmodel.getCache('condition');\n\n    const postData = {\n      billnum: billNo,\n      id: viewmodel.get('id').getValue(),\n      condition: condition\n    }\n    // cb.utils.extend(postData, viewmodel.getNecessaryData())\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          const bSwitchTpl = _tplIsEquql(res, viewmodel);\n          const deleteError = viewmodel.getCache('deleteError')\n          if (!deleteError) {\n            _reloadVoucher(bSwitchTpl, res, viewmodel, billNo, afterAct)\n          }\n          // \n          _handlePageInfoStatus(viewmodel, params);\n        } else {\n          const afterActData = {\n            err: err,\n            res: res\n          }\n          if (err && !res) {\n            viewmodel.setCache('returnList', true);\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n      }\n      common.doProxy(params, callback, postData)\n    })\n  }\n\n  // \n  const pull = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    const targetCode = queryString.get('code')\n    const targetBillNo = queryString.get('targetBillNo')\n    if (targetCode && targetBillNo) {\n      const queryData = {\n        code: targetCode,\n        isMainSelect: 1,\n        childIds: [viewmodel.get('id').getValue()]\n      }\n      const par = {\n        cSvcUrl: queryString.pathname + queryString.toStr(),\n        cHttpMethod: params.cHttpMethod\n      }\n      const beforeActData = {\n        params: params,\n        data: queryData\n      }\n      beforeAct(beforeActData, function () {\n        const callback = function (err, data) {\n          if (!err) {\n            const params = {\n              mode: env.VOUCHER_STATE_ADD,\n              carryData: data\n            }\n            const dt = {\n              billtype: 'voucher',\n              billno: targetBillNo,\n              params: params\n            }\n            cb.loader.runCommandLine('bill', dt, viewmodel)\n          }\n          const afterActData = {\n            err: err,\n            res: data\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        common.doProxy(par, callback, queryData)\n      })\n    }\n  }\n  const saveAndAdd = (billNo, viewModel, params) => {\n    let saveParams = viewModel.allActions && viewModel.allActions.find(item => {\n      return item.cAction.trim().toLocaleLowerCase() === 'save';\n    });\n    if (!saveParams) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    saveParams = Object.assign({}, saveParams, { cAction: params.cAction });\n    const beforeSave = (beforeActData, callback) => {\n      viewModel.promiseExecute('beforeSave', beforeActData, callback);\n    };\n    const afterSave = (afterActData, callback) => {\n      viewModel.promiseExecute('afterSave', afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    save(billNo, viewModel, saveParams, beforeSave, function (afterSaveData) {\n      afterSave(afterSaveData, function () {\n        viewModel.setCache('actionType', 'saveandadd');\n        if (afterSaveData.err) {\n          common.afterAct(afterSaveData);\n          return;\n        }\n        viewModel.clear(false);\n        let addParams = viewModel.allActions && viewModel.allActions.find(item => {\n          return item.cAction.trim().toLocaleLowerCase() === 'add';\n        });\n        // if (!addParams) {\n        //   cb.utils.alert('', 'error');\n        //   return;\n        // }\n        addParams = Object.assign({}, addParams, { cAction: params.cAction });\n        const beforeAdd = (beforeActData, callback) => {\n          viewModel.promiseExecute('beforeAdd', beforeActData, callback);\n        };\n        const afterAdd = (afterActData, callback) => {\n          viewModel.promiseExecute('afterAdd', afterActData, function () {\n            callback && callback(afterActData);\n            const propertyNames = viewModel._get_data('propertyNames');\n            propertyNames.forEach(function (propertyName) {\n              const property = viewModel.get(propertyName);\n              if (property instanceof cb.models.BaseModel) {\n                property.doPropertyChange('validate', {\n                  type: '',\n                  message: ''\n                });\n              }\n            }, viewModel);\n          });\n        };\n        addParams.saveData = afterSaveData.res;/* add by jinzh1   */\n        add(billNo, viewModel, addParams, beforeAdd, afterAdd);\n      });\n    });\n  }\n  const saveAndAudit = (billNo, viewModel, params) => {\n    let saveParams = viewModel.allActions && viewModel.allActions.find(item => {\n      return item.cAction.trim().toLocaleLowerCase() === 'save';\n    });\n    if (!saveParams) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    saveParams = Object.assign({}, saveParams, { cAction: params.cAction });\n    const beforeSave = (beforeActData, callback) => {\n      viewModel.promiseExecute('beforeSave', beforeActData, callback);\n    };\n    const afterSave = (afterActData, callback) => {\n      viewModel.promiseExecute('afterSave', afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    save(billNo, viewModel, saveParams, beforeSave, function (afterSaveData) {\n      afterSave(afterSaveData, function () {\n        if (afterSaveData.err) {\n          common.afterAct(afterSaveData);\n          return;\n        }\n        let auditParams = viewModel.allActions && viewModel.allActions.find(item => {\n          return item.cAction.trim().toLocaleLowerCase() === 'audit';\n        });\n        if (!auditParams) {\n          cb.utils.alert('', 'error');\n          return;\n        }\n        auditParams = Object.assign({}, auditParams, { cAction: params.cAction });\n        const beforeAudit = (beforeActData, callback) => {\n          viewModel.promiseExecute('beforeAudit', beforeActData, callback);\n        };\n        const afterAudit = (afterActData, callback) => {\n          viewModel.promiseExecute('afterAudit', afterActData, function () {\n            callback && callback(afterActData);\n          });\n        };\n        audit(billNo, viewModel, auditParams, beforeAudit, afterAudit);\n      });\n    });\n  }\n  const add = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    if (!viewmodel) {\n      return _getInitdata(billNo, params, afterAct);\n    }\n    params = params || {};\n    if (!params.cAction) {\n      const configParams = viewmodel.allActions && viewmodel.allActions.find(item => {\n        return item.cAction.trim().toLocaleLowerCase() === 'add';\n      });\n      Object.assign(params, configParams);\n    }\n    const queryString = new cb.utils.queryString(params.cSvcUrl)\n    let callbackdata = []\n    if (queryString.has('code')) {\n      const dt = {\n        billtype: 'billmaker',\n        billno: queryString.get('billno'),\n        params: {\n          code: queryString.get('code'),\n          makeBilltype: queryString.get('makeBilltype')\n        }\n      }\n      cb.loader.runCommandLine('bill', dt, null, function (vm, viewmeta) {\n        const callback = function (err, suc) {\n          callbackdata = suc\n          const afterActData = {\n            err: err,\n            params: params,\n            res: suc\n          }\n          afterAct(afterActData, common.afterAct)\n        }\n        const postData = {\n          billnum: billNo\n        }\n        const beforeActData = {\n          params: params,\n          data: postData\n        };\n        beforeAct(beforeActData, function () {\n          common.emptyBill(postData, params, callback)\n          vm.on('afterOkClick', function (args) {\n            if (args.data) {\n              common.setMode(viewmodel, env.VOUCHER_STATE_ADD)\n              const newdata = common.billMerge(args.data, callbackdata)\n              render(viewmodel, newdata, true)\n            }\n          })\n          vm.on('close', function () {\n            viewmodel.communication({\n              type: 'modal',\n              payload: false\n            })\n          })\n          viewmodel.communication({\n            type: 'modal',\n            payload: {\n              type: 'platform',\n              url: 'billmaker',\n              model: viewmodel,\n              data: {\n                vm: vm,\n                viewmeta: viewmeta\n              }\n            }\n          })\n        })\n      })\n    } else {\n      let selectedNode;\n      const { metaType } = viewmodel.getParams();\n      if (metaType === 'treevoucher') {\n        const maxLevel = viewmodel.getTreeModel().getState('maxLevel');\n        const level = maxLevel === false ? 65536 : (maxLevel || 3);\n        selectedNode = _getTreeSelectNode(viewmodel)\n        if (selectedNode && selectedNode.level > level) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026057', {level: (level + 1)}), 'error');\n          return;\n        }\n      }\n      let postData = {\n        billnum: billNo\n      }\n      Object.assign(postData, params.carryParams);\n      if (metaType === 'treevoucher' && cb.extendConfig.voucher.treeCard) {\n        const treeModel = viewmodel.getTreeModel();\n        const parentId = treeModel.getState('keyField');\n        postData = Object.assign({}, postData, {\n          [parentId]: selectedNode && selectedNode[treeModel.getState('keyField')]\n        });\n      }\n      const beforeActData = {\n        params: params,\n        data: postData\n      };\n      beforeAct(beforeActData, function () {\n        common.emptyBill(postData, params, function (err, suc) {\n          suc = suc || {};\n          const afterActData = {\n            err: err,\n            params: params,\n            res: suc\n          }\n          if (!err) {\n            common.setMode(viewmodel, env.VOUCHER_STATE_ADD);\n            viewmodel.addData = suc\n            if (viewmodel.get(env.VOUCHER_TPL_KEY)) {\n              const currentTpl = viewmodel.get(env.VOUCHER_TPL_KEY).getValue()\n              suc[env.VOUCHER_TPL_KEY] = currentTpl\n            }\n            if (metaType === 'treevoucher') {\n              const treeModel = viewmodel.getTreeModel();\n              const parentField = treeModel.getState('parentField');\n              if (selectedNode && suc[parentField] == null) {\n                suc[parentField] = selectedNode[treeModel.getState('keyField')];\n                suc.parent_name = selectedNode.name;\n              }\n            }\n            if (cb.extendConfig && cb.extendConfig.theme == 'ncc') {\n              render(viewmodel, suc, true);\n            } else {\n              render(viewmodel, Object.assign({}, suc, params.carryData), true, !params.carryData);\n            }\n            // render(viewmodel, suc);\n            if (params.callback)\n              params.callback();\n            else {\n              const { masterOrgField, masterOrgKeyField } = viewmodel.getParams();\n              const masterOrgModel = viewmodel.get(masterOrgField);\n              if (masterOrgModel) {\n                const model = viewmodel.get(masterOrgKeyField);\n                if (model) {\n                  const orgId = model.getValue();\n                  if (orgId) {\n                    const condition = {\n                      isExtend: true,\n                      simpleVOs: [{ field: 'id', op: 'in', value1: orgId }]\n                    };\n                    const errCallBack = function () {\n                      model.setValue(null);\n                      viewmodel.setDisabled(true);\n                      viewmodel.get('btnAbandon') && viewmodel.get('btnAbandon').setDisabled(false);\n                      masterOrgModel.setDisabled(false);\n                      return false;\n                    }\n                    const vm = masterOrgModel.getCache('vm');\n                    if (vm) {\n                      vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n                    } else {\n                      masterOrgModel.browse(false, function (vm) {\n                        vm.on('getRefMetaReady', function () {\n                          vm.execute('pressEnter', { model: masterOrgModel, condition: condition, browse: false, errCallBack });\n                        });\n                      });\n                    }\n                  }\n                }\n              }\n            }\n          }\n          afterAct(afterActData, common.afterAct)\n        })\n      })\n    }\n  }\n  const getPredicateValue = formatValue => {\n    const exp = /<%.*?%>/g;\n    const items = formatValue.match(exp);\n    if (!items)\n      return formatValue;\n    const values = {};\n    let valid = true;\n    items.forEach(item => {\n      const predicate = item.substring(2, item.length - 2).split('.');\n      if (predicate.length !== 2) {\n        valid = false;\n        return;\n      }\n      const obj = cb.rest.AppContext[predicate[0]];\n      values[item] = obj && (cb.utils.isEmpty(obj[predicate[1]]) ? '' : obj[predicate[1]]);\n    });\n    if (!valid)\n      return formatValue;\n    return formatValue.replace(exp, function (key) {\n      return values[key];\n    });\n  }\n  const localoutput = async (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const XLSX = await import('xlsx');\n    const outputData = viewmodel.get(`${params.childrenField}`).getData();\n    const dataColumns = viewmodel.get(`${params.childrenField}`).getColumns();\n    const res = [];\n    const tmpObj = {};\n    // \n    for (let i = 0; i < outputData.length; i++) {\n      const resObj = {};\n      for (const key in dataColumns) {\n        const keyName = dataColumns[key].cShowCaption ? dataColumns[key].cShowCaption : dataColumns[key].cCaption;\n        if (dataColumns[key].bShowIt && !dataColumns[key].bHidden) {\n          const resDetails = outputData[i];\n          const resSonObj = {};\n          resSonObj.cShowCaption = keyName;\n          resSonObj.cControlType = dataColumns[key].cControlType;\n          resSonObj.cFormatData = dataColumns[key].cFormatData;\n          resSonObj.iNumPoint = dataColumns[key].iNumPoint;\n          resSonObj.cEnumString = dataColumns[key].cEnumString;\n          let enumValue = null;\n          if (dataColumns[key].cEnumString) {\n            const enumString = dataColumns[key].cEnumString;\n            const lookupVector = Object.keys(eval('(' + enumString + ')')); // eslint-disable-line no-eval\n            const resultVector = Object.values(eval('(' + enumString + ')')); // eslint-disable-line no-eval\n            const thisLoc = lookupVector.indexOf(resDetails[key].toString());\n            enumValue = resultVector[thisLoc];\n          }\n          resSonObj.iColWidth = dataColumns[key].iColWidth;\n          tmpObj[key] = resSonObj;\n          resObj[keyName] = enumValue || resDetails[key];\n        }\n      }\n      res.push(resObj);\n    }\n    // \n    const fileName = `${billNo}.xlsx`;\n    const sheet = XLSX.utils.json_to_sheet(res);\n    // (header)\n    const sheetRowCount = res.length;\n    // \n    const colCount = Object.keys(res[0]).length;\n    sheet['!cols'] = new Array(colCount);\n    const rowRange = XLSX.utils.decode_range(sheet['!ref']);\n    for (let R = 0; R <= 1; ++R) {\n      for (let C = rowRange.s.c; C <= rowRange.e.c; ++C) {\n        if (R == 0) {\n          const cell_address = { c: C, r: R };\n          /* if an A1-style address is needed, encode the address */\n          const cell_ref = XLSX.utils.encode_cell(cell_address);\n          const value = sheet[cell_ref].v;\n          for (const key in tmpObj) {\n            if (tmpObj[key].cShowCaption === value) {\n              const controlType = tmpObj[key].cControlType;\n              const cellConfig = tmpObj[key];\n              let cFormatData = cellConfig.cFormatData;\n              sheet['!cols'][C] = { wpx: cellConfig.iColWidth };\n              if (cFormatData === 'YYYY-MM-DD') {\n                const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                  const thisCell_address = { c: C, r: R };\n                  const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                  sheet[thisCell_ref].t = 'd';\n                }\n              }\n\n              switch (controlType && controlType.trim().toLocaleLowerCase()) {\n                case 'inputnumber':\n                case 'money':\n                case 'price': {\n                  try {\n                    if (!cFormatData || cFormatData == '') {\n                      cFormatData = {};\n                    } else {\n                      cFormatData = JSON.parse(cFormatData);\n                    }\n                  } catch (e) {\n                    cb.utils.alert('//', 'error');\n                  }\n                  let iNumPoint = cellConfig.iNumPoint;\n                  const decimal = cFormatData.decimal ? getPredicateValue(cFormatData.decimal) : null;\n                  if (controlType === 'money') {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                      iNumPoint = cb.rest.AppContext.option.amountofdecimal;\n                  } else if (controlType === 'price') {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                      iNumPoint = cb.rest.AppContext.option.monovalentdecimal;\n                  } else {\n                    if (decimal)\n                      iNumPoint = decimal;\n                    else\n                    if (cb.utils.isEmpty(iNumPoint)) iNumPoint = null;\n                  }\n                  if (controlType === 'money' || (cFormatData.decimal && cFormatData.decimal.indexOf('amountofdecimal'))) {\n                    cFormatData.splitter = true\n                    // ()\n                    if (!iNumPoint) {\n                      const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                      for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                        const thisCell_address = { c: C, r: R };\n                        const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                        sheet[thisCell_ref].z = XLSX.SSF._table[3]; ;\n                      }\n                    }\n                  }\n                  if (iNumPoint) {\n                    // ()\n                    const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n                    for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                      const thisCell_address = { c: C, r: R };\n                      const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                      let decimalCount = cFormatData.splitter ? '#,##0.0' : '0.0'\n                      for (let i = 1; i < iNumPoint; i++) {\n                        decimalCount = decimalCount + '0';\n                      }\n                      sheet[thisCell_ref].z = decimalCount;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        } else if (R === 1) {\n          const cell_address = { c: C, r: R };\n          /* if an A1-style address is needed, encode the address */\n          const cell_ref = XLSX.utils.encode_cell(cell_address);\n          if (sheet[cell_ref].t === 'n') {\n            let length = sheet[cell_ref].v.toString().length;\n            if (sheet[cell_ref].z) {\n              const re = /[0-9]+\\.([0-9]*)/;\n              // \n              const deciLength = sheet[cell_ref].v.toString().replace(re, '$1').length;\n              length = length + deciLength;\n            } else if (length >= 12) {\n              // \n              const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n              for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n                const thisCell_address = { c: C, r: R };\n                const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n                sheet[thisCell_ref].z = XLSX.SSF._table[1];\n              }\n            }\n          } else if (sheet[cell_ref].t === 'b') {\n            const colRange = { s: { r: 1, c: C }, e: { r: sheetRowCount, c: C } };\n            for (let R = colRange.s.r; R <= colRange.e.r; ++R) {\n              const thisCell_address = { c: C, r: R };\n              const thisCell_ref = XLSX.utils.encode_cell(thisCell_address);\n              sheet[thisCell_ref].t = 's';\n              sheet[thisCell_ref].v = sheet[thisCell_ref].v ? '' : '';\n            }\n          }\n        }\n      }\n    }\n    const wb = XLSX.utils.book_new();\n    // wbsheet\n    XLSX.utils.book_append_sheet(wb, sheet, `${params.childrenField}`);\n    //  Excel\n    XLSX.writeFile(wb, fileName);\n  }\n  const output = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    if (!queryString) {\n      return\n    }\n    const inputParams = {\n      billnum: billNo,\n      ids: [viewmodel.get('id').getValue()].join(),\n      id: viewmodel.get('id').getValue(),\n      data: params.data,\n      partParam: params.partParam\n    }\n    const url = queryString && queryString.pathname + queryString.toStr()\n\n    const beforeActData = {\n      params: params,\n      data: inputParams\n    };\n    beforeAct(beforeActData, function () {\n      common.createDownloadForm(url, inputParams);\n      afterAct()\n    })\n  }\n\n  const savebo = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const proxy = cb.rest.DynamicProxy.create({\n      saveBo: { url: 'print/saveBo', method: 'GET' }\n    })\n    proxy.saveBo({ billno: billNo }, function (err, result) {\n      if (err) {\n        cb.utils.alert(err.message, 'error');\n        return;\n      }\n      cb.utils.alert('', 'success');\n    });\n  }\n\n  const preview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const actionName = params.params && params.params.cAction;\n    if (actionName === 'localPrint') {\n      const localPrintButtonModel = viewmodel.get('btnLocalPrint');\n      if (localPrintButtonModel) {\n        params.disabledCallback = function () {\n          localPrintButtonModel.setDisabled(true);\n        }\n        params.enabledCallback = function () {\n          localPrintButtonModel.setDisabled(false);\n        }\n      }\n      viewmodel.biz.do(actionName, viewmodel, params);\n      return;\n    }\n    beforeAct({ params }, function () {\n      let printTplItemName = '';\n      let template = '';\n      let errInfo = '';\n\n      if (params.cParameter) {\n        const cParameter = JSON.parse(params.cParameter);\n        printTplItemName = cParameter && cParameter.printTplItemName;\n      }\n      if (!printTplItemName) {\n        errInfo = 'cParameter{printTplItemName : cItemName}';\n      }\n      else {\n        template = viewmodel.get(printTplItemName).getValue();\n        if (!template) {\n          errInfo = '';\n        }\n      }\n      if (errInfo != '') {\n        cb.utils.alert(errInfo, 'warning');\n        afterAct({ err: errInfo });\n        return;\n      }\n      const inElectronApp = cb.electron.getSharedObject();\n      const newTab = inElectronApp ? null : window.open('about:blank');\n      const proxy = cb.rest.DynamicProxy.create({\n        preview: { url: 'print/printPreview', method: 'POST' }\n      })\n      proxy.preview({\n        route: params.cSvcUrl || '/bill',\n        billno: billNo,\n        template: template,\n        ids: [viewmodel.get('id').getValue()]\n      }, function (err, result) {\n        if (!err) {\n          const { user, serviceUrl } = cb.rest.AppContext;\n          result = `${result}&lang=${user && user.locale || 'zh_CN'}`;\n          if (inElectronApp) {\n            cb.electron.sendOrder('openExternal', `${serviceUrl}${result}&token=${user && user.token || ''}`);\n          } else {\n            newTab.location.href = result;\n          }\n        }\n        const afterActData = {\n          err: err,\n          res: result\n        };\n        afterAct(afterActData, common.afterAct);\n      });\n    });\n  }\n\n  const print = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const postData = {\n      json: {\n        bill: {\n          billnum: billNo,\n          ids: [viewmodel.get('id').getValue()],\n          tplid: printID\n        },\n        type: 'voucher'\n      }\n    }\n\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, result) {\n        if (err) {\n          console.error(err)\n          return\n        }\n        window.open(result)\n        afterAct()\n      }\n      common.doPrint(postData, params, callback)\n    })\n  }\n\n  const initDefaultActions = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const allActions = viewmodel.allActions\n    const beforeActData = {\n      params: params,\n      data: allActions\n    };\n    beforeAct(beforeActData, function () {\n      viewmodel.on('moveprev', function () {\n        const prevAction = allActions.find((x) => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdmoveprev'\n        })\n        if (prevAction) {\n          movePrevOrNext(billNo, viewmodel, prevAction)\n        }\n      })\n      viewmodel.on('movenext', function () {\n        const nextAction = allActions.find((x) => {\n          return x.cCommand && x.cCommand.trim().toLocaleLowerCase() === 'cmdmovenext'\n        })\n        if (nextAction) {\n          movePrevOrNext(billNo, viewmodel, nextAction)\n        }\n      })\n      if (viewmodel.get(env.VOUCHER_TPL_KEY)) {\n        viewmodel.get(env.VOUCHER_TPL_KEY).on('afterValueChange', function (data) {\n          if (data && data.value) {\n            viewmodel.biz.do('selecttpl', viewmodel, data)\n          }\n        })\n      }\n      afterAct()\n    })\n  }\n\n  const selectTpl = function (billNo, oldVM, params, beforeAct, afterAct) {\n    params.tplid = params.value.value\n    const cbk = (err, result,) => {\n      const vmAndView = common.initVM(err, result, billNo, params)\n      if (vmAndView) {\n        const { vm: newVM, view: newView } = vmAndView\n        oldVM.communication({\n          payload: {\n            menuName: newView.cBillName,\n            vm: newVM,\n            refresh: true,\n            metaData: newView\n          }\n        })\n        _loadVm(oldVM, newVM)\n        common.setMode(newVM, common.getMode(oldVM))\n        let loadData,\n          setData\n        if (common.getMode(newVM) == env.VOUCHER_STATE_ADD) {\n          loadData = oldVM.collectData(true)\n          setData = oldVM.addData\n        } else {\n          loadData = oldVM.getOriginalData()\n          setData = oldVM.collectData(true)\n        }\n        newVM.setData(setData)\n        render(newVM, loadData, common.getMode(newVM) == env.VOUCHER_STATE_ADD)\n\n        if (afterAct) afterAct()\n      }\n    }\n    const beforeActData = {\n      params: params,\n    };\n    beforeAct(beforeActData, function () {\n      common.fetchMeta(billNo, params, cbk)\n    })\n  }\n\n  const push = function (billNo, viewModel, params, beforeAct, afterAct) {\n    console.log('begin-push--' + new Date().valueOf())\n    if (viewModel) {\n      common.push(viewModel, params, viewModel.collectData(true), beforeAct, afterAct);\n      return;\n    }\n    if (!params || !params.cSvcUrl) return;\n    const queryString = new cb.utils.queryString(params.cSvcUrl);\n    const groupCode = queryString.get('groupCode'); const targetCode = queryString.get('code');\n    if (!targetCode) return;\n    const callback = function (err, pushData) {\n      if (err) {\n        if (window.parent !== window && cb.rest.AppContext.query.random && params.domain)\n          window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random, args: err.message }, '*');\n        else\n          common.afterAct({ err });\n        return;\n      }\n      if (window.parent !== window && cb.rest.AppContext.query.random && params.domain)\n        window.parent.postMessage({ key: 'crossdomainpush', random: cb.rest.AppContext.query.random }, '*');\n      if (!pushData.targetData) return;\n      // fangqg: \n      delete pushData.targetData._status;\n      params.carryParams = params.carryParams || {};\n      params.carryParams.externalData = pushData.targetData;\n      params.targetData = pushData.targetData;\n      /*    */\n      if (pushData.dimensionKeys && pushData.dimensionKeys.length > 1)\n        params.dimensionKeys = pushData.dimensionKeys;\n      params.dimensionGroupCode = groupCode;\n      params.groupTaskKey = pushData.dimensionKeys && pushData.dimensionKeys.length && pushData.dimensionKeys[0].groupTaskKey;\n      params.bWorkbench = !!groupCode;\n      /* delete by jinzh1   saveReturnfalse */\n      // if (params.bWorkbench == false)\n      // if (params.bWorkbench)\n      // params.saveReturn = false;\n      pushData.targetData.dimensionKey = pushData.dimensionKeys && pushData.dimensionKeys[0] && pushData.dimensionKeys[0].key\n      _getInitdata(billNo, params, function (err1, emptyData) {\n        if (err1) {\n          common.afterAct({ err1 });\n          return;\n        }\n        console.log('_getInitdata-push--' + new Date().valueOf())\n        afterAct(null, common.billMerge(emptyData, pushData.targetData));\n        console.log('afterAct-push--' + new Date().valueOf())\n      });\n    };\n    if (!cb.utils.isArray(params.data))\n      params.data = [params.data];\n    const ids = []; const detailIds = [];\n    params.data.forEach(item => {\n      ids.push(item.id);\n      if (params.pushKey)\n        detailIds.push(item[params.pushKey]);\n    });\n    const childIds = params.pushKey ? detailIds : Array.from(new Set(ids));\n    const mainIds = params.pushKey ? Array.from(new Set(ids)) : undefined;\n    const postData = {\n      code: targetCode,\n      isMainSelect: params.pushKey ? 0 : 1,\n      childIds, // cb.utils.isArray(params.data) ? params.data : [params.data.id],\n      mainIds,\n      data: params.data,\n      groupCode: groupCode\n    };\n    Object.assign(postData, params.carryParams);\n    console.log('doProxy-push--' + new Date().valueOf())\n    common.doProxy(params, callback, postData);\n  }\n  const compositeAction = (billNo, viewModel, params) => {\n    let firstAction = null;\n    let Act = null;\n    try {\n      const defineParams = JSON.parse(params.cParameter);\n      firstAction = defineParams.action.split('&')[0].replace(/(\\w)/, function (v) {\n        return v.toUpperCase()\n      });\n      Act = viewModel.biz.action()[firstAction.trim().toLocaleLowerCase()];\n      if (!Act) return;\n      params.defineParams = defineParams;\n    } catch (e) {\n      console.error('compositeAction error: ' + e.message);\n      return;\n    }\n    const beforeAct = (beforeActData, callback) => {\n      viewModel.promiseExecute('before' + firstAction, beforeActData, callback);\n    };\n    const afterAct = (afterActData, callback) => {\n      viewModel.promiseExecute('after' + firstAction, afterActData, function () {\n        callback && callback(afterActData);\n      });\n    };\n    Act(billNo, viewModel, params, beforeAct, afterAct, params.cShowCaption);\n  }\n\n  const saveDraft = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'Savedraft',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n  const saveDatatemp = (billNo, viewModel, params, beforeAct, afterAct) => {\n    viewModel.communication({\n      type: 'modal',\n      payload: {\n        key: 'Savedatatemp',\n        data: {\n          model: viewModel\n        }\n      }\n    });\n  }\n\n  const getYhtUserIds = function (items, callback) {\n    if (!items) return;\n    if (items.user && items.person) {\n      getYhtUserId('user', items.user, function (userIds) {\n        getYhtUserId('person', items.person, function (personIds) {\n          callback(userIds.concat(personIds));\n        })\n      })\n      return;\n    }\n    if (items.user)\n      getYhtUserId('user', items.user, callback);\n    if (items.person || items.id)\n      getYhtUserId('person', items.person || items.id, callback);\n  }\n\n  const getYhtUserId = (type, models, callback) => {\n    let refCode = ''; let yhtField = '';\n    switch (type) {\n      case 'user':\n        refCode = 'productcenter.aa_user';\n        yhtField = 'yhtUserId';\n        break;\n      case 'person':\n      case 'id':\n        refCode = 'ucf-staff-center.bd_staff_ref';\n        yhtField = 'userId';\n        break;\n    }\n    if (!refCode) return;\n    const proxy = cb.rest.DynamicProxy.create({\n      getYhtUserId: { url: '/bill/ref/getRefData', method: 'POST' }\n    });\n    const ids = [];\n    models.forEach(model => {\n      const id = model.getValue();\n      if (!id) return;\n      ids.push(id);\n    })\n    const params = {\n      refCode,\n      dataType: 'grid',\n      condition: {\n        isExtend: true,\n        simpleVOs: [{\n          field: 'id',\n          op: 'in',\n          value1: ids\n        }]\n      }\n    }\n    proxy.getYhtUserId(params, (_err, result) => {\n      if (result && result.recordList && result.recordList.length) {\n        const yhtIds = [];\n        result.recordList.forEach(item => {\n          yhtIds.push(item[yhtField]);\n        });\n        callback(yhtIds);\n      }\n    });\n  }\n\n  const _getNotice = function (viewModel, fieldName, special) {\n    const model = viewModel.get(fieldName);\n    if (!model) return;\n    let value = model.getValue();\n    if (value && special)\n      value = new Date(value).format('yyyy-MM-dd');\n    return {\n      key: model.getState('cShowCaption'),\n      value\n    };\n  }\n\n  const ecsuite = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const actionMap = (params.cParameter && JSON.parse(params.cParameter)) || {};\n    const action = actionMap.action;\n    const id = viewModel.get('id').getValue();\n    const origin = location.origin;\n    const webUrl = `${origin}/meta/voucher/${billNo}/${id}`;\n    const mobileUrl = webUrl;\n    const name = viewModel.getParams().caption;\n    const notice = [];\n    ['code', 'vouchdate', 'creator'].forEach(field => {\n      const special = field === 'vouchdate';\n      const item = _getNotice(viewModel, field, special);\n      if (!item) return;\n      notice.push(item);\n    });\n    switch (action) {\n      case 'cooperation':\n        /*  */\n        YYCooperationBridge.YYLanuchFlow({\n          name, // \n          objectName: 'YonSuite', //  \n          objectId: id, // ID id\n          webUrl, // web\n          mobileUrl,\n        })\n        break;\n      case 'task':\n        /*  */\n        YYCooperationBridge.YYRenderCreateTask({\n          objectName: 'YonSuite', //  \n          objectId: id, // ID id\n          idList: [], // id\n        })\n        break;\n      case 'discussion': {\n        const ecsuiteItems = viewModel.getCache('ecsuiteItems');\n        /* modify by jinzh1   */\n        // if(!ecsuiteItems) return;\n        if (!ecsuiteItems) {\n          YYCooperationBridge.YYGroupChat({\n            objectId: id, // ID id\n            docCode: viewModel.get('code') && viewModel.get('code').getValue(),\n            webUrl, // \n            mobileUrl,\n            name, // \n            notice,\n            idList: [], // id\n          })\n        } else {\n          getYhtUserIds(ecsuiteItems, function (yhtIds) {\n            /*  */\n            YYCooperationBridge.YYGroupChat({\n              objectId: id, // ID id\n              docCode: viewModel.get('code') && viewModel.get('code').getValue(),\n              webUrl, // \n              mobileUrl,\n              name, // \n              notice,\n              idList: yhtIds, // id\n            })\n          })\n        }\n        break;\n      }\n      case 'chat':\n        getYhtUserId(params.type, [params.model], function (yhtIds) {\n          /*  */\n          YYCooperationBridge.YYChat({\n            id: yhtIds[0], // id\n            webUrl, // \n            mobileUrl,\n            name, // \n            notice\n          })\n        })\n    }\n  }\n\n  const voucherDo = function (billNo, viewModel, params, beforeAct, afterAct) {\n    const data = viewModel.getNecessaryData();\n    const postData = {\n      billnum: billNo,\n      data: JSON.stringify(data)\n    };\n    const beforeActData = {\n      params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      const callback = function (err, res) {\n        if (!err) {\n          cb.utils.alert(cb.locale('P_YS_FED_FW_0001026085', {text: params.cShowCaption}), 'success');\n          if (res) {\n            const oldData = viewModel.collectData(true);\n            const newData = common.billMerge(oldData, res);\n            render(viewModel, newData);\n          }\n        }\n        const afterActData = { err, res };\n        afterAct(afterActData, common.afterAct);\n      }\n      common.doProxy(params, callback, postData);\n    });\n  }\n\n  const asyncMeta = function (billNo, params, billData, viewCallback) {\n    return new Promise(function (resolve) {\n      const { cardViewModel } = params;\n      if (cardViewModel) {\n        cardViewModel.biz.do('load', cardViewModel, {\n          data: billData\n        });\n        cb.utils.loadingControl.end();\n        return;\n      }\n      const vmParams = Object.assign({}, params)\n      if (billData && billData.tplid && params && !params.tplid) {\n        vmParams.tplid = billData.tplid\n      }\n      if (params && params.carryData) {\n        billData = Object.assign(billData, params.carryData)\n      }\n      const cbk = function (err, meta) {\n        vmParams.billData = billData\n        _fetchMetaCallback(err, meta, billNo, viewCallback, vmParams, resolve, function () {\n          common.fetchMeta(billNo, vmParams, cbk)\n        })\n      }\n      common.fetchMeta(billNo, vmParams, cbk)\n    });\n  }\n\n  const asyncWorkflow = function (businessKey) {\n    return new Promise(function (resolve) {\n      window.flowComp({\n        width: 850,\n        height: 510,\n        appsource: env.appCode,\n        businessKey,\n        onload (callbackData) {\n          resolve(callbackData.fieldAuth || 'workflownoctrl');\n        }\n      });\n    });\n  }\n\n  const processWorkflow = function (vm, view, fieldAuths) {\n    parseViewModel(vm, fieldAuths);\n    parseContainer(view.view, fieldAuths);\n  }\n\n  const parseViewModel = function (vm, fieldAuths) {\n    for (const attr in fieldAuths) {\n      if (attr === 'mainTable') {\n        parseMainEntity(vm, fieldAuths[attr]);\n      } else {\n        parseChildEntity(vm, attr, fieldAuths[attr]);\n      }\n    }\n  }\n\n  const parseMainEntity = function (vm, fieldAuthObj) {\n    for (const attr in fieldAuthObj) {\n      const model = vm.get(attr);\n      if (!(model instanceof cb.models.BaseModel)) continue;\n      const { visible, editable } = fieldAuthObj[attr];\n      model._set_data('bShowIt', visible);\n      model._set_data('bCanModify', editable);\n    }\n  }\n\n  const parseChildEntity = function (vm, childrenField, fieldAuthObj) {\n    const model = vm.get(childrenField);\n    if (!(model instanceof cb.models.BaseModel)) return;\n    const columns = model._get_data('columns');\n    if (!columns) return;\n    for (const attr in fieldAuthObj) {\n      const column = columns[attr];\n      if (!column) continue;\n      const { visible, editable } = fieldAuthObj[attr];\n      column.bShowIt = visible;\n      column.bCanModify = editable;\n    }\n  }\n\n  const parseContainer = function (container, fieldAuths) {\n    if (container.containers) {\n      container.containers.forEach(function (item) {\n        parseContainer(item, fieldAuths);\n      });\n    } else if (container.controls) {\n      parseControls(container, fieldAuths);\n    }\n  }\n\n  const parseControls = function (container, fieldAuths) {\n    const fieldAuthObj = fieldAuths[container.childrenField || 'mainTable'];\n    if (!fieldAuthObj) return;\n    const controls = [];\n    container.controls.forEach(function (control) {\n      const fieldAuth = fieldAuthObj[control.cItemName];\n      if (fieldAuth && !fieldAuth.visible) return;\n      controls.push(control);\n    });\n    container.controls = controls;\n  }\n\n  const _bindKeyboard = function (vm) {\n    if (process.env.__KEYBOARD__ === false || process.env.__KEYBOARD__ === 'false') return;\n    const allGroupCode = vm.getCache('containerCodes') || [];\n    if (allGroupCode.length) {\n      const results = getContainers(vm, allGroupCode);\n      (results.length > 2) && vm.execute('afterInitKeyboard', results[0], results[1], results[2]);\n    }\n  }\n\n  const getContainers = function (vm, containerCodes) {\n    const idArr = [];\n    const domArr = [];\n    const firstEle = [];\n    let firstElement = null;\n    const xNum = containerCodes.length;\n    for (let i = 0; i < xNum; i++) {\n      const containerCode = containerCodes[i];\n      const containerMeta = vm && vm.getViewMeta(containerCode);\n      if (!containerMeta) return;\n      const controlId = []; //  group  controlId\n      const controlDom = []; //  group  controlDom\n      getControls(vm, containerMeta, controlId, controlDom, firstEle);\n      idArr[i] = controlId;\n      domArr[i] = controlDom;\n    }\n    firstElement = firstEle.length && firstEle[0];\n    return [idArr, domArr, firstElement];\n  }\n\n  const getControls = function (vm, container, resultId, resultDom, resultFirstEle) {\n    const selectors = vm.getCache('selectors');\n    if (!selectors) return;\n    if (container.containers && !container.controls) {\n      container.containers.forEach(item => {\n        getControls(vm, item, resultId, resultDom, resultFirstEle);\n      })\n    } else if (container.controls) {\n      container.controls.forEach(control => {\n        if (control.cItemName) {\n          const billNo = vm.getParams() && vm.getParams().billNo;\n          const modelKey = control.cItemName;\n          const id = `${billNo}|${modelKey}`;\n          const controlDom = document.getElementById(id);\n          const inputDom = controlDom && controlDom.querySelector(selectors.join(','));\n          const controlModel = vm.get(modelKey);\n          if (id) {\n            resultDom.push(inputDom || null);\n            resultId.push(id);\n          }\n          if (controlModel && !resultFirstEle.length) {\n            const isVisible = (controlModel.getVisible() !== false);\n            const notDisabled = (controlModel.getDisabled() !== true);\n            const notReadOnly = (controlModel.getReadOnly() !== true);\n            if (isVisible && notDisabled && notReadOnly)\n              resultFirstEle.push(inputDom);\n          }\n        }\n      })\n    }\n  }\n\n  const afterInitData = async function (billNo, params, billData, viewCallback) {\n    const promises = [];\n    promises.push(asyncMeta(billNo, params, billData, viewCallback));\n    if (billData && (billData.isWfControlled || billData.pk_procdefins) && billData.verifystate > 0)\n      promises.push(asyncWorkflow(`${billNo}_${billData.id}`));\n    const results = [];\n    for (let i = 0, len = promises.length; i < len; i++)\n      results.push(await promises[i]);\n    const data = results[0];\n    const { vm, view } = data;\n    if (results[1]) {\n      if (results[1] === 'workflownoctrl') {\n        vm.getParams().workflowNoCtrl = true;\n      } else {\n        processWorkflow(vm, view, results[1]);\n      }\n      // fangqg: \n      if (vm.getParams().isCoded === true)\n        vm.getParams().isCoded = 0;\n    }\n    const { masterOrgField } = vm.getParams();\n    if (!cb.utils.isEmpty(masterOrgField) && vm.get(masterOrgField).get('bCheck')) {\n      vm.on('afterCheck', () => {\n        if (vm.getCache('initKeyboardComplete')) return;\n        _bindKeyboard(vm);\n        vm.setCache('initKeyboardComplete', true);\n      });\n    }\n    vm.on('afterEdit', () => {\n      _bindKeyboard(vm);\n    });\n    vm.promiseExecute('afterLoadMeta', data, function () {\n      const title = view.cBillName;\n      viewCallback(vm, view, title) // viewextend viewmode addProperty\n      // vm.execute('afterMount');\n      const gridModels = vm.getGridModels();\n      // addGrandSonTable\n      const addGrandSonTable = vm.get('addGrandSonTable');\n      const billNo = vm.getParams().billNo;\n      const userId = (cb.rest.AppContext.user || {}).id;\n      gridModels.forEach(gridModel => {\n        const childrenField = gridModel.getName();\n        const cacheKey = `${billNo}_${userId}_${childrenField}`;\n        let cacheWidth = null;\n        cb.indexDB.openDB('cacheInfo', 1, ['billInfo'])\n          .then(result => {\n            if (result) {\n              cb.indexDB.IDB_getData({ dbTableName: 'billInfo', dbName: 'cacheInfo', key: cacheKey }).then(result => {\n                cacheWidth = result;\n                if (cacheWidth)\n                  for (const key in cacheWidth) {\n                    if (key != 'indexedDB_id') gridModel.setColumnState(key, 'iColWidth', cacheWidth[key]);\n                  }\n              })\n            } else {\n              console.error('')\n            }\n          })\n          .catch(e => {\n            console.error(e)\n          })\n\n        gridModel.on('afterSetDataSource', () => {\n          const afterAct = gridModel.getCache('afterAct');\n          if (afterAct)\n            afterAct();\n          setTimeout(function () {\n            common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n            staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n          });\n        });\n        gridModel.on('afterMount', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n          staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRow', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n          staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRows', () => {\n          common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n          staterule.runGridActionStates(gridModel, vm, vm.getParams().mode);\n        });\n        gridModel.on('afterInsertRowsFromRefer', args => {\n          vm.biz.do('referrowscheck', vm, Object.assign({ childrenField: childrenField }, args));\n        });\n        if (addGrandSonTable && process.env.__THEMETYPE__ == 'ncc') {\n          gridModel.on('beforeSetDataSource', function (dataList) {\n            dataList.forEach(item => {\n              if (item.id) {\n                if (!item.rid) {\n                  item.rid = item.id\n                }\n              } else {\n                if (!item.rid) item.attachmentId = uuid();\n              }\n            });\n            return dataList;\n          });\n          gridModel.on('beforeInsertRow', function (rowData) {\n            rowData.row.rid = uuid();\n            return rowData\n          });\n          gridModel.on('beforeInsertRows', function (data) {\n            const list = data.rows;\n\n            list.forEach(item => {\n              if (item.id) {\n                if (!item.rid) {\n                  item.rid = item.id\n                }\n              } else {\n                if (!item.rid) item.attachmentId = uuid();\n              }\n            });\n            return list;\n          });\n        }\n\n        // vm.on('afterEdit', () => {\n        //   common.setGridActionStates(gridModel, vm, vm.getParams().mode);\n        // });\n        gridModel.on('colWidthResize', args => {\n          const { columnKey, width } = args;\n          if (!cacheWidth) cacheWidth = { indexedDB_id: cacheKey };\n          cacheWidth[columnKey] = width;\n          cb.indexDB.IDB_saveData(cacheWidth, 'billInfo', 'cacheInfo');\n        });\n        gridModel.on('colWidthReturn', args => {\n          cacheWidth = { id: cacheKey, dbTableName: 'billInfo', dbName: 'cacheInfo'};\n          cb.indexDB.IDB_deleteOneData(cacheWidth);\n        })\n      });\n\n      // \n      const addAttachment = vm.get('addAttachment');\n      if (addAttachment && process.env.__THEMETYPE__ == 'ncc') {\n        gridModels.forEach(gridModel => {\n          gridModel.on('beforeSetDataSource', function (dataList) {\n            dataList.forEach(item => {\n              if (item.id) {\n                if (!item.attachmentId) {\n                  item.attachmentId = item.id\n                }\n              } else {\n                if (!item.attachmentId) item.attachmentId = uuid();\n              }\n            });\n            return dataList;\n          });\n          gridModel.on('beforeInsertRow', function (rowData) {\n            rowData.row.attachmentId = uuid();\n            return rowData\n          });\n        })\n      }\n      // \n      _managePageInfoStatue(vm, billNo);\n      const { billData, metaType } = vm.getParams();\n      if (metaType === 'treevoucher') {\n        const treeModel = vm.getTreeModel();\n        _bindTreeAttachment(vm);\n        if (treeModel && treeModel.getState('banQuery')) {\n        } else {\n          _loadTree(vm, {\n            billnum: billNo,\n            treename: common.getVmParams(vm, 'treeName')\n          });\n          _bindTreeSelect(vm, billNo);\n        }\n        // vm.biz.do('add', vm);\n        // vm.setCache('lastMode', env.VOUCHER_STATE_ADD);\n        if (vm.getParams().mode !== env.VOUCHER_STATE_ADD) {\n          const treeModel = vm.getTreeModel();\n          if (treeModel && !treeModel.getState('defaultSelectedKeys'))\n            treeModel.setState('defaultSelectedKeys', true);\n        } else {\n          vm.biz.do('add', vm);\n        }\n      } else {\n        vm.biz.do('load', vm, {\n          data: billData\n        })\n      }\n      if (vm.getCache('bindTreeSelect') && vm.getTreeModel()) {\n        _bindTreeSelect(vm, billNo);\n      }\n      vm.biz.do('code', vm)\n      vm.biz.do('org', vm)\n      vm.biz.do('depends', vm)\n      vm.biz.do('rule', vm)\n      if (env.USEFORMULARULE) {\n        vm.biz.do('formularule', vm)\n      }\n      if (env.USESTATERULE) {\n        vm.biz.do('staterule', vm)\n      }\n      if (params.copy)\n        vm.biz.do('copy', vm);\n      _afterViewCallback(billNo, vm, params);\n    })\n  }\n  const _handlePageInfoStatus = async function (viewmodel, params, result) {\n    if (themeType != 'ncc') return false;\n    const btnMovefirst = viewmodel.get('btnMovefirst');\n    const btnMovelast = viewmodel.get('btnMovelast');\n    const btnMoveprev = viewmodel.get('btnMoveprev');\n    const btnMovenext = viewmodel.get('btnMovenext');\n    const parentViewmodel = viewmodel.getCache('parentViewModel')\n    const lastSearchCondition = parentViewmodel && parentViewmodel.getCache('lastSearchCondition');\n    let curVoucherIndex = viewmodel.getCache('curVoucherIndex');\n    let recordCount = viewmodel.getCache('recordCount');\n    if (!lastSearchCondition || (cb.utils.isEmpty(curVoucherIndex) || !recordCount)) {\n      btnMovefirst && btnMovefirst.setState('disabled', true);\n      btnMovelast && btnMovelast.setState('disabled', true);\n      btnMoveprev && btnMoveprev.setState('disabled', true);\n      btnMovenext && btnMovenext.setState('disabled', true);\n      return false;\n    }\n    let canLoad = null;// \n    if (params) {\n      const {cAction} = params;\n      switch (cAction) {\n        case 'movenext':\n          curVoucherIndex = curVoucherIndex + 1;\n          break;\n        case 'moveprev':\n          curVoucherIndex = curVoucherIndex - 1;\n          break;\n        case 'movelast':\n          curVoucherIndex = recordCount - 1;\n          break;\n        case 'movefirst':\n          curVoucherIndex = 0;\n          break;\n        case 'delete': {\n          recordCount = recordCount - 1;\n          const deleteReturn = cb.extendConfig.voucher.deleteReturn;\n          canLoad = deleteReturn;\n          if (deleteReturn == 'movenext') {\n            // \n            if (curVoucherIndex == recordCount) {\n              canLoad = 'moveprev'\n              curVoucherIndex = recordCount - 1;\n            }\n          } else if (deleteReturn == 'moveprev') {\n            // \n            if (curVoucherIndex == 0) {\n              canLoad = 'movenext';\n            }\n            curVoucherIndex = curVoucherIndex - 1 < 0 ? 0 : curVoucherIndex - 1;\n          }\n          if (recordCount == 0) {\n            canLoad = false;\n            // \n          }\n          viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n          viewmodel.setCache('recordCount', recordCount);\n          return canLoad;\n        }\n        case 'save' : {\n          const mode = common.getMode(viewmodel);\n          if (mode == env.VOUCHER_STATE_EDIT) {\n            return;\n          }\n          /* const billno=parentViewmodel.getParams().billNo;\n             parentViewmodel.biz.action().refresh(billno,parentViewmodel) */\n          const info = await _getParentAllList(parentViewmodel);\n          const recordList = info.recordList || [];\n          const index = recordList.findIndex(item => {\n            return item.id == result.id;\n          });\n          if (index > -1) {\n            recordCount = info.recordCount || recordList.length;\n            curVoucherIndex = index;\n          } else {\n            recordCount = 1;\n            curVoucherIndex = 0\n          }\n        }\n      }\n      viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n      viewmodel.setCache('recordCount', recordCount);\n    }\n\n    if (recordCount == 1) {\n      btnMovefirst && btnMovefirst.setState('disabled', true);\n      btnMovelast && btnMovelast.setState('disabled', true);\n      btnMoveprev && btnMoveprev.setState('disabled', true);\n      btnMovenext && btnMovenext.setState('disabled', true);\n    } else {\n      if (curVoucherIndex == -1) {\n        // \n        btnMoveprev && btnMoveprev.setState('disabled', true);\n        btnMovenext && btnMovenext.setState('disabled', true);\n        btnMovefirst && btnMovefirst.setState('disabled', true);\n        btnMovelast && btnMovelast.setState('disabled', true);\n      } else if (curVoucherIndex == 0) {\n        btnMovefirst && btnMovefirst.setState('disabled', true);\n        btnMoveprev && btnMoveprev.setState('disabled', true);\n        btnMovelast && btnMovelast.setState('disabled', false);\n        btnMovenext && btnMovenext.setState('disabled', false);\n      } else if (curVoucherIndex < recordCount - 1) {\n        btnMovefirst && btnMovefirst.setState('disabled', false);\n        btnMovelast && btnMovelast.setState('disabled', false);\n        btnMoveprev && btnMoveprev.setState('disabled', false);\n        btnMovenext && btnMovenext.setState('disabled', false);\n      } else if (curVoucherIndex == recordCount - 1) {\n        btnMovelast && btnMovelast.setState('disabled', true);\n        btnMovenext && btnMovenext.setState('disabled', true);\n        btnMovefirst && btnMovefirst.setState('disabled', false);\n        btnMoveprev && btnMoveprev.setState('disabled', false);\n      }\n    }\n  }\n  const _getParentAllList = function (viewmodel) {\n    return new Promise((resolve) => {\n      const gridmodel = viewmodel.getGridModel();\n      const proxyConfig = gridmodel._get_data('proxyConfig');\n      if (!proxyConfig) return;\n      const queryParams = gridmodel._get_data('queryParams');\n      const proxy = cb.rest.DynamicProxy.create({ queryData: proxyConfig });\n      delete queryParams.page;\n      proxy.queryData(queryParams, function (err, result) {\n        if (err) {\n          cb.utils.alert(err.message, 'error');\n          return;\n        }\n        resolve(result);\n      });\n    });\n  }\n  const _managePageInfoStatue = function (viewmodel, billNo) {\n    if (themeType !== 'ncc') {\n      return;\n    }\n    viewmodel.on('afterLoadData', function () {\n      let curVoucherIndex = viewmodel.getCache('curVoucherIndex');\n      let recordCount = viewmodel.getCache('recordCount');\n      if (cb.utils.isEmpty(curVoucherIndex) || !recordCount) {\n        const parentViewmodel = viewmodel.getCache('parentViewModel');\n        if (parentViewmodel) {\n          const parentCurVoucherIndex = parentViewmodel.getCache('curVoucherIndex');\n          const parentPageInfo = parentViewmodel.getCache('pageInfo');\n\n          if (!cb.utils.isEmpty(parentCurVoucherIndex) && parentPageInfo) {\n            const {pageIndex, pageSize, recordCount: count} = parentPageInfo\n            curVoucherIndex = (pageIndex - 1) * pageSize + parentCurVoucherIndex;\n            recordCount = count;\n            viewmodel.setCache('curVoucherIndex', curVoucherIndex);\n            viewmodel.setCache('recordCount', recordCount);\n          }\n        }\n      }\n      _handlePageInfoStatus(viewmodel);\n    })\n  }\n  const rowDetail = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const curGridModel = common.getGridModel(viewmodel, params);\n    const cSunBillNo = curGridModel.getCache('cSunBillNo');\n    if (!cSunBillNo) {\n      return;\n    }\n    const rowIndex = params && params.params && !cb.utils.isEmpty(params.params.index)\n      ? params.params.index : '';\n    if (cb.utils.isEmpty(rowIndex)) {\n      cb.utils.alert('', 'error');\n      return;\n    }\n    const selectedRow = curGridModel.getRow(rowIndex);\n    const rid = selectedRow.rid;\n    if (!rid) {\n      console.error('id');\n      return;\n    }\n    const mode = common.getMode(viewmodel);\n    const param = {\n      mode: env.VOUCHER_STATE_EDIT,\n      id: rid,\n      rowData: selectedRow,\n      carryParams: {},\n    }\n    if (mode == env.VOUCHER_STATE_BROWSE) {\n      param.readOnly = true;\n    }\n    const dt = {\n      billtype: 'voucher',\n      billno: cSunBillNo,\n      params: param\n    }\n    const beforeActData = {\n      params: params,\n      data: dt\n    }\n    beforeAct(beforeActData, function () {\n      cb.loader.runCommandLine('bill', dt, viewmodel);\n      afterAct()\n    })\n  }\n  const jointquery = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    let data = {\n      params: { editType: 'jointquery' },\n      parentViewModel: viewmodel,\n      billNum: billNo,\n      billId: viewmodel.get('id').getValue(),\n    };\n    if (params && params.childrenField) {\n      const childArray = [];\n      childArray.push(viewmodel.getGridModel().getRow(params.params.index).id);\n      const childIds = { childIds: childArray };\n      const childKey = { childKey: params.childrenField };\n      data = Object.assign(data, childIds, childKey);\n    }\n    beforeAct(data, function () {\n      viewmodel.communication({\n        payload: {\n          title: '',\n          type: 'platform',\n          url: 'voucher-search/ShowFlow',\n          // url: 'voucher-search/useShowFlow',\n          checkReturn: true,\n          modal: viewmodel,\n          data: data\n        }\n      });\n    })\n  }\n\n  // \n  const printPreview = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      const { currentParams, url } = common.getPrintParamers(params, 'preview', viewmodel);\n      if (!currentParams)\n        return false;\n      window.open(url + common.combineParams(currentParams), '_blank')\n      afterAct()\n    })\n  }\n  // \n  const printDesign = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct({ params }, function () {\n      const { currentParams, url } = common.getPrintParamers(params, 'design', viewmodel);\n      window.open(url + common.combineParams(currentParams), '_blank')\n    })\n  }\n\n  // \n  const printNow = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    beforeAct(params, function () {\n      common.printNow(params, viewmodel);\n      afterAct()\n    })\n  }\n  const batchOutputVoucher = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    // let printID = viewmodel.get(env.VOUCHER_PRINT_KEY) && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue() && viewmodel.get(env.VOUCHER_PRINT_KEY).getValue().toString()\n    const gridModel = viewmodel.getGridModel();\n    // \n    const treeModel = viewmodel.getTreeModel();\n\n    const postData = { billnum: billNo };\n    if (treeModel) {\n      let selectedDatas = treeModel.getSelectedKeys();\n      if (selectedDatas.includes('main')) {\n        // \n        const keyMap = treeModel._get_data('keyMap');\n        selectedDatas = Object.keys(keyMap);\n      }\n      if (cb.utils.isArray(selectedDatas)) postData.ids = selectedDatas.join();\n      else if (typeof selectedDatas === 'string') postData.ids = selectedDatas;\n    } else if (gridModel) {\n      const selectDatas = params && params.params && params.params.index != null\n        ? [gridModel.getRow(params.params.index)]\n        : gridModel.getSelectedRows();\n      if (!selectDatas || selectDatas.length == 0) {\n        cb.utils.alert('', 'warning')\n        return\n      }\n      const data = []\n      selectDatas.forEach(function (row) {\n        if (row.id && row.pubts) {\n          data.push(row.id)\n        }\n      }, this)\n      postData.ids = data.join();\n    }\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString && queryString.pathname + queryString.toStr()\n    const beforeActData = {\n      params: params,\n      data: postData\n    }\n    beforeAct(beforeActData, function () {\n      if (!postData.fileName) {\n        const fileName = viewmodel.getParams().caption\n        if (fileName) {\n          postData.fileName = `${fileName}`\n        }\n      }\n      common.createDownloadForm(url, postData)\n      afterAct()\n    })\n  }\n\n  const exportVoucherTemplate = (billNo, viewModel, params, beforeAct, afterAct) => {\n    let baseUrl = '';\n    if (window._baseUrl) {\n      baseUrl = window._baseUrl.substr(0, 1) === '/' ? window._baseUrl : '/' + window._baseUrl\n    }\n    const queryUrl = baseUrl + '/files' + params.cSvcUrl;\n    const queryString = new cb.utils.queryString(queryUrl)\n    const url = queryString.pathname + queryString.toStr();\n    const postData = {\n      billnum: common.getVmParams(viewModel, 'cardKey')\n    };\n    const beforeActData = {\n      params: params,\n      data: postData\n    };\n    beforeAct(beforeActData, function () {\n      if (!postData.fileName) {\n        const fileName = viewModel.getParams().caption\n        if (fileName) {\n          postData.fileName = `${fileName}`\n        }\n      }\n      common.createDownloadForm(url, postData);\n      afterAct();\n    });\n  }\n\n  const importVoucher = (billNo, viewModel, params, beforeAct, afterAct) => {\n    const btnCallBack = {\n      disabledCallback: params.disabledCallback,\n      enabledCallback: params.enabledCallback\n    }\n    params.disabledCallback = false;\n    params.enabledCallback = false;\n    const beforeActData = { params, data: {} };\n    let isAsync = false;\n    let asyncInterval = 1;\n    const asyncKey = 'asyncImport_' + cb.utils.getNewGuid().replace(/-/g, '');\n    let acceptedFileType = ''\n    if (params.cParameter) {\n      const cParameter = JSON.parse(params.cParameter);\n      if (cParameter) {\n        isAsync = cParameter.isAsync;\n        asyncInterval = cParameter.interval || asyncInterval;\n        acceptedFileType = cParameter.acceptedFileType || ''\n      }\n    }\n    // isAsync = true;\n    beforeAct(beforeActData, function () {\n      const eleInput = document.createElement('input');\n      eleInput.type = 'file';\n      if (acceptedFileType) {\n        eleInput.accept = acceptedFileType // \n      }\n      eleInput.style.display = 'none';\n      eleInput.onchange = function (e) {\n        cb.utils.loadingControl.start('...');\n        btnCallBack.disabledCallback && btnCallBack.disabledCallback();\n        const formData = new FormData();\n        formData.enctype = 'multipart/form-data';\n        const file = e.target.files[0];\n        const fileName = file && file.name;\n        const fileSize = file && file.size;\n        formData.append('file', file);\n        if (beforeActData.data.mapCondition)\n          formData.append('mapCondition', JSON.stringify(beforeActData.data.mapCondition));\n        const xhr = new XMLHttpRequest();\n        let url = `${params.cSvcUrl}?billnum=${common.getVmParams(viewModel, 'cardKey')}`;\n        if (isAsync) {\n          url = url + '&asyncKey=' + asyncKey;\n        }\n        const _url = window._baseUrl ? `${window._baseUrl}${url}` : url;\n        xhr.open('POST', _url, true);\n        xhr.send(formData);\n        if (isAsync) {\n          btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n          xhr.onreadystatechange = function () {\n            cb.utils.loadingControl.end();\n            let bError = false;\n            let errorInfo = '';\n            if (xhr.readyState !== 4) return;\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                bError = true;\n                errorInfo = ',' + xhr.responseText;\n              }\n              if (ajaxResult.code === 200) {\n              } else {\n                bError = true;\n                errorInfo = `${ajaxResult.message}`;\n              }\n            }\n            else {\n              bError = true;\n              errorInfo = ' xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText;\n            }\n            if (bError) {\n              cb.utils.alert(errorInfo);\n            }\n            else {\n              const curTime = cb.utils.getNowFormatDate();\n              const busName = viewModel.getParams() && (viewModel.getParams().name || viewModel.getParams().caption);\n              const asyncParams = { asyncKey, fileSize, fileName, curTime, busName, percentage: 0, asyncData: '{}' };\n              viewModel.communication({\n                type: 'asyncImport',\n                payload: asyncParams\n              })\n              const _timer = setInterval(() => {\n                asyncImportQuery(viewModel, asyncParams, btnCallBack);\n              }, asyncInterval * 1000);\n              viewModel.setCache(asyncKey, _timer);\n              cb.utils.alert('');\n            }\n          }\n        }\n        else {\n          xhr.onreadystatechange = function () {\n            cb.utils.loadingControl.end();\n            if (xhr.readyState !== 4) return;\n            btnCallBack.enabledCallback && btnCallBack.enabledCallback();\n            if (xhr.status === 200) {\n              let ajaxResult;\n              try {\n                ajaxResult = JSON.parse(xhr.responseText);\n              }\n              catch (e) {\n                cb.utils.alert(',' + xhr.responseText);\n                return;\n              }\n              if (ajaxResult.code === 200) {\n                const res = ajaxResult.data;\n                if (res.sucessCount) {\n                  viewModel.execute('refresh');\n                  viewModel.execute('afterImport', res);\n                }\n\n                viewModel.communication({\n                  type: 'modal',\n                  payload: {\n                    key: 'BatchMsg',\n                    data: {\n                      type: 2,\n                      res\n                    }\n                  }\n                });\n              } else {\n                cb.utils.alert(`${ajaxResult.message}`, 'error');\n              }\n            }\n            else {\n              console.log(' xhr.readyState =' + xhr.readyState + '  xhr.status =' + xhr.status + '  xhr.responseText = ' + xhr.responseText);\n            }\n          };\n        }\n        document.body.removeChild(eleInput);\n      }\n      document.body.appendChild(eleInput);\n      eleInput.click();\n    });\n  }\n\n  const asyncImportQuery = (viewModel, asyncParams, btnCallBack) => {\n    const asyncKey = asyncParams.asyncKey;\n    const url = 'billtemp/getImportProcess?';\n    const proxy = cb.rest.DynamicProxy.create({\n      getImportProcess: {\n        url: url,\n        method: 'GET',\n        options: { mask: false }\n      }\n    })\n\n    proxy.getImportProcess({ asyncKey: asyncKey }, function (err, result) {\n      let errStr = '';\n      if (err) {\n        errStr = err.message;\n        handleAsyncImportOver(viewModel, asyncParams, errStr);\n        return;\n      }\n      if (result) {\n        let res;\n        try {\n          res = JSON.parse(result);\n        }\n        catch (e) {\n          errStr = ',' + result;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n          return;\n        }\n        const percentage = parseFloat(res.percentage || '0');\n        if (res.flag == '0') {\n          errStr = '';\n          if (res.data)\n            errStr = errStr + ',' + res.data;\n          handleAsyncImportOver(viewModel, asyncParams, errStr);\n        }\n        else if (res.flag == 1 && percentage >= 100) {\n          handleAsyncImportOver(viewModel, asyncParams);\n          viewModel.execute('refresh');\n          viewModel.execute('afterImport', res);\n          viewModel.execute('openNotification', Object.assign({ res: res.data }, asyncParams));\n        }\n        asyncParams.asyncData = result;\n        asyncParams.percentage = percentage;\n        viewModel.communication({\n          type: 'asyncImport',\n          payload: asyncParams\n        });\n      }\n    });\n  }\n\n  const handleAsyncImportOver = (viewModel, asyncParams, errStr) => {\n    const _timer = viewModel.getCache(asyncParams.asyncKey);\n    viewModel.clearCache(asyncParams.asyncKey);\n    _timer && clearTimeout(_timer);\n    if (errStr) {\n      cb.utils.alert(errStr);\n      asyncParams.bDelTask = true;\n      asyncParams.errStr = errStr;\n      viewModel.communication({\n        type: 'asyncImport',\n        payload: asyncParams\n      });\n    }\n  }\n  const doCommunication = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    common.doCommunication(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  // \n  const attachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment) {\n      console.log('addAttachment')\n      return;\n    }\n    const gridModel = common.getGridModel(viewmodel, params);\n    const selectDatas = params && params.params && params.params.index != null\n      ? [gridModel.getRow(params.params.index)]\n      : gridModel.getSelectedRows();\n    if (selectDatas.length == 0) {\n      cb.utils.alert('', 'warning');\n      return\n    }\n    if (selectDatas.length > 1) {\n      cb.utils.alert('', 'warning');\n      return;\n    }\n    const selectRow = selectDatas[0];\n    if (!selectRow.attachmentId) {\n      cb.utils.alert('id', 'warning');\n      return;\n    }\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// \n    const rowData = Object.assign({\n      id: selectRow.attachmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // (lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  // \n  const _bindTreeAttachment = function (viewmodel) {\n    const treeModel = viewmodel.getTreeModel();\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment || process.env.__THEMETYPE__ !== 'ncc') {\n      return;\n    }\n    treeModel.on('beforeSetDataSource', function (list) {\n      const childrenField = treeModel._get_data('childrenField') || 'children';\n      const keyField = treeModel._get_data('keyField') || 'id';\n      function loopData (data) {\n        data.forEach(item => {\n          const children = item[childrenField];\n          if (!item.attachmentId) {\n            item.attachmentId = item[keyField]\n          }\n          if (children && cb.utils.isArray(children) && children.length > 0) {\n            loopData(children);\n          }\n        })\n      }\n      loopData(list);\n      return list;\n    })\n  }\n  // \n  const voucherAttachment = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    const addAttachment = viewmodel.get('addAttachment');\n    if (!addAttachment) {\n      console.log('addAttachment')\n      return;\n    }\n    const mode = common.getMode(viewmodel);\n    let newAttchmentId = '';\n    // const value=\n    switch (mode) {\n      case env.VOUCHER_STATE_BROWSE:\n      case env.VOUCHER_STATE_EDIT: {\n        const attachmentId = viewmodel.get('attachmentId').getValue();\n        if (attachmentId) {\n          newAttchmentId = attachmentId\n        } else {\n          const id = viewmodel.get('id').getValue();\n          if (id) {\n            viewmodel.get('attachmentId').setValue(id);\n            newAttchmentId = id;\n          } else {\n            const newId = uuid();\n            viewmodel.get('attachmentId').setValue(newId);\n            newAttchmentId = newId;\n          }\n        }\n        break;\n      }\n      case env.VOUCHER_STATE_ADD: {\n        const id = viewmodel.get('attachmentId').getValue();\n        if (id) {\n          newAttchmentId = id\n        } else {\n          const newId = uuid();\n          viewmodel.get('attachmentId').setValue(newId);\n          newAttchmentId = newId;\n        }\n        break;\n      }\n    }\n    const attachmentCondition = viewmodel.getCache('attachmentCondition');// \n    const rowData = Object.assign({\n      id: newAttchmentId\n    }, attachmentCondition);\n    const beforeActData = {\n      params: params,\n      data: rowData\n    }\n    beforeAct(beforeActData, function () {\n      viewmodel.communication({\n        type: 'modal',\n        payload: {\n          key: 'Attachment',\n          data: {\n            size: 'md', // (lg xg md sm)\n            data: rowData,\n            model: viewmodel\n          }\n        }\n      });\n      afterAct()\n    })\n  }\n  const stateRule = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    staterule.runRules(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  const formulaRule = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    formularule(billNo, viewmodel, params, beforeAct, afterAct)\n  }\n  // \n  let showSon = env.DEFAULT_SHOW_SON;\n  const showHideSon = (billNo, viewModel, params, beforeAct, afterAct) => {\n    showSon = !showSon;\n    let sonGroupCode = null;\n    if (params.cParameter) {\n      try {\n        sonGroupCode = JSON.parse(params.cParameter).sonGroupCode;\n      } catch (e) {\n        console.error(e);\n      }\n    }\n    viewModel.execute('updateViewMeta', { code: sonGroupCode, visible: showSon });\n  }\n\n  const scan = (billNo, viewmodel, params, beforeAct, afterAct) => {\n    mtlScan(billNo, viewmodel, params, beforeAct, afterAct);\n  };\n  const share = function (billNo, viewmodel, params, beforeAct, afterAct) {\n    mtlShare(billNo, viewmodel, params, beforeAct, afterAct)\n  };\n\n  return {\n    init: function (billNo, params, viewCallback) {\n      params = params || {};\n      if (!params.mode && params.query && params.query.mode)\n        params.mode = params.query.mode;\n      if (!params.id && params.query && params.query.id)\n        params.id = params.query.id;\n      // params saveReturn\n      if (!cb.extendConfig.voucher) {\n        cb.extendConfig.voucher = {};\n      }\n      if (!params.hasOwnProperty('saveReturn') && cb.extendConfig.voucher.hasOwnProperty('saveReturn')) {\n        params.saveReturn = cb.extendConfig.voucher.saveReturn\n      }\n      const self = this\n      const initDataCallback = function (err, billData) {\n        if (!err) {\n          billData = billData || {};\n          if (billData._status === cb.models.DataStates.Insert) {\n            params.mode = env.VOUCHER_STATE_ADD;\n            params.realAdd = false;\n          }\n          afterInitData(billNo, params, billData, viewCallback);\n        } else {\n          common.afterAct({\n            err: err\n          })\n        }\n      }\n      const lowerMetaType = params.metaType && params.metaType.trim().toLocaleLowerCase();\n      if (lowerMetaType === 'editablevoucherlist' || lowerMetaType === 'treevoucher') { // ,\n        params.metaType = lowerMetaType;\n        initDataCallback()\n      } else {\n        // _getInitdata(billNo, params, initDataCallback)\n        const proxy = cb.rest.DynamicProxy.create({ getTplList: { url: 'billmeta/tpllist', method: 'GET' } });\n        proxy.getTplList({ billno: billNo }, function (err, result) {\n          const { systemCode } = params.query;\n          if (systemCode && result && result.length) {\n            result = result.find(item => {\n              return item.systemCode === systemCode;\n            });\n            params.tplid = result && result.iTplId;\n          } else {\n            if (result && result.length) {\n              result = result.filter(item => {\n                return item.systemCode == null;\n              });\n            }\n            if (err || (result && result.length === 1)) {\n              // params.tplid = result && result[0].iTplId;\n            } else {\n              const tpllist = {};\n              (result || []).forEach(function (tpl) {\n                const tplid = tpl.iTplId;\n                switch (tpl.iTplMode) {\n                  case 0:\n                    tpllist[env.VOUCHER_STATE_BROWSE] = tplid;\n                    break;\n                  case 2:\n                    tpllist[env.VOUCHER_STATE_EDIT] = tplid;\n                }\n              });\n              params.multitpl = true;\n              params.tplid = params.mode === 'browse' || params.readOnly ? tpllist[env.VOUCHER_STATE_BROWSE] : tpllist[env.VOUCHER_STATE_EDIT];\n            }\n          }\n          if (params.action)\n            return self.action()[params.action](billNo, null, params, function () { }, initDataCallback);\n          _getInitdata(billNo, params, initDataCallback);\n        });\n      }\n    },\n    do: function (act, viewmodel, params) {\n      common.todo(this, act, viewmodel, params)\n    },\n    action: function () {\n      //  yueming\n      let voucherExtend = {}\n      try {\n        voucherExtend = cb.extendConfig.voucherExtendConfig;\n      } catch (error) {\n        console.log(error);\n        voucherExtend = {};\n      }\n      const voucherAction = {\n        scan: scan,\n        share: share,\n        render: renderData,\n        doservice: _doService,\n        load: loadData,\n        search: search,\n        code: buildCode,\n        org: buildOrg,\n        depends: buildDepends,\n        rule: buildRule,\n        initdefaultactions: initDefaultActions,\n        commandline: common.commandLine,\n        abandon: abandon,\n        copy: copy,\n        push: push,\n        edit: common.edit,\n        save: save,\n        addrow: addRow,\n        table2dbtnclick: table2DBtnClick,\n        insertrow: insertRow,\n        deleterow: deleteRow,\n        copyrow: copyRow,\n        shiftuprow: shiftUpRow,\n        shiftdownrow: shiftDownRow,\n        delete: doDelete,\n        invalid: inValid,\n        workflow: workflow,\n        audit: audit,\n        submit: submit,\n        unsubmit: unsubmit,\n        unaudit: audit,\n        close: close,\n        open: open,\n        movefirst: moveFirstOrLast,\n        movelast: moveFirstOrLast,\n        moveprev: movePrevOrNext,\n        movenext: movePrevOrNext,\n        add: add,\n        create: add,\n        pull: pull,\n        check: check,\n        refresh: refresh,\n        columnsetting: common.columnsetting,\n        checkapprove: checkApprove,\n        cellcheck: cellCheck,\n        cellscheck: cellsCheck,\n        referrowscheck: referRowsCheck,\n        lineopen: lineOpenOrClose,\n        lineclose: lineOpenOrClose,\n        localoutput: localoutput,\n        output: output,\n        print: print,\n        selecttpl: selectTpl,\n        saveandadd: saveAndAdd,\n        saveandaudit: saveAndAudit,\n        savebo: savebo,\n        preview: preview,\n        localprint: localPrint,\n        selfdefineaction: compositeAction,\n        savedraft: saveDraft,\n        savedatatemp: saveDatatemp,\n        ecsuite,\n        voucherdo: voucherDo,\n        batchmodify: batchModify,\n        jointquery: jointquery,\n        printpreview: printPreview, // \n        printdesign: printDesign, // \n        printnow: printNow, // \n        batchoutput: batchOutputVoucher,\n        batchimport: importVoucher,\n        tempexport: exportVoucherTemplate,\n        openpage: doCommunication, // \n        goback: doCommunication, // \n        attachment: attachment, // \n        voucherattachment: voucherAttachment, // \n        rowdetail: rowDetail, // \n        staterule: stateRule, // \n        billsetting: common.openBillModal,\n        formularule: formulaRule,\n        autocomplete: common.autoComplete, // \n        customdo: common.customDo,\n        bizflowpush: common.bizflowpush, // \n        showhideson: showHideSon\n      }\n      return Object.assign(voucherAction, voucherExtend, mVoucher);\n    }\n  }\n})()\n\ncb.namespace('biz.common')\ncb.biz.common.voucher = voucher\n\nexport default voucher\n"],"sourceRoot":""}