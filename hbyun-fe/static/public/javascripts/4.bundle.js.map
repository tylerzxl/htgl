{"version":3,"sources":["webpack:///./node_modules/@mdf/metaui-web/src/components/voucher-search/show/showflow.jsx"],"names":["G6","dagre","props","handleDblClick","i","parentViewModel","getGridModel","execute","state","billNumber","data","billNum","billId","childIds","childKey","jsonData","viewModel","flowWidth","componentWillReceiveProps","nextProps","this","setState","width","callback","cb","utils","confirm","locale","abandonText","caption","componentDidMount","that","thisdata","rest","DynamicProxy","create","map","url","method","err","res","console","log","resu","getMaxFloor","upperNodes","downresu","downNodes","startX","window","innerWidth","registerEdge","draw","cfg","group","offset","MinOffset","startPoint","endPoint","x","addShape","attrs","stroke","path","y","endArrow","d","nodes","edges","thisCount","push","node","label","billName","date","vouchdate","substring","code","billCode","number","menuCode","srvUrl","isCrossDomain","id","name","type","handleDownNodes","nodesData","count","forEach","item","source","target","shape","handleUpperNodes","parent","coord","g","graphlib","Graph","setDefaultEdgeLabel","setGraph","rankdir","setNode","height","edge","setEdge","layout","points","length","controlPoints","slice","registerNode","drawShape","fillColor","strokeColor","centerNameColor","centerCodeColor","centerDateColor","rect","radius","fill","fillOpacity","lineWidth","text","fontSize","fontWeight","textBaseline","img","registerBehavior","getEvents","onMouseenter","ev","getModel","graph","findById","update","style","cursor","onMouseleave","getDefaultCfg","sensitivity","minZoom","maxZoom","wheel","onWheel","e","preventDefault","shouldUpdate","canvas","get","point","getPointByClient","clientX","clientY","pixelRatio","ratio","getZoom","zoom","wheelDelta","paint","emit","container","innerHeight","modes","default","defaultNode","anchorPoints","nodeStyle","selected","active","defaultEdge","edgeStyle","on","params","mode","VOUCHER_STATE_EDIT","_cfg","model","readOnly","dt","billtype","billno","billid","tempCustomCode","jDiwork","AppContext","query","serviceCode","openService","carryNode","getWebUrl","menuUrl","random","loader","runCommandLine","menuId","userClick","viewType","render","fitView","zoomTo","treeData","max","each","floor","handleClick","index","delItem","className","onClick","portal","toJS","dispatch","ShowFlow"],"mappings":"4rBAQMA,EAA+B,EAAQ,KACvCC,EAAQ,EAAQ,KAOtB,cACE,WAAaC,GAAb,MACE,YAAMA,IAAM,K,OA+dZ,EAAAC,eAAiB,SAACC,GACE,EAAKF,MAAMG,gBAAgBC,eACnCC,QAAQ,WAAY,KAhehC,EAAKC,MAAQ,CACXC,WAAY,EAAKP,MAAMQ,KAAKC,SAAW,kBACvCC,OAAQ,EAAKV,MAAMQ,KAAKE,QAAU,gBAClCC,SAAU,EAAKX,MAAMQ,KAAKG,UAAY,KACtCC,SAAU,EAAKZ,MAAMQ,KAAKI,UAAY,KAGtCC,SAAU,GACVC,UAAW,EAAKd,MAAMQ,KAAKL,gBAC3BY,UAAW,M,EA+ejB,OA3fuB,OAgBrB,YAAAC,0BAAA,SAA2BC,GACzBC,KAAKC,SAAS,CACZL,UAAWG,EAAUT,KAAKL,gBAC1BY,UAAWE,EAAUG,QAElBH,EAAUI,UAAYJ,EAAUI,WAAaH,KAAKlB,MAAMqB,UAC7DC,GAAGC,MAAMC,QAAQF,GAAGG,OAAO,yBAA0B,CAACC,YAAaT,EAAUU,WAAW,WACtFV,EAAUI,eAId,YAAAO,kBAAA,WACE,IAAMC,EAAOX,KACPY,EAAW,GACjBA,EAASvB,WAAaW,KAAKZ,MAAMC,WACjCuB,EAASpB,OAASQ,KAAKZ,MAAMI,OACD,OAAxBQ,KAAKZ,MAAMM,WACbkB,EAASnB,SAAWO,KAAKZ,MAAMK,SAC/BmB,EAASlB,SAAWM,KAAKZ,MAAMM,UAEnBU,GAAGS,KAAKC,aAAaC,OAAO,CAAEC,IAAK,CAAEC,IAAK,mBAAoBC,OAAQ,UA0b9EF,IAAIJ,GAzbV,SAAuBO,EAAKC,GAC1B,GAAID,EACFE,QAAQC,IAAIH,OADd,CAIAE,QAAQC,IAAIF,GAmBZ,IAAMG,EAAOC,EAAYJ,EAAIK,YACvBC,EAAWF,EAAYJ,EAAIO,WAE3BC,EADeC,OAAOC,WAAa,EAAI,IACf,IAAMP,EAAO,IAM3C3C,EAAGmD,aAAa,MAAO,CACrBC,KAAI,SAAEC,EAAKC,GACT,IAAIC,EAAS,EACTC,EAAY,EACVC,EAAaJ,EAAII,WACjBC,EAAWL,EAAIK,SA6BrB,OA5BKV,EAAS,IAAM,GAAKA,EAAS,IAAMU,EAASC,EAAIF,EAAWE,EAAI,GAClEJ,GAAU,KACA,IAAMP,EAAS,KAAOA,EAAS,IAAMU,EAASC,EAAIF,EAAWE,EAAI,KAC3EH,EAAY,KAEAF,EAAMM,SAAS,OAAQ,CACnCC,MAAO,CACLC,OAAQ,UACRC,KAAM,CACJ,CAAC,IAAKN,EAAWE,EAAIH,EAAWC,EAAWO,GAC3C,CAAC,KAAMN,EAASC,EAAIJ,GAAU,EAAI,EAAI,GAAKE,EAAWE,EAAIH,GAAYC,EAAWO,GACjF,CAAC,KAAMN,EAASC,EAAIJ,GAAU,EAAI,EAAI,GAAKE,EAAWE,EAAIH,GAAYE,EAASM,GAC/E,CAAC,IAAKN,EAASC,EAAIJ,EAAS,EAAGG,EAASM,IAE1CC,SAAU,CAERF,KAAM,CACJ,CAAC,KAAM,EAAG,GACV,CAAC,IAAK,EAAG,GACT,CAAC,KAAM,GAAI,GACX,CAAC,IAAK,GAAI,GAAI,EAAG,EAAG,GAAI,EAAG,GAC3B,CAAC,MAEHG,EAAG,SAQb,IAAMxD,EAAO,CACXyD,MAAO,GACPC,MAAO,IAELC,EAAY,EACZ7B,IACF9B,EAAKyD,MAAMG,KAAK,CACdC,KAAM/B,EACNgC,MAAO,GAAGhC,EAAIiC,SACdC,KAAOlC,EAAImC,WAAa,GAAGnC,EAAImC,UAAUC,UAAU,EAAG,KAAU,GAChEC,KAAM,GAAGrC,EAAIsC,SACbC,OAAQ,GAAGvC,EAAI/B,WACfuE,SAAU,GAAGxC,EAAIwC,SACjBC,OAAQzC,EAAI0C,eAAiB1C,EAAIyC,OACjCE,GAAI,GAAGd,EACPzD,OAAQ,GAAG4B,EAAI5B,OACfwE,KAAM,GAAG5C,EAAIiC,SACbY,KAAM,WAEJ7C,EAAIO,WAOV,SAASuC,EAAiBC,EAAWC,GACnCD,EAAUE,SAAQ,SAACC,GACjBrB,GAAa,EACb3D,EAAKyD,MAAMG,KAAK,CACdC,KAAMmB,EACNlB,MAAO,GAAGkB,EAAKjB,SACfC,KAAOgB,EAAKf,WAAa,GAAGe,EAAKf,UAAUC,UAAU,EAAG,KAAU,GAClEC,KAAM,GAAGa,EAAKZ,SACdC,OAAQ,GAAGW,EAAKjF,WAChBuE,SAAU,GAAGU,EAAKV,SAClBC,OAAQS,EAAKR,eAAiBQ,EAAKT,OACnCE,GAAI,GAAGd,EACPzD,OAAQ,GAAG8E,EAAK9E,OAChBwE,KAAM,GAAGM,EAAKjB,WAEhB/D,EAAK0D,MAAME,KAAK,CACdqB,OAAQ,GAAGH,EACXI,OAAQ,GAAGvB,EACXwB,MAAO,QAELH,EAAKvB,OACPmB,EAAgBI,EAAKvB,MAAOE,MA3B9BiB,CAAgB9C,EAAIO,UAAWsB,GAE7B7B,EAAIK,YA6BV,SAASiD,EAAkBP,EAAWQ,GAEpCR,EAAUE,SAAQ,SAACC,GACjBrB,GAAa,EACb3D,EAAKyD,MAAMG,KAAK,CACdC,KAAMmB,EACNlB,MAAO,GAAGkB,EAAKjB,SACfC,KAAOgB,EAAKf,WAAa,GAAGe,EAAKf,UAAUC,UAAU,EAAG,KAAU,GAClEC,KAAM,GAAGa,EAAKZ,SACdC,OAAQ,GAAGW,EAAKjF,WAChBuE,SAAU,GAAGU,EAAKV,SAClBC,OAAQS,EAAKR,eAAiBQ,EAAKT,OACnCE,GAAI,GAAGd,EACPzD,OAAQ,GAAG8E,EAAK9E,OAChBwE,KAAM,GAAGM,EAAKjB,WAEhB/D,EAAK0D,MAAME,KAAK,CACdqB,OAAQ,GAAGtB,EACXuB,OAAQ,GAAGG,EACXF,MAAO,QAELH,EAAKvB,OACP2B,EAAiBJ,EAAKvB,MAAOE,MAlD/ByB,CAAiBtD,EAAIK,WAAY,IAuDrC,IAkBImD,EAlBEC,EAAI,IAAIhG,EAAMiG,SAASC,MAC7BF,EAAEG,qBAAoB,WACpB,MAAO,MAETH,EAAEI,SAAS,CACTC,QAAS,OAEX5F,EAAKyD,MAAMsB,SAAQ,SAAUlB,GAC3BA,EAAKC,MAAQ,GACbyB,EAAEM,QAAQhC,EAAKY,GAAI,CACjB7D,MAAO,IACPkF,OAAQ,QAGZ9F,EAAK0D,MAAMqB,SAAQ,SAAUgB,GAC3BR,EAAES,QAAQD,EAAKd,OAAQc,EAAKb,WAE9B3F,EAAM0G,OAAOV,GAEbA,EAAE9B,QAAQsB,SAAQ,SAAUlB,EAAMnE,GAChC4F,EAAQC,EAAE1B,KAAKA,GACf7D,EAAKyD,MAAM/D,GAAGuD,EAAIqC,EAAMrC,EACxBjD,EAAKyD,MAAM/D,GAAG4D,EAAIgC,EAAMhC,KAE1BiC,EAAE7B,QAAQqB,SAAQ,SAAUgB,EAAMrG,GAChC4F,EAAQC,EAAEQ,KAAKA,GACf/F,EAAK0D,MAAMhE,GAAGqD,WAAauC,EAAMY,OAAO,GACxClG,EAAK0D,MAAMhE,GAAGsD,SAAWsC,EAAMY,OAAOZ,EAAMY,OAAOC,OAAS,GAC5DnG,EAAK0D,MAAMhE,GAAG0G,cAAgBd,EAAMY,OAAOG,MAAM,EAAGf,EAAMY,OAAOC,OAAS,MAG5E7G,EAAGgH,aAAa,aAAc,CAC5BC,UAAW,SAAoB5D,EAAKC,GAClC,IAAI4D,EAAY,UACZC,EAAc,UACdC,EAAkB,KAClBC,EAAkB,KAClBC,EAAkB,KACN,UAAZjE,EAAIgC,OACN6B,EAAY,UACZC,EAAc,UACdC,EAAkB,UAClBC,EAAkB,UAClBC,EAAkB,WAEpB,IAAMC,EAAOjE,EAAMM,SAAS,OAAQ,CAClCC,MAAO,CACLF,EAAGX,EACHgB,GAAI,GACJ1C,MAAO,IACPkF,OAAQ,GACRgB,OAAQ,EACR1D,OAAQqD,EACRM,KAAM,WAAWP,EAAX,SAAqCA,EAArC,aAENQ,YAAa,EACbC,UAAW,KA8Cf,OA3CArE,EAAMM,SAAS,OAAQ,CACrBC,MAAO,CACLF,EAAGX,EAAS,GACZgB,EAAG,GACHyD,KAAML,GAAmB,OACzBQ,KAAM,GAAGvE,EAAI+B,KACbyC,SAAU,GACVC,WAAY,OAGhBxE,EAAMM,SAAS,OAAQ,CACrBC,MAAO,CACLF,EAAGX,EAAS,GACZgB,EAAG,GACHyD,KAAMJ,GAAmB,UACzBO,KAAM,GAAGvE,EAAIwB,KACbkD,aAAc,MACdF,SAAU,MAGdvE,EAAMM,SAAS,OAAQ,CACrBC,MAAO,CACLF,EAAGX,EAAS,GACZgB,EAAG,GACHyD,KAAMH,GAAmB,UACzBM,KAAM,GAAGvE,EAAIqB,KACbqD,aAAc,MACdF,SAAU,MAGE,UAAZxE,EAAIgC,MACN/B,EAAMM,SAAS,QAAS,CACtBC,MAAO,CACLF,EAAGX,EAAS,MACZgB,GAAI,GACJ1C,MAAO,GACPkF,OAAQ,GACRwB,IAAK,g6DAMJT,IAER,gBACHvH,EAAGiI,iBAAiB,gBAAiB,CACnCC,UAAS,WACP,MAAO,CACL,kBAAmB,eACnB,kBAAmB,iBAIvBC,aAAY,SAAEC,GACZ,GAA+B,UAA3BA,EAAG1C,KAAK2C,WAAWhD,KAAkB,CACvC,IAAMK,EAAO4C,EAAMC,SAAS,KAC5BD,EAAME,OAAO9C,EAAM,CACjB+C,MAAO,CACL3E,OAAQ,UACR2D,KAAM,yCACNiB,OAAQ,iBAGP,CACChD,EAAO0C,EAAG1C,KAChB4C,EAAME,OAAO9C,EAAM,CACjB+C,MAAO,CAEL3E,OAAQ,UACR2D,KAAM,yCACNiB,OAAQ,eAKhBC,aAAY,SAAEP,GACZ,GAA+B,UAA3BA,EAAG1C,KAAK2C,WAAWhD,KAAkB,CACvC,IAAMK,EAAO4C,EAAMC,SAAS,KAC5BD,EAAME,OAAO9C,EAAM,CACjB+C,MAAO,CACL3E,OAAQ,UACR2D,KAAM,yCACNiB,OAAQ,iBAGP,CACChD,EAAO0C,EAAG1C,KAChB4C,EAAME,OAAO9C,EAAM,CACjB+C,MAAO,CACL3E,OAAQ,UACR2D,KAAM,yCACNiB,OAAQ,iBAOlB1I,EAAGiI,iBAAiB,cAAe,CACjCW,cAAa,WACX,MAAO,CACLC,YAAa,GACbC,QAAS,GACTC,QAAS,IAGbb,UAAS,WACP,MAAO,CACLc,MAAO,YAGXC,QAAO,SAAEC,GAEP,GADAA,EAAEC,iBACG/H,KAAKgI,aAAaF,GAAvB,CAGA,IAAMZ,EAAQlH,KAAKkH,MACbe,EAASf,EAAMgB,IAAI,UACnBC,EAAQF,EAAOG,iBAAiBN,EAAEO,QAASP,EAAEQ,SAC7CC,EAAaN,EAAOC,IAAI,cACxBT,EAAczH,KAAKkI,IAAI,eACzBM,EAAQtB,EAAMuB,UAMZC,GAJJF,EADEV,EAAEa,WAAa,EACT,EA1BA,IA0BYlB,EAEZ,EA5BA,IA4BYA,GAEDP,EAAMuB,UACvBC,EAAO1I,KAAKkI,IAAI,YAAcQ,EAAO1I,KAAKkI,IAAI,aAGlDhB,EAAMwB,KAAKF,EAAO,CAAEjG,EAAG4F,EAAM5F,EAAIgG,EAAY3F,EAAGuF,EAAMvF,EAAI2F,IAC1DrB,EAAM0B,QACN1B,EAAM2B,KAAK,YAAaf,QAI5B,IAAMZ,EAAQ,IAAItI,EAAGmG,MAAM,CACzB+D,UAAW,YACX5I,MAAO2B,OAAOC,WACdsD,OAAQvD,OAAOkH,YAAc,GAC7BR,WAAY,EACZS,MAAO,CAGLC,QAAS,CAAC,cAAe,gBAAiB,gBAE5CC,YAAa,CACXzE,MAAO,aACP0E,aAAc,CAAC,CAAC,EAAG,IAAM,CAAC,EAAG,MAE/BC,UAAW,CAETH,QAAS,GAKTI,SAAU,CACR9C,UAAW,EACXD,YAAa,GACb5D,OAAQ,QAEV4G,OAAQ,CACN/C,UAAW,IACX7D,OAAQ,UACR4E,OAAQ,YAGZiC,YAAa,CAEX9E,MAAO,OAET+E,UAAW,CACTP,QAAS,CACPpG,UAAU,EACV0D,UAAW,EACX7D,OAAQ,WAIdwE,EAAM5H,KAAKA,GAQX4H,EAAMuC,GAAG,cAAc,SAACzK,GACtB,IAAM2F,EAAShE,EAAKvB,MAAMQ,UACpB8J,EAAS,CACbC,KAAM,IAAIC,mBACV7F,GAAI/E,EAAEsF,KAAKuF,KAAKC,MAAMtK,OACtBuK,UAAU,GAENC,EAAK,CACTC,SAAU,UACVC,OAAQlL,EAAEsF,KAAKuF,KAAKC,MAAMnG,OAC1BwG,OAAQnL,EAAEsF,KAAKuF,KAAKC,MAAMtK,QAEtB4K,EAAiB,MAEnBvI,OAAO8C,SAAW9C,QAAUA,OAAOwI,SAAWjK,GAAGS,KAAKyJ,WAAWC,MAAMC,YACzE3I,OAAOwI,QAAQI,YAAYzL,EAAEsF,KAAKuF,KAAKC,MAAMlG,SAAUoG,EAAI,CAAEvG,KAAM2G,EAAgB9K,KAAM,CAAEoL,UAAW1L,EAAEsF,KAAKuF,KAAKC,MAAM3G,QAEpHnE,EAAEsF,KAAKuF,KAAKC,MAAMjG,OACpBzD,GAAGC,MAAMsK,UAAU3L,EAAEsF,KAAKuF,KAAKC,MAAMjG,OAAQ,iBAAiBmG,EAAGE,OAAM,IAAIF,EAAGG,QAAU,SAAUS,GAChG,IAAMC,EAAS,MACfD,GAAW,WAAWC,EACtBzK,GAAG0K,OAAOC,eAAe,OAAQ,CAC/BC,OAAQH,EACRI,WAAW,EACXC,SAAU,WACVN,QAAO,GACNjG,OAGLqF,EAAGN,OAASA,EACZtJ,GAAG0K,OAAOC,eAAe,OAAQf,EAAIrF,OAK3CuC,EAAMiE,UAEFvJ,GAAU,KAAOF,EAAW,KAC9BwF,EAAMkE,UACFlE,EAAMuB,UAAY,GACpBvB,EAAMmE,OAAO,IA/ajB,SAAS7J,EAAa8J,GAGpB,IAAIC,EAAM,EAaV,OAZA,SAASC,EAAMlM,EAAMmM,GACnBnM,EAAK+E,SAAQ,SAAAyD,GACXA,EAAE2D,MAAQA,EACNA,EAAQF,IACVA,EAAME,GAEJ3D,EAAE/E,OAAS+E,EAAE/E,MAAM0C,OAAS,GAC9B+F,EAAK1D,EAAE/E,MAAO0I,EAAQ,MAI5BD,CAAKF,EAAU,GACRC,OA2aX,YAAAG,YAAA,SAAaC,GACX3L,KAAKlB,MAAM8M,QAAQD,GACnB3L,KAAKZ,MAAMQ,UAAUT,QAAQ,SAG/B,YAAAgM,OAAA,sBACUQ,EAAU3L,KAAKlB,MAAK,MAC5B,OACE,6BACE,yBAAK+M,UAAU,+BACb,kBAAC,SAAM,CAACC,QAAS,WAAM,SAAKJ,YAAYC,KACtC,kBAAC,IAAO,CAAC1H,KAAK,aACd,0BAAM4H,UAAU,oBAAkB,QAGtC,yBAAKA,UAAU,oCACb,yBAAK9H,GAAG,iBAKpB,EA3fA,CAAuB,aAwgBR,6BAZS,SAAC3E,GACvB,MAAO,CACL2M,OAAQ3M,EAAM2M,OAAOC,WAIzB,SAA6BC,GAC3B,OAAO,EAAP,GACK,YAAmB,EAAeA,MAI1B,CAA6CC","file":"public/javascripts/4.bundle.js?_=9caee9a6-182a-4097-97f1-f68638de0d5e","sourcesContent":["import React, { Component } from 'react';\nimport env from '../../../helpers/env';\nimport SvgIcon from '../../common/SvgIcon';\nimport { Button } from '@mdf/baseui';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport uuid from 'uuid';\nimport * as portalactions from '../../../redux/portal';\nconst G6 = process.env.__CLIENT__ && require('@antv/g6');\nconst dagre = require('dagre');\n/**\n * 传入billNumber和billId\n * 通过common.doProxy()发送请求然后调用回调函数\n * res赋值给json，处理json\n */\n\nclass ShowFlow extends Component {\n  constructor (props) {\n    super(props);\n    this.state = {\n      billNumber: this.props.data.billNum || 'pu_arrivalorder',\n      billId: this.props.data.billId || 1220905394262272,\n      childIds: this.props.data.childIds || null,\n      childKey: this.props.data.childKey || null,\n      // billNumber: \"pu_arrivalorder\",\n      // billId: 1220905394262272,\n      jsonData: {},\n      viewModel: this.props.data.parentViewModel,\n      flowWidth: 1280\n    }\n  }\n\n  componentWillReceiveProps (nextProps) {\n    this.setState({\n      viewModel: nextProps.data.parentViewModel,\n      flowWidth: nextProps.width\n    })\n    if (!nextProps.callback || nextProps.callback === this.props.callback) return;\n    cb.utils.confirm(cb.locale('P_YS_FED_FW_0001026038', {abandonText: nextProps.caption}), function () {\n      nextProps.callback();\n    });\n  }\n\n  componentDidMount () {\n    const that = this;\n    const thisdata = {};\n    thisdata.billNumber = this.state.billNumber;\n    thisdata.billId = this.state.billId;\n    if (this.state.childKey !== null) {\n      thisdata.childIds = this.state.childIds;\n      thisdata.childKey = this.state.childKey;\n    }\n    const proxy = cb.rest.DynamicProxy.create({ map: { url: 'billrelation/map', method: 'POST' } });\n    function thisCallBack (err, res) {\n      if (err) {\n        console.log(err);\n        return;\n      }\n      console.log(res);\n      function getMaxFloor (treeData) {\n        // let floor = 0\n        // let v = this\n        let max = 0\n        function each (data, floor) {\n          data.forEach(e => {\n            e.floor = floor\n            if (floor > max) {\n              max = floor\n            }\n            if (e.nodes && e.nodes.length > 0) {\n              each(e.nodes, floor + 1)\n            }\n          })\n        }\n        each(treeData, 1)\n        return max\n      }\n      const resu = getMaxFloor(res.upperNodes);// 获取upperNodes的层数\n      const downresu = getMaxFloor(res.downNodes);// 获取downNodes的层数\n      const currentWidth = window.innerWidth / 2 - 115;\n      const startX = currentWidth - 280 * resu - 115;// 最左边节点相对于中点的偏移\n\n      // var imgObj = new Image();\n      // imgObj.src = './voucher.png';\n\n      // 自定义边\n      G6.registerEdge('hvh', {\n        draw (cfg, group) {\n          let offset = 0;\n          let MinOffset = 0;\n          const startPoint = cfg.startPoint;\n          const endPoint = cfg.endPoint;\n          if ((startX + 280 < 0 || startX < 0) && endPoint.x - startPoint.x > 50) {\n            offset = -230\n          } else if ((280 - startX < 115 || startX > 0) && endPoint.x - startPoint.x > 50) {\n            MinOffset = 230\n          }\n          const shape = group.addShape('path', {\n            attrs: {\n              stroke: '#D9D9D9',\n              path: [\n                ['M', startPoint.x + MinOffset, startPoint.y],\n                ['L', (endPoint.x + offset) / 3 + 2 / 3 * (startPoint.x + MinOffset), startPoint.y],\n                ['L', (endPoint.x + offset) / 3 + 2 / 3 * (startPoint.x + MinOffset), endPoint.y],\n                ['L', endPoint.x + offset - 4, endPoint.y]\n              ],\n              endArrow: {\n                // path 的 width, height, radius 是基于线宽来计算的，详情可见源码。\n                path: [\n                  ['M', -6, 6],\n                  ['L', 6, 0],\n                  ['L', -6, -6],\n                  ['A', 11, 11, 0, 0, 1, -6, 6],\n                  ['Z']\n                ],\n                d: 6\n              },\n\n            }\n          });\n          return shape;\n        }\n      });\n      const data = {\n        nodes: [],\n        edges: []\n      }\n      let thisCount = 0;\n      if (res) {\n        data.nodes.push({\n          node: res,\n          label: `${res.billName}`,\n          date: (res.vouchdate && `${res.vouchdate.substring(0, 10)}`) || '',\n          code: `${res.billCode}`,\n          number: `${res.billNumber}`,\n          menuCode: `${res.menuCode}`,\n          srvUrl: res.isCrossDomain && res.srvUrl,\n          id: `${thisCount}`,\n          billId: `${res.billId}`,\n          name: `${res.billName}`,\n          type: 'center'\n        });\n        if (res.downNodes) {\n          handleDownNodes(res.downNodes, thisCount);\n        }\n        if (res.upperNodes) {\n          handleUpperNodes(res.upperNodes, 0);\n        }\n      }\n      function handleDownNodes (nodesData, count) {\n        nodesData.forEach((item) => {\n          thisCount += 1;\n          data.nodes.push({\n            node: item,\n            label: `${item.billName}`,\n            date: (item.vouchdate && `${item.vouchdate.substring(0, 10)}`) || '',\n            code: `${item.billCode}`,\n            number: `${item.billNumber}`,\n            menuCode: `${item.menuCode}`,\n            srvUrl: item.isCrossDomain && item.srvUrl,\n            id: `${thisCount}`,\n            billId: `${item.billId}`,\n            name: `${item.billName}`\n          });\n          data.edges.push({\n            source: `${count}`,\n            target: `${thisCount}`,\n            shape: 'hvh'\n          });\n          if (item.nodes) {\n            handleDownNodes(item.nodes, thisCount);\n          }\n        })\n      }\n      function handleUpperNodes (nodesData, parent) {\n        // let thisCount = count;\n        nodesData.forEach((item) => {\n          thisCount += 1;\n          data.nodes.push({\n            node: item,\n            label: `${item.billName}`,\n            date: (item.vouchdate && `${item.vouchdate.substring(0, 10)}`) || '',\n            code: `${item.billCode}`,\n            number: `${item.billNumber}`,\n            menuCode: `${item.menuCode}`,\n            srvUrl: item.isCrossDomain && item.srvUrl,\n            id: `${thisCount}`,\n            billId: `${item.billId}`,\n            name: `${item.billName}`\n          });\n          data.edges.push({\n            source: `${thisCount}`,\n            target: `${parent}`,\n            shape: 'hvh'\n          });\n          if (item.nodes) {\n            handleUpperNodes(item.nodes, thisCount);\n          }\n        });\n      }\n\n      const g = new dagre.graphlib.Graph();\n      g.setDefaultEdgeLabel(function () {\n        return {};\n      });\n      g.setGraph({\n        rankdir: 'LR'\n      });\n      data.nodes.forEach(function (node) {\n        node.label = '';\n        g.setNode(node.id, {\n          width: 230,\n          height: 90\n        });\n      });\n      data.edges.forEach(function (edge) {\n        g.setEdge(edge.source, edge.target);\n      });\n      dagre.layout(g);\n      let coord\n      g.nodes().forEach(function (node, i) {\n        coord = g.node(node);\n        data.nodes[i].x = coord.x;\n        data.nodes[i].y = coord.y;\n      });\n      g.edges().forEach(function (edge, i) {\n        coord = g.edge(edge);\n        data.edges[i].startPoint = coord.points[0];\n        data.edges[i].endPoint = coord.points[coord.points.length - 1];\n        data.edges[i].controlPoints = coord.points.slice(1, coord.points.length - 1);\n      });\n      // 自定义节点\n      G6.registerNode('vocherrect', {\n        drawShape: function drawShape (cfg, group) {\n          let fillColor = '#FD9839';\n          let strokeColor = '#CDCDCD';\n          let centerNameColor = null;\n          let centerCodeColor = null;\n          let centerDateColor = null;\n          if (cfg.type == 'center') {\n            fillColor = '#9ECAFF';\n            strokeColor = '#9ECAFF';\n            centerNameColor = '#0072FF';\n            centerCodeColor = '#0072FF';\n            centerDateColor = '#5DA0FF';\n          }\n          const rect = group.addShape('rect', {\n            attrs: {\n              x: startX,\n              y: -20,\n              width: 230,\n              height: 90,\n              radius: 3,\n              stroke: strokeColor,\n              fill: `l (0) 0:${fillColor} ` + 0.01 + `:${fillColor} ` + 0.01 + ':#fff',\n              // fill: fillColor,//决定可拖动node区域覆盖\n              fillOpacity: 1,\n              lineWidth: 1\n            }\n          });\n          group.addShape('text', {\n            attrs: {\n              x: startX + 16,\n              y: 10,\n              fill: centerNameColor || '#333',\n              text: `${cfg.name}`,\n              fontSize: 14,\n              fontWeight: 510\n            }\n          })\n          group.addShape('text', {\n            attrs: {\n              x: startX + 16,\n              y: 18,\n              fill: centerCodeColor || '#666666',\n              text: `${cfg.code}`,\n              textBaseline: 'top',\n              fontSize: 12,\n            }\n          })\n          group.addShape('text', {\n            attrs: {\n              x: startX + 16,\n              y: 40,\n              fill: centerDateColor || '#BAC0C7',\n              text: `${cfg.date}`,\n              textBaseline: 'top',\n              fontSize: 12,\n            }\n          });\n          if (cfg.type == 'center') {\n            group.addShape('image', {\n              attrs: {\n                x: startX + 200.8,\n                y: -26,\n                width: 32,\n                height: 30,\n                img: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMywgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojMDA3MkZGO30KCS5zdDF7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZmlsbDojRkZGRkZGO30KPC9zdHlsZT4KPHRpdGxlPuWOn+WNleaNrjwvdGl0bGU+CjxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgo8cGF0aCBpZD0i55+p5b2iIiBjbGFzcz0ic3QwIiBkPSJNOTcsMjE2aDcxMS40YzY1LjUsMCwxMTguNiw1My4xLDExOC42LDExOC42djQ3NC4zbC0zMDMuNCwwYy0xNzMuMiwwLTMyMC44LTEyNS41LTM0OC43LTI5Ni40bDAsMAoJQzI1Mi4zLDM3NC4xLDE5MywyNzUuMyw5NywyMTZ6Ii8+CjxwYXRoIGlkPSLljp8iIGNsYXNzPSJzdDEiIGQ9Ik01NDMsNDEwLjhoNTIuNGMzLjctOS4zLDcuMS0xOC44LDEwLjQtMjguN2gtOTQuOXY3OC43YzAsNDQuOC0yLjYsNzcuOC03LjgsOTkKCWMtNS4yLDIyLjgtMTUuOSw0NS45LTMyLjEsNjkuNWMtNC44LTYuNi0xMC4yLTEzLjItMTYuMi0yMGMxMy4zLTE5LjksMjIuMS0zOS41LDI2LjMtNTguOGM0LjQtMTguMyw2LjctNDYuNSw2LjctODQuNVYzNjFoMjUzdjIxLjEKCUg2MzEuM2MtNC4zLDEwLjQtOC41LDIwLTEyLjYsMjguN2g5OC45djExOC43aC0yMS43di01LjhoLTUzLjZ2NjQuOGMwLDI0LjMtMTEsMzYuNC0zMywzNi4yYy02LjgsMC0xOC45LTAuMi0zNi41LTAuNgoJYy0wLjgtNy4zLTItMTUuNy0zLjgtMjUuMmMxNS4xLDEuOSwyNi45LDIuOSwzNS42LDIuOWM5LjYsMCwxNC41LTUuNiwxNC41LTE2Ljh2LTYxLjRoLTU0LjR2NS44SDU0M1Y0MTAuOHogTTU2NC43LDUwNC4zaDEzMS4xCgl2LTI3LjhINTY0LjdWNTA0LjN6IE02OTUuOSw0MzAuMkg1NjQuN3YyNy41aDEzMS4xVjQzMC4yeiBNNTY3LjksNTM1bDIwLDEzYy0xOC43LDI3LjgtMzguOSw1Mi40LTYwLjUsNzMuOAoJYy01LTQuMi0xMS4zLTktMTguOC0xNC4yQzUyOC4xLDU4OS43LDU0Ny45LDU2NS41LDU2Ny45LDUzNXogTTY4MC44LDUzNS42YzI1LjEsMjMuNyw0Ni41LDQ1LjcsNjQuMyw2Nkw3MjUuNyw2MTkKCWMtMTguNS0yMy41LTM5LjItNDYuNy02MS45LTY5LjVMNjgwLjgsNTM1LjZ6Ii8+Cjwvc3ZnPgo='\n                // img: 'http://u8cmallserver-daily.yyuap.com/photo/carousel/182/64f8edd0-61de-406c-8691-72b3dd1451d1.jpg'\n              }\n            });\n          }\n\n          return rect;\n        }\n      }, 'single-shape');\n      G6.registerBehavior('center-active', {\n        getEvents () {\n          return {\n            'node:mouseenter': 'onMouseenter',\n            'node:mouseleave': 'onMouseleave'\n          };\n        },\n\n        onMouseenter (ev) {\n          if (ev.item.getModel().type == 'center') {\n            const item = graph.findById('0');\n            graph.update(item, {\n              style: {\n                stroke: '#0072FF',\n                fill: 'l (0) 0:#0072FF ' + 0.01 + ':#0072FF ' + 0.01 + ':#fff',\n                cursor: 'pointer'\n              }\n            })\n          } else {\n            const item = ev.item;\n            graph.update(item, {\n              style: {\n                // stroke: '#505766',\n                stroke: '#FD9839',\n                fill: 'l (0) 0:#FD9839 ' + 0.01 + ':#FD9839 ' + 0.01 + ':#fff',\n                cursor: 'pointer'\n              }\n            })\n          }\n        },\n        onMouseleave (ev) {\n          if (ev.item.getModel().type == 'center') {\n            const item = graph.findById('0');\n            graph.update(item, {\n              style: {\n                stroke: '#9ECAFF',\n                fill: 'l (0) 0:#9ECAFF ' + 0.01 + ':#9ECAFF ' + 0.01 + ':#fff',\n                cursor: 'default'\n              }\n            })\n          } else {\n            const item = ev.item;\n            graph.update(item, {\n              style: {\n                stroke: '#CDCDCD',\n                fill: 'l (0) 0:#FD9839 ' + 0.01 + ':#FD9839 ' + 0.01 + ':#fff',\n                cursor: 'default'\n              }\n            })\n          }\n        }\n      });\n      const DELTA = 0.05;\n      G6.registerBehavior('zoom-canvas', {\n        getDefaultCfg () {\n          return {\n            sensitivity: 0.5,\n            minZoom: 0.2,\n            maxZoom: 1\n          };\n        },\n        getEvents () {\n          return {\n            wheel: 'onWheel'\n          };\n        },\n        onWheel (e) {\n          e.preventDefault();\n          if (!this.shouldUpdate(e)) {\n            return;\n          }\n          const graph = this.graph;\n          const canvas = graph.get('canvas');\n          const point = canvas.getPointByClient(e.clientX, e.clientY);\n          const pixelRatio = canvas.get('pixelRatio');\n          const sensitivity = this.get('sensitivity');\n          let ratio = graph.getZoom();\n          if (e.wheelDelta < 0) {\n            ratio = 1 - DELTA * sensitivity;\n          } else {\n            ratio = 1 + DELTA * sensitivity;\n          }\n          const zoom = ratio * graph.getZoom();\n          if (zoom < this.get('minZoom') || zoom > this.get('maxZoom')) {\n            return;\n          }\n          graph.zoom(ratio, { x: point.x / pixelRatio, y: point.y / pixelRatio });\n          graph.paint();\n          graph.emit('wheelzoom', e);\n        }\n      });\n\n      const graph = new G6.Graph({\n        container: 'mountNode',\n        width: window.innerWidth,\n        height: window.innerHeight - 65,\n        pixelRatio: 2,\n        modes: {\n          // 拖动、放大缩小\n          // default: ['drag-canvas', 'zoom-canvas']\n          default: ['drag-canvas', 'center-active', 'zoom-canvas']\n        },\n        defaultNode: {\n          shape: 'vocherrect',\n          anchorPoints: [[0, 0.5], [1, 0.5]]\n        },\n        nodeStyle: {\n          // 节点在默认状态下的样式\n          default: {\n            // fill: '#40a9ff',\n            // stroke: '#096dd9'\n          },\n          // 当节点在 selected 状态下的样式\n          selected: {\n            lineWidth: 2,\n            fillOpacity: 0.8,\n            stroke: '#000'\n          },\n          active: {\n            lineWidth: 1.5,\n            stroke: '#505766',\n            cursor: 'pointer'\n          }\n        },\n        defaultEdge: {\n          // shape: 'cubic-horizontal'//内置边的形状\n          shape: 'hvh'\n        },\n        edgeStyle: {\n          default: {\n            endArrow: true,\n            lineWidth: 2,\n            stroke: '#ccc'\n          }\n        }\n      });\n      graph.data(data);\n\n      // graph.on('node:mouseenter', function (e) {\n      //     graph.setItemState(e.item, 'active', true);\n      // });\n      // graph.on('node:mouseleave', function (e) {\n      //     graph.setItemState(e.item, 'active', false);\n      // });\n      graph.on('node:click', (i) => { // 点击事件\n        const parent = that.state.viewModel;\n        const params = {\n          mode: env.VOUCHER_STATE_EDIT,\n          id: i.item._cfg.model.billId,\n          readOnly: true\n        }\n        const dt = {\n          billtype: 'voucher',\n          billno: i.item._cfg.model.number,\n          billid: i.item._cfg.model.billId,\n        }\n        const tempCustomCode = uuid();\n        // cb.loader.runCommandLine('menu', dt, parent)\n        if (window.parent !== window && window.jDiwork && cb.rest.AppContext.query.serviceCode) {\n          window.jDiwork.openService(i.item._cfg.model.menuCode, dt, { code: tempCustomCode, data: { carryNode: i.item._cfg.model.node } })\n        } else {\n          if (i.item._cfg.model.srvUrl) {\n            cb.utils.getWebUrl(i.item._cfg.model.srvUrl, `/meta/voucher/${dt.billno}/${dt.billid}`, function (menuUrl) {\n              const random = uuid();\n              menuUrl += `&random=${random}`;\n              cb.loader.runCommandLine('menu', {\n                menuId: random,\n                userClick: true,\n                viewType: 'external',\n                menuUrl\n              }, parent);\n            });\n          } else {\n            dt.params = params;\n            cb.loader.runCommandLine('bill', dt, parent);\n          }\n        }\n      });\n\n      graph.render();\n      // 适应窗口\n      if (startX < -115 || downresu > 1) {\n        graph.fitView();\n        if (graph.getZoom() > 1) {\n          graph.zoomTo(1);\n        }\n      }\n    }\n    proxy.map(thisdata, thisCallBack);\n  }\n\n    handleDblClick = (i) => {\n      const gridModel = this.props.parentViewModel.getGridModel();\n      gridModel.execute('dblClick', {});\n    }\n\n    handleClick (index) {\n      this.props.delItem(index);\n      this.state.viewModel.execute('back');\n    }\n\n    render () {\n      const { index } = this.props;\n      return (\n        <div>\n          <div className='voucher-back-button-wrapper'>\n            <Button onClick={() => this.handleClick(index)}>\n              <SvgIcon type='rollback' />\n              <span className='voucher-rollback'>返回</span>\n            </Button>\n          </div>\n          <div className='voucher-showflow-content-wrapper'>\n            <div id='mountNode' />\n          </div>\n        </div>\n      )\n    }\n}\nconst mapStateToProps = (state) => {\n  return {\n    portal: state.portal.toJS()\n  }\n}\n\nfunction mapDispatchToProps (dispatch) {\n  return {\n    ...bindActionCreators(portalactions, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ShowFlow)\n"],"sourceRoot":""}