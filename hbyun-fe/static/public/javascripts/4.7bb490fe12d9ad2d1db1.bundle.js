(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1859:function(e,t,o){"use strict";o.r(t);var n,i=o(0),l=o.n(i),r=o(34),a=o(19),d=o(2),s=o(30),c=o(35),u=o(126),h=o.n(u),p=o(94),m=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),M=function(){return(M=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},f=o(752),N=o(753),y=function(e){function t(t){var o=e.call(this,t)||this;return o.handleDblClick=function(e){o.props.parentViewModel.getGridModel().execute("dblClick",{})},o.state={billNumber:o.props.data.billNum||"pu_arrivalorder",billId:o.props.data.billId||0x4566830545100,childIds:o.props.data.childIds||null,childKey:o.props.data.childKey||null,jsonData:{},viewModel:o.props.data.parentViewModel,flowWidth:1280},o}return m(t,e),t.prototype.componentWillReceiveProps=function(e){this.setState({viewModel:e.data.parentViewModel,flowWidth:e.width}),e.callback&&e.callback!==this.props.callback&&cb.utils.confirm(cb.locale("P_YS_FED_FW_0001026038",{abandonText:e.caption}),(function(){e.callback()}))},t.prototype.componentDidMount=function(){var e=this,t={};t.billNumber=this.state.billNumber,t.billId=this.state.billId,null!==this.state.childKey&&(t.childIds=this.state.childIds,t.childKey=this.state.childKey),cb.rest.DynamicProxy.create({map:{url:"billrelation/map",method:"POST"}}).map(t,(function(t,o){if(t)console.log(t);else{console.log(o);var n=p(o.upperNodes),i=p(o.downNodes),l=window.innerWidth/2-115-280*n-115;f.registerEdge("hvh",{draw:function(e,t){var o=0,n=0,i=e.startPoint,r=e.endPoint;return(l+280<0||l<0)&&r.x-i.x>50?o=-230:(280-l<115||l>0)&&r.x-i.x>50&&(n=230),t.addShape("path",{attrs:{stroke:"#D9D9D9",path:[["M",i.x+n,i.y],["L",(r.x+o)/3+2/3*(i.x+n),i.y],["L",(r.x+o)/3+2/3*(i.x+n),r.y],["L",r.x+o-4,r.y]],endArrow:{path:[["M",-6,6],["L",6,0],["L",-6,-6],["A",11,11,0,0,1,-6,6],["Z"]],d:6}}})}});var a={nodes:[],edges:[]},d=0;o&&(a.nodes.push({node:o,label:""+o.billName,date:o.vouchdate&&""+o.vouchdate.substring(0,10)||"",code:""+o.billCode,number:""+o.billNumber,menuCode:""+o.menuCode,srvUrl:o.isCrossDomain&&o.srvUrl,id:""+d,billId:""+o.billId,name:""+o.billName,type:"center"}),o.downNodes&&function e(t,o){t.forEach((function(t){d+=1,a.nodes.push({node:t,label:""+t.billName,date:t.vouchdate&&""+t.vouchdate.substring(0,10)||"",code:""+t.billCode,number:""+t.billNumber,menuCode:""+t.menuCode,srvUrl:t.isCrossDomain&&t.srvUrl,id:""+d,billId:""+t.billId,name:""+t.billName}),a.edges.push({source:""+o,target:""+d,shape:"hvh"}),t.nodes&&e(t.nodes,d)}))}(o.downNodes,d),o.upperNodes&&function e(t,o){t.forEach((function(t){d+=1,a.nodes.push({node:t,label:""+t.billName,date:t.vouchdate&&""+t.vouchdate.substring(0,10)||"",code:""+t.billCode,number:""+t.billNumber,menuCode:""+t.menuCode,srvUrl:t.isCrossDomain&&t.srvUrl,id:""+d,billId:""+t.billId,name:""+t.billName}),a.edges.push({source:""+d,target:""+o,shape:"hvh"}),t.nodes&&e(t.nodes,d)}))}(o.upperNodes,0));var s,c=new N.graphlib.Graph;c.setDefaultEdgeLabel((function(){return{}})),c.setGraph({rankdir:"LR"}),a.nodes.forEach((function(e){e.label="",c.setNode(e.id,{width:230,height:90})})),a.edges.forEach((function(e){c.setEdge(e.source,e.target)})),N.layout(c),c.nodes().forEach((function(e,t){s=c.node(e),a.nodes[t].x=s.x,a.nodes[t].y=s.y})),c.edges().forEach((function(e,t){s=c.edge(e),a.edges[t].startPoint=s.points[0],a.edges[t].endPoint=s.points[s.points.length-1],a.edges[t].controlPoints=s.points.slice(1,s.points.length-1)})),f.registerNode("vocherrect",{drawShape:function(e,t){var o="#FD9839",n="#CDCDCD",i=null,r=null,a=null;"center"==e.type&&(o="#9ECAFF",n="#9ECAFF",i="#0072FF",r="#0072FF",a="#5DA0FF");var d=t.addShape("rect",{attrs:{x:l,y:-20,width:230,height:90,radius:3,stroke:n,fill:"l (0) 0:"+o+" 0.01:"+o+" 0.01:#fff",fillOpacity:1,lineWidth:1}});return t.addShape("text",{attrs:{x:l+16,y:10,fill:i||"#333",text:""+e.name,fontSize:14,fontWeight:510}}),t.addShape("text",{attrs:{x:l+16,y:18,fill:r||"#666666",text:""+e.code,textBaseline:"top",fontSize:12}}),t.addShape("text",{attrs:{x:l+16,y:40,fill:a||"#BAC0C7",text:""+e.date,textBaseline:"top",fontSize:12}}),"center"==e.type&&t.addShape("image",{attrs:{x:l+200.8,y:-26,width:32,height:30,img:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMywgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojMDA3MkZGO30KCS5zdDF7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZmlsbDojRkZGRkZGO30KPC9zdHlsZT4KPHRpdGxlPuWOn+WNleaNrjwvdGl0bGU+CjxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgo8cGF0aCBpZD0i55+p5b2iIiBjbGFzcz0ic3QwIiBkPSJNOTcsMjE2aDcxMS40YzY1LjUsMCwxMTguNiw1My4xLDExOC42LDExOC42djQ3NC4zbC0zMDMuNCwwYy0xNzMuMiwwLTMyMC44LTEyNS41LTM0OC43LTI5Ni40bDAsMAoJQzI1Mi4zLDM3NC4xLDE5MywyNzUuMyw5NywyMTZ6Ii8+CjxwYXRoIGlkPSLljp8iIGNsYXNzPSJzdDEiIGQ9Ik01NDMsNDEwLjhoNTIuNGMzLjctOS4zLDcuMS0xOC44LDEwLjQtMjguN2gtOTQuOXY3OC43YzAsNDQuOC0yLjYsNzcuOC03LjgsOTkKCWMtNS4yLDIyLjgtMTUuOSw0NS45LTMyLjEsNjkuNWMtNC44LTYuNi0xMC4yLTEzLjItMTYuMi0yMGMxMy4zLTE5LjksMjIuMS0zOS41LDI2LjMtNTguOGM0LjQtMTguMyw2LjctNDYuNSw2LjctODQuNVYzNjFoMjUzdjIxLjEKCUg2MzEuM2MtNC4zLDEwLjQtOC41LDIwLTEyLjYsMjguN2g5OC45djExOC43aC0yMS43di01LjhoLTUzLjZ2NjQuOGMwLDI0LjMtMTEsMzYuNC0zMywzNi4yYy02LjgsMC0xOC45LTAuMi0zNi41LTAuNgoJYy0wLjgtNy4zLTItMTUuNy0zLjgtMjUuMmMxNS4xLDEuOSwyNi45LDIuOSwzNS42LDIuOWM5LjYsMCwxNC41LTUuNiwxNC41LTE2Ljh2LTYxLjRoLTU0LjR2NS44SDU0M1Y0MTAuOHogTTU2NC43LDUwNC4zaDEzMS4xCgl2LTI3LjhINTY0LjdWNTA0LjN6IE02OTUuOSw0MzAuMkg1NjQuN3YyNy41aDEzMS4xVjQzMC4yeiBNNTY3LjksNTM1bDIwLDEzYy0xOC43LDI3LjgtMzguOSw1Mi40LTYwLjUsNzMuOAoJYy01LTQuMi0xMS4zLTktMTguOC0xNC4yQzUyOC4xLDU4OS43LDU0Ny45LDU2NS41LDU2Ny45LDUzNXogTTY4MC44LDUzNS42YzI1LjEsMjMuNyw0Ni41LDQ1LjcsNjQuMyw2Nkw3MjUuNyw2MTkKCWMtMTguNS0yMy41LTM5LjItNDYuNy02MS45LTY5LjVMNjgwLjgsNTM1LjZ6Ii8+Cjwvc3ZnPgo="}}),d}},"single-shape"),f.registerBehavior("center-active",{getEvents:function(){return{"node:mouseenter":"onMouseenter","node:mouseleave":"onMouseleave"}},onMouseenter:function(e){if("center"==e.item.getModel().type){var t=u.findById("0");u.update(t,{style:{stroke:"#0072FF",fill:"l (0) 0:#0072FF 0.01:#0072FF 0.01:#fff",cursor:"pointer"}})}else{t=e.item;u.update(t,{style:{stroke:"#FD9839",fill:"l (0) 0:#FD9839 0.01:#FD9839 0.01:#fff",cursor:"pointer"}})}},onMouseleave:function(e){if("center"==e.item.getModel().type){var t=u.findById("0");u.update(t,{style:{stroke:"#9ECAFF",fill:"l (0) 0:#9ECAFF 0.01:#9ECAFF 0.01:#fff",cursor:"default"}})}else{t=e.item;u.update(t,{style:{stroke:"#CDCDCD",fill:"l (0) 0:#FD9839 0.01:#FD9839 0.01:#fff",cursor:"default"}})}}});f.registerBehavior("zoom-canvas",{getDefaultCfg:function(){return{sensitivity:.5,minZoom:.2,maxZoom:1}},getEvents:function(){return{wheel:"onWheel"}},onWheel:function(e){if(e.preventDefault(),this.shouldUpdate(e)){var t=this.graph,o=t.get("canvas"),n=o.getPointByClient(e.clientX,e.clientY),i=o.get("pixelRatio"),l=this.get("sensitivity"),r=t.getZoom(),a=(r=e.wheelDelta<0?1-.05*l:1+.05*l)*t.getZoom();a<this.get("minZoom")||a>this.get("maxZoom")||(t.zoom(r,{x:n.x/i,y:n.y/i}),t.paint(),t.emit("wheelzoom",e))}}});var u=new f.Graph({container:"mountNode",width:window.innerWidth,height:window.innerHeight-65,pixelRatio:2,modes:{default:["drag-canvas","center-active","zoom-canvas"]},defaultNode:{shape:"vocherrect",anchorPoints:[[0,.5],[1,.5]]},nodeStyle:{default:{},selected:{lineWidth:2,fillOpacity:.8,stroke:"#000"},active:{lineWidth:1.5,stroke:"#505766",cursor:"pointer"}},defaultEdge:{shape:"hvh"},edgeStyle:{default:{endArrow:!0,lineWidth:2,stroke:"#ccc"}}});u.data(a),u.on("node:click",(function(t){var o=e.state.viewModel,n={mode:r.a.VOUCHER_STATE_EDIT,id:t.item._cfg.model.billId,readOnly:!0},i={billtype:"voucher",billno:t.item._cfg.model.number,billid:t.item._cfg.model.billId},l=h()();window.parent!==window&&window.jDiwork&&cb.rest.AppContext.query.serviceCode?window.jDiwork.openService(t.item._cfg.model.menuCode,i,{code:l,data:{carryNode:t.item._cfg.model.node}}):t.item._cfg.model.srvUrl?cb.utils.getWebUrl(t.item._cfg.model.srvUrl,"/meta/voucher/"+i.billno+"/"+i.billid,(function(e){var t=h()();e+="&random="+t,cb.loader.runCommandLine("menu",{menuId:t,userClick:!0,viewType:"external",menuUrl:e},o)})):(i.params=n,cb.loader.runCommandLine("bill",i,o))})),u.render(),(l<-115||i>1)&&(u.fitView(),u.getZoom()>1&&u.zoomTo(1))}function p(e){var t=0;return function e(o,n){o.forEach((function(o){o.floor=n,n>t&&(t=n),o.nodes&&o.nodes.length>0&&e(o.nodes,n+1)}))}(e,1),t}}))},t.prototype.handleClick=function(e){this.props.delItem(e),this.state.viewModel.execute("back")},t.prototype.render=function(){var e=this,t=this.props.index;return l.a.createElement("div",null,l.a.createElement("div",{className:"voucher-back-button-wrapper"},l.a.createElement(d.Button,{onClick:function(){return e.handleClick(t)}},l.a.createElement(a.a,{type:"rollback"}),l.a.createElement("span",{className:"voucher-rollback"},"返回"))),l.a.createElement("div",{className:"voucher-showflow-content-wrapper"},l.a.createElement("div",{id:"mountNode"})))},t}(i.Component);t.default=Object(s.connect)((function(e){return{portal:e.portal.toJS()}}),(function(e){return M({},Object(c.a)(p,e))}))(y)}}]);
//# sourceMappingURL=4.7bb490fe12d9ad2d1db1.bundle.js.map